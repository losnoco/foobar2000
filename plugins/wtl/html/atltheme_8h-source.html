<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>atltheme.h Source File</title>
<link href="mystyles.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>atltheme.h</h1><a href="atltheme_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// Windows Template Library - WTL version 7.0</font>
00002 <font class="comment">// Copyright (C) 1997-2002 Microsoft Corporation</font>
00003 <font class="comment">// All rights reserved.</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// This file is a part of the Windows Template Library.</font>
00006 <font class="comment">// The code and information is provided "as-is" without</font>
00007 <font class="comment">// warranty of any kind, either expressed or implied.</font>
00008 
00009 <font class="preprocessor">#ifndef __ATLTHEME_H__</font>
00010 <font class="preprocessor"></font><font class="preprocessor">#define __ATLTHEME_H__</font>
00011 <font class="preprocessor"></font>
00012 <font class="preprocessor">#pragma once</font>
00013 <font class="preprocessor"></font>
00014 <font class="preprocessor">#ifndef __cplusplus</font>
00015 <font class="preprocessor"></font><font class="preprocessor">    #error ATL requires C++ compilation (use a .cpp suffix)</font>
00016 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00017 <font class="preprocessor"></font>
00018 <font class="preprocessor">#ifndef __ATLAPP_H__</font>
00019 <font class="preprocessor"></font><font class="preprocessor">    #error atltheme.h requires atlapp.h to be included first</font>
00020 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00021 <font class="preprocessor"></font>
00022 <font class="preprocessor">#ifndef __ATLWIN_H__</font>
00023 <font class="preprocessor"></font><font class="preprocessor">    #error atltheme.h requires atlwin.h to be included first</font>
00024 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00025 <font class="preprocessor"></font>
00026 <font class="preprocessor">#if (_WIN32_WINNT &lt; 0x0501)</font>
00027 <font class="preprocessor"></font><font class="preprocessor">    #error atltheme.h requires _WIN32_WINNT &gt;= 0x0501</font>
00028 <font class="preprocessor"></font><font class="preprocessor">#endif //(_WIN32_WINNT &lt; 0x0501)</font>
00029 <font class="preprocessor"></font>
00030 <font class="preprocessor">#include &lt;tmschema.h&gt;</font>
00031 <font class="preprocessor">#include &lt;uxtheme.h&gt;</font>
00032 <font class="preprocessor">#pragma comment(lib, "uxtheme.lib")</font>
00033 <font class="preprocessor"></font>
00034 <font class="comment">// Note: To create an application that also runs on older versions of Windows,</font>
00035 <font class="comment">// use delay load of uxtheme.dll and ensure that no calls to the Theme API are</font>
00036 <font class="comment">// made if theming is not supported. It is enough to check if m_hTheme is NULL.</font>
00037 <font class="comment">// Example:</font>
00038 <font class="comment">//  if(m_hTheme != NULL)</font>
00039 <font class="comment">//  {</font>
00040 <font class="comment">//      DrawThemeBackground(dc, BP_PUSHBUTTON, PBS_NORMAL, &amp;rect, NULL);</font>
00041 <font class="comment">//      DrawThemeText(dc, BP_PUSHBUTTON, PBS_NORMAL, L"Button", -1, DT_SINGLELINE | DT_CENTER | DT_VCENTER, 0, &amp;rect);</font>
00042 <font class="comment">//  }</font>
00043 <font class="comment">//  else</font>
00044 <font class="comment">//  {</font>
00045 <font class="comment">//      dc.DrawFrameControl(&amp;rect, DFC_BUTTON, DFCS_BUTTONPUSH);</font>
00046 <font class="comment">//      dc.DrawText(_T("Button"), -1, &amp;rect, DT_SINGLELINE | DT_CENTER | DT_VCENTER);</font>
00047 <font class="comment">//  }</font>
00048 <font class="comment">//</font>
00049 <font class="comment">// Delay load is NOT AUTOMATIC for VC++ 7, you have to link to delayimp.lib, </font>
00050 <font class="comment">// and add uxtheme.dll in the Linker.Input.Delay Loaded DLLs section of the </font>
00051 <font class="comment">// project properties.</font>
00052 <font class="preprocessor">#if (_MSC_VER &lt; 1300) &amp;&amp; !defined(_WTL_NO_THEME_DELAYLOAD)</font>
00053 <font class="preprocessor"></font><font class="preprocessor">#pragma comment(lib, "delayimp.lib")</font>
00054 <font class="preprocessor"></font><font class="preprocessor">#pragma comment(linker, "/delayload:uxtheme.dll")</font>
00055 <font class="preprocessor"></font><font class="preprocessor">#endif //(_MSC_VER &lt; 1300) &amp;&amp; !defined(_WTL_NO_THEME_DELAYLOAD)</font>
00056 <font class="preprocessor"></font>
00057 
00059 <font class="comment">// Classes in this file</font>
00060 <font class="comment">//</font>
00061 <font class="comment">// CTheme</font>
00062 <font class="comment">// CThemeImpl&lt;T, TBase&gt;</font>
00063 
00064 
00065 <font class="keyword">namespace </font>WTL
00066 {
00067 
00069 <font class="comment">// CTheme - wrapper for theme handle</font>
00070 
<a name="l00071"></a><a class="code" href="classWTL_1_1CTheme.html">00071</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CTheme.html">CTheme</a>
00072 {
00073 <font class="keyword">public</font>:
00074 <font class="comment">// Data members</font>
<a name="l00075"></a><a class="code" href="classWTL_1_1CTheme.html#m0">00075</a>     HTHEME <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>;
<a name="l00076"></a><a class="code" href="classWTL_1_1CTheme.html#p0">00076</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CTheme.html#p0">m_nIsThemingSupported</a>;
00077 
00078 <font class="comment">// Constructor</font>
<a name="l00079"></a><a class="code" href="classWTL_1_1CTheme.html#a0">00079</a>     <a class="code" href="classWTL_1_1CTheme.html#a0">CTheme</a>() : <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>(NULL)
00080     {
00081         <a class="code" href="classWTL_1_1CTheme.html#d0">IsThemingSupported</a>();
00082     }
00083 
00084 <font class="comment">// Operators and helpers</font>
<a name="l00085"></a><a class="code" href="classWTL_1_1CTheme.html#a1">00085</a>     <font class="keywordtype">bool</font> <a class="code" href="classWTL_1_1CTheme.html#a1">IsThemeNull</a>()<font class="keyword"> const</font>
00086 <font class="keyword">    </font>{
00087         <font class="keywordflow">return</font> (<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> == NULL);
00088     }
00089 
<a name="l00090"></a><a class="code" href="classWTL_1_1CTheme.html#a2">00090</a>     <a class="code" href="classWTL_1_1CTheme.html">CTheme</a>&amp; <a class="code" href="classWTL_1_1CTheme.html#a2">operator =</a>(HTHEME hTheme)
00091     {
00092         <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> = hTheme;
00093         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00094     }
00095 
<a name="l00096"></a><a class="code" href="classWTL_1_1CTheme.html#a3">00096</a>     <a class="code" href="classWTL_1_1CTheme.html#a3">operator HTHEME</a>()<font class="keyword"> const</font>
00097 <font class="keyword">    </font>{
00098         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>;
00099     }
00100 
<a name="l00101"></a><a class="code" href="classWTL_1_1CTheme.html#a4">00101</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CTheme.html#a4">Attach</a>(HTHEME hTheme)
00102     {
00103         <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> = hTheme;
00104     }
00105 
<a name="l00106"></a><a class="code" href="classWTL_1_1CTheme.html#a5">00106</a>     HTHEME <a class="code" href="classWTL_1_1CTheme.html#a5">Detach</a>()
00107     {
00108         HTHEME hTheme = <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>;
00109         <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> = NULL;
00110         <font class="keywordflow">return</font> hTheme;
00111     }
00112 
00113 <font class="comment">// Theme support helper</font>
<a name="l00114"></a><a class="code" href="classWTL_1_1CTheme.html#d0">00114</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="classWTL_1_1CTheme.html#d0">IsThemingSupported</a>()
00115     {
00116         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CTheme.html#p0">m_nIsThemingSupported</a> == -1)
00117         {
00118             ::EnterCriticalSection(&amp;_Module.m_csStaticDataInit);
00119             <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CTheme.html#p0">m_nIsThemingSupported</a> == -1)
00120             {
00121                 HMODULE hThemeDLL = ::LoadLibrary(_T(<font class="stringliteral">"uxtheme.dll"</font>));
00122                 <a class="code" href="classWTL_1_1CTheme.html#p0">m_nIsThemingSupported</a> = (hThemeDLL != NULL) ? 1 : 0;
00123                 <font class="keywordflow">if</font>(hThemeDLL != NULL)
00124                     ::FreeLibrary(hThemeDLL);
00125             }
00126             ::LeaveCriticalSection(&amp;_Module.m_csStaticDataInit);
00127         }
00128 
00129         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#p0">m_nIsThemingSupported</a> != -1);
00130         <font class="keywordflow">return</font> (<a class="code" href="classWTL_1_1CTheme.html#p0">m_nIsThemingSupported</a> == 1);
00131     }
00132 
00133 <font class="comment">// Operations and theme properties</font>
<a name="l00134"></a><a class="code" href="classWTL_1_1CTheme.html#a6">00134</a>     HTHEME <a class="code" href="classWTL_1_1CTheme.html#a6">OpenThemeData</a>(HWND hWnd, LPCWSTR pszClassList)
00135     {
00136         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CTheme.html#d0">IsThemingSupported</a>())
00137             <font class="keywordflow">return</font> NULL;
00138 
00139         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> == NULL);
00140         <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> = ::OpenThemeData(hWnd, pszClassList);
00141         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>;
00142     }
00143 
<a name="l00144"></a><a class="code" href="classWTL_1_1CTheme.html#a7">00144</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a7">CloseThemeData</a>()
00145     {
00146         HRESULT hRet = S_FALSE;
00147         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL)
00148         {
00149             hRet = ::CloseThemeData(m_hTheme);
00150             <font class="keywordflow">if</font>(SUCCEEDED(hRet))
00151                 <a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> = NULL;
00152         }
00153         <font class="keywordflow">return</font> hRet;
00154     }
00155 
<a name="l00156"></a><a class="code" href="classWTL_1_1CTheme.html#a8">00156</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a8">DrawThemeBackground</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCRECT pRect, LPCRECT pClipRect = NULL)
00157     {
00158         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00159         return ::DrawThemeBackground(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pRect, pClipRect);
00160     }
00161 
<a name="l00162"></a><a class="code" href="classWTL_1_1CTheme.html#a9">00162</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a9">DrawThemeText</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCWSTR pszText, <font class="keywordtype">int</font> nCharCount, DWORD dwTextFlags, DWORD dwTextFlags2, LPCRECT pRect)
00163     {
00164         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00165         return ::DrawThemeText(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pszText, nCharCount, dwTextFlags, dwTextFlags2, pRect);
00166     }
00167 
<a name="l00168"></a><a class="code" href="classWTL_1_1CTheme.html#a10">00168</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a10">GetThemeBackgroundContentRect</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID,  LPCRECT pBoundingRect, LPRECT pContentRect)<font class="keyword"> const</font>
00169 <font class="keyword">    </font>{
00170         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00171         return ::GetThemeBackgroundContentRect(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID,  pBoundingRect, pContentRect);
00172     }
00173 
<a name="l00174"></a><a class="code" href="classWTL_1_1CTheme.html#a11">00174</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a11">GetThemeBackgroundExtent</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCRECT pContentRect, LPRECT pExtentRect)<font class="keyword"> const</font>
00175 <font class="keyword">    </font>{
00176         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00177         return ::GetThemeBackgroundExtent(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pContentRect, pExtentRect);
00178     }
00179 
<a name="l00180"></a><a class="code" href="classWTL_1_1CTheme.html#a12">00180</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a12">GetThemePartSize</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPRECT pRect, <font class="keyword">enum</font> THEMESIZE eSize, LPSIZE pSize)<font class="keyword"> const</font>
00181 <font class="keyword">    </font>{
00182         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00183         return ::GetThemePartSize(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pRect, eSize, pSize);
00184     }
00185 
<a name="l00186"></a><a class="code" href="classWTL_1_1CTheme.html#a13">00186</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a13">GetThemeTextExtent</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCWSTR pszText, <font class="keywordtype">int</font> nCharCount, DWORD dwTextFlags, LPCRECT  pBoundingRect, LPRECT pExtentRect)<font class="keyword"> const</font>
00187 <font class="keyword">    </font>{
00188         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00189         return ::GetThemeTextExtent(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pszText, nCharCount, dwTextFlags, pBoundingRect, pExtentRect);
00190     }
00191 
<a name="l00192"></a><a class="code" href="classWTL_1_1CTheme.html#a14">00192</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a14">GetThemeTextMetrics</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, PTEXTMETRIC pTextMetric)<font class="keyword"> const</font>
00193 <font class="keyword">    </font>{
00194         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00195         return ::GetThemeTextMetrics(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pTextMetric);
00196     }
00197 
<a name="l00198"></a><a class="code" href="classWTL_1_1CTheme.html#a15">00198</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a15">GetThemeBackgroundRegion</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCRECT pRect, HRGN* pRegion)<font class="keyword"> const</font>
00199 <font class="keyword">    </font>{
00200         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00201         return ::GetThemeBackgroundRegion(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pRect, pRegion);
00202     }
00203 
<a name="l00204"></a><a class="code" href="classWTL_1_1CTheme.html#a16">00204</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a16">HitTestThemeBackground</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, DWORD dwOptions, LPCRECT pRect, HRGN hrgn, POINT ptTest, WORD* pwHitTestCode)<font class="keyword"> const</font>
00205 <font class="keyword">    </font>{
00206         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00207         return ::HitTestThemeBackground(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, dwOptions, pRect, hrgn, ptTest, pwHitTestCode);
00208     }
00209 
<a name="l00210"></a><a class="code" href="classWTL_1_1CTheme.html#a17">00210</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a17">DrawThemeEdge</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCRECT pDestRect, UINT uEdge, UINT uFlags, LPRECT pContentRect = NULL)
00211     {
00212         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00213         return ::DrawThemeEdge(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pDestRect, uEdge, uFlags, pContentRect);
00214     }
00215 
<a name="l00216"></a><a class="code" href="classWTL_1_1CTheme.html#a18">00216</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a18">DrawThemeIcon</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, LPCRECT pRect, HIMAGELIST himl, <font class="keywordtype">int</font> nImageIndex)
00217     {
00218         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00219         return ::DrawThemeIcon(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, pRect, himl, nImageIndex);
00220     }
00221 
<a name="l00222"></a><a class="code" href="classWTL_1_1CTheme.html#a19">00222</a>     BOOL <a class="code" href="classWTL_1_1CTheme.html#a19">IsThemePartDefined</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID)<font class="keyword"> const</font>
00223 <font class="keyword">    </font>{
00224         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00225         return ::IsThemePartDefined(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID);
00226     }
00227 
<a name="l00228"></a><a class="code" href="classWTL_1_1CTheme.html#a20">00228</a>     BOOL <a class="code" href="classWTL_1_1CTheme.html#a20">IsThemeBackgroundPartiallyTransparent</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID)<font class="keyword"> const</font>
00229 <font class="keyword">    </font>{
00230         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00231         return ::IsThemeBackgroundPartiallyTransparent(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID);
00232     }
00233 
<a name="l00234"></a><a class="code" href="classWTL_1_1CTheme.html#a21">00234</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a21">GetThemeColor</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, COLORREF* pColor)<font class="keyword"> const</font>
00235 <font class="keyword">    </font>{
00236         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00237         return ::GetThemeColor(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pColor);
00238     }
00239 
<a name="l00240"></a><a class="code" href="classWTL_1_1CTheme.html#a22">00240</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a22">GetThemeMetric</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, <font class="keywordtype">int</font>* pnVal)<font class="keyword"> const</font>
00241 <font class="keyword">    </font>{
00242         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00243         return ::GetThemeMetric(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, nPropID, pnVal);
00244     }
00245 
<a name="l00246"></a><a class="code" href="classWTL_1_1CTheme.html#a23">00246</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a23">GetThemeString</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, LPWSTR pszBuff, <font class="keywordtype">int</font> cchMaxBuffChars)<font class="keyword"> const</font>
00247 <font class="keyword">    </font>{
00248         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00249         return ::GetThemeString(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pszBuff, cchMaxBuffChars);
00250     }
00251 
<a name="l00252"></a><a class="code" href="classWTL_1_1CTheme.html#a24">00252</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a24">GetThemeBool</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, BOOL* pfVal)<font class="keyword"> const</font>
00253 <font class="keyword">    </font>{
00254         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00255         return ::GetThemeBool(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pfVal);
00256     }
00257 
<a name="l00258"></a><a class="code" href="classWTL_1_1CTheme.html#a25">00258</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a25">GetThemeInt</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, <font class="keywordtype">int</font>* pnVal)<font class="keyword"> const</font>
00259 <font class="keyword">    </font>{
00260         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00261         return ::GetThemeInt(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pnVal);
00262     }
00263 
<a name="l00264"></a><a class="code" href="classWTL_1_1CTheme.html#a26">00264</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a26">GetThemeEnumValue</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, <font class="keywordtype">int</font>* pnVal)<font class="keyword"> const</font>
00265 <font class="keyword">    </font>{
00266         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00267         return ::GetThemeEnumValue(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pnVal);
00268     }
00269 
<a name="l00270"></a><a class="code" href="classWTL_1_1CTheme.html#a27">00270</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a27">GetThemePosition</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, LPPOINT pPoint)<font class="keyword"> const</font>
00271 <font class="keyword">    </font>{
00272         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00273         return ::GetThemePosition(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pPoint);
00274     }
00275 
<a name="l00276"></a><a class="code" href="classWTL_1_1CTheme.html#a28">00276</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a28">GetThemeFont</a>(<font class="keywordtype">int</font> nPartID, HDC hDC, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, LOGFONT* pFont)<font class="keyword"> const</font>
00277 <font class="keyword">    </font>{
00278         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00279         return ::GetThemeFont(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, nPropID, pFont);
00280     }
00281 
<a name="l00282"></a><a class="code" href="classWTL_1_1CTheme.html#a29">00282</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a29">GetThemeRect</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, LPRECT pRect)<font class="keyword"> const</font>
00283 <font class="keyword">    </font>{
00284         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00285         return ::GetThemeRect(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pRect);
00286     }
00287 
<a name="l00288"></a><a class="code" href="classWTL_1_1CTheme.html#a30">00288</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a30">GetThemeMargins</a>(HDC hDC, <font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, LPRECT pRect, PMARGINS pMargins)<font class="keyword"> const</font>
00289 <font class="keyword">    </font>{
00290         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00291         return ::GetThemeMargins(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, hDC, nPartID, nStateID, nPropID, pRect, pMargins);
00292     }
00293 
<a name="l00294"></a><a class="code" href="classWTL_1_1CTheme.html#a31">00294</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a31">GetThemeIntList</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, INTLIST* pIntList)<font class="keyword"> const</font>
00295 <font class="keyword">    </font>{
00296         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00297         return ::GetThemeIntList(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pIntList);
00298     }
00299 
<a name="l00300"></a><a class="code" href="classWTL_1_1CTheme.html#a32">00300</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a32">GetThemePropertyOrigin</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, <font class="keyword">enum</font> PROPERTYORIGIN* pOrigin)<font class="keyword"> const</font>
00301 <font class="keyword">    </font>{
00302         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00303         return ::GetThemePropertyOrigin(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pOrigin);
00304     }
00305 
<a name="l00306"></a><a class="code" href="classWTL_1_1CTheme.html#a33">00306</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a33">GetThemeFilename</a>(<font class="keywordtype">int</font> nPartID, <font class="keywordtype">int</font> nStateID, <font class="keywordtype">int</font> nPropID, LPWSTR pszThemeFileName, <font class="keywordtype">int</font> cchMaxBuffChars)<font class="keyword"> const</font>
00307 <font class="keyword">    </font>{
00308         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00309         return ::GetThemeFilename(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nPartID, nStateID, nPropID, pszThemeFileName, cchMaxBuffChars);
00310     }
00311 
<a name="l00312"></a><a class="code" href="classWTL_1_1CTheme.html#a34">00312</a>     COLORREF <a class="code" href="classWTL_1_1CTheme.html#a34">GetThemeSysColor</a>(<font class="keywordtype">int</font> nColorID)<font class="keyword"> const</font>
00313 <font class="keyword">    </font>{
00314         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00315         return ::GetThemeSysColor(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nColorID);
00316     }
00317 
<a name="l00318"></a><a class="code" href="classWTL_1_1CTheme.html#a35">00318</a>     HBRUSH <a class="code" href="classWTL_1_1CTheme.html#a35">GetThemeSysColorBrush</a>(<font class="keywordtype">int</font> nColorID)<font class="keyword"> const</font>
00319 <font class="keyword">    </font>{
00320         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00321         return ::GetThemeSysColorBrush(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nColorID);
00322     }
00323 
<a name="l00324"></a><a class="code" href="classWTL_1_1CTheme.html#a36">00324</a>     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CTheme.html#a36">GetThemeSysSize</a>(<font class="keywordtype">int</font> nSizeID)<font class="keyword"> const</font>
00325 <font class="keyword">    </font>{
00326         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00327         return ::GetThemeSysSize(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nSizeID);
00328     }
00329 
<a name="l00330"></a><a class="code" href="classWTL_1_1CTheme.html#a37">00330</a>     BOOL <a class="code" href="classWTL_1_1CTheme.html#a37">GetThemeSysBool</a>(<font class="keywordtype">int</font> nBoolID)<font class="keyword"> const</font>
00331 <font class="keyword">    </font>{
00332         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00333         return ::GetThemeSysBool(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nBoolID);
00334     }
00335 
<a name="l00336"></a><a class="code" href="classWTL_1_1CTheme.html#a38">00336</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a38">GetThemeSysFont</a>(<font class="keywordtype">int</font> nFontID, LOGFONT* plf)<font class="keyword"> const</font>
00337 <font class="keyword">    </font>{
00338         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00339         return ::GetThemeSysFont(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nFontID, plf);
00340     }
00341 
<a name="l00342"></a><a class="code" href="classWTL_1_1CTheme.html#a39">00342</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a39">GetThemeSysString</a>(<font class="keywordtype">int</font> nStringID, LPWSTR pszStringBuff, <font class="keywordtype">int</font> cchMaxStringChars)<font class="keyword"> const</font>
00343 <font class="keyword">    </font>{
00344         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00345         return ::GetThemeSysString(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nStringID, pszStringBuff, cchMaxStringChars);
00346     }
00347 
<a name="l00348"></a><a class="code" href="classWTL_1_1CTheme.html#a40">00348</a>     HRESULT <a class="code" href="classWTL_1_1CTheme.html#a40">GetThemeSysInt</a>(<font class="keywordtype">int</font> nIntID, <font class="keywordtype">int</font>* pnValue)<font class="keyword"> const</font>
00349 <font class="keyword">    </font>{
00350         ATLASSERT(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a> != NULL);
00351         return ::GetThemeSysInt(<a class="code" href="classWTL_1_1CTheme.html#m0">m_hTheme</a>, nIntID, pnValue);
00352     }
00353 };
00354 
00355 <a class="code" href="namespaceWTL.html#a64">__declspec</a>(selectany) <font class="keywordtype">int</font> CTheme::m_nIsThemingSupported = -1;
00356 
00357 
00359 <font class="comment">// CThemeImpl - theme support implementation</font>
00360 
00361 <font class="comment">// Derive from this class to implement window with theme support.</font>
00362 <font class="comment">// Example:</font>
00363 <font class="comment">//  class CMyThemeWindow : public CWindowImpl&lt;CMyThemeWindow&gt;, public CThemeImpl&lt;CMyThemeWindow&gt;</font>
00364 <font class="comment">//  {</font>
00365 <font class="comment">//  ...</font>
00366 <font class="comment">//      BEGIN_MSG_MAP(CMyThemeWindow)</font>
00367 <font class="comment">//          CHAIN_MSG_MAP(CThemeImpl&lt;CMyThemeWindow&gt;)</font>
00368 <font class="comment">//          ...</font>
00369 <font class="comment">//      END_MSG_MAP()</font>
00370 <font class="comment">//  ...</font>
00371 <font class="comment">//  };</font>
00372 <font class="comment">//</font>
00373 <font class="comment">// If you set theme class list, the class will automaticaly open/close/reopen theme data.</font>
00374 
00375 
00376 <font class="comment">// Helper for drawing theme client edge</font>
00377 <font class="keyword">inline</font> <font class="keywordtype">bool</font> AtlDrawThemeClientEdge(HTHEME hTheme, HWND hWnd, HRGN hRgnUpdate = NULL, HBRUSH hBrush = NULL, <font class="keywordtype">int</font> nPartID = 0, <font class="keywordtype">int</font> nStateID = 0)
00378 {
00379     ATLASSERT(hTheme != NULL);
00380     ATLASSERT(::IsWindow(hWnd));
00381 
00382     CWindowDC dc(hWnd);
00383     <font class="keywordflow">if</font>(dc.IsNull())
00384         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00385 
00386     <font class="comment">// Get border size</font>
00387     <font class="keywordtype">int</font> cxBorder = GetSystemMetrics(SM_CXBORDER);
00388     <font class="keywordtype">int</font> cyBorder = GetSystemMetrics(SM_CYBORDER);
00389     <font class="keywordflow">if</font>(SUCCEEDED(::GetThemeInt(hTheme, nPartID, nStateID, TMT_SIZINGBORDERWIDTH, &amp;cxBorder)))
00390         cyBorder = cxBorder;
00391 
00392     RECT rect;
00393     ::GetWindowRect(hWnd, &amp;rect);            
00394 
00395     <font class="comment">// Remove the client edge from the update region</font>
00396     <font class="keywordtype">int</font> cxEdge = GetSystemMetrics(SM_CXEDGE);
00397     <font class="keywordtype">int</font> cyEdge = GetSystemMetrics(SM_CYEDGE);
00398     ::InflateRect(&amp;rect, -cxEdge, -cyEdge);
00399     <a class="code" href="namespaceWTL.html#a46">CRgn</a> rgn;
00400     rgn.CreateRectRgnIndirect(&amp;rect);
00401     <font class="keywordflow">if</font>(rgn.IsNull())
00402         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00403 
00404     <font class="keywordflow">if</font>(hRgnUpdate != NULL)
00405         rgn.CombineRgn(hRgnUpdate, rgn, RGN_AND);
00406 
00407     ::OffsetRect(&amp;rect, -rect.left, -rect.top);
00408 
00409     ::OffsetRect(&amp;rect, cxEdge, cyEdge);
00410     dc.ExcludeClipRect(&amp;rect);
00411     ::InflateRect(&amp;rect, cxEdge, cyEdge);
00412 
00413     ::DrawThemeBackground(hTheme, dc, nPartID, nStateID, &amp;rect, NULL);
00414 
00415     <font class="comment">// Use background brush too, since theme border might not cover everything</font>
00416     <font class="keywordflow">if</font>(cxBorder &lt; cxEdge &amp;&amp; cyBorder &lt; cyEdge)
00417     {
00418         <font class="keywordflow">if</font>(hBrush == NULL)
00419 <font class="comment">// need conditional code because types don't match in winuser.h</font>
00420 <font class="preprocessor">#ifdef _WIN64</font>
00421 <font class="preprocessor"></font>            hBrush = (HBRUSH)::GetClassLongPtr(hWnd, GCLP_HBRBACKGROUND);
00422 <font class="preprocessor">#else</font>
00423 <font class="preprocessor"></font>            hBrush = (HBRUSH)UlongToPtr(::GetClassLongPtr(hWnd, GCLP_HBRBACKGROUND));
00424 <font class="preprocessor">#endif</font>
00425 <font class="preprocessor"></font>
00426         ::InflateRect(&amp;rect, cxBorder - cxEdge, cyBorder - cyEdge);
00427         dc.FillRect(&amp;rect, hBrush);
00428     }
00429 
00430     ::DefWindowProc(hWnd, WM_NCPAINT, (WPARAM)rgn.m_hRgn, 0L);
00431 
00432     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00433 }
00434 
00435 
00436 <font class="comment">// Theme extended styles</font>
<a name="l00437"></a><a class="code" href="atltheme_8h.html#a0">00437</a> <font class="preprocessor">#define THEME_EX_3DCLIENTEDGE       0x00000001</font>
<a name="l00438"></a><a class="code" href="atltheme_8h.html#a1">00438</a> <font class="preprocessor"></font><font class="preprocessor">#define THEME_EX_THEMECLIENTEDGE    0x00000002</font>
00439 <font class="preprocessor"></font>
00440 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> TBase = CTheme&gt;
<a name="l00441"></a><a class="code" href="classWTL_1_1CThemeImpl.html">00441</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CThemeImpl.html">CThemeImpl</a> : <font class="keyword">public</font> TBase
00442 {
00443 <font class="keyword">public</font>:
00444 <font class="comment">// Data members</font>
<a name="l00445"></a><a class="code" href="classWTL_1_1CThemeImpl.html#m0">00445</a>     LPWSTR <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>;
<a name="l00446"></a><a class="code" href="classWTL_1_1CThemeImpl.html#m1">00446</a>     DWORD <a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a>;    <font class="comment">// theme specific extended styles</font>
00447 
00448 <font class="comment">// Constructor &amp; destructor</font>
<a name="l00449"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a0">00449</a>     <a class="code" href="classWTL_1_1CThemeImpl.html#a0">CThemeImpl</a>() : <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>(NULL), <a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a>(0)
00450     { }
00451 
<a name="l00452"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a1">00452</a>     <a class="code" href="classWTL_1_1CThemeImpl.html#a1">~CThemeImpl</a>()
00453     {
00454         <font class="keyword">delete</font> <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>;
00455     }
00456 
00457 <font class="comment">// Attributes</font>
<a name="l00458"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a2">00458</a>     <font class="keywordtype">bool</font> <a class="code" href="classWTL_1_1CThemeImpl.html#a2">SetThemeClassList</a>(LPCWSTR lpstrThemeClassList)
00459     {
00460         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> != NULL)
00461         {
00462             <font class="keyword">delete</font> <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>;
00463             <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> = NULL;
00464         }
00465 
00466         <font class="keywordflow">if</font>(lpstrThemeClassList == NULL)
00467             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00468 
00469         <font class="keywordtype">int</font> cchLen = lstrlenW(lpstrThemeClassList) + 1;
00470         ATLTRY(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> = <font class="keyword">new</font> WCHAR[cchLen]);
00471         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> == NULL)
00472             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00473 
00474         <font class="keywordtype">bool</font> bRet = (lstrcpyW(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>, lpstrThemeClassList) != NULL);
00475         <font class="keywordflow">if</font>(!bRet)
00476         {
00477             <font class="keyword">delete</font> <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>;
00478             <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> = NULL;
00479         }
00480         <font class="keywordflow">return</font> bRet;
00481     }
00482 
<a name="l00483"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a3">00483</a>     <font class="keywordtype">bool</font> <a class="code" href="classWTL_1_1CThemeImpl.html#a4">GetThemeClassList</a>(LPWSTR lpstrThemeClassList, <font class="keywordtype">int</font> cchListBuffer)<font class="keyword"> const</font>
00484 <font class="keyword">    </font>{
00485         <font class="keywordtype">int</font> cchLen = lstrlenW(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>) + 1;
00486         <font class="keywordflow">if</font>(cchListBuffer &lt; cchLen)
00487             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00488 
00489         <font class="keywordflow">return</font> (lstrcpyW(lpstrThemeClassList, <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>) != NULL);
00490     }
00491 
<a name="l00492"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a4">00492</a>     LPCWSTR <a class="code" href="classWTL_1_1CThemeImpl.html#a4">GetThemeClassList</a>()<font class="keyword"> const</font>
00493 <font class="keyword">    </font>{
00494         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>;
00495     }
00496 
<a name="l00497"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a5">00497</a>     DWORD <a class="code" href="classWTL_1_1CThemeImpl.html#a5">SetThemeExtendedStyle</a>(DWORD dwExtendedStyle, DWORD dwMask = 0)
00498     {
00499         DWORD dwPrevStyle = <a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a>;
00500         <font class="keywordflow">if</font>(dwMask == 0)
00501             <a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a> = dwExtendedStyle;
00502         <font class="keywordflow">else</font>
00503             <a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a> = (<a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a> &amp; ~dwMask) | (dwExtendedStyle &amp; dwMask);
00504         <font class="keywordflow">return</font> dwPrevStyle;
00505     }
00506 
<a name="l00507"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a6">00507</a>     DWORD <a class="code" href="classWTL_1_1CThemeImpl.html#a6">GetThemeExtendedStyle</a>()<font class="keyword"> const</font>
00508 <font class="keyword">    </font>{
00509         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a>;
00510     }
00511 
00512 <font class="comment">// Operations</font>
<a name="l00513"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a7">00513</a>     HTHEME <a class="code" href="classWTL_1_1CThemeImpl.html#a7">OpenThemeData</a>()
00514     {
00515         T* pT = static_cast&lt;T*&gt;(this);
00516         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00517         ATLASSERT(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> != NULL);
00518         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> == NULL)
00519             <font class="keywordflow">return</font> NULL;
00520         CloseThemeData();
00521         <font class="keywordflow">return</font> TBase::OpenThemeData(pT-&gt;m_hWnd, <a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a>);
00522     }
00523 
<a name="l00524"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a8">00524</a>     HTHEME <a class="code" href="classWTL_1_1CThemeImpl.html#a7">OpenThemeData</a>(LPCWSTR pszClassList)
00525     {
00526         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CThemeImpl.html#a2">SetThemeClassList</a>(pszClassList))
00527             <font class="keywordflow">return</font> NULL;
00528         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CThemeImpl.html#a7">OpenThemeData</a>();
00529     }
00530 
<a name="l00531"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a9">00531</a>     HRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a9">SetWindowTheme</a>(LPCWSTR pszSubAppName, LPCWSTR pszSubIDList)
00532     {
00533         <font class="keywordflow">if</font>(!IsThemingSupported())
00534             <font class="keywordflow">return</font> S_FALSE;
00535 
00536         T* pT = static_cast&lt;T*&gt;(this);
00537         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00538         return ::SetWindowTheme(pT-&gt;m_hWnd, pszSubAppName, pszSubIDList);
00539     }
00540 
<a name="l00541"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a10">00541</a>     HTHEME <a class="code" href="classWTL_1_1CThemeImpl.html#a10">GetWindowTheme</a>()<font class="keyword"> const</font>
00542 <font class="keyword">    </font>{
00543         <font class="keywordflow">if</font>(!IsThemingSupported())
00544             <font class="keywordflow">return</font> NULL;
00545 
00546         <font class="keyword">const</font> T* pT = static_cast&lt;const T*&gt;(this);
00547         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00548         return ::GetWindowTheme(pT-&gt;m_hWnd);
00549     }
00550 
<a name="l00551"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a11">00551</a>     HRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a11">EnableThemeDialogTexture</a>(BOOL bEnable)
00552     {
00553         <font class="keywordflow">if</font>(!IsThemingSupported())
00554             <font class="keywordflow">return</font> S_FALSE;
00555 
00556         T* pT = static_cast&lt;T*&gt;(this);
00557         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00558         return ::EnableThemeDialogTexture(pT-&gt;m_hWnd, bEnable);
00559     }
00560 
<a name="l00561"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a12">00561</a>     BOOL <a class="code" href="classWTL_1_1CThemeImpl.html#a12">IsThemeDialogTextureEnabled</a>()<font class="keyword"> const</font>
00562 <font class="keyword">    </font>{
00563         <font class="keywordflow">if</font>(!IsThemingSupported())
00564             <font class="keywordflow">return</font> FALSE;
00565 
00566         <font class="keyword">const</font> T* pT = static_cast&lt;const T*&gt;(this);
00567         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00568         return ::IsThemeDialogTextureEnabled(pT-&gt;m_hWnd);
00569     }
00570 
<a name="l00571"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a13">00571</a>     HRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a13">DrawThemeParentBackground</a>(HDC hDC, LPRECT pRect = NULL)
00572     {
00573         <font class="keywordflow">if</font>(!IsThemingSupported())
00574             <font class="keywordflow">return</font> S_FALSE;
00575 
00576         T* pT = static_cast&lt;T*&gt;(this);
00577         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00578         return ::DrawThemeParentBackground(pT-&gt;m_hWnd, hDC, pRect);
00579     }
00580 
00581 <font class="comment">// Message map and handlers</font>
00582     <font class="comment">// Note: If you handle any of these messages in your derived class,</font>
00583     <font class="comment">// it is better to put CHAIN_MSG_MAP at the start of your message map.</font>
00584     BEGIN_MSG_MAP(<a class="code" href="classWTL_1_1CThemeImpl.html#a0">CThemeImpl</a>)
00585         MESSAGE_HANDLER(WM_CREATE, <a class="code" href="classWTL_1_1CThemeImpl.html#a14">OnCreate</a>)
00586         MESSAGE_HANDLER(WM_DESTROY, <a class="code" href="classWTL_1_1CThemeImpl.html#a15">OnDestroy</a>)
00587         MESSAGE_HANDLER(WM_THEMECHANGED, <a class="code" href="classWTL_1_1CThemeImpl.html#a16">OnThemeChanged</a>)
00588         MESSAGE_HANDLER(WM_NCPAINT, <a class="code" href="classWTL_1_1CThemeImpl.html#a17">OnNcPaint</a>)
00589     END_MSG_MAP()
00590 
<a name="l00591"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a14">00591</a>     LRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a14">OnCreate</a>(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
00592     {
00593         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> != NULL)
00594             <a class="code" href="classWTL_1_1CThemeImpl.html#a7">OpenThemeData</a>();
00595         bHandled = FALSE;
00596         <font class="keywordflow">return</font> 1;
00597     }
00598 
<a name="l00599"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a15">00599</a>     LRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a15">OnDestroy</a>(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
00600     {
00601         CloseThemeData();
00602         bHandled = FALSE;
00603         <font class="keywordflow">return</font> 1;
00604     }
00605 
<a name="l00606"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a16">00606</a>     LRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a16">OnThemeChanged</a>(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
00607     {
00608         CloseThemeData();
00609         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CThemeImpl.html#m0">m_lpstrThemeClassList</a> != NULL)
00610             <a class="code" href="classWTL_1_1CThemeImpl.html#a7">OpenThemeData</a>();
00611         bHandled = FALSE;
00612         <font class="keywordflow">return</font> 1;
00613     }
00614 
<a name="l00615"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a17">00615</a>     LRESULT <a class="code" href="classWTL_1_1CThemeImpl.html#a17">OnNcPaint</a>(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; bHandled)
00616     {
00617         T* pT = static_cast&lt;T*&gt;(this);
00618         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
00619         LRESULT lRet = 0;
00620         bHandled = FALSE;
00621         <font class="keywordflow">if</font>(IsThemingSupported() &amp;&amp; ((pT-&gt;GetExStyle() &amp; WS_EX_CLIENTEDGE) != 0))
00622         {
00623             <font class="keywordflow">if</font>((<a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a> &amp; <a class="code" href="atltheme_8h.html#a0">THEME_EX_3DCLIENTEDGE</a>) != 0)
00624             {
00625                 lRet = ::DefWindowProc(pT-&gt;m_hWnd, uMsg, wParam, lParam);
00626                 bHandled = TRUE;
00627             }
00628             <font class="keywordflow">else</font> <font class="keywordflow">if</font>((m_hTheme != NULL) &amp;&amp; ((<a class="code" href="classWTL_1_1CThemeImpl.html#m1">m_dwExtendedStyle</a> &amp; <a class="code" href="atltheme_8h.html#a1">THEME_EX_THEMECLIENTEDGE</a>) != 0))
00629             {
00630                 HRGN hRgn = (wParam != 1) ? (HRGN)wParam : NULL;
00631                 <font class="keywordflow">if</font>(pT-&gt;DrawThemeClientEdge(hRgn))
00632                     bHandled = TRUE;
00633             }
00634         }
00635         <font class="keywordflow">return</font> lRet;
00636     }
00637 
00638 <font class="comment">// Drawing helper</font>
<a name="l00639"></a><a class="code" href="classWTL_1_1CThemeImpl.html#a18">00639</a>     <font class="keywordtype">bool</font> <a class="code" href="classWTL_1_1CThemeImpl.html#a18">DrawThemeClientEdge</a>(HRGN hRgnUpdate)
00640     {
00641         T* pT = static_cast&lt;T*&gt;(this);
00642         <font class="keywordflow">return</font> AtlDrawThemeClientEdge(m_hTheme, pT-&gt;m_hWnd, hRgnUpdate, NULL, 0, 0);
00643     }
00644 };
00645 
00646 }; <font class="comment">//namespace WTL</font>
00647 
00648 <font class="preprocessor">#endif // __ATLTHEME_H__</font>
</pre></div><hr><address align="right"><small>Generated on Thu Apr 11 21:09:32 2002 for wtl-doc by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
