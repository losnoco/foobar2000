<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>atlmisc.h Source File</title>
<link href="mystyles.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>atlmisc.h</h1><a href="atlmisc_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// Windows Template Library - WTL version 7.0</font>
00002 <font class="comment">// Copyright (C) 1997-2002 Microsoft Corporation</font>
00003 <font class="comment">// All rights reserved.</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// This file is a part of the Windows Template Library.</font>
00006 <font class="comment">// The code and information is provided "as-is" without</font>
00007 <font class="comment">// warranty of any kind, either expressed or implied.</font>
00008 
00009 <font class="preprocessor">#ifndef __ATLMISC_H__</font>
00010 <font class="preprocessor"></font><font class="preprocessor">#define __ATLMISC_H__</font>
00011 <font class="preprocessor"></font>
00012 <font class="preprocessor">#pragma once</font>
00013 <font class="preprocessor"></font>
00014 <font class="preprocessor">#ifndef __cplusplus</font>
00015 <font class="preprocessor"></font><font class="preprocessor">    #error ATL requires C++ compilation (use a .cpp suffix)</font>
00016 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00017 <font class="preprocessor"></font>
00018 <font class="preprocessor">#ifndef __ATLAPP_H__</font>
00019 <font class="preprocessor"></font><font class="preprocessor">    #error atlmisc.h requires atlapp.h to be included first</font>
00020 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00021 <font class="preprocessor"></font>
00022 
00023 <font class="preprocessor">#ifdef _ATL_TMP_NO_CSTRING</font>
00024 <font class="preprocessor"></font><font class="preprocessor">#define _WTL_NO_CSTRING</font>
00025 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00026 <font class="preprocessor"></font>
00027 <font class="preprocessor">#if defined(_WTL_USE_CSTRING) &amp;&amp; defined(_WTL_NO_CSTRING)</font>
00028 <font class="preprocessor"></font><font class="preprocessor">    #error Conflicting options - both _WTL_USE_CSTRING and _WTL_NO_CSTRING are defined</font>
00029 <font class="preprocessor"></font><font class="preprocessor">#endif //defined(_WTL_USE_CSTRING) &amp;&amp; defined(_WTL_NO_CSTRING)</font>
00030 <font class="preprocessor"></font>
00031 <font class="preprocessor">#if !defined(_WTL_USE_CSTRING) &amp;&amp; !defined(_WTL_NO_CSTRING)</font>
<a name="l00032"></a><a class="code" href="atlmisc_8h.html#a0">00032</a> <font class="preprocessor"></font><font class="preprocessor">#define _WTL_USE_CSTRING</font>
00033 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
00034 <font class="preprocessor"></font>
00035 <font class="preprocessor"></font><font class="preprocessor">#ifndef _WTL_NO_CSTRING</font>
00036 <font class="preprocessor"></font><font class="preprocessor">  #if defined(_ATL_USE_CSTRING_FLOAT) &amp;&amp; defined(_ATL_MIN_CRT)</font>
00037 <font class="preprocessor"></font><font class="preprocessor">    #error Cannot use CString floating point formatting with _ATL_MIN_CRT defined</font>
00038 <font class="preprocessor"></font><font class="preprocessor">  #endif //defined(_ATL_USE_CSTRING_FLOAT) &amp;&amp; defined(_ATL_MIN_CRT)</font>
00039 <font class="preprocessor"></font>
00040 <font class="preprocessor">  #ifndef _DEBUG</font>
00041 <font class="preprocessor"></font><font class="preprocessor">  #include &lt;stdio.h&gt;</font>
00042 <font class="preprocessor">  #endif </font>
00043 <font class="preprocessor">#endif </font>
00044 <font class="preprocessor"></font>
00045 <font class="preprocessor"></font>
00047 <font class="comment">// Classes in this file</font>
00048 <font class="comment">//</font>
00049 <font class="comment">// CSize</font>
00050 <font class="comment">// CPoint</font>
00051 <font class="comment">// CRect</font>
00052 <font class="comment">// CString</font>
00053 <font class="comment">//</font>
00054 <font class="comment">// CRecentDocumentListBase&lt;T, t_cchItemLen&gt;</font>
00055 <font class="comment">// CRecentDocumentList</font>
00056 <font class="comment">// CFindFile</font>
00057 
00058 
00059 <font class="keyword">namespace </font>WTL
00060 {
00061 
00062 <font class="preprocessor">#ifndef _WTL_NO_WTYPES</font>
00063 <font class="preprocessor"></font>
00064 <font class="comment">// forward declarations</font>
00065 <font class="keyword">class </font>CSize;
00066 <font class="keyword">class </font>CPoint;
00067 <font class="keyword">class </font>CRect;
00068 
00070 <font class="comment">// CSize - Wrapper for Windows SIZE structure.</font>
00071 
<a name="l00072"></a><a class="code" href="classWTL_1_1CSize.html">00072</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CSize.html">CSize</a> : <font class="keyword">public</font> tagSIZE
00073 {
00074 <font class="keyword">public</font>:
00075 <font class="comment">// Constructors</font>
00076     <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>();
00077     <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(<font class="keywordtype">int</font> initCX, <font class="keywordtype">int</font> initCY);
00078     <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(SIZE initSize);
00079     <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(POINT initPt);
00080     <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(DWORD dwSize);
00081 
00082 <font class="comment">// Operations</font>
00083     BOOL <a class="code" href="classWTL_1_1CSize.html#a5">operator==</a>(SIZE size) <font class="keyword">const</font>;
00084     BOOL <a class="code" href="classWTL_1_1CSize.html#a6">operator!=</a>(SIZE size) <font class="keyword">const</font>;
00085     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CSize.html#a7">operator+=</a>(SIZE size);
00086     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CSize.html#a8">operator-=</a>(SIZE size);
00087     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CSize.html#a9">SetSize</a>(<font class="keywordtype">int</font> CX, <font class="keywordtype">int</font> CY);
00088 
00089 <font class="comment">// Operators returning CSize values</font>
00090     <a class="code" href="classWTL_1_1CSize.html">CSize</a> <a class="code" href="classWTL_1_1CSize.html#a10">operator+</a>(SIZE size) <font class="keyword">const</font>;
00091     <a class="code" href="classWTL_1_1CSize.html">CSize</a> <a class="code" href="classWTL_1_1CSize.html#a12">operator-</a>(SIZE size) <font class="keyword">const</font>;
00092     <a class="code" href="classWTL_1_1CSize.html">CSize</a> <a class="code" href="classWTL_1_1CSize.html#a12">operator-</a>() <font class="keyword">const</font>;
00093 
00094 <font class="comment">// Operators returning CPoint values</font>
00095     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CSize.html#a10">operator+</a>(POINT point) <font class="keyword">const</font>;
00096     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CSize.html#a12">operator-</a>(POINT point) <font class="keyword">const</font>;
00097 
00098 <font class="comment">// Operators returning CRect values</font>
00099     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CSize.html#a10">operator+</a>(<font class="keyword">const</font> RECT* lpRect) <font class="keyword">const</font>;
00100     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CSize.html#a12">operator-</a>(<font class="keyword">const</font> RECT* lpRect) <font class="keyword">const</font>;
00101 };
00102 
00103 
00105 <font class="comment">// CPoint - Wrapper for Windows POINT structure.</font>
00106 
<a name="l00107"></a><a class="code" href="classWTL_1_1CPoint.html">00107</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CPoint.html">CPoint</a> : <font class="keyword">public</font> tagPOINT
00108 {
00109 <font class="keyword">public</font>:
00110 <font class="comment">// Constructors</font>
00111     <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>();
00112     <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(<font class="keywordtype">int</font> initX, <font class="keywordtype">int</font> initY);
00113     <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(POINT initPt);
00114     <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(SIZE initSize);
00115     <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(DWORD dwPoint);
00116 
00117 <font class="comment">// Operations</font>
00118     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a5">Offset</a>(<font class="keywordtype">int</font> xOffset, <font class="keywordtype">int</font> yOffset);
00119     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a5">Offset</a>(POINT point);
00120     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a5">Offset</a>(SIZE size);
00121     BOOL <a class="code" href="classWTL_1_1CPoint.html#a8">operator==</a>(POINT point) <font class="keyword">const</font>;
00122     BOOL <a class="code" href="classWTL_1_1CPoint.html#a9">operator!=</a>(POINT point) <font class="keyword">const</font>;
00123     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a10">operator+=</a>(SIZE size);
00124     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a11">operator-=</a>(SIZE size);
00125     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a10">operator+=</a>(POINT point);
00126     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a11">operator-=</a>(POINT point);
00127     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CPoint.html#a14">SetPoint</a>(<font class="keywordtype">int</font> X, <font class="keywordtype">int</font> Y);
00128 
00129 <font class="comment">// Operators returning CPoint values</font>
00130     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CPoint.html#a15">operator+</a>(SIZE size) <font class="keyword">const</font>;
00131     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CPoint.html#a17">operator-</a>(SIZE size) <font class="keyword">const</font>;
00132     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CPoint.html#a17">operator-</a>() <font class="keyword">const</font>;
00133     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CPoint.html#a15">operator+</a>(POINT point) <font class="keyword">const</font>;
00134 
00135 <font class="comment">// Operators returning CSize values</font>
00136     <a class="code" href="classWTL_1_1CSize.html">CSize</a> <a class="code" href="classWTL_1_1CPoint.html#a17">operator-</a>(POINT point) <font class="keyword">const</font>;
00137 
00138 <font class="comment">// Operators returning CRect values</font>
00139     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CPoint.html#a15">operator+</a>(<font class="keyword">const</font> RECT* lpRect) <font class="keyword">const</font>;
00140     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CPoint.html#a17">operator-</a>(<font class="keyword">const</font> RECT* lpRect) <font class="keyword">const</font>;
00141 };
00142 
00143 
00145 <font class="comment">// CRect - Wrapper for Windows RECT structure.</font>
00146 
<a name="l00147"></a><a class="code" href="classWTL_1_1CRect.html">00147</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CRect.html">CRect</a> : <font class="keyword">public</font> tagRECT
00148 {
00149 <font class="keyword">public</font>:
00150 <font class="comment">// Constructors</font>
00151     <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>();
00152     <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>(<font class="keywordtype">int</font> l, <font class="keywordtype">int</font> t, <font class="keywordtype">int</font> r, <font class="keywordtype">int</font> b);
00153     <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>(<font class="keyword">const</font> RECT&amp; srcRect);
00154     <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>(LPCRECT lpSrcRect);
00155     <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>(POINT point, SIZE size);
00156     <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>(POINT topLeft, POINT bottomRight);
00157 
00158 <font class="comment">// Attributes (in addition to RECT members)</font>
00159     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CRect.html#a6">Width</a>() <font class="keyword">const</font>;
00160     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CRect.html#a7">Height</a>() <font class="keyword">const</font>;
00161     <a class="code" href="classWTL_1_1CSize.html">CSize</a> <a class="code" href="classWTL_1_1CRect.html#a8">Size</a>() <font class="keyword">const</font>;
00162     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; <a class="code" href="classWTL_1_1CRect.html#a9">TopLeft</a>();
00163     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; <a class="code" href="classWTL_1_1CRect.html#a10">BottomRight</a>();
00164     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; <a class="code" href="classWTL_1_1CRect.html#a9">TopLeft</a>() <font class="keyword">const</font>;
00165     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; <a class="code" href="classWTL_1_1CRect.html#a10">BottomRight</a>() <font class="keyword">const</font>;
00166     <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> <a class="code" href="classWTL_1_1CRect.html#a13">CenterPoint</a>() <font class="keyword">const</font>;
00167 
00168     <font class="comment">// convert between CRect and LPRECT/LPCRECT (no need for &amp;)</font>
00169     <a class="code" href="classWTL_1_1CRect.html#a14">operator LPRECT</a>();
00170     <a class="code" href="classWTL_1_1CRect.html#a15">operator LPCRECT</a>() <font class="keyword">const</font>;
00171 
00172     BOOL <a class="code" href="classWTL_1_1CRect.html#a16">IsRectEmpty</a>() <font class="keyword">const</font>;
00173     BOOL <a class="code" href="classWTL_1_1CRect.html#a17">IsRectNull</a>() <font class="keyword">const</font>;
00174     BOOL <a class="code" href="classWTL_1_1CRect.html#a18">PtInRect</a>(POINT point) <font class="keyword">const</font>;
00175 
00176 <font class="comment">// Operations</font>
00177     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a19">SetRect</a>(<font class="keywordtype">int</font> x1, <font class="keywordtype">int</font> y1, <font class="keywordtype">int</font> x2, <font class="keywordtype">int</font> y2);
00178     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a19">SetRect</a>(POINT topLeft, POINT bottomRight);
00179     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a21">SetRectEmpty</a>();
00180     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a22">CopyRect</a>(LPCRECT lpSrcRect);
00181     BOOL <a class="code" href="classWTL_1_1CRect.html#a23">EqualRect</a>(LPCRECT lpRect) <font class="keyword">const</font>;
00182 
00183     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a24">InflateRect</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00184     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a24">InflateRect</a>(SIZE size);
00185     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a24">InflateRect</a>(LPCRECT lpRect);
00186     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a24">InflateRect</a>(<font class="keywordtype">int</font> l, <font class="keywordtype">int</font> t, <font class="keywordtype">int</font> r, <font class="keywordtype">int</font> b);
00187     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a28">DeflateRect</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00188     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a28">DeflateRect</a>(SIZE size);
00189     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a28">DeflateRect</a>(LPCRECT lpRect);
00190     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a28">DeflateRect</a>(<font class="keywordtype">int</font> l, <font class="keywordtype">int</font> t, <font class="keywordtype">int</font> r, <font class="keywordtype">int</font> b);
00191 
00192     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a32">OffsetRect</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00193     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a32">OffsetRect</a>(SIZE size);
00194     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a32">OffsetRect</a>(POINT point);
00195     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a35">NormalizeRect</a>();
00196 
00197     <font class="comment">// absolute position of rectangle</font>
00198     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a36">MoveToY</a>(<font class="keywordtype">int</font> y);
00199     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a37">MoveToX</a>(<font class="keywordtype">int</font> x);
00200     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a38">MoveToXY</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00201     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a38">MoveToXY</a>(POINT point);
00202 
00203     <font class="comment">// operations that fill '*this' with result</font>
00204     BOOL <a class="code" href="classWTL_1_1CRect.html#a40">IntersectRect</a>(LPCRECT lpRect1, LPCRECT lpRect2);
00205     BOOL <a class="code" href="classWTL_1_1CRect.html#a41">UnionRect</a>(LPCRECT lpRect1, LPCRECT lpRect2);
00206     BOOL <a class="code" href="classWTL_1_1CRect.html#a42">SubtractRect</a>(LPCRECT lpRectSrc1, LPCRECT lpRectSrc2);
00207 
00208 <font class="comment">// Additional Operations</font>
00209     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a43">operator=</a>(<font class="keyword">const</font> RECT&amp; srcRect);
00210     BOOL <a class="code" href="classWTL_1_1CRect.html#a44">operator==</a>(<font class="keyword">const</font> RECT&amp; rect) <font class="keyword">const</font>;
00211     BOOL <a class="code" href="classWTL_1_1CRect.html#a45">operator!=</a>(<font class="keyword">const</font> RECT&amp; rect) <font class="keyword">const</font>;
00212     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a46">operator+=</a>(POINT point);
00213     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a46">operator+=</a>(SIZE size);
00214     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a46">operator+=</a>(LPCRECT lpRect);
00215     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a49">operator-=</a>(POINT point);
00216     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a49">operator-=</a>(SIZE size);
00217     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a49">operator-=</a>(LPCRECT lpRect);
00218     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a52">operator&amp;=</a>(<font class="keyword">const</font> RECT&amp; rect);
00219     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRect.html#a53">operator|=</a>(<font class="keyword">const</font> RECT&amp; rect);
00220 
00221 <font class="comment">// Operators returning CRect values</font>
00222     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a54">operator+</a>(POINT point) <font class="keyword">const</font>;
00223     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a55">operator-</a>(POINT point) <font class="keyword">const</font>;
00224     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a54">operator+</a>(LPCRECT lpRect) <font class="keyword">const</font>;
00225     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a54">operator+</a>(SIZE size) <font class="keyword">const</font>;
00226     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a55">operator-</a>(SIZE size) <font class="keyword">const</font>;
00227     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a55">operator-</a>(LPCRECT lpRect) <font class="keyword">const</font>;
00228     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a60">operator&amp;</a>(<font class="keyword">const</font> RECT&amp; rect2) <font class="keyword">const</font>;
00229     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a61">operator|</a>(<font class="keyword">const</font> RECT&amp; rect2) <font class="keyword">const</font>;
00230     <a class="code" href="classWTL_1_1CRect.html">CRect</a> <a class="code" href="classWTL_1_1CRect.html#a62">MulDiv</a>(<font class="keywordtype">int</font> nMultiplier, <font class="keywordtype">int</font> nDivisor) <font class="keyword">const</font>;
00231 };
00232 
00233 
00235 <font class="comment">// CSize, CPoint, CRect Implementation</font>
00236 
00237 <font class="comment">// CSize</font>
<a name="l00238"></a><a class="code" href="classWTL_1_1CSize.html#a0">00238</a> <font class="keyword">inline</font> CSize::CSize()
00239     { <font class="comment">/* random filled */</font> }
<a name="l00240"></a><a class="code" href="classWTL_1_1CSize.html#a1">00240</a> <font class="keyword">inline</font> CSize::CSize(<font class="keywordtype">int</font> initCX, <font class="keywordtype">int</font> initCY)
00241     { cx = initCX; cy = initCY; }
<a name="l00242"></a><a class="code" href="classWTL_1_1CSize.html#a2">00242</a> <font class="keyword">inline</font> CSize::CSize(SIZE initSize)
00243     { *(SIZE*)<font class="keyword">this</font> = initSize; }
<a name="l00244"></a><a class="code" href="classWTL_1_1CSize.html#a3">00244</a> <font class="keyword">inline</font> CSize::CSize(POINT initPt)
00245     { *(POINT*)<font class="keyword">this</font> = initPt; }
<a name="l00246"></a><a class="code" href="classWTL_1_1CSize.html#a4">00246</a> <font class="keyword">inline</font> CSize::CSize(DWORD dwSize)
00247     {
00248         cx = (short)LOWORD(dwSize);
00249         cy = (short)HIWORD(dwSize);
00250     }
<a name="l00251"></a><a class="code" href="classWTL_1_1CSize.html#a5">00251</a> <font class="keyword">inline</font> BOOL CSize::operator==(SIZE size)<font class="keyword"> const</font>
00252 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (cx == size.cx &amp;&amp; cy == size.cy); }
<a name="l00253"></a><a class="code" href="classWTL_1_1CSize.html#a6">00253</a> <font class="keyword">inline</font> BOOL CSize::operator!=(SIZE size)<font class="keyword"> const</font>
00254 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (cx != size.cx || cy != size.cy); }
<a name="l00255"></a><a class="code" href="classWTL_1_1CSize.html#a7">00255</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CSize::operator+=(SIZE size)
00256     { cx += size.cx; cy += size.cy; }
<a name="l00257"></a><a class="code" href="classWTL_1_1CSize.html#a8">00257</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CSize::operator-=(SIZE size)
00258     { cx -= size.cx; cy -= size.cy; }
<a name="l00259"></a><a class="code" href="classWTL_1_1CSize.html#a9">00259</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CSize::SetSize(<font class="keywordtype">int</font> CX, <font class="keywordtype">int</font> CY)
00260     { cx = CX; cy = CY; }   
<a name="l00261"></a><a class="code" href="classWTL_1_1CSize.html#a10">00261</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a> CSize::operator+(SIZE size)<font class="keyword"> const</font>
00262 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(cx + size.cx, cy + size.cy); }
<a name="l00263"></a><a class="code" href="classWTL_1_1CSize.html#a11">00263</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a> CSize::operator-(SIZE size)<font class="keyword"> const</font>
00264 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(cx - size.cx, cy - size.cy); }
<a name="l00265"></a><a class="code" href="classWTL_1_1CSize.html#a12">00265</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a> CSize::operator-()<font class="keyword"> const</font>
00266 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CSize.html#a0">CSize</a>(-cx, -cy); }
<a name="l00267"></a><a class="code" href="classWTL_1_1CSize.html#a13">00267</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CSize::operator+(POINT point)<font class="keyword"> const</font>
00268 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>(cx + point.x, cy + point.y); }
<a name="l00269"></a><a class="code" href="classWTL_1_1CSize.html#a14">00269</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CSize::operator-(POINT point)<font class="keyword"> const</font>
00270 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>(cx - point.x, cy - point.y); }
<a name="l00271"></a><a class="code" href="classWTL_1_1CSize.html#a15">00271</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CSize::operator+(<font class="keyword">const</font> RECT* lpRect)<font class="keyword"> const</font>
00272 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a>(lpRect) + *<font class="keyword">this</font>; }
<a name="l00273"></a><a class="code" href="classWTL_1_1CSize.html#a16">00273</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CSize::operator-(<font class="keyword">const</font> RECT* lpRect)<font class="keyword"> const</font>
00274 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a>(lpRect) - *<font class="keyword">this</font>; }
00275 
00276 <font class="comment">// CPoint</font>
<a name="l00277"></a><a class="code" href="classWTL_1_1CPoint.html#a0">00277</a> <font class="keyword">inline</font> CPoint::CPoint()
00278     { <font class="comment">/* random filled */</font> }
<a name="l00279"></a><a class="code" href="classWTL_1_1CPoint.html#a1">00279</a> <font class="keyword">inline</font> CPoint::CPoint(<font class="keywordtype">int</font> initX, <font class="keywordtype">int</font> initY)
00280     { x = initX; y = initY; }
<a name="l00281"></a><a class="code" href="classWTL_1_1CPoint.html#a2">00281</a> <font class="keyword">inline</font> CPoint::CPoint(POINT initPt)
00282     { *(POINT*)<font class="keyword">this</font> = initPt; }
<a name="l00283"></a><a class="code" href="classWTL_1_1CPoint.html#a3">00283</a> <font class="keyword">inline</font> CPoint::CPoint(SIZE initSize)
00284     { *(SIZE*)<font class="keyword">this</font> = initSize; }
<a name="l00285"></a><a class="code" href="classWTL_1_1CPoint.html#a4">00285</a> <font class="keyword">inline</font> CPoint::CPoint(DWORD dwPoint)
00286     {
00287         x = (short)LOWORD(dwPoint);
00288         y = (short)HIWORD(dwPoint);
00289     }
<a name="l00290"></a><a class="code" href="classWTL_1_1CPoint.html#a5">00290</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::Offset(<font class="keywordtype">int</font> xOffset, <font class="keywordtype">int</font> yOffset)
00291     { x += xOffset; y += yOffset; }
<a name="l00292"></a><a class="code" href="classWTL_1_1CPoint.html#a6">00292</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::Offset(POINT point)
00293     { x += point.x; y += point.y; }
<a name="l00294"></a><a class="code" href="classWTL_1_1CPoint.html#a7">00294</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::Offset(SIZE size)
00295     { x += size.cx; y += size.cy; }
<a name="l00296"></a><a class="code" href="classWTL_1_1CPoint.html#a8">00296</a> <font class="keyword">inline</font> BOOL CPoint::operator==(POINT point)<font class="keyword"> const</font>
00297 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (x == point.x &amp;&amp; y == point.y); }
<a name="l00298"></a><a class="code" href="classWTL_1_1CPoint.html#a9">00298</a> <font class="keyword">inline</font> BOOL CPoint::operator!=(POINT point)<font class="keyword"> const</font>
00299 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (x != point.x || y != point.y); }
<a name="l00300"></a><a class="code" href="classWTL_1_1CPoint.html#a10">00300</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::operator+=(SIZE size)
00301     { x += size.cx; y += size.cy; }
<a name="l00302"></a><a class="code" href="classWTL_1_1CPoint.html#a11">00302</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::operator-=(SIZE size)
00303     { x -= size.cx; y -= size.cy; }
<a name="l00304"></a><a class="code" href="classWTL_1_1CPoint.html#a12">00304</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::operator+=(POINT point)
00305     { x += point.x; y += point.y; }
<a name="l00306"></a><a class="code" href="classWTL_1_1CPoint.html#a13">00306</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::operator-=(POINT point)
00307     { x -= point.x; y -= point.y; }
<a name="l00308"></a><a class="code" href="classWTL_1_1CPoint.html#a14">00308</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CPoint::SetPoint(<font class="keywordtype">int</font> X, <font class="keywordtype">int</font> Y)
00309     { x = X; y = Y; }
<a name="l00310"></a><a class="code" href="classWTL_1_1CPoint.html#a15">00310</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CPoint::operator+(SIZE size)<font class="keyword"> const</font>
00311 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(x + size.cx, y + size.cy); }
<a name="l00312"></a><a class="code" href="classWTL_1_1CPoint.html#a16">00312</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CPoint::operator-(SIZE size)<font class="keyword"> const</font>
00313 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(x - size.cx, y - size.cy); }
<a name="l00314"></a><a class="code" href="classWTL_1_1CPoint.html#a17">00314</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CPoint::operator-()<font class="keyword"> const</font>
00315 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(-x, -y); }
<a name="l00316"></a><a class="code" href="classWTL_1_1CPoint.html#a18">00316</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CPoint::operator+(POINT point)<font class="keyword"> const</font>
00317 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html#a0">CPoint</a>(x + point.x, y + point.y); }
<a name="l00318"></a><a class="code" href="classWTL_1_1CPoint.html#a19">00318</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a> CPoint::operator-(POINT point)<font class="keyword"> const</font>
00319 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a>(x - point.x, y - point.y); }
<a name="l00320"></a><a class="code" href="classWTL_1_1CPoint.html#a20">00320</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CPoint::operator+(<font class="keyword">const</font> RECT* lpRect)<font class="keyword"> const</font>
00321 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a>(lpRect) + *<font class="keyword">this</font>; }
<a name="l00322"></a><a class="code" href="classWTL_1_1CPoint.html#a21">00322</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CPoint::operator-(<font class="keyword">const</font> RECT* lpRect)<font class="keyword"> const</font>
00323 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a>(lpRect) - *<font class="keyword">this</font>; }
00324 
00325 <font class="comment">// CRect</font>
<a name="l00326"></a><a class="code" href="classWTL_1_1CRect.html#a0">00326</a> <font class="keyword">inline</font> CRect::CRect()
00327     { <font class="comment">/* random filled */</font> }
<a name="l00328"></a><a class="code" href="classWTL_1_1CRect.html#a1">00328</a> <font class="keyword">inline</font> CRect::CRect(<font class="keywordtype">int</font> l, <font class="keywordtype">int</font> t, <font class="keywordtype">int</font> r, <font class="keywordtype">int</font> b)
00329     { left = l; top = t; right = r; bottom = b; }
<a name="l00330"></a><a class="code" href="classWTL_1_1CRect.html#a2">00330</a> <font class="keyword">inline</font> CRect::CRect(<font class="keyword">const</font> RECT&amp; srcRect)
00331     { ::CopyRect(<font class="keyword">this</font>, &amp;srcRect); }
<a name="l00332"></a><a class="code" href="classWTL_1_1CRect.html#a3">00332</a> <font class="keyword">inline</font> CRect::CRect(LPCRECT lpSrcRect)
00333     { ::CopyRect(<font class="keyword">this</font>, lpSrcRect); }
<a name="l00334"></a><a class="code" href="classWTL_1_1CRect.html#a4">00334</a> <font class="keyword">inline</font> CRect::CRect(POINT point, SIZE size)
00335     { right = (left = point.x) + size.cx; bottom = (top = point.y) + size.cy; }
<a name="l00336"></a><a class="code" href="classWTL_1_1CRect.html#a5">00336</a> <font class="keyword">inline</font> CRect::CRect(POINT topLeft, POINT bottomRight)
00337     { left = topLeft.x; top = topLeft.y;
00338         right = bottomRight.x; bottom = bottomRight.y; }
<a name="l00339"></a><a class="code" href="classWTL_1_1CRect.html#a6">00339</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CRect::Width()<font class="keyword"> const</font>
00340 <font class="keyword">    </font>{ <font class="keywordflow">return</font> right - left; }
<a name="l00341"></a><a class="code" href="classWTL_1_1CRect.html#a7">00341</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CRect::Height()<font class="keyword"> const</font>
00342 <font class="keyword">    </font>{ <font class="keywordflow">return</font> bottom - top; }
<a name="l00343"></a><a class="code" href="classWTL_1_1CRect.html#a8">00343</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a> CRect::Size()<font class="keyword"> const</font>
00344 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CSize.html">CSize</a>(right - left, bottom - top); }
<a name="l00345"></a><a class="code" href="classWTL_1_1CRect.html#a9">00345</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; CRect::TopLeft()
00346     { <font class="keywordflow">return</font> *((<a class="code" href="classWTL_1_1CPoint.html">CPoint</a>*)<font class="keyword">this</font>); }
<a name="l00347"></a><a class="code" href="classWTL_1_1CRect.html#a10">00347</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; CRect::BottomRight()
00348     { <font class="keywordflow">return</font> *((<a class="code" href="classWTL_1_1CPoint.html">CPoint</a>*)<font class="keyword">this</font> + 1); }
<a name="l00349"></a><a class="code" href="classWTL_1_1CRect.html#a11">00349</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; CRect::TopLeft()<font class="keyword"> const</font>
00350 <font class="keyword">    </font>{ <font class="keywordflow">return</font> *((<a class="code" href="classWTL_1_1CPoint.html">CPoint</a>*)<font class="keyword">this</font>); }
<a name="l00351"></a><a class="code" href="classWTL_1_1CRect.html#a12">00351</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>&amp; CRect::BottomRight()<font class="keyword"> const</font>
00352 <font class="keyword">    </font>{ <font class="keywordflow">return</font> *((<a class="code" href="classWTL_1_1CPoint.html">CPoint</a>*)<font class="keyword">this</font> + 1); }
<a name="l00353"></a><a class="code" href="classWTL_1_1CRect.html#a13">00353</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a> CRect::CenterPoint()<font class="keyword"> const</font>
00354 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CPoint.html">CPoint</a>((left + right) / 2, (top + bottom) / 2); }
<a name="l00355"></a><a class="code" href="classWTL_1_1CRect.html#a14">00355</a> <font class="keyword">inline</font> CRect::operator LPRECT()
00356     { <font class="keywordflow">return</font> <font class="keyword">this</font>; }
<a name="l00357"></a><a class="code" href="classWTL_1_1CRect.html#a15">00357</a> <font class="keyword">inline</font> CRect::operator LPCRECT()<font class="keyword"> const</font>
00358 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <font class="keyword">this</font>; }
<a name="l00359"></a><a class="code" href="classWTL_1_1CRect.html#a16">00359</a> <font class="keyword">inline</font> BOOL CRect::IsRectEmpty()<font class="keyword"> const</font>
00360 <font class="keyword">    </font>{ return ::IsRectEmpty(<font class="keyword">this</font>); }
<a name="l00361"></a><a class="code" href="classWTL_1_1CRect.html#a17">00361</a> <font class="keyword">inline</font> BOOL CRect::IsRectNull()<font class="keyword"> const</font>
00362 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (left == 0 &amp;&amp; right == 0 &amp;&amp; top == 0 &amp;&amp; bottom == 0); }
<a name="l00363"></a><a class="code" href="classWTL_1_1CRect.html#a18">00363</a> <font class="keyword">inline</font> BOOL CRect::PtInRect(POINT point)<font class="keyword"> const</font>
00364 <font class="keyword">    </font>{ return ::PtInRect(<font class="keyword">this</font>, point); }
<a name="l00365"></a><a class="code" href="classWTL_1_1CRect.html#a19">00365</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::SetRect(<font class="keywordtype">int</font> x1, <font class="keywordtype">int</font> y1, <font class="keywordtype">int</font> x2, <font class="keywordtype">int</font> y2)
00366     { ::SetRect(<font class="keyword">this</font>, x1, y1, x2, y2); }
<a name="l00367"></a><a class="code" href="classWTL_1_1CRect.html#a20">00367</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::SetRect(POINT topLeft, POINT bottomRight)
00368     { ::SetRect(<font class="keyword">this</font>, topLeft.x, topLeft.y, bottomRight.x, bottomRight.y); }
<a name="l00369"></a><a class="code" href="classWTL_1_1CRect.html#a21">00369</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::SetRectEmpty()
00370     { ::SetRectEmpty(this); }
<a name="l00371"></a><a class="code" href="classWTL_1_1CRect.html#a22">00371</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::CopyRect(LPCRECT lpSrcRect)
00372     { ::CopyRect(<font class="keyword">this</font>, lpSrcRect); }
<a name="l00373"></a><a class="code" href="classWTL_1_1CRect.html#a23">00373</a> <font class="keyword">inline</font> BOOL CRect::EqualRect(LPCRECT lpRect)<font class="keyword"> const</font>
00374 <font class="keyword">    </font>{ return ::EqualRect(<font class="keyword">this</font>, lpRect); }
<a name="l00375"></a><a class="code" href="classWTL_1_1CRect.html#a24">00375</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::InflateRect(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)
00376     { ::InflateRect(<font class="keyword">this</font>, x, y); }
<a name="l00377"></a><a class="code" href="classWTL_1_1CRect.html#a25">00377</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::InflateRect(SIZE size)
00378     { ::InflateRect(<font class="keyword">this</font>, size.cx, size.cy); }
<a name="l00379"></a><a class="code" href="classWTL_1_1CRect.html#a28">00379</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::DeflateRect(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)
00380     { ::InflateRect(<font class="keyword">this</font>, -x, -y); }
<a name="l00381"></a><a class="code" href="classWTL_1_1CRect.html#a29">00381</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::DeflateRect(SIZE size)
00382     { ::InflateRect(<font class="keyword">this</font>, -size.cx, -size.cy); }
<a name="l00383"></a><a class="code" href="classWTL_1_1CRect.html#a32">00383</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::OffsetRect(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)
00384     { ::OffsetRect(<font class="keyword">this</font>, x, y); }
<a name="l00385"></a><a class="code" href="classWTL_1_1CRect.html#a34">00385</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::OffsetRect(POINT point)
00386     { ::OffsetRect(<font class="keyword">this</font>, point.x, point.y); }
<a name="l00387"></a><a class="code" href="classWTL_1_1CRect.html#a33">00387</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::OffsetRect(SIZE size)
00388     { ::OffsetRect(<font class="keyword">this</font>, size.cx, size.cy); }
<a name="l00389"></a><a class="code" href="classWTL_1_1CRect.html#a40">00389</a> <font class="keyword">inline</font> BOOL CRect::IntersectRect(LPCRECT lpRect1, LPCRECT lpRect2)
00390     { return ::IntersectRect(<font class="keyword">this</font>, lpRect1, lpRect2);}
<a name="l00391"></a><a class="code" href="classWTL_1_1CRect.html#a41">00391</a> <font class="keyword">inline</font> BOOL CRect::UnionRect(LPCRECT lpRect1, LPCRECT lpRect2)
00392     { return ::UnionRect(<font class="keyword">this</font>, lpRect1, lpRect2); }
<a name="l00393"></a><a class="code" href="classWTL_1_1CRect.html#a43">00393</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator=(<font class="keyword">const</font> RECT&amp; srcRect)
00394     { ::CopyRect(<font class="keyword">this</font>, &amp;srcRect); }
<a name="l00395"></a><a class="code" href="classWTL_1_1CRect.html#a44">00395</a> <font class="keyword">inline</font> BOOL CRect::operator==(<font class="keyword">const</font> RECT&amp; rect)<font class="keyword"> const</font>
00396 <font class="keyword">    </font>{ return ::EqualRect(<font class="keyword">this</font>, &amp;rect); }
<a name="l00397"></a><a class="code" href="classWTL_1_1CRect.html#a45">00397</a> <font class="keyword">inline</font> BOOL CRect::operator!=(<font class="keyword">const</font> RECT&amp; rect)<font class="keyword"> const</font>
00398 <font class="keyword">    </font>{ <font class="keywordflow">return</font> !::EqualRect(<font class="keyword">this</font>, &amp;rect); }
<a name="l00399"></a><a class="code" href="classWTL_1_1CRect.html#a46">00399</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator+=(POINT point)
00400     { ::OffsetRect(<font class="keyword">this</font>, point.x, point.y); }
<a name="l00401"></a><a class="code" href="classWTL_1_1CRect.html#a47">00401</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator+=(SIZE size)
00402     { ::OffsetRect(<font class="keyword">this</font>, size.cx, size.cy); }
<a name="l00403"></a><a class="code" href="classWTL_1_1CRect.html#a48">00403</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator+=(LPCRECT lpRect)
00404     { <a class="code" href="classWTL_1_1CRect.html#a24">InflateRect</a>(lpRect); }
<a name="l00405"></a><a class="code" href="classWTL_1_1CRect.html#a49">00405</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator-=(POINT point)
00406     { ::OffsetRect(<font class="keyword">this</font>, -point.x, -point.y); }
<a name="l00407"></a><a class="code" href="classWTL_1_1CRect.html#a50">00407</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator-=(SIZE size)
00408     { ::OffsetRect(<font class="keyword">this</font>, -size.cx, -size.cy); }
<a name="l00409"></a><a class="code" href="classWTL_1_1CRect.html#a51">00409</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator-=(LPCRECT lpRect)
00410     { <a class="code" href="classWTL_1_1CRect.html#a28">DeflateRect</a>(lpRect); }
<a name="l00411"></a><a class="code" href="classWTL_1_1CRect.html#a52">00411</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator&amp;=(<font class="keyword">const</font> RECT&amp; rect)
00412     { ::IntersectRect(<font class="keyword">this</font>, <font class="keyword">this</font>, &amp;rect); }
<a name="l00413"></a><a class="code" href="classWTL_1_1CRect.html#a53">00413</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::operator|=(<font class="keyword">const</font> RECT&amp; rect)
00414     { ::UnionRect(<font class="keyword">this</font>, <font class="keyword">this</font>, &amp;rect); }
<a name="l00415"></a><a class="code" href="classWTL_1_1CRect.html#a54">00415</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator+(POINT pt)<font class="keyword"> const</font>
00416 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect(*<font class="keyword">this</font>); ::OffsetRect(&amp;rect, pt.x, pt.y); <font class="keywordflow">return</font> rect; }
<a name="l00417"></a><a class="code" href="classWTL_1_1CRect.html#a55">00417</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator-(POINT pt)<font class="keyword"> const</font>
00418 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect(*<font class="keyword">this</font>); ::OffsetRect(&amp;rect, -pt.x, -pt.y); <font class="keywordflow">return</font> rect; }
<a name="l00419"></a><a class="code" href="classWTL_1_1CRect.html#a57">00419</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator+(SIZE size)<font class="keyword"> const</font>
00420 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect(*<font class="keyword">this</font>); ::OffsetRect(&amp;rect, size.cx, size.cy); <font class="keywordflow">return</font> rect; }
<a name="l00421"></a><a class="code" href="classWTL_1_1CRect.html#a58">00421</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator-(SIZE size)<font class="keyword"> const</font>
00422 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect(*<font class="keyword">this</font>); ::OffsetRect(&amp;rect, -size.cx, -size.cy); <font class="keywordflow">return</font> rect; }
<a name="l00423"></a><a class="code" href="classWTL_1_1CRect.html#a56">00423</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator+(LPCRECT lpRect)<font class="keyword"> const</font>
00424 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect(<font class="keyword">this</font>); rect.<a class="code" href="classWTL_1_1CRect.html#a24">InflateRect</a>(lpRect); <font class="keywordflow">return</font> rect; }
<a name="l00425"></a><a class="code" href="classWTL_1_1CRect.html#a59">00425</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator-(LPCRECT lpRect)<font class="keyword"> const</font>
00426 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect(<font class="keyword">this</font>); rect.<a class="code" href="classWTL_1_1CRect.html#a28">DeflateRect</a>(lpRect); <font class="keywordflow">return</font> rect; }
<a name="l00427"></a><a class="code" href="classWTL_1_1CRect.html#a60">00427</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator&amp;(<font class="keyword">const</font> RECT&amp; rect2)<font class="keyword"> const</font>
00428 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect; ::IntersectRect(&amp;rect, <font class="keyword">this</font>, &amp;rect2);
00429         <font class="keywordflow">return</font> rect; }
<a name="l00430"></a><a class="code" href="classWTL_1_1CRect.html#a61">00430</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::operator|(<font class="keyword">const</font> RECT&amp; rect2)<font class="keyword"> const</font>
00431 <font class="keyword">    </font>{ <a class="code" href="classWTL_1_1CRect.html">CRect</a> rect; ::UnionRect(&amp;rect, <font class="keyword">this</font>, &amp;rect2);
00432         <font class="keywordflow">return</font> rect; }
<a name="l00433"></a><a class="code" href="classWTL_1_1CRect.html#a42">00433</a> <font class="keyword">inline</font> BOOL CRect::SubtractRect(LPCRECT lpRectSrc1, LPCRECT lpRectSrc2)
00434     { return ::SubtractRect(<font class="keyword">this</font>, lpRectSrc1, lpRectSrc2); }
00435 
<a name="l00436"></a><a class="code" href="classWTL_1_1CRect.html#a35">00436</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::NormalizeRect()
00437 {
00438     <font class="keywordtype">int</font> nTemp;
00439     <font class="keywordflow">if</font> (left &gt; right)
00440     {
00441         nTemp = left;
00442         left = right;
00443         right = nTemp;
00444     }
00445     <font class="keywordflow">if</font> (top &gt; bottom)
00446     {
00447         nTemp = top;
00448         top = bottom;
00449         bottom = nTemp;
00450     }
00451 }
00452 
<a name="l00453"></a><a class="code" href="classWTL_1_1CRect.html#a36">00453</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::MoveToY(<font class="keywordtype">int</font> y)
00454     { bottom = <a class="code" href="classWTL_1_1CRect.html#a7">Height</a>() + y; top = y; }
<a name="l00455"></a><a class="code" href="classWTL_1_1CRect.html#a37">00455</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::MoveToX(<font class="keywordtype">int</font> x)
00456     { right = <a class="code" href="classWTL_1_1CRect.html#a6">Width</a>() + x; left = x; }
<a name="l00457"></a><a class="code" href="classWTL_1_1CRect.html#a38">00457</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::MoveToXY(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)
00458     { <a class="code" href="classWTL_1_1CRect.html#a37">MoveToX</a>(x); <a class="code" href="classWTL_1_1CRect.html#a36">MoveToY</a>(y); }
<a name="l00459"></a><a class="code" href="classWTL_1_1CRect.html#a39">00459</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::MoveToXY(POINT pt)
00460     { <a class="code" href="classWTL_1_1CRect.html#a37">MoveToX</a>(pt.x); <a class="code" href="classWTL_1_1CRect.html#a36">MoveToY</a>(pt.y); }
00461 
<a name="l00462"></a><a class="code" href="classWTL_1_1CRect.html#a26">00462</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::InflateRect(LPCRECT lpRect)
00463 {
00464     left -= lpRect-&gt;left;
00465     top -= lpRect-&gt;top;
00466     right += lpRect-&gt;right;
00467     bottom += lpRect-&gt;bottom;
00468 }
00469 
<a name="l00470"></a><a class="code" href="classWTL_1_1CRect.html#a27">00470</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::InflateRect(<font class="keywordtype">int</font> l, <font class="keywordtype">int</font> t, <font class="keywordtype">int</font> r, <font class="keywordtype">int</font> b)
00471 {
00472     left -= l;
00473     top -= t;
00474     right += r;
00475     bottom += b;
00476 }
00477 
<a name="l00478"></a><a class="code" href="classWTL_1_1CRect.html#a30">00478</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::DeflateRect(LPCRECT lpRect)
00479 {
00480     left += lpRect-&gt;left;
00481     top += lpRect-&gt;top;
00482     right -= lpRect-&gt;right;
00483     bottom -= lpRect-&gt;bottom;
00484 }
00485 
<a name="l00486"></a><a class="code" href="classWTL_1_1CRect.html#a31">00486</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CRect::DeflateRect(<font class="keywordtype">int</font> l, <font class="keywordtype">int</font> t, <font class="keywordtype">int</font> r, <font class="keywordtype">int</font> b)
00487 {
00488     left += l;
00489     top += t;
00490     right -= r;
00491     bottom -= b;
00492 }
00493 
<a name="l00494"></a><a class="code" href="classWTL_1_1CRect.html#a62">00494</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CRect.html">CRect</a> CRect::MulDiv(<font class="keywordtype">int</font> nMultiplier, <font class="keywordtype">int</font> nDivisor)<font class="keyword"> const</font>
00495 <font class="keyword"></font>{
00496     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRect.html#a0">CRect</a>(
00497         ::<a class="code" href="classWTL_1_1CRect.html#a62">MulDiv</a>(left, nMultiplier, nDivisor),
00498         ::<a class="code" href="classWTL_1_1CRect.html#a62">MulDiv</a>(top, nMultiplier, nDivisor),
00499         ::<a class="code" href="classWTL_1_1CRect.html#a62">MulDiv</a>(right, nMultiplier, nDivisor),
00500         ::<a class="code" href="classWTL_1_1CRect.html#a62">MulDiv</a>(bottom, nMultiplier, nDivisor));
00501 }
00502 
00503 <font class="preprocessor">#endif </font>
00504 <font class="preprocessor"></font>
00505 <font class="preprocessor"></font>
00507 <font class="comment">// CString - String class</font>
00508 
00509 <font class="preprocessor">#ifndef _WTL_NO_CSTRING</font>
00510 <font class="preprocessor"></font>
<a name="l00511"></a><a class="code" href="structWTL_1_1CStringData.html">00511</a> <font class="keyword">struct </font><a class="code" href="structWTL_1_1CStringData.html">CStringData</a>
00512 {
<a name="l00513"></a><a class="code" href="structWTL_1_1CStringData.html#m0">00513</a>     <font class="keywordtype">long</font> <a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a>;     <font class="comment">// reference count</font>
<a name="l00514"></a><a class="code" href="structWTL_1_1CStringData.html#m1">00514</a>     <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
<a name="l00515"></a><a class="code" href="structWTL_1_1CStringData.html#m2">00515</a>     <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a>;
00516     <font class="comment">// TCHAR data[nAllocLength]</font>
00517 
<a name="l00518"></a><a class="code" href="structWTL_1_1CStringData.html#a0">00518</a>     TCHAR* <a class="code" href="structWTL_1_1CStringData.html#a0">data</a>()
00519         { <font class="keywordflow">return</font> (TCHAR*)(<font class="keyword">this</font> + 1); }
00520 };
00521 
00522 <font class="comment">// Globals</font>
00523 
00524 <font class="comment">// For an empty string, m_pchData will point here</font>
00525 <font class="comment">// (note: avoids special case of checking for NULL m_pchData)</font>
00526 <font class="comment">// empty string data (and locked)</font>
<a name="l00527"></a><a class="code" href="namespaceWTL.html#a66">00527</a> <a class="code" href="namespaceWTL.html#a66">_declspec</a>(selectany) <font class="keywordtype">int</font> rgInitData[] = { -1, 0, 0, 0 };
00528 <a class="code" href="namespaceWTL.html#a66">_declspec</a>(selectany) CStringData* _atltmpDataNil = (CStringData*)&amp;rgInitData;
00529 <a class="code" href="namespaceWTL.html#a66">_declspec</a>(selectany) LPCTSTR _atltmpPchNil = (LPCTSTR)(((BYTE*)&amp;rgInitData) + <font class="keyword">sizeof</font>(CStringData));
00530 
00531 
<a name="l00532"></a><a class="code" href="classWTL_1_1CString.html">00532</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CString.html">CString</a>
00533 {
00534 <font class="keyword">public</font>:
00535 <font class="comment">// Constructors</font>
00536     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>();
00537     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; stringSrc);
00538     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(TCHAR ch, <font class="keywordtype">int</font> nRepeat = 1);
00539     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(LPCSTR lpsz);
00540     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(LPCWSTR lpsz);
00541     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(LPCSTR lpch, <font class="keywordtype">int</font> nLength);
00542     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(LPCWSTR lpch, <font class="keywordtype">int</font> nLength);
00543     <a class="code" href="classWTL_1_1CString.html#a0">CString</a>(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* psz);
00544 
00545 <font class="comment">// Attributes &amp; Operations</font>
00546     <font class="comment">// as an array of characters</font>
00547     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a8">GetLength</a>() <font class="keyword">const</font>;
00548     BOOL <a class="code" href="classWTL_1_1CString.html#a9">IsEmpty</a>() <font class="keyword">const</font>;
00549     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a10">Empty</a>();                       <font class="comment">// free up the data</font>
00550 
00551     TCHAR <a class="code" href="classWTL_1_1CString.html#a11">GetAt</a>(<font class="keywordtype">int</font> nIndex) <font class="keyword">const</font>;      <font class="comment">// 0 based</font>
00552     TCHAR <a class="code" href="classWTL_1_1CString.html#a12">operator[]</a>(<font class="keywordtype">int</font> nIndex) <font class="keyword">const</font>; <font class="comment">// same as GetAt</font>
00553     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a13">SetAt</a>(<font class="keywordtype">int</font> nIndex, TCHAR ch);
00554     <a class="code" href="classWTL_1_1CString.html#a14">operator LPCTSTR</a>() <font class="keyword">const</font>;           <font class="comment">// as a C string</font>
00555 
00556     <font class="comment">// overloaded assignment</font>
00557     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a15">operator=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; stringSrc);
00558     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a15">operator=</a>(TCHAR ch);
00559 <font class="preprocessor">#ifdef _UNICODE</font>
00560 <font class="preprocessor"></font>    <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a15">operator=</a>(<font class="keywordtype">char</font> ch);
00561 <font class="preprocessor">#endif</font>
00562 <font class="preprocessor"></font>    <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a15">operator=</a>(LPCSTR lpsz);
00563     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a15">operator=</a>(LPCWSTR lpsz);
00564     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a15">operator=</a>(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* psz);
00565 
00566     <font class="comment">// string concatenation</font>
00567     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a20">operator+=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string);
00568     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a20">operator+=</a>(TCHAR ch);
00569 <font class="preprocessor">#ifdef _UNICODE</font>
00570 <font class="preprocessor"></font>    <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a20">operator+=</a>(<font class="keywordtype">char</font> ch);
00571 <font class="preprocessor">#endif</font>
00572 <font class="preprocessor"></font>    <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a20">operator+=</a>(LPCTSTR lpsz);
00573 
00574     <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string2);
00575     <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string, TCHAR ch);
00576     <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(TCHAR ch, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string);
00577 <font class="preprocessor">#ifdef _UNICODE</font>
00578 <font class="preprocessor"></font>    <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string, <font class="keywordtype">char</font> ch);
00579     <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(<font class="keywordtype">char</font> ch, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string);
00580 <font class="preprocessor">#endif</font>
00581 <font class="preprocessor"></font>    <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string, LPCTSTR lpsz);
00582     <font class="keyword">friend</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="classWTL_1_1CString.html#a85">operator+</a>(LPCTSTR lpsz, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string);
00583 
00584     <font class="comment">// string comparison</font>
00585     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(LPCTSTR lpsz) <font class="keyword">const</font>;         <font class="comment">// straight character</font>
00586     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a24">CompareNoCase</a>(LPCTSTR lpsz) <font class="keyword">const</font>;   <font class="comment">// ignore case</font>
00587     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a25">Collate</a>(LPCTSTR lpsz) <font class="keyword">const</font>;         <font class="comment">// NLS aware</font>
00588     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a26">CollateNoCase</a>(LPCTSTR lpsz) <font class="keyword">const</font>;   <font class="comment">// ignore case</font>
00589 
00590     <font class="comment">// simple sub-string extraction</font>
00591     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CString.html#a27">Mid</a>(<font class="keywordtype">int</font> nFirst, <font class="keywordtype">int</font> nCount) <font class="keyword">const</font>;
00592     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CString.html#a27">Mid</a>(<font class="keywordtype">int</font> nFirst) <font class="keyword">const</font>;
00593     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CString.html#a29">Left</a>(<font class="keywordtype">int</font> nCount) <font class="keyword">const</font>;
00594     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CString.html#a30">Right</a>(<font class="keywordtype">int</font> nCount) <font class="keyword">const</font>;
00595 
00596     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CString.html#a31">SpanIncluding</a>(LPCTSTR lpszCharSet) <font class="keyword">const</font>;
00597     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CString.html#a32">SpanExcluding</a>(LPCTSTR lpszCharSet) <font class="keyword">const</font>;
00598 
00599     <font class="comment">// upper/lower/reverse conversion</font>
00600     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a33">MakeUpper</a>();
00601     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a34">MakeLower</a>();
00602     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a35">MakeReverse</a>();
00603 
00604     <font class="comment">// trimming whitespace (either side)</font>
00605     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a36">TrimRight</a>();
00606     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a37">TrimLeft</a>();
00607 
00608     <font class="comment">// remove continuous occurrences of chTarget starting from right</font>
00609     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a36">TrimRight</a>(TCHAR chTarget);
00610     <font class="comment">// remove continuous occcurrences of characters in passed string,</font>
00611     <font class="comment">// starting from right</font>
00612     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a36">TrimRight</a>(LPCTSTR lpszTargets);
00613     <font class="comment">// remove continuous occurrences of chTarget starting from left</font>
00614     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a37">TrimLeft</a>(TCHAR chTarget);
00615     <font class="comment">// remove continuous occcurrences of characters in</font>
00616     <font class="comment">// passed string, starting from left</font>
00617     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a37">TrimLeft</a>(LPCTSTR lpszTargets);
00618 
00619     <font class="comment">// advanced manipulation</font>
00620     <font class="comment">// replace occurrences of chOld with chNew</font>
00621     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a42">Replace</a>(TCHAR chOld, TCHAR chNew);
00622     <font class="comment">// replace occurrences of substring lpszOld with lpszNew;</font>
00623     <font class="comment">// empty lpszNew removes instances of lpszOld</font>
00624     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a42">Replace</a>(LPCTSTR lpszOld, LPCTSTR lpszNew);
00625     <font class="comment">// remove occurrences of chRemove</font>
00626     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a44">Remove</a>(TCHAR chRemove);
00627     <font class="comment">// insert character at zero-based index; concatenates</font>
00628     <font class="comment">// if index is past end of string</font>
00629     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a45">Insert</a>(<font class="keywordtype">int</font> nIndex, TCHAR ch);
00630     <font class="comment">// insert substring at zero-based index; concatenates</font>
00631     <font class="comment">// if index is past end of string</font>
00632     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a45">Insert</a>(<font class="keywordtype">int</font> nIndex, LPCTSTR pstr);
00633     <font class="comment">// delete nCount characters starting at zero-based index</font>
00634     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a47">Delete</a>(<font class="keywordtype">int</font> nIndex, <font class="keywordtype">int</font> nCount = 1);
00635 
00636     <font class="comment">// searching (return starting index, or -1 if not found)</font>
00637     <font class="comment">// look for a single character match</font>
00638     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a48">Find</a>(TCHAR ch) <font class="keyword">const</font>;                     <font class="comment">// like "C" strchr</font>
00639     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a49">ReverseFind</a>(TCHAR ch) <font class="keyword">const</font>;
00640     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a48">Find</a>(TCHAR ch, <font class="keywordtype">int</font> nStart) <font class="keyword">const</font>;         <font class="comment">// starting at index</font>
00641     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a51">FindOneOf</a>(LPCTSTR lpszCharSet) <font class="keyword">const</font>;
00642 
00643     <font class="comment">// look for a specific sub-string</font>
00644     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a48">Find</a>(LPCTSTR lpszSub) <font class="keyword">const</font>;        <font class="comment">// like "C" strstr</font>
00645     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a48">Find</a>(LPCTSTR lpszSub, <font class="keywordtype">int</font> nStart) <font class="keyword">const</font>;  <font class="comment">// starting at index</font>
00646 
00647     <font class="comment">// Concatentation for non strings</font>
<a name="l00648"></a><a class="code" href="classWTL_1_1CString.html#a54">00648</a>     <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; <a class="code" href="classWTL_1_1CString.html#a54">Append</a>(<font class="keywordtype">int</font> n)
00649     {
00650         TCHAR szBuffer[10];
00651         wsprintf(szBuffer,_T(<font class="stringliteral">"%d"</font>),n);
00652         <a class="code" href="classWTL_1_1CString.html#b6">ConcatInPlace</a>(<a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(szBuffer), szBuffer);
00653         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00654     }
00655 
00656     <font class="comment">// simple formatting</font>
00657     BOOL __cdecl <a class="code" href="classWTL_1_1CString.html#a55">Format</a>(LPCTSTR lpszFormat, ...);
00658     BOOL __cdecl <a class="code" href="classWTL_1_1CString.html#a55">Format</a>(UINT nFormatID, ...);
00659     BOOL <a class="code" href="classWTL_1_1CString.html#a57">FormatV</a>(LPCTSTR lpszFormat, va_list argList);
00660 
00661     <font class="comment">// formatting for localization (uses FormatMessage API)</font>
00662     BOOL __cdecl <a class="code" href="classWTL_1_1CString.html#a58">FormatMessage</a>(LPCTSTR lpszFormat, ...);
00663     BOOL __cdecl <a class="code" href="classWTL_1_1CString.html#a58">FormatMessage</a>(UINT nFormatID, ...);
00664 
00665     <font class="comment">// Windows support</font>
00666     BOOL <a class="code" href="classWTL_1_1CString.html#a60">LoadString</a>(UINT nID);          <font class="comment">// load from string resource</font>
00667                                         <font class="comment">// 255 chars max</font>
00668 <font class="preprocessor">#ifndef _UNICODE</font>
00669 <font class="preprocessor"></font>    <font class="comment">// ANSI &lt;-&gt; OEM support (convert string in place)</font>
00670     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a61">AnsiToOem</a>();
00671     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a62">OemToAnsi</a>();
00672 <font class="preprocessor">#endif</font>
00673 <font class="preprocessor"></font>
00674 <font class="preprocessor">#ifndef _ATL_NO_COM</font>
00675 <font class="preprocessor"></font>    <font class="comment">// OLE BSTR support (use for OLE automation)</font>
00676     BSTR <a class="code" href="classWTL_1_1CString.html#a63">AllocSysString</a>() <font class="keyword">const</font>;
00677     BSTR <a class="code" href="classWTL_1_1CString.html#a64">SetSysString</a>(BSTR* pbstr) <font class="keyword">const</font>;
00678 <font class="preprocessor">#endif </font>
00679 <font class="preprocessor"></font>
00680 <font class="preprocessor"></font>    <font class="comment">// Access to string implementation buffer as "C" character array</font>
00681     LPTSTR <a class="code" href="classWTL_1_1CString.html#a65">GetBuffer</a>(<font class="keywordtype">int</font> nMinBufLength);
00682     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>(<font class="keywordtype">int</font> nNewLength = -1);
00683     LPTSTR <a class="code" href="classWTL_1_1CString.html#a67">GetBufferSetLength</a>(<font class="keywordtype">int</font> nNewLength);
00684     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a68">FreeExtra</a>();
00685 
00686     <font class="comment">// Use LockBuffer/UnlockBuffer to turn refcounting off</font>
00687     LPTSTR <a class="code" href="classWTL_1_1CString.html#a69">LockBuffer</a>();
00688     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#a70">UnlockBuffer</a>();
00689 
00690 <font class="comment">// Implementation</font>
00691 <font class="keyword">public</font>:
00692     <a class="code" href="classWTL_1_1CString.html#a71">~CString</a>();
00693     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#a72">GetAllocLength</a>() <font class="keyword">const</font>;
00694 
<a name="l00695"></a><a class="code" href="classWTL_1_1CString.html#d0">00695</a>     <font class="keyword">static</font> BOOL __stdcall <a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(LPCWSTR lpsz, <font class="keywordtype">int</font> nLength = -1)
00696     {
00697         <font class="keywordflow">if</font>(lpsz == NULL)
00698             <font class="keywordflow">return</font> FALSE;
00699         <font class="keywordflow">return</font> !::IsBadStringPtrW(lpsz, nLength);
00700     }
00701 
<a name="l00702"></a><a class="code" href="classWTL_1_1CString.html#d1">00702</a>     <font class="keyword">static</font> BOOL __stdcall <a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(LPCSTR lpsz, <font class="keywordtype">int</font> nLength = -1)
00703     {
00704         <font class="keywordflow">if</font>(lpsz == NULL)
00705             <font class="keywordflow">return</font> FALSE;
00706         <font class="keywordflow">return</font> !::IsBadStringPtrA(lpsz, nLength);
00707     }
00708 
00709 <font class="keyword">protected</font>:
<a name="l00710"></a><a class="code" href="classWTL_1_1CString.html#n0">00710</a>     LPTSTR <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;   <font class="comment">// pointer to ref counted string data</font>
00711 
00712     <font class="comment">// implementation helpers</font>
00713     <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() <font class="keyword">const</font>;
00714     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
00715     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#b2">AllocCopy</a>(<a class="code" href="classWTL_1_1CString.html">CString</a>&amp; dest, <font class="keywordtype">int</font> nCopyLen, <font class="keywordtype">int</font> nCopyIndex, <font class="keywordtype">int</font> nExtraLen) <font class="keyword">const</font>;
00716     BOOL <a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(<font class="keywordtype">int</font> nLen);
00717     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#b4">AssignCopy</a>(<font class="keywordtype">int</font> nSrcLen, LPCTSTR lpszSrcData);
00718     BOOL <a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(<font class="keywordtype">int</font> nSrc1Len, LPCTSTR lpszSrc1Data, <font class="keywordtype">int</font> nSrc2Len, LPCTSTR lpszSrc2Data);
00719     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#b6">ConcatInPlace</a>(<font class="keywordtype">int</font> nSrcLen, LPCTSTR lpszSrcData);
00720     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
00721     BOOL <a class="code" href="classWTL_1_1CString.html#b8">AllocBeforeWrite</a>(<font class="keywordtype">int</font> nLen);
00722     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CString.html#b9">Release</a>();
00723     <font class="keyword">static</font> <font class="keywordtype">void</font> PASCAL <a class="code" href="classWTL_1_1CString.html#b9">Release</a>(<a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pData);
00724     <font class="keyword">static</font> <font class="keywordtype">int</font> PASCAL <a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(LPCTSTR lpsz);
00725 
<a name="l00726"></a><a class="code" href="classWTL_1_1CString.html#e2">00726</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> __stdcall <a class="code" href="classWTL_1_1CString.html#e2">_LoadString</a>(UINT nID, LPTSTR lpszBuf, UINT nMaxBuf)
00727     {
00728 <font class="preprocessor">#ifdef _DEBUG</font>
00729 <font class="preprocessor"></font>        <font class="comment">// LoadString without annoying warning from the Debug kernel if the</font>
00730         <font class="comment">//  segment containing the string is not present</font>
00731         <font class="keywordflow">if</font> (::FindResource(_Module.GetResourceInstance(), MAKEINTRESOURCE((nID&gt;&gt;4) + 1), RT_STRING) == NULL)
00732         {
00733             lpszBuf[0] = <font class="charliteral">'\0'</font>;
00734             <font class="keywordflow">return</font> 0; <font class="comment">// not found</font>
00735         }
00736 <font class="preprocessor">#endif //_DEBUG</font>
00737 <font class="preprocessor"></font>        <font class="keywordtype">int</font> nLen = ::LoadString(_Module.GetResourceInstance(), nID, lpszBuf, nMaxBuf);
00738         <font class="keywordflow">if</font> (nLen == 0)
00739             lpszBuf[0] = <font class="charliteral">'\0'</font>;
00740         <font class="keywordflow">return</font> nLen;
00741     }
00742 
<a name="l00743"></a><a class="code" href="classWTL_1_1CString.html#e3">00743</a>     <font class="keyword">static</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; __stdcall <a class="code" href="classWTL_1_1CString.html#e3">_GetEmptyString</a>()
00744     {
00745         <font class="keywordflow">return</font> *(<a class="code" href="classWTL_1_1CString.html">CString</a>*)&amp;_atltmpPchNil;
00746     }
00747 
00748 <font class="comment">// CString conversion helpers</font>
<a name="l00749"></a><a class="code" href="classWTL_1_1CString.html#e4">00749</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> __cdecl <a class="code" href="classWTL_1_1CString.html#e4">_wcstombsz</a>(<font class="keywordtype">char</font>* mbstr, <font class="keyword">const</font> <font class="keywordtype">wchar_t</font>* wcstr, size_t count)
00750     {
00751         <font class="keywordflow">if</font> (count == 0 &amp;&amp; mbstr != NULL)
00752             <font class="keywordflow">return</font> 0;
00753 
00754         <font class="keywordtype">int</font> result = ::WideCharToMultiByte(CP_ACP, 0, wcstr, -1, mbstr, (int)count, NULL, NULL);
00755         ATLASSERT(mbstr == NULL || result &lt;= (<font class="keywordtype">int</font>)count);
00756         <font class="keywordflow">if</font> (result &gt; 0)
00757             mbstr[result - 1] = 0;
00758         <font class="keywordflow">return</font> result;
00759     }
00760 
<a name="l00761"></a><a class="code" href="classWTL_1_1CString.html#e5">00761</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> __cdecl <a class="code" href="classWTL_1_1CString.html#e5">_mbstowcsz</a>(<font class="keywordtype">wchar_t</font>* wcstr, <font class="keyword">const</font> <font class="keywordtype">char</font>* mbstr, size_t count)
00762     {
00763         <font class="keywordflow">if</font> (count == 0 &amp;&amp; wcstr != NULL)
00764             <font class="keywordflow">return</font> 0;
00765 
00766         <font class="keywordtype">int</font> result = ::MultiByteToWideChar(CP_ACP, 0, mbstr, -1, wcstr, (int)count);
00767         ATLASSERT(wcstr == NULL || result &lt;= (<font class="keywordtype">int</font>)count);
00768         <font class="keywordflow">if</font> (result &gt; 0)
00769             wcstr[result - 1] = 0;
00770         <font class="keywordflow">return</font> result;
00771     }
00772 
00773 <font class="comment">// Helpers to avoid CRT startup code</font>
00774 <font class="preprocessor">#ifdef _ATL_MIN_CRT</font>
00775 <font class="preprocessor"></font>    <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(<font class="keyword">const</font> TCHAR* p, TCHAR ch)
00776     {
00777         <font class="comment">//strchr for '\0' should succeed</font>
00778         <font class="keywordflow">while</font> (*p != 0)
00779         {
00780             <font class="keywordflow">if</font> (*p == ch)
00781                 <font class="keywordflow">break</font>;
00782             p = ::CharNext(p);
00783         }
00784         <font class="keywordflow">return</font> (TCHAR*)((*p == ch) ? p : NULL);
00785     }
00786     <font class="keyword">static</font> TCHAR* _cstrchr_db(<font class="keyword">const</font> TCHAR* p, TCHAR ch1, TCHAR ch2)
00787     {
00788         <font class="keyword">const</font> TCHAR* lpsz = NULL;
00789         <font class="keywordflow">while</font> (*p != 0)
00790         {
00791             <font class="keywordflow">if</font> (*p == ch1 &amp;&amp; *(p + 1) == ch2)
00792             {
00793                 lpsz = p;
00794                 <font class="keywordflow">break</font>;
00795             }
00796             p = ::CharNext(p);
00797         }
00798         <font class="keywordflow">return</font> (TCHAR*)lpsz;
00799     }
00800     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e7">_cstrrchr</a>(<font class="keyword">const</font> TCHAR* p, TCHAR ch)
00801     {
00802         <font class="keyword">const</font> TCHAR* lpsz = NULL;
00803         <font class="keywordflow">while</font> (*p != 0)
00804         {
00805             <font class="keywordflow">if</font> (*p == ch)
00806                 lpsz = p;
00807             p = ::CharNext(p);
00808         }
00809         <font class="keywordflow">return</font> (TCHAR*)lpsz;
00810     }
00811     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e8">_cstrrev</a>(TCHAR* pStr)
00812     {
00813         <font class="comment">// Optimize NULL, zero-length, and single-char case.</font>
00814         <font class="keywordflow">if</font> ((pStr == NULL) || (pStr[0] == <font class="charliteral">'\0'</font>) || (pStr[1] == <font class="charliteral">'\0'</font>))
00815             <font class="keywordflow">return</font> pStr;
00816 
00817         TCHAR* p = pStr;
00818 
00819         <font class="keywordflow">while</font> (p[1] != 0) 
00820         {
00821             TCHAR* pNext = ::CharNext(p);
00822             <font class="keywordflow">if</font>(pNext &gt; p + 1)
00823             {
00824                 <font class="keywordtype">char</font> p1 = *(<font class="keywordtype">char</font>*)p;
00825                 *(<font class="keywordtype">char</font>*)p = *(<font class="keywordtype">char</font>*)(p + 1);
00826                 *(<font class="keywordtype">char</font>*)(p + 1) = p1;
00827             }
00828             p = pNext;
00829         }
00830 
00831         TCHAR* q = pStr;
00832 
00833         <font class="keywordflow">while</font> (q &lt; p)
00834         {
00835             TCHAR t = *q;
00836             *q = *p;
00837             *p = t;
00838             q++;
00839             p--;
00840         }
00841         <font class="keywordflow">return</font> (TCHAR*)pStr;
00842     }
00843     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e9">_cstrstr</a>(<font class="keyword">const</font> TCHAR* pStr, <font class="keyword">const</font> TCHAR* pCharSet)
00844     {
00845         <font class="keywordtype">int</font> nLen = lstrlen(pCharSet);
00846         <font class="keywordflow">if</font> (nLen == 0)
00847             <font class="keywordflow">return</font> (TCHAR*)pStr;
00848 
00849         <font class="keyword">const</font> TCHAR* pRet = NULL;
00850         <font class="keyword">const</font> TCHAR* pCur = pStr;
00851         <font class="keywordflow">while</font>((pStr = <a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(pCur, *pCharSet)) != NULL)
00852         {
00853             <font class="keywordflow">if</font>(memcmp(pCur, pCharSet, nLen * <font class="keyword">sizeof</font>(TCHAR)) == 0)
00854             {
00855                 pRet = pCur;
00856                 <font class="keywordflow">break</font>;
00857             }
00858             pCur = ::CharNext(pCur);
00859         }
00860         <font class="keywordflow">return</font> (TCHAR*) pRet;
00861     }
00862     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e10">_cstrspn</a>(<font class="keyword">const</font> TCHAR* pStr, <font class="keyword">const</font> TCHAR* pCharSet)
00863     {
00864         <font class="keywordtype">int</font> nRet = 0;
00865         TCHAR* p = (TCHAR*)pStr;
00866         <font class="keywordflow">while</font> (*p != 0)
00867         {
00868             TCHAR* pNext = ::CharNext(p);
00869             <font class="keywordflow">if</font>(pNext &gt; p + 1)
00870             {
00871                 <font class="keywordflow">if</font>(_cstrchr_db(pCharSet, *p, *(p + 1)) == NULL)
00872                     <font class="keywordflow">break</font>;
00873                 nRet += 2;
00874             }
00875             <font class="keywordflow">else</font>
00876             {
00877                 <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(pCharSet, *p) == NULL)
00878                     <font class="keywordflow">break</font>;
00879                 nRet++;
00880             }
00881             p = pNext;
00882         }
00883         <font class="keywordflow">return</font> nRet;
00884     }
00885     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e11">_cstrcspn</a>(<font class="keyword">const</font> TCHAR* pStr, <font class="keyword">const</font> TCHAR* pCharSet)
00886     {
00887         <font class="keywordtype">int</font> nRet = 0;
00888         TCHAR* p = (TCHAR*)pStr;
00889         <font class="keywordflow">while</font> (*p != 0)
00890         {
00891             TCHAR* pNext = ::CharNext(p);
00892             <font class="keywordflow">if</font>(pNext &gt; p + 1)
00893             {
00894                 <font class="keywordflow">if</font>(_cstrchr_db(pCharSet, *p, *(p + 1)) != NULL)
00895                     <font class="keywordflow">break</font>;
00896                 nRet += 2;
00897             }
00898             <font class="keywordflow">else</font>
00899             {
00900                 <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(pCharSet, *p) != NULL)
00901                     <font class="keywordflow">break</font>;
00902                 nRet++;
00903             }
00904             p = pNext;
00905         }
00906         <font class="keywordflow">return</font> nRet;
00907     }
00908     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e12">_cstrpbrk</a>(<font class="keyword">const</font> TCHAR* p, <font class="keyword">const</font> TCHAR* lpszCharSet)
00909     {
00910         <font class="keywordflow">while</font> (*p != 0)
00911         {
00912             <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(lpszCharSet, *p) != NULL)
00913             {
00914                 <font class="keywordflow">return</font> (TCHAR*)p;
00915                 <font class="keywordflow">break</font>;
00916             }
00917             p = ::CharNext(p);
00918         }
00919         <font class="keywordflow">return</font> NULL;
00920     }
00921     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e13">_cstrisdigit</a>(TCHAR ch)
00922     {
00923         WORD type;
00924         GetStringTypeEx(GetThreadLocale(), CT_CTYPE1, &amp;ch, 1, &amp;type);
00925         <font class="keywordflow">return</font> (type &amp; C1_DIGIT) == C1_DIGIT;
00926     }
00927     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e14">_cstrisspace</a>(TCHAR ch)
00928     {
00929         WORD type;
00930         GetStringTypeEx(GetThreadLocale(), CT_CTYPE1, &amp;ch, 1, &amp;type);
00931         <font class="keywordflow">return</font> (type &amp; C1_SPACE) == C1_SPACE;
00932     }
00933     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e15">_cstrcmp</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
00934     {
00935         <font class="keywordflow">return</font> lstrcmp(pstrOne, pstrOther);
00936     }
00937     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e16">_cstrcmpi</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
00938     {
00939         <font class="keywordflow">return</font> lstrcmpi(pstrOne, pstrOther);
00940     }
00941     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e17">_cstrcoll</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
00942     {
00943         <font class="keywordtype">int</font> nRet = CompareString(GetThreadLocale(), 0, pstrOne, -1, pstrOther, -1);
00944         ATLASSERT(nRet != 0);
00945         <font class="keywordflow">return</font> nRet - 2;  <font class="comment">// Convert to strcmp convention.  This really is documented.</font>
00946     }
00947     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e18">_cstrcolli</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
00948     {
00949         <font class="keywordtype">int</font> nRet = CompareString(GetThreadLocale(), NORM_IGNORECASE, pstrOne, -1, pstrOther, -1);
00950         ATLASSERT(nRet != 0);
00951         <font class="keywordflow">return</font> nRet - 2;  <font class="comment">// Convert to strcmp convention.  This really is documented.</font>
00952     }
00953     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e19">_cstrtoi</a>(<font class="keyword">const</font> TCHAR* nptr)
00954     {
00955         <font class="keywordtype">int</font> c;              <font class="comment">/* current char */</font>
00956         <font class="keywordtype">int</font> total;          <font class="comment">/* current total */</font>
00957         <font class="keywordtype">int</font> sign;           <font class="comment">/* if '-', then negative, otherwise positive */</font>
00958 
00959         <font class="keywordflow">while</font> ( <a class="code" href="classWTL_1_1CString.html#e14">_cstrisspace</a>(*nptr) )
00960             ++nptr;
00961 
00962         c = (int)(_TUCHAR)*nptr++;
00963         sign = c;           <font class="comment">/* save sign indication */</font>
00964         <font class="keywordflow">if</font> (c == _T(<font class="charliteral">'-'</font>) || c == _T(<font class="charliteral">'+'</font>))
00965             c = (int)(_TUCHAR)*nptr++;    <font class="comment">/* skip sign */</font>
00966 
00967         total = 0;
00968 
00969         <font class="keywordflow">while</font> (<a class="code" href="classWTL_1_1CString.html#e13">_cstrisdigit</a>((TCHAR)c)) {
00970             total = 10 * total + (c - <font class="charliteral">'0'</font>);     <font class="comment">/* accumulate digit */</font>
00971             c = (int)(_TUCHAR)*nptr++;    <font class="comment">/* get next char */</font>
00972         }
00973 
00974         <font class="keywordflow">if</font> (sign == <font class="charliteral">'-'</font>)
00975             <font class="keywordflow">return</font> -total;
00976         <font class="keywordflow">else</font>
00977             <font class="keywordflow">return</font> total;   <font class="comment">/* return result, negated if necessary */</font>
00978     }
00979 <font class="preprocessor">#else </font>
<a name="l00980"></a><a class="code" href="classWTL_1_1CString.html#e6">00980</a> <font class="preprocessor">    static TCHAR* _cstrchr(const TCHAR* p, TCHAR ch)</font>
00981 <font class="preprocessor"></font>    {
00982         <font class="keywordflow">return</font> _tcschr(p, ch);
00983     }
<a name="l00984"></a><a class="code" href="classWTL_1_1CString.html#e7">00984</a>     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e7">_cstrrchr</a>(<font class="keyword">const</font> TCHAR* p, TCHAR ch)
00985     {
00986         <font class="keywordflow">return</font> _tcsrchr(p, ch);
00987     }
<a name="l00988"></a><a class="code" href="classWTL_1_1CString.html#e8">00988</a>     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e8">_cstrrev</a>(TCHAR* pStr)
00989     {
00990         <font class="keywordflow">return</font> _tcsrev(pStr);
00991     }
<a name="l00992"></a><a class="code" href="classWTL_1_1CString.html#e9">00992</a>     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e9">_cstrstr</a>(<font class="keyword">const</font> TCHAR* pStr, <font class="keyword">const</font> TCHAR* pCharSet)
00993     {
00994         <font class="keywordflow">return</font> _tcsstr(pStr, pCharSet);
00995     }
<a name="l00996"></a><a class="code" href="classWTL_1_1CString.html#e10">00996</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e10">_cstrspn</a>(<font class="keyword">const</font> TCHAR* pStr, <font class="keyword">const</font> TCHAR* pCharSet)
00997     {
00998         <font class="keywordflow">return</font> (int)_tcsspn(pStr, pCharSet);
00999     }
<a name="l01000"></a><a class="code" href="classWTL_1_1CString.html#e11">01000</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e11">_cstrcspn</a>(<font class="keyword">const</font> TCHAR* pStr, <font class="keyword">const</font> TCHAR* pCharSet)
01001     {
01002         <font class="keywordflow">return</font> (int)_tcscspn(pStr, pCharSet);
01003     }
<a name="l01004"></a><a class="code" href="classWTL_1_1CString.html#e12">01004</a>     <font class="keyword">static</font> TCHAR* <a class="code" href="classWTL_1_1CString.html#e12">_cstrpbrk</a>(<font class="keyword">const</font> TCHAR* p, <font class="keyword">const</font> TCHAR* lpszCharSet)
01005     {
01006         <font class="keywordflow">return</font> _tcspbrk(p, lpszCharSet);
01007     }
<a name="l01008"></a><a class="code" href="classWTL_1_1CString.html#e13">01008</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e13">_cstrisdigit</a>(TCHAR ch)
01009     {
01010         <font class="keywordflow">return</font> _istdigit(ch);
01011     }
<a name="l01012"></a><a class="code" href="classWTL_1_1CString.html#e14">01012</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e14">_cstrisspace</a>(TCHAR ch)
01013     {
01014         <font class="keywordflow">return</font> _istspace(ch);
01015     }
<a name="l01016"></a><a class="code" href="classWTL_1_1CString.html#e15">01016</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e15">_cstrcmp</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
01017     {
01018         <font class="keywordflow">return</font> _tcscmp(pstrOne, pstrOther);
01019     }
<a name="l01020"></a><a class="code" href="classWTL_1_1CString.html#e16">01020</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e16">_cstrcmpi</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
01021     {
01022         <font class="keywordflow">return</font> _tcsicmp(pstrOne, pstrOther);
01023     }
<a name="l01024"></a><a class="code" href="classWTL_1_1CString.html#e17">01024</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e17">_cstrcoll</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
01025     {
01026         <font class="keywordflow">return</font> _tcscoll(pstrOne, pstrOther);
01027     }
<a name="l01028"></a><a class="code" href="classWTL_1_1CString.html#e18">01028</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e18">_cstrcolli</a>(<font class="keyword">const</font> TCHAR* pstrOne, <font class="keyword">const</font> TCHAR* pstrOther)
01029     {
01030         <font class="keywordflow">return</font> _tcsicoll(pstrOne, pstrOther);
01031     }
<a name="l01032"></a><a class="code" href="classWTL_1_1CString.html#e19">01032</a>     <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CString.html#e19">_cstrtoi</a>(<font class="keyword">const</font> TCHAR* nptr)
01033     {
01034         <font class="keywordflow">return</font> _ttoi(nptr);
01035     }
01036 <font class="preprocessor">#endif </font>
01037 <font class="preprocessor">};</font>
01038 <font class="preprocessor"></font>
01039 <font class="comment">// Compare helpers</font>
01040 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a67">operator==</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01041 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a67">operator==</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, LPCTSTR s2);
01042 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a67">operator==</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01043 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a70">operator!=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01044 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a70">operator!=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, LPCTSTR s2);
01045 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a70">operator!=</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01046 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a73">operator&lt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01047 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a73">operator&lt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, LPCTSTR s2);
01048 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a73">operator&lt;</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01049 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a76">operator&gt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01050 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a76">operator&gt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, LPCTSTR s2);
01051 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a76">operator&gt;</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01052 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a79">operator&lt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01053 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a79">operator&lt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, LPCTSTR s2);
01054 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a79">operator&lt;=</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01055 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a82">operator&gt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01056 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a82">operator&gt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s1, LPCTSTR s2);
01057 <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a82">operator&gt;=</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html#a0">CString</a>&amp; s2);
01058 
01059 
01061 <font class="comment">// CString Implementation</font>
01062 
<a name="l01063"></a><a class="code" href="classWTL_1_1CString.html#b0">01063</a> <font class="keyword">inline</font> <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* CString::GetData()<font class="keyword"> const</font>
01064 <font class="keyword">    </font>{ ATLASSERT(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> != NULL); <font class="keywordflow">return</font> ((<a class="code" href="structWTL_1_1CStringData.html">CStringData</a>*)<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>) - 1; }
<a name="l01065"></a><a class="code" href="classWTL_1_1CString.html#b1">01065</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::Init()
01066     { <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> = <a class="code" href="classWTL_1_1CString.html#e3">_GetEmptyString</a>().<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>; }
<a name="l01067"></a><a class="code" href="classWTL_1_1CString.html#a7">01067</a> <font class="keyword">inline</font> CString::CString(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* lpsz)
01068     { <a class="code" href="classWTL_1_1CString.html#b1">Init</a>(); *<font class="keyword">this</font> = (LPCSTR)lpsz; }
<a name="l01069"></a><a class="code" href="classWTL_1_1CString.html#a19">01069</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; CString::operator=(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* lpsz)
01070     { *<font class="keyword">this</font> = (LPCSTR)lpsz; <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
01071 <font class="preprocessor">#ifdef _UNICODE</font>
01072 <font class="preprocessor"></font><font class="keyword">inline</font> <font class="keyword">const</font> CString&amp; CString::operator+=(<font class="keywordtype">char</font> ch)
01073     { *<font class="keyword">this</font> += (TCHAR)ch; <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
01074 <font class="keyword">inline</font> <font class="keyword">const</font> CString&amp; CString::operator=(<font class="keywordtype">char</font> ch)
01075     { *<font class="keyword">this</font> = (TCHAR)ch; <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
01076 <font class="keyword">inline</font> CString __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(<font class="keyword">const</font> CString&amp; string, <font class="keywordtype">char</font> ch)
01077     { <font class="keywordflow">return</font> string + (TCHAR)ch; }
01078 <font class="keyword">inline</font> CString __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(<font class="keywordtype">char</font> ch, <font class="keyword">const</font> CString&amp; string)
01079     { <font class="keywordflow">return</font> (TCHAR)ch + string; }
01080 <font class="preprocessor">#endif</font>
01081 <font class="preprocessor"></font>
<a name="l01082"></a><a class="code" href="classWTL_1_1CString.html#a8">01082</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::GetLength()<font class="keyword"> const</font>
01083 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>; }
<a name="l01084"></a><a class="code" href="classWTL_1_1CString.html#a72">01084</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::GetAllocLength()<font class="keyword"> const</font>
01085 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a>; }
<a name="l01086"></a><a class="code" href="classWTL_1_1CString.html#a9">01086</a> <font class="keyword">inline</font> BOOL CString::IsEmpty()<font class="keyword"> const</font>
01087 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> == 0; }
<a name="l01088"></a><a class="code" href="classWTL_1_1CString.html#a14">01088</a> <font class="keyword">inline</font> CString::operator LPCTSTR()<font class="keyword"> const</font>
01089 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>; }
<a name="l01090"></a><a class="code" href="classWTL_1_1CString.html#e1">01090</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> PASCAL CString::SafeStrlen(LPCTSTR lpsz)
01091     { <font class="keywordflow">return</font> (lpsz == NULL) ? 0 : lstrlen(lpsz); }
01092 
01093 <font class="comment">// CString support (windows specific)</font>
<a name="l01094"></a><a class="code" href="classWTL_1_1CString.html#a23">01094</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Compare(LPCTSTR lpsz)<font class="keyword"> const</font>
01095 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#e15">_cstrcmp</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz); }    <font class="comment">// MBCS/Unicode aware</font>
<a name="l01096"></a><a class="code" href="classWTL_1_1CString.html#a24">01096</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::CompareNoCase(LPCTSTR lpsz)<font class="keyword"> const</font>
01097 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#e16">_cstrcmpi</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz); }   <font class="comment">// MBCS/Unicode aware</font>
01098 <font class="comment">// CString::Collate is often slower than Compare but is MBSC/Unicode</font>
01099 <font class="comment">//  aware as well as locale-sensitive with respect to sort order.</font>
<a name="l01100"></a><a class="code" href="classWTL_1_1CString.html#a25">01100</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Collate(LPCTSTR lpsz)<font class="keyword"> const</font>
01101 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#e17">_cstrcoll</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz); }   <font class="comment">// locale sensitive</font>
<a name="l01102"></a><a class="code" href="classWTL_1_1CString.html#a26">01102</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::CollateNoCase(LPCTSTR lpsz)<font class="keyword"> const</font>
01103 <font class="keyword">    </font>{ <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#e18">_cstrcolli</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz); }   <font class="comment">// locale sensitive</font>
01104 
<a name="l01105"></a><a class="code" href="classWTL_1_1CString.html#a11">01105</a> <font class="keyword">inline</font> TCHAR CString::GetAt(<font class="keywordtype">int</font> nIndex)<font class="keyword"> const</font>
01106 <font class="keyword"></font>{
01107     ATLASSERT(nIndex &gt;= 0);
01108     ATLASSERT(nIndex &lt; GetData()-&gt;nDataLength);
01109     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nIndex];
01110 }
<a name="l01111"></a><a class="code" href="classWTL_1_1CString.html#a12">01111</a> <font class="keyword">inline</font> TCHAR CString::operator[](<font class="keywordtype">int</font> nIndex)<font class="keyword"> const</font>
01112 <font class="keyword"></font>{
01113     <font class="comment">// same as GetAt</font>
01114     ATLASSERT(nIndex &gt;= 0);
01115     ATLASSERT(nIndex &lt; GetData()-&gt;nDataLength);
01116     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nIndex];
01117 }
<a name="l01118"></a><a class="code" href="namespaceWTL.html#a67">01118</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a67">operator==</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01119     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) == 0; }
<a name="l01120"></a><a class="code" href="namespaceWTL.html#a68">01120</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a67">operator==</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, LPCTSTR s2)
01121     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) == 0; }
<a name="l01122"></a><a class="code" href="namespaceWTL.html#a69">01122</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a67">operator==</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01123     { <font class="keywordflow">return</font> s2.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s1) == 0; }
<a name="l01124"></a><a class="code" href="namespaceWTL.html#a70">01124</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a70">operator!=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01125     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) != 0; }
<a name="l01126"></a><a class="code" href="namespaceWTL.html#a71">01126</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a70">operator!=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, LPCTSTR s2)
01127     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) != 0; }
<a name="l01128"></a><a class="code" href="namespaceWTL.html#a72">01128</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a70">operator!=</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01129     { <font class="keywordflow">return</font> s2.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s1) != 0; }
<a name="l01130"></a><a class="code" href="namespaceWTL.html#a73">01130</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a73">operator&lt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01131     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &lt; 0; }
<a name="l01132"></a><a class="code" href="namespaceWTL.html#a74">01132</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a73">operator&lt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, LPCTSTR s2)
01133     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &lt; 0; }
<a name="l01134"></a><a class="code" href="namespaceWTL.html#a75">01134</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a73">operator&lt;</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01135     { <font class="keywordflow">return</font> s2.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s1) &gt; 0; }
<a name="l01136"></a><a class="code" href="namespaceWTL.html#a76">01136</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a76">operator&gt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01137     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &gt; 0; }
<a name="l01138"></a><a class="code" href="namespaceWTL.html#a77">01138</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a76">operator&gt;</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, LPCTSTR s2)
01139     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &gt; 0; }
<a name="l01140"></a><a class="code" href="namespaceWTL.html#a78">01140</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a76">operator&gt;</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01141     { <font class="keywordflow">return</font> s2.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s1) &lt; 0; }
<a name="l01142"></a><a class="code" href="namespaceWTL.html#a79">01142</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a79">operator&lt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01143     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &lt;= 0; }
<a name="l01144"></a><a class="code" href="namespaceWTL.html#a80">01144</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a79">operator&lt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, LPCTSTR s2)
01145     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &lt;= 0; }
<a name="l01146"></a><a class="code" href="namespaceWTL.html#a81">01146</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a79">operator&lt;=</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01147     { <font class="keywordflow">return</font> s2.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s1) &gt;= 0; }
<a name="l01148"></a><a class="code" href="namespaceWTL.html#a82">01148</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a82">operator&gt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01149     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &gt;= 0; }
<a name="l01150"></a><a class="code" href="namespaceWTL.html#a83">01150</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a82">operator&gt;=</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s1, LPCTSTR s2)
01151     { <font class="keywordflow">return</font> s1.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s2) &gt;= 0; }
<a name="l01152"></a><a class="code" href="namespaceWTL.html#a84">01152</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> __stdcall <a class="code" href="namespaceWTL.html#a82">operator&gt;=</a>(LPCTSTR s1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; s2)
01153     { <font class="keywordflow">return</font> s2.<a class="code" href="classWTL_1_1CString.html#a23">Compare</a>(s1) &lt;= 0; }
01154 
<a name="l01155"></a><a class="code" href="classWTL_1_1CString.html#a0">01155</a> <font class="keyword">inline</font> CString::CString()
01156 {
01157     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01158 }
01159 
<a name="l01160"></a><a class="code" href="classWTL_1_1CString.html#a1">01160</a> <font class="keyword">inline</font> CString::CString(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; stringSrc)
01161 {
01162     ATLASSERT(stringSrc.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> != 0);
01163     <font class="keywordflow">if</font> (stringSrc.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt;= 0)
01164     {
01165         ATLASSERT(stringSrc.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() != _atltmpDataNil);
01166         <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> = stringSrc.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
01167         InterlockedIncrement(&amp;<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs);
01168     }
01169     <font class="keywordflow">else</font>
01170     {
01171         <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01172         *<font class="keyword">this</font> = stringSrc.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
01173     }
01174 }
01175 
<a name="l01176"></a><a class="code" href="classWTL_1_1CString.html#b3">01176</a> <font class="keyword">inline</font> BOOL CString::AllocBuffer(<font class="keywordtype">int</font> nLen)
01177 <font class="comment">// always allocate one extra character for '\0' termination</font>
01178 <font class="comment">// assumes [optimistically] that data length will equal allocation length</font>
01179 {
01180     ATLASSERT(nLen &gt;= 0);
01181     ATLASSERT(nLen &lt;= INT_MAX - 1);    <font class="comment">// max size (enough room for 1 extra)</font>
01182 
01183     <font class="keywordflow">if</font> (nLen == 0)
01184     {
01185         Init();
01186     }
01187     <font class="keywordflow">else</font>
01188     {
01189         <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pData = NULL;
01190         ATLTRY(pData = (<a class="code" href="structWTL_1_1CStringData.html">CStringData</a>*)<font class="keyword">new</font> BYTE[<font class="keyword">sizeof</font>(<a class="code" href="structWTL_1_1CStringData.html">CStringData</a>) + (nLen + 1) * <font class="keyword">sizeof</font>(TCHAR)]);
01191         <font class="keywordflow">if</font>(pData == NULL)
01192             <font class="keywordflow">return</font> FALSE;
01193 
01194         pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> = 1;
01195         pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#a0">data</a>()[nLen] = <font class="charliteral">'\0'</font>;
01196         pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nLen;
01197         pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a> = nLen;
01198         m_pchData = pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#a0">data</a>();
01199     }
01200 
01201     <font class="keywordflow">return</font> TRUE;
01202 }
01203 
<a name="l01204"></a><a class="code" href="classWTL_1_1CString.html#b9">01204</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::Release()
01205 {
01206     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() != _atltmpDataNil)
01207     {
01208         ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs != 0);
01209         <font class="keywordflow">if</font> (InterlockedDecrement(&amp;<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs) &lt;= 0)
01210             <font class="keyword">delete</font>[] (BYTE*)<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
01211         <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01212     }
01213 }
01214 
<a name="l01215"></a><a class="code" href="classWTL_1_1CString.html#e0">01215</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> PASCAL CString::Release(<a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pData)
01216 {
01217     <font class="keywordflow">if</font> (pData != _atltmpDataNil)
01218     {
01219         ATLASSERT(pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> != 0);
01220         <font class="keywordflow">if</font> (InterlockedDecrement(&amp;pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a>) &lt;= 0)
01221             <font class="keyword">delete</font>[] (BYTE*)pData;
01222     }
01223 }
01224 
<a name="l01225"></a><a class="code" href="classWTL_1_1CString.html#a10">01225</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::Empty()
01226 {
01227     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> == 0)
01228         <font class="keywordflow">return</font>;
01229 
01230     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt;= 0)
01231         <a class="code" href="classWTL_1_1CString.html#b9">Release</a>();
01232     <font class="keywordflow">else</font>
01233         *<font class="keyword">this</font> = _T(<font class="stringliteral">""</font>);
01234 
01235     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength == 0);
01236     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs &lt; 0 || GetData()-&gt;nAllocLength == 0);
01237 }
01238 
<a name="l01239"></a><a class="code" href="classWTL_1_1CString.html#b7">01239</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::CopyBeforeWrite()
01240 {
01241     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt; 1)
01242     {
01243         <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
01244         <a class="code" href="classWTL_1_1CString.html#b9">Release</a>();
01245         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>))
01246             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#a0">data</a>(), (pData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> + 1) * <font class="keyword">sizeof</font>(TCHAR));
01247     }
01248     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs &lt;= 1);
01249 }
01250 
<a name="l01251"></a><a class="code" href="classWTL_1_1CString.html#b8">01251</a> <font class="keyword">inline</font> BOOL CString::AllocBeforeWrite(<font class="keywordtype">int</font> nLen)
01252 {
01253     BOOL bRet = TRUE;
01254     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt; 1 || nLen &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a>)
01255     {
01256         <a class="code" href="classWTL_1_1CString.html#b9">Release</a>();
01257         bRet = <a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nLen);
01258     }
01259     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs &lt;= 1);
01260     <font class="keywordflow">return</font> bRet;
01261 }
01262 
<a name="l01263"></a><a class="code" href="classWTL_1_1CString.html#a71">01263</a> <font class="keyword">inline</font> CString::~CString()
01264 <font class="comment">//  free any attached data</font>
01265 {
01266     <font class="keywordflow">if</font> (GetData() != _atltmpDataNil)
01267     {
01268         <font class="keywordflow">if</font> (InterlockedDecrement(&amp;GetData()-&gt;nRefs) &lt;= 0)
01269             <font class="keyword">delete</font>[] (BYTE*)GetData();
01270     }
01271 }
01272 
<a name="l01273"></a><a class="code" href="classWTL_1_1CString.html#b2">01273</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::AllocCopy(<a class="code" href="classWTL_1_1CString.html">CString</a>&amp; dest, <font class="keywordtype">int</font> nCopyLen, <font class="keywordtype">int</font> nCopyIndex,
01274      <font class="keywordtype">int</font> nExtraLen)<font class="keyword"> const</font>
01275 <font class="keyword"></font>{
01276     <font class="comment">// will clone the data attached to this string</font>
01277     <font class="comment">// allocating 'nExtraLen' characters</font>
01278     <font class="comment">// Places results in uninitialized string 'dest'</font>
01279     <font class="comment">// Will copy the part or all of original data to start of new string</font>
01280 
01281     <font class="keywordtype">int</font> nNewLen = nCopyLen + nExtraLen;
01282     <font class="keywordflow">if</font> (nNewLen == 0)
01283     {
01284         dest.<a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01285     }
01286     <font class="keywordflow">else</font>
01287     {
01288         <font class="keywordflow">if</font>(dest.<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nNewLen))
01289             memcpy(dest.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nCopyIndex, nCopyLen * <font class="keyword">sizeof</font>(TCHAR));
01290     }
01291 }
01292 
01293 <font class="keyword">inline</font> CString::CString(LPCTSTR lpsz)
01294 {
01295     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01296     <font class="keywordflow">if</font> (lpsz != NULL &amp;&amp; HIWORD(lpsz) == NULL)
01297     {
01298         UINT nID = LOWORD((<a class="code" href="atlapp_8h.html#a43">DWORD_PTR</a>)lpsz);
01299         <font class="keywordflow">if</font> (!<a class="code" href="classWTL_1_1CString.html#a60">LoadString</a>(nID))
01300             ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"Warning: implicit LoadString(%u) in CString failed\n"</font>), nID);
01301     }
01302     <font class="keywordflow">else</font>
01303     {
01304         <font class="keywordtype">int</font> nLen = <a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(lpsz);
01305         <font class="keywordflow">if</font> (nLen != 0)
01306         {
01307             <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nLen))
01308                 memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, nLen * <font class="keyword">sizeof</font>(TCHAR));
01309         }
01310     }
01311 }
01312 
01313 <font class="preprocessor">#ifdef _UNICODE</font>
01314 <font class="preprocessor"></font><font class="keyword">inline</font> CString::CString(LPCSTR lpsz)
01315 {
01316     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01317     <font class="keywordtype">int</font> nSrcLen = (lpsz != NULL) ? lstrlenA(lpsz) : 0;
01318     <font class="keywordflow">if</font> (nSrcLen != 0)
01319     {
01320         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nSrcLen))
01321         {
01322             <a class="code" href="classWTL_1_1CString.html#e5">_mbstowcsz</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, nSrcLen + 1);
01323             <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>();
01324         }
01325     }
01326 }
01327 <font class="preprocessor">#else //_UNICODE</font>
<a name="l01328"></a><a class="code" href="classWTL_1_1CString.html#a4">01328</a> <font class="preprocessor"></font><font class="keyword">inline</font> CString::CString(LPCWSTR lpsz)
01329 {
01330     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01331     <font class="keywordtype">int</font> nSrcLen = (lpsz != NULL) ? (int)wcslen(lpsz) : 0;
01332     <font class="keywordflow">if</font> (nSrcLen != 0)
01333     {
01334         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nSrcLen * 2))
01335         {
01336             <a class="code" href="classWTL_1_1CString.html#e4">_wcstombsz</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, (nSrcLen * 2) + 1);
01337             <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>();
01338         }
01339     }
01340 }
01341 <font class="preprocessor">#endif </font>
01342 <font class="preprocessor"></font>
01343 <font class="preprocessor"></font><font class="comment">// Assignment operators</font>
01344 <font class="comment">//  All assign a new value to the string</font>
01345 <font class="comment">//      (a) first see if the buffer is big enough</font>
01346 <font class="comment">//      (b) if enough room, copy on top of old buffer, set size and type</font>
01347 <font class="comment">//      (c) otherwise free old string data, and create a new one</font>
01348 <font class="comment">//</font>
01349 <font class="comment">//  All routines return the new string (but as a 'const CString&amp;' so that</font>
01350 <font class="comment">//      assigning it again will cause a copy, eg: s1 = s2 = "hi there".</font>
01351 <font class="comment">//</font>
01352 
<a name="l01353"></a><a class="code" href="classWTL_1_1CString.html#b4">01353</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::AssignCopy(<font class="keywordtype">int</font> nSrcLen, LPCTSTR lpszSrcData)
01354 {
01355     <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b8">AllocBeforeWrite</a>(nSrcLen))
01356     {
01357         memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszSrcData, nSrcLen * <font class="keyword">sizeof</font>(TCHAR));
01358         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nSrcLen;
01359         <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nSrcLen] = <font class="charliteral">'\0'</font>;
01360     }
01361 }
01362 
<a name="l01363"></a><a class="code" href="classWTL_1_1CString.html#a15">01363</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; CString::operator=(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; stringSrc)
01364 {
01365     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> != stringSrc.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>)
01366     {
01367         <font class="keywordflow">if</font> ((<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &lt; 0 &amp;&amp; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() != _atltmpDataNil) || stringSrc.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &lt; 0)
01368         {
01369             <font class="comment">// actual copy necessary since one of the strings is locked</font>
01370             <a class="code" href="classWTL_1_1CString.html#b4">AssignCopy</a>(stringSrc.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, stringSrc.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01371         }
01372         <font class="keywordflow">else</font>
01373         {
01374             <font class="comment">// can just copy references around</font>
01375             <a class="code" href="classWTL_1_1CString.html#b9">Release</a>();
01376             ATLASSERT(stringSrc.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() != _atltmpDataNil);
01377             <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> = stringSrc.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
01378             InterlockedIncrement(&amp;<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs);
01379         }
01380     }
01381     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01382 }
01383 
01384 <font class="keyword">inline</font> <font class="keyword">const</font> CString&amp; CString::operator=(LPCTSTR lpsz)
01385 {
01386     ATLASSERT(lpsz == NULL || <a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpsz));
01387     <a class="code" href="classWTL_1_1CString.html#b4">AssignCopy</a>(<a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(lpsz), lpsz);
01388     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01389 }
01390 
01391 <font class="preprocessor">#ifdef _UNICODE</font>
01392 <font class="preprocessor"></font><font class="keyword">inline</font> <font class="keyword">const</font> CString&amp; CString::operator=(LPCSTR lpsz)
01393 {
01394     <font class="keywordtype">int</font> nSrcLen = (lpsz != NULL) ? lstrlenA(lpsz) : 0;
01395     <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b8">AllocBeforeWrite</a>(nSrcLen))
01396     {
01397         <a class="code" href="classWTL_1_1CString.html#e5">_mbstowcsz</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, nSrcLen + 1);
01398         <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>();
01399     }
01400     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01401 }
01402 <font class="preprocessor">#else </font>
<a name="l01403"></a><a class="code" href="classWTL_1_1CString.html#a18">01403</a> <font class="preprocessor">inline const CString&amp; CString::operator=(LPCWSTR lpsz)</font>
01404 <font class="preprocessor"></font>{
01405     <font class="keywordtype">int</font> nSrcLen = (lpsz != NULL) ? (int)wcslen(lpsz) : 0;
01406     <font class="keywordflow">if</font>(AllocBeforeWrite(nSrcLen * 2))
01407     {
01408         _wcstombsz(m_pchData, lpsz, (nSrcLen * 2) + 1);
01409         ReleaseBuffer();
01410     }
01411     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01412 }
01413 <font class="preprocessor">#endif  </font>
01414 <font class="preprocessor"></font>
01415 <font class="preprocessor"></font><font class="comment">// Concatenation</font>
01416 <font class="comment">// NOTE: "operator+" is done as friend functions for simplicity</font>
01417 <font class="comment">//      There are three variants:</font>
01418 <font class="comment">//          CString + CString</font>
01419 <font class="comment">// and for ? = TCHAR, LPCTSTR</font>
01420 <font class="comment">//          CString + ?</font>
01421 <font class="comment">//          ? + CString</font>
01422 
<a name="l01423"></a><a class="code" href="classWTL_1_1CString.html#b5">01423</a> <font class="keyword">inline</font> BOOL CString::ConcatCopy(<font class="keywordtype">int</font> nSrc1Len, LPCTSTR lpszSrc1Data,
01424     <font class="keywordtype">int</font> nSrc2Len, LPCTSTR lpszSrc2Data)
01425 {
01426   <font class="comment">// -- master concatenation routine</font>
01427   <font class="comment">// Concatenate two sources</font>
01428   <font class="comment">// -- assume that 'this' is a new CString object</font>
01429 
01430     BOOL bRet = TRUE;
01431     <font class="keywordtype">int</font> nNewLen = nSrc1Len + nSrc2Len;
01432     <font class="keywordflow">if</font> (nNewLen != 0)
01433     {
01434         bRet = <a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nNewLen);
01435         <font class="keywordflow">if</font> (bRet)
01436         {
01437             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszSrc1Data, nSrc1Len * <font class="keyword">sizeof</font>(TCHAR));
01438             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nSrc1Len, lpszSrc2Data, nSrc2Len * <font class="keyword">sizeof</font>(TCHAR));
01439         }
01440     }
01441     <font class="keywordflow">return</font> bRet;
01442 }
01443 
<a name="l01444"></a><a class="code" href="namespaceWTL.html#a85">01444</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string1, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string2)
01445 {
01446     <a class="code" href="classWTL_1_1CString.html">CString</a> s;
01447     s.<a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(string1.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string1.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, string2.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string2.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01448     <font class="keywordflow">return</font> s;
01449 }
01450 
<a name="l01451"></a><a class="code" href="namespaceWTL.html#a86">01451</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string, LPCTSTR lpsz)
01452 {
01453     ATLASSERT(lpsz == NULL || CString::_IsValidString(lpsz));
01454     <a class="code" href="classWTL_1_1CString.html">CString</a> s;
01455     s.<a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(string.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, CString::SafeStrlen(lpsz), lpsz);
01456     <font class="keywordflow">return</font> s;
01457 }
01458 
<a name="l01459"></a><a class="code" href="namespaceWTL.html#a87">01459</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(LPCTSTR lpsz, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string)
01460 {
01461     ATLASSERT(lpsz == NULL || CString::_IsValidString(lpsz));
01462     <a class="code" href="classWTL_1_1CString.html">CString</a> s;
01463     s.<a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(CString::SafeStrlen(lpsz), lpsz, string.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01464     <font class="keywordflow">return</font> s;
01465 }
01466 
<a name="l01467"></a><a class="code" href="classWTL_1_1CString.html#b6">01467</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::ConcatInPlace(<font class="keywordtype">int</font> nSrcLen, LPCTSTR lpszSrcData)
01468 {
01469     <font class="comment">//  -- the main routine for += operators</font>
01470 
01471     <font class="comment">// concatenating an empty string is a no-op!</font>
01472     <font class="keywordflow">if</font> (nSrcLen == 0)
01473         <font class="keywordflow">return</font>;
01474 
01475     <font class="comment">// if the buffer is too small, or we have a width mis-match, just</font>
01476     <font class="comment">//   allocate a new buffer (slow but sure)</font>
01477     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt; 1 || <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> + nSrcLen &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a>)
01478     {
01479         <font class="comment">// we have to grow the buffer, use the ConcatCopy routine</font>
01480         <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pOldData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
01481         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, nSrcLen, lpszSrcData))
01482         {
01483             ATLASSERT(pOldData != NULL);
01484             CString::Release(pOldData);
01485         }
01486     }
01487     <font class="keywordflow">else</font>
01488     {
01489         <font class="comment">// fast concatenation when buffer big enough</font>
01490         memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength, lpszSrcData, nSrcLen * <font class="keyword">sizeof</font>(TCHAR));
01491         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> += nSrcLen;
01492         ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength &lt;= GetData()-&gt;nAllocLength);
01493         <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>] = <font class="charliteral">'\0'</font>;
01494     }
01495 }
01496 
<a name="l01497"></a><a class="code" href="classWTL_1_1CString.html#a22">01497</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; CString::operator+=(LPCTSTR lpsz)
01498 {
01499     ATLASSERT(lpsz == NULL || <a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpsz));
01500     <a class="code" href="classWTL_1_1CString.html#b6">ConcatInPlace</a>(<a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(lpsz), lpsz);
01501     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01502 }
01503 
<a name="l01504"></a><a class="code" href="classWTL_1_1CString.html#a21">01504</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; CString::operator+=(TCHAR ch)
01505 {
01506     <a class="code" href="classWTL_1_1CString.html#b6">ConcatInPlace</a>(1, &amp;ch);
01507     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01508 }
01509 
<a name="l01510"></a><a class="code" href="classWTL_1_1CString.html#a20">01510</a> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; CString::operator+=(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string)
01511 {
01512     <a class="code" href="classWTL_1_1CString.html#b6">ConcatInPlace</a>(string.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01513     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01514 }
01515 
<a name="l01516"></a><a class="code" href="classWTL_1_1CString.html#a65">01516</a> <font class="keyword">inline</font> LPTSTR CString::GetBuffer(<font class="keywordtype">int</font> nMinBufLength)
01517 {
01518     ATLASSERT(nMinBufLength &gt;= 0);
01519 
01520     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt; 1 || nMinBufLength &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a>)
01521     {
01522         <font class="comment">// we have to grow the buffer</font>
01523         <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pOldData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
01524         <font class="keywordtype">int</font> nOldLen = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;   <font class="comment">// AllocBuffer will tromp it</font>
01525         <font class="keywordflow">if</font> (nMinBufLength &lt; nOldLen)
01526             nMinBufLength = nOldLen;
01527 
01528         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nMinBufLength))
01529             <font class="keywordflow">return</font> NULL;
01530 
01531         memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, pOldData-&gt;<a class="code" href="structWTL_1_1CStringData.html#a0">data</a>(), (nOldLen + 1) * <font class="keyword">sizeof</font>(TCHAR));
01532         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nOldLen;
01533         CString::Release(pOldData);
01534     }
01535     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs &lt;= 1);
01536 
01537     <font class="comment">// return a pointer to the character storage for this string</font>
01538     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> != NULL);
01539     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
01540 }
01541 
<a name="l01542"></a><a class="code" href="classWTL_1_1CString.html#a66">01542</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::ReleaseBuffer(<font class="keywordtype">int</font> nNewLength)
01543 {
01544     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();  <font class="comment">// just in case GetBuffer was not called</font>
01545 
01546     <font class="keywordflow">if</font> (nNewLength == -1)
01547         nNewLength = lstrlen(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>); <font class="comment">// zero terminated</font>
01548 
01549     ATLASSERT(nNewLength &lt;= GetData()-&gt;nAllocLength);
01550     <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nNewLength;
01551     <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nNewLength] = <font class="charliteral">'\0'</font>;
01552 }
01553 
<a name="l01554"></a><a class="code" href="classWTL_1_1CString.html#a67">01554</a> <font class="keyword">inline</font> LPTSTR CString::GetBufferSetLength(<font class="keywordtype">int</font> nNewLength)
01555 {
01556     ATLASSERT(nNewLength &gt;= 0);
01557 
01558     <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#a65">GetBuffer</a>(nNewLength) == NULL)
01559         <font class="keywordflow">return</font> NULL;
01560 
01561     <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nNewLength;
01562     <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nNewLength] = <font class="charliteral">'\0'</font>;
01563     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
01564 }
01565 
<a name="l01566"></a><a class="code" href="classWTL_1_1CString.html#a68">01566</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::FreeExtra()
01567 {
01568     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength &lt;= GetData()-&gt;nAllocLength);
01569     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> != <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a>)
01570     {
01571         <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pOldData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
01572         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength))
01573         {
01574             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, pOldData-&gt;<a class="code" href="structWTL_1_1CStringData.html#a0">data</a>(), pOldData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> * <font class="keyword">sizeof</font>(TCHAR));
01575             ATLASSERT(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength] == <font class="charliteral">'\0'</font>);
01576             CString::Release(pOldData);
01577         }
01578     }
01579     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() != NULL);
01580 }
01581 
<a name="l01582"></a><a class="code" href="classWTL_1_1CString.html#a69">01582</a> <font class="keyword">inline</font> LPTSTR CString::LockBuffer()
01583 {
01584     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#a65">GetBuffer</a>(0);
01585     <font class="keywordflow">if</font>(lpsz != NULL)
01586         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> = -1;
01587     <font class="keywordflow">return</font> lpsz;
01588 }
01589 
<a name="l01590"></a><a class="code" href="classWTL_1_1CString.html#a70">01590</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::UnlockBuffer()
01591 {
01592     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nRefs == -1);
01593     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>() != _atltmpDataNil)
01594         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> = 1;
01595 }
01596 
<a name="l01597"></a><a class="code" href="classWTL_1_1CString.html#a48">01597</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Find(TCHAR ch)<font class="keyword"> const</font>
01598 <font class="keyword"></font>{
01599     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#a48">Find</a>(ch, 0);
01600 }
01601 
<a name="l01602"></a><a class="code" href="classWTL_1_1CString.html#a50">01602</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Find(TCHAR ch, <font class="keywordtype">int</font> nStart)<font class="keyword"> const</font>
01603 <font class="keyword"></font>{
01604     <font class="keywordtype">int</font> nLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
01605     <font class="keywordflow">if</font> (nStart &gt;= nLength)
01606         <font class="keywordflow">return</font> -1;
01607 
01608     <font class="comment">// find first single character</font>
01609     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nStart, (_TUCHAR)ch);
01610 
01611     <font class="comment">// return -1 if not found and index otherwise</font>
01612     <font class="keywordflow">return</font> (lpsz == NULL) ? -1 : (int)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01613 }
01614 
<a name="l01615"></a><a class="code" href="classWTL_1_1CString.html#a51">01615</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::FindOneOf(LPCTSTR lpszCharSet)<font class="keyword"> const</font>
01616 <font class="keyword"></font>{
01617     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpszCharSet));
01618     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#e12">_cstrpbrk</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszCharSet);
01619     <font class="keywordflow">return</font> (lpsz == NULL) ? -1 : (int)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01620 }
01621 
<a name="l01622"></a><a class="code" href="classWTL_1_1CString.html#a33">01622</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::MakeUpper()
01623 {
01624     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
01625     CharUpper(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01626 }
01627 
<a name="l01628"></a><a class="code" href="classWTL_1_1CString.html#a34">01628</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::MakeLower()
01629 {
01630     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
01631     CharLower(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01632 }
01633 
<a name="l01634"></a><a class="code" href="classWTL_1_1CString.html#a35">01634</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::MakeReverse()
01635 {
01636     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
01637     <a class="code" href="classWTL_1_1CString.html#e8">_cstrrev</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01638 }
01639 
<a name="l01640"></a><a class="code" href="classWTL_1_1CString.html#a13">01640</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::SetAt(<font class="keywordtype">int</font> nIndex, TCHAR ch)
01641 {
01642     ATLASSERT(nIndex &gt;= 0);
01643     ATLASSERT(nIndex &lt; GetData()-&gt;nDataLength);
01644 
01645     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
01646     <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nIndex] = ch;
01647 }
01648 
01649 <font class="preprocessor">#ifndef _UNICODE</font>
<a name="l01650"></a><a class="code" href="classWTL_1_1CString.html#a61">01650</a> <font class="preprocessor"></font><font class="keyword">inline</font> <font class="keywordtype">void</font> CString::AnsiToOem()
01651 {
01652     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
01653     ::AnsiToOem(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01654 }
<a name="l01655"></a><a class="code" href="classWTL_1_1CString.html#a62">01655</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::OemToAnsi()
01656 {
01657     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
01658     ::OemToAnsi(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01659 }
01660 <font class="preprocessor">#endif</font>
01661 <font class="preprocessor"></font>
<a name="l01662"></a><a class="code" href="classWTL_1_1CString.html#a2">01662</a> <font class="keyword">inline</font> CString::CString(TCHAR ch, <font class="keywordtype">int</font> nLength)
01663 {
01664     ATLASSERT(!_istlead(ch));    <font class="comment">// can't create a lead byte string</font>
01665     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01666     <font class="keywordflow">if</font> (nLength &gt;= 1)
01667     {
01668         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nLength))
01669         {
01670 <font class="preprocessor">#ifdef _UNICODE</font>
01671 <font class="preprocessor"></font>            <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; nLength; i++)
01672                 <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[i] = ch;
01673 <font class="preprocessor">#else</font>
01674 <font class="preprocessor"></font>            memset(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, ch, nLength);
01675 <font class="preprocessor">#endif</font>
01676 <font class="preprocessor"></font>        }
01677     }
01678 }
01679 
01680 <font class="keyword">inline</font> CString::CString(LPCTSTR lpch, <font class="keywordtype">int</font> nLength)
01681 {
01682     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01683     <font class="keywordflow">if</font> (nLength != 0)
01684     {
01685         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nLength))
01686             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpch, nLength * <font class="keyword">sizeof</font>(TCHAR));
01687     }
01688 }
01689 
01690 <font class="preprocessor">#ifdef _UNICODE</font>
01691 <font class="preprocessor"></font><font class="keyword">inline</font> CString::CString(LPCSTR lpsz, <font class="keywordtype">int</font> nLength)
01692 {
01693     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01694     <font class="keywordflow">if</font> (nLength != 0)
01695     {
01696         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nLength))
01697         {
01698             <font class="keywordtype">int</font> n = ::MultiByteToWideChar(CP_ACP, 0, lpsz, nLength, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, nLength + 1);
01699             <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>((n &gt;= 0) ? n : -1);
01700         }
01701     }
01702 }
01703 <font class="preprocessor">#else //_UNICODE</font>
<a name="l01704"></a><a class="code" href="classWTL_1_1CString.html#a6">01704</a> <font class="preprocessor"></font><font class="keyword">inline</font> CString::CString(LPCWSTR lpsz, <font class="keywordtype">int</font> nLength)
01705 {
01706     <a class="code" href="classWTL_1_1CString.html#b1">Init</a>();
01707     <font class="keywordflow">if</font> (nLength != 0)
01708     {
01709         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nLength * 2))
01710         {
01711             <font class="keywordtype">int</font> n = ::WideCharToMultiByte(CP_ACP, 0, lpsz, nLength, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, (nLength * 2) + 1, NULL, NULL);
01712             <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>((n &gt;= 0) ? n : -1);
01713         }
01714     }
01715 }
01716 <font class="preprocessor">#endif </font>
01717 <font class="preprocessor"></font>
<a name="l01718"></a><a class="code" href="classWTL_1_1CString.html#a16">01718</a> <font class="preprocessor"></font><font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; CString::operator=(TCHAR ch)
01719 {
01720     ATLASSERT(!_istlead(ch));    <font class="comment">// can't set single lead byte</font>
01721     <a class="code" href="classWTL_1_1CString.html#b4">AssignCopy</a>(1, &amp;ch);
01722     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01723 }
01724 
<a name="l01725"></a><a class="code" href="namespaceWTL.html#a88">01725</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(<font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string1, TCHAR ch)
01726 {
01727     <a class="code" href="classWTL_1_1CString.html">CString</a> s;
01728     s.<a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(string1.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string1.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, 1, &amp;ch);
01729     <font class="keywordflow">return</font> s;
01730 }
01731 
<a name="l01732"></a><a class="code" href="namespaceWTL.html#a89">01732</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> __stdcall <a class="code" href="namespaceWTL.html#a85">operator+</a>(TCHAR ch, <font class="keyword">const</font> <a class="code" href="classWTL_1_1CString.html">CString</a>&amp; string)
01733 {
01734     <a class="code" href="classWTL_1_1CString.html">CString</a> s;
01735     s.<a class="code" href="classWTL_1_1CString.html#b5">ConcatCopy</a>(1, &amp;ch, string.<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>, string.<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01736     <font class="keywordflow">return</font> s;
01737 }
01738 
<a name="l01739"></a><a class="code" href="classWTL_1_1CString.html#a28">01739</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> CString::Mid(<font class="keywordtype">int</font> nFirst)<font class="keyword"> const</font>
01740 <font class="keyword"></font>{
01741     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#a27">Mid</a>(nFirst, <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength - nFirst);
01742 }
01743 
<a name="l01744"></a><a class="code" href="classWTL_1_1CString.html#a27">01744</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> CString::Mid(<font class="keywordtype">int</font> nFirst, <font class="keywordtype">int</font> nCount)<font class="keyword"> const</font>
01745 <font class="keyword"></font>{
01746     <font class="comment">// out-of-bounds requests return sensible things</font>
01747     <font class="keywordflow">if</font> (nFirst &lt; 0)
01748         nFirst = 0;
01749     <font class="keywordflow">if</font> (nCount &lt; 0)
01750         nCount = 0;
01751 
01752     <font class="keywordflow">if</font> (nFirst + nCount &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>)
01753         nCount = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> - nFirst;
01754     <font class="keywordflow">if</font> (nFirst &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>)
01755         nCount = 0;
01756 
01757     <a class="code" href="classWTL_1_1CString.html">CString</a> dest;
01758     <a class="code" href="classWTL_1_1CString.html#b2">AllocCopy</a>(dest, nCount, nFirst, 0);
01759     <font class="keywordflow">return</font> dest;
01760 }
01761 
<a name="l01762"></a><a class="code" href="classWTL_1_1CString.html#a30">01762</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> CString::Right(<font class="keywordtype">int</font> nCount)<font class="keyword"> const</font>
01763 <font class="keyword"></font>{
01764     <font class="keywordflow">if</font> (nCount &lt; 0)
01765         nCount = 0;
01766     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (nCount &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>)
01767         nCount = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
01768 
01769     <a class="code" href="classWTL_1_1CString.html">CString</a> dest;
01770     <a class="code" href="classWTL_1_1CString.html#b2">AllocCopy</a>(dest, nCount, <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength-nCount, 0);
01771     <font class="keywordflow">return</font> dest;
01772 }
01773 
<a name="l01774"></a><a class="code" href="classWTL_1_1CString.html#a29">01774</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> CString::Left(<font class="keywordtype">int</font> nCount)<font class="keyword"> const</font>
01775 <font class="keyword"></font>{
01776     <font class="keywordflow">if</font> (nCount &lt; 0)
01777         nCount = 0;
01778     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (nCount &gt; <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>)
01779         nCount = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
01780 
01781     <a class="code" href="classWTL_1_1CString.html">CString</a> dest;
01782     <a class="code" href="classWTL_1_1CString.html#b2">AllocCopy</a>(dest, nCount, 0, 0);
01783     <font class="keywordflow">return</font> dest;
01784 }
01785 
01786 <font class="comment">// strspn equivalent</font>
<a name="l01787"></a><a class="code" href="classWTL_1_1CString.html#a31">01787</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> CString::SpanIncluding(LPCTSTR lpszCharSet)<font class="keyword"> const</font>
01788 <font class="keyword"></font>{
01789     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpszCharSet));
01790     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#a29">Left</a>(<a class="code" href="classWTL_1_1CString.html#e10">_cstrspn</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszCharSet));
01791 }
01792 
01793 <font class="comment">// strcspn equivalent</font>
<a name="l01794"></a><a class="code" href="classWTL_1_1CString.html#a32">01794</a> <font class="keyword">inline</font> <a class="code" href="classWTL_1_1CString.html">CString</a> CString::SpanExcluding(LPCTSTR lpszCharSet)<font class="keyword"> const</font>
01795 <font class="keyword"></font>{
01796     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpszCharSet));
01797     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#a29">Left</a>(<a class="code" href="classWTL_1_1CString.html#e11">_cstrcspn</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszCharSet));
01798 }
01799 
<a name="l01800"></a><a class="code" href="classWTL_1_1CString.html#a49">01800</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::ReverseFind(TCHAR ch)<font class="keyword"> const</font>
01801 <font class="keyword"></font>{
01802     <font class="comment">// find last single character</font>
01803     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#e7">_cstrrchr</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, (_TUCHAR)ch);
01804 
01805     <font class="comment">// return -1 if not found, distance from beginning otherwise</font>
01806     <font class="keywordflow">return</font> (lpsz == NULL) ? -1 : (int)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01807 }
01808 
01809 <font class="comment">// find a sub-string (like strstr)</font>
<a name="l01810"></a><a class="code" href="classWTL_1_1CString.html#a52">01810</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Find(LPCTSTR lpszSub)<font class="keyword"> const</font>
01811 <font class="keyword"></font>{
01812     <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CString.html#a48">Find</a>(lpszSub, 0);
01813 }
01814 
<a name="l01815"></a><a class="code" href="classWTL_1_1CString.html#a53">01815</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Find(LPCTSTR lpszSub, <font class="keywordtype">int</font> nStart)<font class="keyword"> const</font>
01816 <font class="keyword"></font>{
01817     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpszSub));
01818 
01819     <font class="keywordtype">int</font> nLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
01820     <font class="keywordflow">if</font> (nStart &gt; nLength)
01821         <font class="keywordflow">return</font> -1;
01822 
01823     <font class="comment">// find first matching substring</font>
01824     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#e9">_cstrstr</a>(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nStart, lpszSub);
01825 
01826     <font class="comment">// return -1 for not found, distance from beginning otherwise</font>
01827     <font class="keywordflow">return</font> (lpsz == NULL) ? -1 : (int)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
01828 }
01829 
<a name="l01830"></a><a class="code" href="classWTL_1_1CString.html#a57">01830</a> <font class="keyword">inline</font> BOOL CString::FormatV(LPCTSTR lpszFormat, va_list argList)
01831 {
01832     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpszFormat));
01833 
01834     <font class="keyword">enum</font> _FormatModifiers
01835     {
01836         FORCE_ANSI =    0x10000,
01837         FORCE_UNICODE = 0x20000,
01838         FORCE_INT64 =   0x40000
01839     };
01840 
01841     va_list argListSave = argList;
01842 
01843     <font class="comment">// make a guess at the maximum length of the resulting string</font>
01844     <font class="keywordtype">int</font> nMaxLen = 0;
01845     <font class="keywordflow">for</font> (LPCTSTR lpsz = lpszFormat; *lpsz != <font class="charliteral">'\0'</font>; lpsz = ::CharNext(lpsz))
01846     {
01847         <font class="comment">// handle '%' character, but watch out for '%%'</font>
01848         <font class="keywordflow">if</font> (*lpsz != <font class="charliteral">'%'</font> || *(lpsz = ::CharNext(lpsz)) == <font class="charliteral">'%'</font>)
01849         {
01850             <font class="comment">// this is instead of _tclen()</font>
01851 <font class="preprocessor">#if !defined(_UNICODE) &amp;&amp; defined(_MBCS)</font>
01852 <font class="preprocessor"></font>            nMaxLen += (int)(::CharNext(lpsz) - lpsz);
01853 <font class="preprocessor">#else</font>
01854 <font class="preprocessor"></font>            nMaxLen++;
01855 <font class="preprocessor">#endif</font>
01856 <font class="preprocessor"></font>            <font class="keywordflow">continue</font>;
01857         }
01858 
01859         <font class="keywordtype">int</font> nItemLen = 0;
01860 
01861         <font class="comment">// handle '%' character with format</font>
01862         <font class="keywordtype">int</font> nWidth = 0;
01863         <font class="keywordflow">for</font> (; *lpsz != <font class="charliteral">'\0'</font>; lpsz = ::CharNext(lpsz))
01864         {
01865             <font class="comment">// check for valid flags</font>
01866             <font class="keywordflow">if</font> (*lpsz == <font class="charliteral">'#'</font>)
01867                 nMaxLen += 2;   <font class="comment">// for '0x'</font>
01868             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (*lpsz == <font class="charliteral">'*'</font>)
01869                 nWidth = va_arg(argList, <font class="keywordtype">int</font>);
01870             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (*lpsz == <font class="charliteral">'-'</font> || *lpsz == <font class="charliteral">'+'</font> || *lpsz == <font class="charliteral">'0'</font> || *lpsz == <font class="charliteral">' '</font>)
01871                 ;
01872             <font class="keywordflow">else</font> <font class="comment">// hit non-flag character</font>
01873                 <font class="keywordflow">break</font>;
01874         }
01875         <font class="comment">// get width and skip it</font>
01876         <font class="keywordflow">if</font> (nWidth == 0)
01877         {
01878             <font class="comment">// width indicated by</font>
01879             nWidth = <a class="code" href="classWTL_1_1CString.html#e19">_cstrtoi</a>(lpsz);
01880             <font class="keywordflow">for</font> (; *lpsz != <font class="charliteral">'\0'</font> &amp;&amp; <a class="code" href="classWTL_1_1CString.html#e13">_cstrisdigit</a>(*lpsz); lpsz = ::CharNext(lpsz))
01881                 ;
01882         }
01883         ATLASSERT(nWidth &gt;= 0);
01884 
01885         <font class="keywordtype">int</font> nPrecision = 0;
01886         <font class="keywordflow">if</font> (*lpsz == <font class="charliteral">'.'</font>)
01887         {
01888             <font class="comment">// skip past '.' separator (width.precision)</font>
01889             lpsz = ::CharNext(lpsz);
01890 
01891             <font class="comment">// get precision and skip it</font>
01892             <font class="keywordflow">if</font> (*lpsz == <font class="charliteral">'*'</font>)
01893             {
01894                 nPrecision = va_arg(argList, <font class="keywordtype">int</font>);
01895                 lpsz = ::CharNext(lpsz);
01896             }
01897             <font class="keywordflow">else</font>
01898             {
01899                 nPrecision = <a class="code" href="classWTL_1_1CString.html#e19">_cstrtoi</a>(lpsz);
01900                 <font class="keywordflow">for</font> (; *lpsz != <font class="charliteral">'\0'</font> &amp;&amp; <a class="code" href="classWTL_1_1CString.html#e13">_cstrisdigit</a>(*lpsz); lpsz = ::CharNext(lpsz))
01901                     ;
01902             }
01903             ATLASSERT(nPrecision &gt;= 0);
01904         }
01905 
01906         <font class="comment">// should be on type modifier or specifier</font>
01907         <font class="keywordtype">int</font> nModifier = 0;
01908         <font class="keywordflow">if</font>(lpsz[0] == _T(<font class="charliteral">'I'</font>) &amp;&amp; lpsz[1] == _T(<font class="charliteral">'6'</font>) &amp;&amp; lpsz[2] == _T(<font class="charliteral">'4'</font>))
01909         {
01910             lpsz += 3;
01911             nModifier = FORCE_INT64;
01912         }
01913         <font class="keywordflow">else</font>
01914         {
01915             <font class="keywordflow">switch</font> (*lpsz)
01916             {
01917             <font class="comment">// modifiers that affect size</font>
01918             <font class="keywordflow">case</font> <font class="charliteral">'h'</font>:
01919                 nModifier = FORCE_ANSI;
01920                 lpsz = ::CharNext(lpsz);
01921                 <font class="keywordflow">break</font>;
01922             <font class="keywordflow">case</font> <font class="charliteral">'l'</font>:
01923                 nModifier = FORCE_UNICODE;
01924                 lpsz = ::CharNext(lpsz);
01925                 <font class="keywordflow">break</font>;
01926 
01927             <font class="comment">// modifiers that do not affect size</font>
01928             <font class="keywordflow">case</font> <font class="charliteral">'F'</font>:
01929             <font class="keywordflow">case</font> <font class="charliteral">'N'</font>:
01930             <font class="keywordflow">case</font> <font class="charliteral">'L'</font>:
01931                 lpsz = ::CharNext(lpsz);
01932                 <font class="keywordflow">break</font>;
01933             }
01934         }
01935 
01936         <font class="comment">// now should be on specifier</font>
01937         <font class="keywordflow">switch</font> (*lpsz | nModifier)
01938         {
01939         <font class="comment">// single characters</font>
01940         <font class="keywordflow">case</font> <font class="charliteral">'c'</font>:
01941         <font class="keywordflow">case</font> <font class="charliteral">'C'</font>:
01942             nItemLen = 2;
01943             va_arg(argList, TCHAR);
01944             <font class="keywordflow">break</font>;
01945         <font class="keywordflow">case</font> <font class="charliteral">'c'</font> | FORCE_ANSI:
01946         <font class="keywordflow">case</font> <font class="charliteral">'C'</font> | FORCE_ANSI:
01947             nItemLen = 2;
01948             va_arg(argList, <font class="keywordtype">char</font>);
01949             <font class="keywordflow">break</font>;
01950         <font class="keywordflow">case</font> <font class="charliteral">'c'</font> | FORCE_UNICODE:
01951         <font class="keywordflow">case</font> <font class="charliteral">'C'</font> | FORCE_UNICODE:
01952             nItemLen = 2;
01953             va_arg(argList, WCHAR);
01954             <font class="keywordflow">break</font>;
01955 
01956         <font class="comment">// strings</font>
01957         <font class="keywordflow">case</font> <font class="charliteral">'s'</font>:
01958         {
01959             LPCTSTR pstrNextArg = va_arg(argList, LPCTSTR);
01960             <font class="keywordflow">if</font> (pstrNextArg == NULL)
01961             {
01962                 nItemLen = 6;  <font class="comment">// "(null)"</font>
01963             }
01964             <font class="keywordflow">else</font>
01965             {
01966                 nItemLen = lstrlen(pstrNextArg);
01967                 nItemLen = max(1, nItemLen);
01968             }
01969             <font class="keywordflow">break</font>;
01970         }
01971 
01972         <font class="keywordflow">case</font> <font class="charliteral">'S'</font>:
01973         {
01974 <font class="preprocessor">#ifndef _UNICODE</font>
01975 <font class="preprocessor"></font>            LPWSTR pstrNextArg = va_arg(argList, LPWSTR);
01976             <font class="keywordflow">if</font> (pstrNextArg == NULL)
01977             {
01978                 nItemLen = 6;  <font class="comment">// "(null)"</font>
01979             }
01980             <font class="keywordflow">else</font>
01981             {
01982                 nItemLen = (int)wcslen(pstrNextArg);
01983                 nItemLen = max(1, nItemLen);
01984             }
01985 <font class="preprocessor">#else</font>
01986 <font class="preprocessor"></font>            LPCSTR pstrNextArg = va_arg(argList, LPCSTR);
01987             <font class="keywordflow">if</font> (pstrNextArg == NULL)
01988             {
01989                 nItemLen = 6; <font class="comment">// "(null)"</font>
01990             }
01991             <font class="keywordflow">else</font>
01992             {
01993                 nItemLen = lstrlenA(pstrNextArg);
01994                 nItemLen = max(1, nItemLen);
01995             }
01996 <font class="preprocessor">#endif</font>
01997 <font class="preprocessor"></font>            <font class="keywordflow">break</font>;
01998         }
01999 
02000         <font class="keywordflow">case</font> <font class="charliteral">'s'</font> | FORCE_ANSI:
02001         <font class="keywordflow">case</font> <font class="charliteral">'S'</font> | FORCE_ANSI:
02002         {
02003             LPCSTR pstrNextArg = va_arg(argList, LPCSTR);
02004             <font class="keywordflow">if</font> (pstrNextArg == NULL)
02005             {
02006                 nItemLen = 6; <font class="comment">// "(null)"</font>
02007             }
02008             <font class="keywordflow">else</font>
02009             {
02010                 nItemLen = lstrlenA(pstrNextArg);
02011                 nItemLen = max(1, nItemLen);
02012             }
02013             <font class="keywordflow">break</font>;
02014         }
02015 
02016         <font class="keywordflow">case</font> <font class="charliteral">'s'</font> | FORCE_UNICODE:
02017         <font class="keywordflow">case</font> <font class="charliteral">'S'</font> | FORCE_UNICODE:
02018         {
02019             LPWSTR pstrNextArg = va_arg(argList, LPWSTR);
02020             <font class="keywordflow">if</font> (pstrNextArg == NULL)
02021             {
02022                 nItemLen = 6; <font class="comment">// "(null)"</font>
02023             }
02024             <font class="keywordflow">else</font>
02025             {
02026                 nItemLen = (int)wcslen(pstrNextArg);
02027                 nItemLen = max(1, nItemLen);
02028             }
02029             <font class="keywordflow">break</font>;
02030         }
02031         }
02032 
02033         <font class="comment">// adjust nItemLen for strings</font>
02034         <font class="keywordflow">if</font> (nItemLen != 0)
02035         {
02036             nItemLen = max(nItemLen, nWidth);
02037             <font class="keywordflow">if</font> (nPrecision != 0)
02038                 nItemLen = min(nItemLen, nPrecision);
02039         }
02040         <font class="keywordflow">else</font>
02041         {
02042             <font class="keywordflow">switch</font> (*lpsz)
02043             {
02044             <font class="comment">// integers</font>
02045             <font class="keywordflow">case</font> <font class="charliteral">'d'</font>:
02046             <font class="keywordflow">case</font> <font class="charliteral">'i'</font>:
02047             <font class="keywordflow">case</font> <font class="charliteral">'u'</font>:
02048             <font class="keywordflow">case</font> <font class="charliteral">'x'</font>:
02049             <font class="keywordflow">case</font> <font class="charliteral">'X'</font>:
02050             <font class="keywordflow">case</font> <font class="charliteral">'o'</font>:
02051                 <font class="keywordflow">if</font> (nModifier &amp; FORCE_INT64)
02052                     va_arg(argList, __int64);
02053                 <font class="keywordflow">else</font>
02054                     va_arg(argList, <font class="keywordtype">int</font>);
02055                 nItemLen = 32;
02056                 nItemLen = max(nItemLen, nWidth + nPrecision);
02057                 <font class="keywordflow">break</font>;
02058 
02059 <font class="preprocessor">#ifndef _ATL_USE_CSTRING_FLOAT</font>
02060 <font class="preprocessor"></font>            <font class="keywordflow">case</font> <font class="charliteral">'e'</font>:
02061             <font class="keywordflow">case</font> <font class="charliteral">'f'</font>:
02062             <font class="keywordflow">case</font> <font class="charliteral">'g'</font>:
02063             <font class="keywordflow">case</font> <font class="charliteral">'G'</font>:
02064                 ATLASSERT(!<font class="stringliteral">"Floating point (%%e, %%f, %%g, and %%G) is not supported by the WTL::CString class."</font>);
02065 <font class="preprocessor">#ifndef _DEBUG</font>
02066 <font class="preprocessor"></font>                ::OutputDebugString(_T(<font class="stringliteral">"Floating point (%%e, %%f, %%g, and %%G) is not supported by the WTL::CString class."</font>));
02067                 ::DebugBreak();
02068 <font class="preprocessor">#endif </font>
02069 <font class="preprocessor">                break;</font>
02070 <font class="preprocessor"></font><font class="preprocessor">#else //_ATL_USE_CSTRING_FLOAT</font>
02071 <font class="preprocessor"></font>            <font class="keywordflow">case</font> <font class="charliteral">'e'</font>:
02072             <font class="keywordflow">case</font> <font class="charliteral">'g'</font>:
02073             <font class="keywordflow">case</font> <font class="charliteral">'G'</font>:
02074                 va_arg(argList, <font class="keywordtype">double</font>);
02075                 nItemLen = 128;
02076                 nItemLen = max(nItemLen, nWidth + nPrecision);
02077                 <font class="keywordflow">break</font>;
02078             <font class="keywordflow">case</font> <font class="charliteral">'f'</font>:
02079                 {
02080                     <font class="keywordtype">double</font> f;
02081                     LPTSTR pszTemp;
02082 
02083                     <font class="comment">// 312 == strlen("-1+(309 zeroes).")</font>
02084                     <font class="comment">// 309 zeroes == max precision of a double</font>
02085                     <font class="comment">// 6 == adjustment in case precision is not specified,</font>
02086                     <font class="comment">//   which means that the precision defaults to 6</font>
02087                     pszTemp = (LPTSTR)_alloca(max(nWidth, 312 + nPrecision + 6));
02088 
02089                     f = va_arg(argList, <font class="keywordtype">double</font>);
02090                     _stprintf(pszTemp, _T( <font class="stringliteral">"%*.*f"</font> ), nWidth, nPrecision + 6, f);
02091                     nItemLen = _tcslen(pszTemp);
02092                 }
02093                 <font class="keywordflow">break</font>;
02094 <font class="preprocessor">#endif //_ATL_USE_CSTRING_FLOAT</font>
02095 <font class="preprocessor"></font>
02096             <font class="keywordflow">case</font> <font class="charliteral">'p'</font>:
02097                 va_arg(argList, <font class="keywordtype">void</font>*);
02098                 nItemLen = 32;
02099                 nItemLen = max(nItemLen, nWidth + nPrecision);
02100                 <font class="keywordflow">break</font>;
02101 
02102             <font class="comment">// no output</font>
02103             <font class="keywordflow">case</font> <font class="charliteral">'n'</font>:
02104                 va_arg(argList, <font class="keywordtype">int</font>*);
02105                 <font class="keywordflow">break</font>;
02106 
02107             <font class="keywordflow">default</font>:
02108                 ATLASSERT(FALSE);  <font class="comment">// unknown formatting option</font>
02109             }
02110         }
02111 
02112         <font class="comment">// adjust nMaxLen for output nItemLen</font>
02113         nMaxLen += nItemLen;
02114     }
02115 
02116     <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CString.html#a65">GetBuffer</a>(nMaxLen) == NULL)
02117         <font class="keywordflow">return</font> FALSE;
02118 <font class="preprocessor">#ifndef _ATL_USE_CSTRING_FLOAT</font>
02119 <font class="preprocessor"></font>    <font class="keywordtype">int</font> nRet = wvsprintf(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszFormat, argListSave);
02120 <font class="preprocessor">#else //_ATL_USE_CSTRING_FLOAT</font>
02121 <font class="preprocessor"></font>    <font class="keywordtype">int</font> nRet = _vstprintf(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpszFormat, argListSave);
02122 <font class="preprocessor">#endif //_ATL_USE_CSTRING_FLOAT</font>
02123 <font class="preprocessor"></font>    nRet;   <font class="comment">// ref</font>
02124     ATLASSERT(nRet &lt;= <a class="code" href="classWTL_1_1CString.html#a72">GetAllocLength</a>());
02125     <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>();
02126 
02127     va_end(argListSave);
02128     <font class="keywordflow">return</font> TRUE;
02129 }
02130 
02131 <font class="comment">// formatting (using wsprintf style formatting)</font>
<a name="l02132"></a><a class="code" href="classWTL_1_1CString.html#a55">02132</a> <font class="keyword">inline</font> BOOL __cdecl CString::Format(LPCTSTR lpszFormat, ...)
02133 {
02134     ATLASSERT(<a class="code" href="classWTL_1_1CString.html#d0">_IsValidString</a>(lpszFormat));
02135 
02136     va_list argList;
02137     va_start(argList, lpszFormat);
02138     BOOL bRet = <a class="code" href="classWTL_1_1CString.html#a57">FormatV</a>(lpszFormat, argList);
02139     va_end(argList);
02140     <font class="keywordflow">return</font> bRet;
02141 }
02142 
<a name="l02143"></a><a class="code" href="classWTL_1_1CString.html#a56">02143</a> <font class="keyword">inline</font> BOOL __cdecl CString::Format(UINT nFormatID, ...)
02144 {
02145     <a class="code" href="classWTL_1_1CString.html">CString</a> strFormat;
02146     BOOL bRet = strFormat.<a class="code" href="classWTL_1_1CString.html#a60">LoadString</a>(nFormatID);
02147     ATLASSERT(bRet != 0);
02148 
02149     va_list argList;
02150     va_start(argList, nFormatID);
02151     bRet = <a class="code" href="classWTL_1_1CString.html#a57">FormatV</a>(strFormat, argList);
02152     va_end(argList);
02153     <font class="keywordflow">return</font> bRet;
02154 }
02155 
02156 <font class="comment">// formatting (using FormatMessage style formatting)</font>
<a name="l02157"></a><a class="code" href="classWTL_1_1CString.html#a58">02157</a> <font class="keyword">inline</font> BOOL __cdecl CString::FormatMessage(LPCTSTR lpszFormat, ...)
02158 {
02159     <font class="comment">// format message into temporary buffer lpszTemp</font>
02160     va_list argList;
02161     va_start(argList, lpszFormat);
02162     LPTSTR lpszTemp;
02163     BOOL bRet = TRUE;
02164 
02165     <font class="keywordflow">if</font> (::FormatMessage(FORMAT_MESSAGE_FROM_STRING | FORMAT_MESSAGE_ALLOCATE_BUFFER,
02166             lpszFormat, 0, 0, (LPTSTR)&amp;lpszTemp, 0, &amp;argList) == 0 || lpszTemp == NULL)
02167         bRet = FALSE;
02168 
02169     <font class="comment">// assign lpszTemp into the resulting string and free the temporary</font>
02170     *<font class="keyword">this</font> = lpszTemp;
02171     LocalFree(lpszTemp);
02172     va_end(argList);
02173     <font class="keywordflow">return</font> bRet;
02174 }
02175 
<a name="l02176"></a><a class="code" href="classWTL_1_1CString.html#a59">02176</a> <font class="keyword">inline</font> BOOL __cdecl CString::FormatMessage(UINT nFormatID, ...)
02177 {
02178     <font class="comment">// get format string from string table</font>
02179     <a class="code" href="classWTL_1_1CString.html">CString</a> strFormat;
02180     BOOL bRetTmp = strFormat.<a class="code" href="classWTL_1_1CString.html#a60">LoadString</a>(nFormatID);
02181     bRetTmp;    <font class="comment">// ref</font>
02182     ATLASSERT(bRetTmp != 0);
02183 
02184     <font class="comment">// format message into temporary buffer lpszTemp</font>
02185     va_list argList;
02186     va_start(argList, nFormatID);
02187     LPTSTR lpszTemp;
02188     BOOL bRet = TRUE;
02189 
02190     <font class="keywordflow">if</font> (::FormatMessage(FORMAT_MESSAGE_FROM_STRING | FORMAT_MESSAGE_ALLOCATE_BUFFER,
02191             strFormat, 0, 0, (LPTSTR)&amp;lpszTemp, 0, &amp;argList) == 0 || lpszTemp == NULL)
02192         bRet = FALSE;
02193 
02194     <font class="comment">// assign lpszTemp into the resulting string and free lpszTemp</font>
02195     *<font class="keyword">this</font> = lpszTemp;
02196     LocalFree(lpszTemp);
02197     va_end(argList);
02198     <font class="keywordflow">return</font> bRet;
02199 }
02200 
<a name="l02201"></a><a class="code" href="classWTL_1_1CString.html#a36">02201</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::TrimRight()
02202 {
02203     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02204 
02205     <font class="comment">// find beginning of trailing spaces by starting at beginning (DBCS aware)</font>
02206     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02207     LPTSTR lpszLast = NULL;
02208     <font class="keywordflow">while</font> (*lpsz != <font class="charliteral">'\0'</font>)
02209     {
02210         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#e14">_cstrisspace</a>(*lpsz))
02211         {
02212             <font class="keywordflow">if</font> (lpszLast == NULL)
02213                 lpszLast = lpsz;
02214         }
02215         <font class="keywordflow">else</font>
02216         {
02217             lpszLast = NULL;
02218         }
02219         lpsz = ::CharNext(lpsz);
02220     }
02221 
02222     <font class="keywordflow">if</font> (lpszLast != NULL)
02223     {
02224         <font class="comment">// truncate at trailing space start</font>
02225         *lpszLast = <font class="charliteral">'\0'</font>;
02226         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = (int)(DWORD_PTR)(lpszLast - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
02227     }
02228 }
02229 
<a name="l02230"></a><a class="code" href="classWTL_1_1CString.html#a37">02230</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::TrimLeft()
02231 {
02232     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02233 
02234     <font class="comment">// find first non-space character</font>
02235     LPCTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02236     <font class="keywordflow">while</font> (<a class="code" href="classWTL_1_1CString.html#e14">_cstrisspace</a>(*lpsz))
02237         lpsz = ::CharNext(lpsz);
02238 
02239     <font class="comment">// fix up data and length</font>
02240     <font class="keywordtype">int</font> nDataLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> - (int)(DWORD_PTR)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
02241     memmove(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, (nDataLength + 1) * <font class="keyword">sizeof</font>(TCHAR));
02242     <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nDataLength;
02243 }
02244 
<a name="l02245"></a><a class="code" href="classWTL_1_1CString.html#a39">02245</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::TrimRight(LPCTSTR lpszTargetList)
02246 {
02247     <font class="comment">// find beginning of trailing matches</font>
02248     <font class="comment">// by starting at beginning (DBCS aware)</font>
02249 
02250     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02251     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02252     LPTSTR lpszLast = NULL;
02253 
02254     <font class="keywordflow">while</font> (*lpsz != <font class="charliteral">'\0'</font>)
02255     {
02256         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(lpszTargetList, *lpsz) != NULL)
02257         {
02258             <font class="keywordflow">if</font> (lpszLast == NULL)
02259                 lpszLast = lpsz;
02260         }
02261         <font class="keywordflow">else</font>
02262             lpszLast = NULL;
02263         lpsz = ::CharNext(lpsz);
02264     }
02265 
02266     <font class="keywordflow">if</font> (lpszLast != NULL)
02267     {
02268         <font class="comment">// truncate at left-most matching character</font>
02269         *lpszLast = <font class="charliteral">'\0'</font>;
02270         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = (int)(DWORD_PTR)(lpszLast - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
02271     }
02272 }
02273 
<a name="l02274"></a><a class="code" href="classWTL_1_1CString.html#a38">02274</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::TrimRight(TCHAR chTarget)
02275 {
02276     <font class="comment">// find beginning of trailing matches</font>
02277     <font class="comment">// by starting at beginning (DBCS aware)</font>
02278 
02279     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02280     LPTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02281     LPTSTR lpszLast = NULL;
02282 
02283     <font class="keywordflow">while</font> (*lpsz != <font class="charliteral">'\0'</font>)
02284     {
02285         <font class="keywordflow">if</font> (*lpsz == chTarget)
02286         {
02287             <font class="keywordflow">if</font> (lpszLast == NULL)
02288                 lpszLast = lpsz;
02289         }
02290         <font class="keywordflow">else</font>
02291             lpszLast = NULL;
02292         lpsz = ::CharNext(lpsz);
02293     }
02294 
02295     <font class="keywordflow">if</font> (lpszLast != NULL)
02296     {
02297         <font class="comment">// truncate at left-most matching character</font>
02298         *lpszLast = <font class="charliteral">'\0'</font>;
02299         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = (int)(DWORD_PTR)(lpszLast - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
02300     }
02301 }
02302 
<a name="l02303"></a><a class="code" href="classWTL_1_1CString.html#a41">02303</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::TrimLeft(LPCTSTR lpszTargets)
02304 {
02305     <font class="comment">// if we're not trimming anything, we're not doing any work</font>
02306     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(lpszTargets) == 0)
02307         <font class="keywordflow">return</font>;
02308 
02309     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02310     LPCTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02311 
02312     <font class="keywordflow">while</font> (*lpsz != <font class="charliteral">'\0'</font>)
02313     {
02314         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#e6">_cstrchr</a>(lpszTargets, *lpsz) == NULL)
02315             <font class="keywordflow">break</font>;
02316         lpsz = ::CharNext(lpsz);
02317     }
02318 
02319     <font class="keywordflow">if</font> (lpsz != <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>)
02320     {
02321         <font class="comment">// fix up data and length</font>
02322         <font class="keywordtype">int</font> nDataLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> - (int)(DWORD_PTR)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
02323         memmove(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, (nDataLength + 1) * <font class="keyword">sizeof</font>(TCHAR));
02324         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nDataLength;
02325     }
02326 }
02327 
<a name="l02328"></a><a class="code" href="classWTL_1_1CString.html#a40">02328</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> CString::TrimLeft(TCHAR chTarget)
02329 {
02330     <font class="comment">// find first non-matching character</font>
02331 
02332     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02333     LPCTSTR lpsz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02334 
02335     <font class="keywordflow">while</font> (chTarget == *lpsz)
02336         lpsz = ::CharNext(lpsz);
02337 
02338     <font class="keywordflow">if</font> (lpsz != <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>)
02339     {
02340         <font class="comment">// fix up data and length</font>
02341         <font class="keywordtype">int</font> nDataLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> - (int)(DWORD_PTR)(lpsz - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>);
02342         memmove(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, lpsz, (nDataLength + 1) * <font class="keyword">sizeof</font>(TCHAR));
02343         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nDataLength;
02344     }
02345 }
02346 
<a name="l02347"></a><a class="code" href="classWTL_1_1CString.html#a47">02347</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Delete(<font class="keywordtype">int</font> nIndex, <font class="keywordtype">int</font> nCount <font class="comment">/* = 1 */</font>)
02348 {
02349     <font class="keywordflow">if</font> (nIndex &lt; 0)
02350         nIndex = 0;
02351     <font class="keywordtype">int</font> nNewLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02352     <font class="keywordflow">if</font> (nCount &gt; 0 &amp;&amp; nIndex &lt; nNewLength)
02353     {
02354         <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02355         <font class="keywordtype">int</font> nBytesToCopy = nNewLength - (nIndex + nCount) + 1;
02356 
02357         memmove(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex + nCount, nBytesToCopy * <font class="keyword">sizeof</font>(TCHAR));
02358         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nNewLength - nCount;
02359     }
02360 
02361     <font class="keywordflow">return</font> nNewLength;
02362 }
02363 
<a name="l02364"></a><a class="code" href="classWTL_1_1CString.html#a45">02364</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Insert(<font class="keywordtype">int</font> nIndex, TCHAR ch)
02365 {
02366     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02367 
02368     <font class="keywordflow">if</font> (nIndex &lt; 0)
02369         nIndex = 0;
02370 
02371     <font class="keywordtype">int</font> nNewLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02372     <font class="keywordflow">if</font> (nIndex &gt; nNewLength)
02373         nIndex = nNewLength;
02374     nNewLength++;
02375 
02376     <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a> &lt; nNewLength)
02377     {
02378         <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pOldData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
02379         LPTSTR pstr = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02380         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nNewLength))
02381             <font class="keywordflow">return</font> -1;
02382         memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, pstr, (pOldData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> + 1) * <font class="keyword">sizeof</font>(TCHAR));
02383         CString::Release(pOldData);
02384     }
02385 
02386     <font class="comment">// move existing bytes down</font>
02387     memmove(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex + 1, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex, (nNewLength - nIndex) * <font class="keyword">sizeof</font>(TCHAR));
02388     <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nIndex] = ch;
02389     <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nNewLength;
02390 
02391     <font class="keywordflow">return</font> nNewLength;
02392 }
02393 
<a name="l02394"></a><a class="code" href="classWTL_1_1CString.html#a46">02394</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Insert(<font class="keywordtype">int</font> nIndex, LPCTSTR pstr)
02395 {
02396     <font class="keywordflow">if</font> (nIndex &lt; 0)
02397         nIndex = 0;
02398 
02399     <font class="keywordtype">int</font> nInsertLength = <a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(pstr);
02400     <font class="keywordtype">int</font> nNewLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02401     <font class="keywordflow">if</font> (nInsertLength &gt; 0)
02402     {
02403         <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02404         <font class="keywordflow">if</font> (nIndex &gt; nNewLength)
02405             nIndex = nNewLength;
02406         nNewLength += nInsertLength;
02407 
02408         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a> &lt; nNewLength)
02409         {
02410             <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pOldData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
02411             LPTSTR pstr = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02412             <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nNewLength))
02413                 <font class="keywordflow">return</font> -1;
02414             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, pstr, (pOldData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> + 1) * <font class="keyword">sizeof</font>(TCHAR));
02415             CString::Release(pOldData);
02416         }
02417 
02418         <font class="comment">// move existing bytes down</font>
02419         memmove(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex + nInsertLength, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex, (nNewLength - nIndex - nInsertLength + 1) * <font class="keyword">sizeof</font>(TCHAR));
02420         memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + nIndex, pstr, nInsertLength * <font class="keyword">sizeof</font>(TCHAR));
02421         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nNewLength;
02422     }
02423 
02424     <font class="keywordflow">return</font> nNewLength;
02425 }
02426 
<a name="l02427"></a><a class="code" href="classWTL_1_1CString.html#a42">02427</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Replace(TCHAR chOld, TCHAR chNew)
02428 {
02429     <font class="keywordtype">int</font> nCount = 0;
02430 
02431     <font class="comment">// short-circuit the nop case</font>
02432     <font class="keywordflow">if</font> (chOld != chNew)
02433     {
02434         <font class="comment">// otherwise modify each character that matches in the string</font>
02435         <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02436         LPTSTR psz = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02437         LPTSTR pszEnd = psz + <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02438         <font class="keywordflow">while</font> (psz &lt; pszEnd)
02439         {
02440             <font class="comment">// replace instances of the specified character only</font>
02441             <font class="keywordflow">if</font> (*psz == chOld)
02442             {
02443                 *psz = chNew;
02444                 nCount++;
02445             }
02446             psz = ::CharNext(psz);
02447         }
02448     }
02449     <font class="keywordflow">return</font> nCount;
02450 }
02451 
<a name="l02452"></a><a class="code" href="classWTL_1_1CString.html#a43">02452</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Replace(LPCTSTR lpszOld, LPCTSTR lpszNew)
02453 {
02454     <font class="comment">// can't have empty or NULL lpszOld</font>
02455 
02456     <font class="keywordtype">int</font> nSourceLen = <a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(lpszOld);
02457     <font class="keywordflow">if</font> (nSourceLen == 0)
02458         <font class="keywordflow">return</font> 0;
02459     <font class="keywordtype">int</font> nReplacementLen = <a class="code" href="classWTL_1_1CString.html#e1">SafeStrlen</a>(lpszNew);
02460 
02461     <font class="comment">// loop once to figure out the size of the result string</font>
02462     <font class="keywordtype">int</font> nCount = 0;
02463     LPTSTR lpszStart = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02464     LPTSTR lpszEnd = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02465     LPTSTR lpszTarget;
02466     <font class="keywordflow">while</font> (lpszStart &lt; lpszEnd)
02467     {
02468         <font class="keywordflow">while</font> ((lpszTarget = <a class="code" href="classWTL_1_1CString.html#e9">_cstrstr</a>(lpszStart, lpszOld)) != NULL)
02469         {
02470             nCount++;
02471             lpszStart = lpszTarget + nSourceLen;
02472         }
02473         lpszStart += lstrlen(lpszStart) + 1;
02474     }
02475 
02476     <font class="comment">// if any changes were made, make them</font>
02477     <font class="keywordflow">if</font> (nCount &gt; 0)
02478     {
02479         <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02480 
02481         <font class="comment">// if the buffer is too small, just</font>
02482         <font class="comment">//   allocate a new buffer (slow but sure)</font>
02483         <font class="keywordtype">int</font> nOldLength = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02484         <font class="keywordtype">int</font> nNewLength =  nOldLength + (nReplacementLen - nSourceLen) * nCount;
02485         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m2">nAllocLength</a> &lt; nNewLength || <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m0">nRefs</a> &gt; 1)
02486         {
02487             <a class="code" href="structWTL_1_1CStringData.html">CStringData</a>* pOldData = <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>();
02488             LPTSTR pstr = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02489             <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CString.html#b3">AllocBuffer</a>(nNewLength))
02490                 <font class="keywordflow">return</font> -1;
02491             memcpy(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, pstr, pOldData-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> * <font class="keyword">sizeof</font>(TCHAR));
02492             CString::Release(pOldData);
02493         }
02494         <font class="comment">// else, we just do it in-place</font>
02495         lpszStart = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02496         lpszEnd = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02497 
02498         <font class="comment">// loop again to actually do the work</font>
02499         <font class="keywordflow">while</font> (lpszStart &lt; lpszEnd)
02500         {
02501             <font class="keywordflow">while</font> ( (lpszTarget = <a class="code" href="classWTL_1_1CString.html#e9">_cstrstr</a>(lpszStart, lpszOld)) != NULL)
02502             {
02503                 <font class="keywordtype">int</font> nBalance = nOldLength - ((int)(DWORD_PTR)(lpszTarget - <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>) + nSourceLen);
02504                 memmove(lpszTarget + nReplacementLen, lpszTarget + nSourceLen, nBalance * <font class="keyword">sizeof</font>(TCHAR));
02505                 memcpy(lpszTarget, lpszNew, nReplacementLen * <font class="keyword">sizeof</font>(TCHAR));
02506                 lpszStart = lpszTarget + nReplacementLen;
02507                 lpszStart[nBalance] = <font class="charliteral">'\0'</font>;
02508                 nOldLength += (nReplacementLen - nSourceLen);
02509             }
02510             lpszStart += lstrlen(lpszStart) + 1;
02511         }
02512         ATLASSERT(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>[nNewLength] == <font class="charliteral">'\0'</font>);
02513         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> = nNewLength;
02514     }
02515 
02516     <font class="keywordflow">return</font> nCount;
02517 }
02518 
<a name="l02519"></a><a class="code" href="classWTL_1_1CString.html#a44">02519</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> CString::Remove(TCHAR chRemove)
02520 {
02521     <a class="code" href="classWTL_1_1CString.html#b7">CopyBeforeWrite</a>();
02522 
02523     LPTSTR pstrSource = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02524     LPTSTR pstrDest = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>;
02525     LPTSTR pstrEnd = <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a> + <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>;
02526 
02527     <font class="keywordflow">while</font> (pstrSource &lt; pstrEnd)
02528     {
02529         <font class="keywordflow">if</font> (*pstrSource != chRemove)
02530         {
02531             *pstrDest = *pstrSource;
02532             pstrDest = ::CharNext(pstrDest);
02533         }
02534         pstrSource = ::CharNext(pstrSource);
02535     }
02536     *pstrDest = <font class="charliteral">'\0'</font>;
02537     <font class="keywordtype">int</font> nCount = (int)(DWORD_PTR)(pstrSource - pstrDest);
02538     <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a> -= nCount;
02539 
02540     <font class="keywordflow">return</font> nCount;
02541 }
02542 
02543 <font class="preprocessor">#ifdef _UNICODE</font>
02544 <font class="preprocessor"></font><font class="preprocessor">#define CHAR_FUDGE 1    // one TCHAR unused is good enough</font>
02545 <font class="preprocessor"></font><font class="preprocessor">#else</font>
<a name="l02546"></a><a class="code" href="atlmisc_8h.html#a1">02546</a> <font class="preprocessor"></font><font class="preprocessor">#define CHAR_FUDGE 2    // two BYTES unused for case of DBC last char</font>
02547 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
02548 <font class="preprocessor"></font>
<a name="l02549"></a><a class="code" href="classWTL_1_1CString.html#a60">02549</a> <font class="keyword">inline</font> BOOL CString::LoadString(UINT nID)
02550 {
02551     <font class="comment">// try fixed buffer first (to avoid wasting space in the heap)</font>
02552     TCHAR szTemp[256];
02553     <font class="keywordtype">int</font> nCount =  <font class="keyword">sizeof</font>(szTemp) / <font class="keyword">sizeof</font>(szTemp[0]);
02554     <font class="keywordtype">int</font> nLen = <a class="code" href="classWTL_1_1CString.html#e2">_LoadString</a>(nID, szTemp, nCount);
02555     <font class="keywordflow">if</font> (nCount - nLen &gt; <a class="code" href="atlmisc_8h.html#a1">CHAR_FUDGE</a>)
02556     {
02557         *<font class="keyword">this</font> = szTemp;
02558         <font class="keywordflow">return</font> (nLen &gt; 0);
02559     }
02560 
02561     <font class="comment">// try buffer size of 512, then larger size until entire string is retrieved</font>
02562     <font class="keywordtype">int</font> nSize = 256;
02563     <font class="keywordflow">do</font>
02564     {
02565         nSize += 256;
02566         LPTSTR lpstr = <a class="code" href="classWTL_1_1CString.html#a65">GetBuffer</a>(nSize - 1);
02567         <font class="keywordflow">if</font>(lpstr == NULL)
02568         {
02569             nLen = 0;
02570             <font class="keywordflow">break</font>;
02571         }
02572         nLen = <a class="code" href="classWTL_1_1CString.html#e2">_LoadString</a>(nID, lpstr, nSize);
02573     } <font class="keywordflow">while</font> (nSize - nLen &lt;= <a class="code" href="atlmisc_8h.html#a1">CHAR_FUDGE</a>);
02574     <a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>();
02575 
02576     <font class="keywordflow">return</font> (nLen &gt; 0);
02577 }
02578 
02579 <font class="preprocessor">#ifndef _ATL_NO_COM</font>
<a name="l02580"></a><a class="code" href="classWTL_1_1CString.html#a63">02580</a> <font class="preprocessor"></font><font class="keyword">inline</font> BSTR CString::AllocSysString()<font class="keyword"> const</font>
02581 <font class="keyword"></font>{
02582 <font class="preprocessor">#if defined(_UNICODE) || defined(OLE2ANSI)</font>
02583 <font class="preprocessor"></font>    BSTR bstr = ::SysAllocStringLen(<a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>);
02584 <font class="preprocessor">#else</font>
02585 <font class="preprocessor"></font>    <font class="keywordtype">int</font> nLen = MultiByteToWideChar(CP_ACP, 0, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>,
02586         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength, NULL, NULL);
02587     BSTR bstr = ::SysAllocStringLen(NULL, nLen);
02588     <font class="keywordflow">if</font>(bstr != NULL)
02589         MultiByteToWideChar(CP_ACP, 0, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength, bstr, nLen);
02590 <font class="preprocessor">#endif</font>
02591 <font class="preprocessor"></font>    <font class="keywordflow">return</font> bstr;
02592 }
02593 
<a name="l02594"></a><a class="code" href="classWTL_1_1CString.html#a64">02594</a> <font class="keyword">inline</font> BSTR CString::SetSysString(BSTR* pbstr)<font class="keyword"> const</font>
02595 <font class="keyword"></font>{
02596 <font class="preprocessor">#if defined(_UNICODE) || defined(OLE2ANSI)</font>
02597 <font class="preprocessor"></font>    ::SysReAllocStringLen(pbstr, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;<a class="code" href="structWTL_1_1CStringData.html#m1">nDataLength</a>);
02598 <font class="preprocessor">#else</font>
02599 <font class="preprocessor"></font>    <font class="keywordtype">int</font> nLen = MultiByteToWideChar(CP_ACP, 0, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>,
02600         <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength, NULL, NULL);
02601     <font class="keywordflow">if</font>(::SysReAllocStringLen(pbstr, NULL, nLen))
02602         MultiByteToWideChar(CP_ACP, 0, <a class="code" href="classWTL_1_1CString.html#n0">m_pchData</a>, <a class="code" href="classWTL_1_1CString.html#b0">GetData</a>()-&gt;nDataLength, *pbstr, nLen);
02603 <font class="preprocessor">#endif</font>
02604 <font class="preprocessor"></font>    ATLASSERT(*pbstr != NULL);
02605     <font class="keywordflow">return</font> *pbstr;
02606 }
02607 <font class="preprocessor">#endif </font>
02608 <font class="preprocessor"></font>
02609 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
02610 <font class="preprocessor"></font>
02611 <font class="preprocessor"></font>
02613 <font class="comment">// CRecentDocumentList - MRU List Support</font>
02614 
02615 <font class="preprocessor">#ifndef _WTL_MRUEMPTY_TEXT</font>
<a name="l02616"></a><a class="code" href="atlmisc_8h.html#a2">02616</a> <font class="preprocessor"></font><font class="preprocessor">#define _WTL_MRUEMPTY_TEXT  _T("(empty)")</font>
02617 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
02618 <font class="preprocessor"></font>
02619 <font class="comment">// forward declaration</font>
02620 <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespaceWTL.html#a90">AtlCompactPath</a>(LPTSTR lpstrOut, LPCTSTR lpstrIn, <font class="keywordtype">int</font> cchLen);
02621 
02622 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> t_cchItemLen = MAX_PATH&gt;
<a name="l02623"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html">02623</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CRecentDocumentListBase.html">CRecentDocumentListBase</a>
02624 {
02625 <font class="keyword">public</font>:
02626 <font class="comment">// Declarations</font>
<a name="l02627"></a><a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html">02627</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html">_DocEntry</a>
02628     {
<a name="l02629"></a><a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html#m0">02629</a>         TCHAR <a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html#m0">szDocName</a>[t_cchItemLen];
<a name="l02630"></a><a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html#a0">02630</a>         <font class="keywordtype">bool</font> <a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html#a0">operator==</a>(<font class="keyword">const</font> <a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html">_DocEntry</a>&amp; de)<font class="keyword"> const</font>
02631 <font class="keyword">        </font>{ <font class="keywordflow">return</font> (lstrcmpi(<a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html#m0">szDocName</a>, de.<a class="code" href="structWTL_1_1CRecentDocumentListBase_1_1__DocEntry.html#m0">szDocName</a>) == 0); }
02632     };
02633 
02634     <font class="keyword">enum</font>
02635     {
02636         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s0">m_nMaxEntries_Min</a> = 2,
02637         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s1">m_nMaxEntries_Max</a> = <a class="code" href="atlres_8h.html#a46">ID_FILE_MRU_LAST</a> - <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a> + 1,
02638         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s2">m_cchMaxItemLen_Min</a> = 6,
02639         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s3">m_cchMaxItemLen_Max</a> = t_cchItemLen
02640     };
02641 
02642 <font class="comment">// Data members</font>
<a name="l02643"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m0">02643</a>     <a class="code" href="classCSimpleArray.html">CSimpleArray&lt;_DocEntry&gt;</a> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m0">m_arrDocs</a>;
<a name="l02644"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">02644</a>     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>;  <font class="comment">// default is 4</font>
<a name="l02645"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">02645</a>     HMENU <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>;
02646 
<a name="l02647"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m3">02647</a>     TCHAR <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m3">m_szNoEntries</a>[t_cchItemLen];
02648 
<a name="l02649"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">02649</a>     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">m_cchMaxItemLen</a>;
02650 
02651 <font class="comment">// Constructor</font>
<a name="l02652"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a0">02652</a>     <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a0">CRecentDocumentListBase</a>() : <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>(NULL), <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>(4), <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">m_cchMaxItemLen</a>(-1)
02653     {
02654         ATLASSERT(t_cchItemLen &gt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s2">m_cchMaxItemLen_Min</a>);
02655     }
02656 
02657 <font class="comment">// Attributes</font>
<a name="l02658"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a1">02658</a>     HMENU <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a1">GetMenuHandle</a>()<font class="keyword"> const</font>
02659 <font class="keyword">    </font>{
02660         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>;
02661     }
<a name="l02662"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a2">02662</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a2">SetMenuHandle</a>(HMENU hMenu)
02663     {
02664         ATLASSERT(hMenu == NULL || ::IsMenu(hMenu));
02665         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a> = hMenu;
02666         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a> == NULL || (::GetMenuString(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>, <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m3">m_szNoEntries</a>, t_cchItemLen, MF_BYCOMMAND) == 0))
02667             lstrcpy(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m3">m_szNoEntries</a>, <a class="code" href="atlmisc_8h.html#a2">_WTL_MRUEMPTY_TEXT</a>);
02668     }
<a name="l02669"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a3">02669</a>     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a3">GetMaxEntries</a>()<font class="keyword"> const</font>
02670 <font class="keyword">    </font>{
02671         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>;
02672     }
<a name="l02673"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a4">02673</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a4">SetMaxEntries</a>(<font class="keywordtype">int</font> nMaxEntries)
02674     {
02675         ATLASSERT(nMaxEntries &gt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s0">m_nMaxEntries_Min</a> &amp;&amp; nMaxEntries &lt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s1">m_nMaxEntries_Max</a>);
02676         <font class="keywordflow">if</font>(nMaxEntries &lt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s0">m_nMaxEntries_Min</a>)
02677             nMaxEntries = <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s0">m_nMaxEntries_Min</a>;
02678         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(nMaxEntries &gt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s1">m_nMaxEntries_Max</a>)
02679             nMaxEntries = <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s1">m_nMaxEntries_Max</a>;
02680         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a> = nMaxEntries;
02681     }
<a name="l02682"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a5">02682</a>     <font class="keywordtype">int</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a5">GetMaxItemLength</a>()<font class="keyword"> const</font>
02683 <font class="keyword">    </font>{
02684         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">m_cchMaxItemLen</a>;
02685     }
<a name="l02686"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a6">02686</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a6">SetMaxItemLength</a>(<font class="keywordtype">int</font> cchMaxLen)
02687     {
02688         ATLASSERT((cchMaxLen &gt;= <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s2">m_cchMaxItemLen_Min</a> &amp;&amp; cchMaxLen &lt;= <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s3">m_cchMaxItemLen_Max</a>) || cchMaxLen == -1);
02689         <font class="keywordflow">if</font>(cchMaxLen != -1)
02690         {
02691             <font class="keywordflow">if</font>(cchMaxLen &lt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s2">m_cchMaxItemLen_Min</a>)
02692                 cchMaxLen = <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s2">m_cchMaxItemLen_Min</a>;
02693             <font class="keywordflow">else</font> <font class="keywordflow">if</font>(cchMaxLen &gt; <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s3">m_cchMaxItemLen_Max</a>)
02694                 cchMaxLen = <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#s4s3">m_cchMaxItemLen_Max</a>;
02695         }
02696         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">m_cchMaxItemLen</a> = cchMaxLen;
02697         T* pT = static_cast&lt;T*&gt;(this);
02698         pT-&gt;UpdateMenu();
02699     }
02700 
02701 <font class="comment">// Operations</font>
<a name="l02702"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a7">02702</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a7">AddToList</a>(LPCTSTR lpstrDocName)
02703     {
02704         _DocEntry de;
02705         <font class="keywordflow">if</font>(lstrcpy(de.szDocName, lpstrDocName) == NULL)
02706             <font class="keywordflow">return</font> FALSE;
02707 
02708         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; m_arrDocs.GetSize(); i++)
02709         {
02710             <font class="keywordflow">if</font>(lstrcmpi(m_arrDocs[i].szDocName, lpstrDocName) == 0)
02711             {
02712                 m_arrDocs.RemoveAt(i);
02713                 <font class="keywordflow">break</font>;
02714             }
02715         }
02716 
02717         <font class="keywordflow">if</font>(m_arrDocs.GetSize() == <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>)
02718             m_arrDocs.RemoveAt(0);
02719 
02720         BOOL bRet = m_arrDocs.Add(de);
02721         <font class="keywordflow">if</font>(bRet)
02722         {
02723             T* pT = static_cast&lt;T*&gt;(this);
02724             bRet = pT-&gt;UpdateMenu();
02725         }
02726         <font class="keywordflow">return</font> bRet;
02727     }
<a name="l02728"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a8">02728</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a8">GetFromList</a>(<font class="keywordtype">int</font> nItemID, LPTSTR lpstrDocName)
02729     {
02730         <font class="keywordtype">int</font> nIndex = m_arrDocs.GetSize() - (nItemID - <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>) - 1;
02731         <font class="keywordflow">if</font>(nIndex &lt; 0 || nIndex &gt;= m_arrDocs.GetSize())
02732             <font class="keywordflow">return</font> FALSE;
02733         <font class="keywordflow">return</font> (lstrcpy(lpstrDocName, m_arrDocs[nIndex].szDocName) != NULL);
02734     }
<a name="l02735"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a9">02735</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a9">RemoveFromList</a>(<font class="keywordtype">int</font> nItemID)
02736     {
02737         <font class="keywordtype">int</font> nIndex = m_arrDocs.GetSize() - (nItemID - <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>) - 1;
02738         BOOL bRet = m_arrDocs.RemoveAt(nIndex);
02739         <font class="keywordflow">if</font>(bRet)
02740         {
02741             T* pT = static_cast&lt;T*&gt;(this);
02742             bRet = pT-&gt;UpdateMenu();
02743         }
02744         <font class="keywordflow">return</font> bRet;
02745     }
<a name="l02746"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a10">02746</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a10">MoveToTop</a>(<font class="keywordtype">int</font> nItemID)
02747     {
02748         <font class="keywordtype">int</font> nIndex = m_arrDocs.GetSize() - 1 - (nItemID - <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>);
02749         <font class="keywordflow">if</font>(nIndex &lt; 0 || nIndex &gt;= m_arrDocs.GetSize())
02750             <font class="keywordflow">return</font> FALSE;
02751         _DocEntry de;
02752         de = m_arrDocs[nIndex];
02753         m_arrDocs.RemoveAt(nIndex);
02754         BOOL bRet = m_arrDocs.Add(de);
02755         <font class="keywordflow">if</font>(bRet)
02756         {
02757             T* pT = static_cast&lt;T*&gt;(this);
02758             bRet = pT-&gt;UpdateMenu();
02759         }
02760         <font class="keywordflow">return</font> bRet;
02761     }
02762 
<a name="l02763"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a11">02763</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a11">ReadFromRegistry</a>(LPCTSTR lpstrRegKey)
02764     {
02765         CRegKey rkParent;
02766         CRegKey rk;
02767 
02768         LONG lRet = rkParent.Open(HKEY_CURRENT_USER, lpstrRegKey);
02769         <font class="keywordflow">if</font>(lRet != ERROR_SUCCESS)
02770             <font class="keywordflow">return</font> FALSE;
02771         lRet = rk.Open(rkParent, _T(<font class="stringliteral">"Recent Document List"</font>));
02772         <font class="keywordflow">if</font>(lRet != ERROR_SUCCESS)
02773             <font class="keywordflow">return</font> FALSE;
02774 
02775         DWORD dwRet;
02776 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
02777 <font class="preprocessor"></font>        lRet = rk.QueryDWORDValue(_T(<font class="stringliteral">"DocumentCount"</font>), dwRet);
02778 <font class="preprocessor">#else</font>
02779 <font class="preprocessor"></font>        lRet = rk.QueryValue(dwRet, _T(<font class="stringliteral">"DocumentCount"</font>));
02780 <font class="preprocessor">#endif</font>
02781 <font class="preprocessor"></font>        <font class="keywordflow">if</font>(lRet != ERROR_SUCCESS)
02782             <font class="keywordflow">return</font> FALSE;
02783         <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a4">SetMaxEntries</a>(dwRet);
02784 
02785         m_arrDocs.RemoveAll();
02786 
02787         TCHAR szRetString[t_cchItemLen];
02788         _DocEntry de;
02789 
02790         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> nItem = <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>; nItem &gt; 0; nItem--)
02791         {
02792             TCHAR szBuff[11];
02793             wsprintf(szBuff, _T(<font class="stringliteral">"Document%i"</font>), nItem);
02794 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
02795 <font class="preprocessor"></font>            ULONG ulCount = t_cchItemLen * <font class="keyword">sizeof</font>(TCHAR);
02796             lRet = rk.QueryStringValue(szBuff, szRetString, &amp;ulCount);
02797 <font class="preprocessor">#else</font>
02798 <font class="preprocessor"></font>            DWORD dwCount = t_cchItemLen * <font class="keyword">sizeof</font>(TCHAR);
02799             lRet = rk.QueryValue(szRetString, szBuff, &amp;dwCount);
02800 <font class="preprocessor">#endif</font>
02801 <font class="preprocessor"></font>            <font class="keywordflow">if</font>(lRet == ERROR_SUCCESS &amp;&amp; (lstrcpy(de.szDocName, szRetString) != NULL))
02802                 m_arrDocs.Add(de);
02803         }
02804 
02805         rk.Close();
02806         rkParent.Close();
02807 
02808         T* pT = static_cast&lt;T*&gt;(this);
02809         <font class="keywordflow">return</font> pT-&gt;UpdateMenu();
02810     }
<a name="l02811"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a12">02811</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a12">WriteToRegistry</a>(LPCTSTR lpstrRegKey)
02812     {
02813         CRegKey rkParent;
02814         CRegKey rk;
02815 
02816         LONG lRet = rkParent.Create(HKEY_CURRENT_USER, lpstrRegKey);
02817         <font class="keywordflow">if</font>(lRet != ERROR_SUCCESS)
02818             <font class="keywordflow">return</font> FALSE;
02819         lRet = rk.Create(rkParent, _T(<font class="stringliteral">"Recent Document List"</font>));
02820         <font class="keywordflow">if</font>(lRet != ERROR_SUCCESS)
02821             <font class="keywordflow">return</font> FALSE;
02822 
02823 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
02824 <font class="preprocessor"></font>        lRet = rk.SetDWORDValue(_T(<font class="stringliteral">"DocumentCount"</font>), <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>);
02825 <font class="preprocessor">#else</font>
02826 <font class="preprocessor"></font>        lRet = rk.SetValue(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>, _T(<font class="stringliteral">"DocumentCount"</font>));
02827 <font class="preprocessor">#endif</font>
02828 <font class="preprocessor"></font>        ATLASSERT(lRet == ERROR_SUCCESS);
02829 
02830         <font class="comment">// set new values</font>
02831         <font class="keywordtype">int</font> nItem;
02832         <font class="keywordflow">for</font>(nItem = m_arrDocs.GetSize(); nItem &gt; 0; nItem--)
02833         {
02834             TCHAR szBuff[11];
02835             wsprintf(szBuff, _T(<font class="stringliteral">"Document%i"</font>), nItem);
02836             TCHAR szDocName[t_cchItemLen];
02837             <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a8">GetFromList</a>(<a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a> + nItem - 1, szDocName);
02838 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
02839 <font class="preprocessor"></font>            lRet = rk.SetStringValue(szBuff, szDocName);
02840 <font class="preprocessor">#else</font>
02841 <font class="preprocessor"></font>            lRet = rk.SetValue(szDocName, szBuff);
02842 <font class="preprocessor">#endif</font>
02843 <font class="preprocessor"></font>            ATLASSERT(lRet == ERROR_SUCCESS);
02844         }
02845 
02846         <font class="comment">// delete unused keys</font>
02847         <font class="keywordflow">for</font>(nItem = m_arrDocs.GetSize() + 1; nItem &lt; (<a class="code" href="atlres_8h.html#a46">ID_FILE_MRU_LAST</a> - <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a> + 1); nItem++)
02848         {
02849             TCHAR szBuff[11];
02850             wsprintf(szBuff, _T(<font class="stringliteral">"Document%i"</font>), nItem);
02851             rk.DeleteValue(szBuff);
02852         }
02853 
02854         rk.Close();
02855         rkParent.Close();
02856 
02857         <font class="keywordflow">return</font> TRUE;
02858     }
02859 
02860 <font class="comment">// Implementation</font>
<a name="l02861"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a13">02861</a>     BOOL <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#a13">UpdateMenu</a>()
02862     {
02863         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a> == NULL)
02864             <font class="keywordflow">return</font> FALSE;
02865         ATLASSERT(::IsMenu(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>));
02866 
02867         <font class="keywordtype">int</font> nItems = ::GetMenuItemCount(m_hMenu);
02868         <font class="keywordtype">int</font> nInsertPoint;
02869         <font class="keywordflow">for</font>(nInsertPoint = 0; nInsertPoint &lt; nItems; nInsertPoint++)
02870         {
02871             MENUITEMINFO mi;
02872             mi.cbSize = <font class="keyword">sizeof</font>(MENUITEMINFO);
02873             mi.fMask = MIIM_ID;
02874             ::GetMenuItemInfo(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, nInsertPoint, TRUE, &amp;mi);
02875             <font class="keywordflow">if</font> (mi.wID == <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>)
02876                 <font class="keywordflow">break</font>;
02877         }
02878         ATLASSERT(nInsertPoint &lt; nItems &amp;&amp; <font class="stringliteral">"You need a menu item with an ID = ID_FILE_MRU_FIRST"</font>);
02879 
02880         <font class="keywordtype">int</font> nItem;
02881         <font class="keywordflow">for</font>(nItem = <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>; nItem &lt; <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a> + <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m1">m_nMaxEntries</a>; nItem++)
02882         {
02883             <font class="comment">// keep the first one as an insertion point</font>
02884             <font class="keywordflow">if</font> (nItem != <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>)
02885                 ::DeleteMenu(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, nItem, MF_BYCOMMAND);
02886         }
02887 
02888         TCHAR szItemText[t_cchItemLen + 6];     <font class="comment">// add space for &amp;, 2 digits, and a space</font>
02889         <font class="keywordtype">int</font> nSize = m_arrDocs.GetSize();
02890         nItem = 0;
02891         <font class="keywordflow">if</font>(nSize &gt; 0)
02892         {
02893             <font class="keywordflow">for</font>(nItem = 0; nItem &lt; nSize; nItem++)
02894             {
02895                 <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">m_cchMaxItemLen</a> == -1)
02896                 {
02897                     wsprintf(szItemText, _T(<font class="stringliteral">"&amp;%i %s"</font>), nItem + 1, m_arrDocs[nSize - 1 - nItem].szDocName);
02898                 }
02899                 <font class="keywordflow">else</font>
02900                 {
02901                     TCHAR szBuff[t_cchItemLen];
02902                     T* pT = static_cast&lt;T*&gt;(this);
02903                     pT; <font class="comment">// avoid level 4 warning</font>
02904                     <font class="keywordtype">bool</font> bRet = pT-&gt;CompactDocumentName(szBuff, m_arrDocs[nSize - 1 - nItem].szDocName, <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m4">m_cchMaxItemLen</a>);
02905                     bRet;   <font class="comment">// avoid level 4 warning</font>
02906                     ATLASSERT(bRet);
02907                     wsprintf(szItemText, _T(<font class="stringliteral">"&amp;%i %s"</font>), nItem + 1, szBuff);
02908                 }
02909                 ::InsertMenu(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, nInsertPoint + nItem, MF_BYPOSITION | MF_STRING, <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a> + nItem, szItemText);
02910             }
02911         }
02912         <font class="keywordflow">else</font>    <font class="comment">// empty</font>
02913         {
02914             ::InsertMenu(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, nInsertPoint, MF_BYPOSITION | MF_STRING, <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>, <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m3">m_szNoEntries</a>);
02915             ::EnableMenuItem(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a>, MF_GRAYED);
02916             nItem++;
02917         }
02918         ::DeleteMenu(<a class="code" href="classWTL_1_1CRecentDocumentListBase.html#m2">m_hMenu</a>, nInsertPoint + nItem, MF_BYPOSITION);
02919 
02920         <font class="keywordflow">return</font> TRUE;
02921     }
02922 
02923 <font class="comment">// Overrideable</font>
02924     <font class="comment">// override to provide a different method of compacting document names</font>
<a name="l02925"></a><a class="code" href="classWTL_1_1CRecentDocumentListBase.html#d0">02925</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html#d0">CompactDocumentName</a>(LPTSTR lpstrOut, LPCTSTR lpstrIn, <font class="keywordtype">int</font> cchLen)
02926     {
02927         <font class="keywordflow">return</font> <a class="code" href="namespaceWTL.html#a90">AtlCompactPath</a>(lpstrOut, lpstrIn, cchLen);
02928     }
02929 };
02930 
<a name="l02931"></a><a class="code" href="classWTL_1_1CRecentDocumentList.html">02931</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CRecentDocumentList.html">CRecentDocumentList</a> : <font class="keyword">public</font> <a class="code" href="classWTL_1_1CRecentDocumentListBase.html">CRecentDocumentListBase</a>&lt;CRecentDocumentList&gt;
02932 {
02933 <font class="keyword">public</font>:
02934 <font class="comment">// nothing here</font>
02935 };
02936 
02937 
02939 <font class="comment">// CFindFile - file search helper class</font>
02940 
<a name="l02941"></a><a class="code" href="classWTL_1_1CFindFile.html">02941</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CFindFile.html">CFindFile</a>
02942 {
02943 <font class="keyword">public</font>:
02944 <font class="comment">// Data members</font>
<a name="l02945"></a><a class="code" href="classWTL_1_1CFindFile.html#m0">02945</a>     WIN32_FIND_DATA <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>;
<a name="l02946"></a><a class="code" href="classWTL_1_1CFindFile.html#m1">02946</a>     TCHAR <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>[MAX_PATH];
<a name="l02947"></a><a class="code" href="classWTL_1_1CFindFile.html#m2">02947</a>     TCHAR <a class="code" href="classWTL_1_1CFindFile.html#m2">m_chDirSeparator</a>;
<a name="l02948"></a><a class="code" href="classWTL_1_1CFindFile.html#m3">02948</a>     HANDLE <a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a>;
<a name="l02949"></a><a class="code" href="classWTL_1_1CFindFile.html#m4">02949</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a>;
02950 
02951 <font class="comment">// Constructor/destructor</font>
<a name="l02952"></a><a class="code" href="classWTL_1_1CFindFile.html#a0">02952</a>     <a class="code" href="classWTL_1_1CFindFile.html#a0">CFindFile</a>() : <a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a>(NULL), <a class="code" href="classWTL_1_1CFindFile.html#m2">m_chDirSeparator</a>('\\'), <a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a>(FALSE)
02953     { }
02954 
<a name="l02955"></a><a class="code" href="classWTL_1_1CFindFile.html#a1">02955</a>     <a class="code" href="classWTL_1_1CFindFile.html#a1">~CFindFile</a>()
02956     {
02957         <a class="code" href="classWTL_1_1CFindFile.html#a28">Close</a>();
02958     }
02959 
02960 <font class="comment">// Attributes</font>
<a name="l02961"></a><a class="code" href="classWTL_1_1CFindFile.html#a2">02961</a>     ULONGLONG <a class="code" href="classWTL_1_1CFindFile.html#a2">GetFileSize</a>()<font class="keyword"> const</font>
02962 <font class="keyword">    </font>{
02963         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
02964 
02965         ULARGE_INTEGER nFileSize;
02966 
02967         <font class="keywordflow">if</font>(m_bFound)
02968         {
02969             nFileSize.LowPart = <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.nFileSizeLow;
02970             nFileSize.HighPart = <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.nFileSizeHigh;
02971         }
02972         <font class="keywordflow">else</font>
02973         {
02974             nFileSize.QuadPart = 0;
02975         }
02976 
02977         <font class="keywordflow">return</font> nFileSize.QuadPart;
02978     }
<a name="l02979"></a><a class="code" href="classWTL_1_1CFindFile.html#a3">02979</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a8">GetFileName</a>(LPTSTR lpstrFileName, <font class="keywordtype">int</font> cchLength)<font class="keyword"> const</font>
02980 <font class="keyword">    </font>{
02981         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
02982         <font class="keywordflow">if</font>(lstrlen(<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName) &gt;= cchLength)
02983             <font class="keywordflow">return</font> FALSE;
02984         <font class="keywordflow">return</font> (<a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> &amp;&amp; (lstrcpy(lpstrFileName, <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName) != NULL));
02985     }
<a name="l02986"></a><a class="code" href="classWTL_1_1CFindFile.html#a4">02986</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a9">GetFilePath</a>(LPTSTR lpstrFilePath, <font class="keywordtype">int</font> cchLength)<font class="keyword"> const</font>
02987 <font class="keyword">    </font>{
02988         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
02989 
02990         <font class="keywordtype">int</font> nLen = lstrlen(<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>);
02991         ATLASSERT(nLen &gt; 0);
02992         <font class="keywordflow">if</font>(nLen == 0)
02993             <font class="keywordflow">return</font> FALSE;
02994         <font class="keywordtype">bool</font> bAddSep = (<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>[nLen - 1] != <font class="charliteral">'\\'</font> &amp;&amp; <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>[nLen - 1] != <font class="charliteral">'/'</font>);
02995 
02996         <font class="keywordflow">if</font>((lstrlen(<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>) + (bAddSep ?  1 : 0)) &gt;= cchLength)
02997             <font class="keywordflow">return</font> FALSE;
02998 
02999         BOOL bRet = (lstrcpy(lpstrFilePath, <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>) != NULL);
03000         <font class="keywordflow">if</font>(bRet)
03001         {
03002             TCHAR szSeparator[2] = { <a class="code" href="classWTL_1_1CFindFile.html#m2">m_chDirSeparator</a>, 0 };
03003             bRet = (lstrcat(lpstrFilePath, szSeparator) != NULL);
03004             <font class="keywordflow">if</font>(bRet)
03005                 bRet = (lstrcat(lpstrFilePath, <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName) != NULL);
03006         }
03007         <font class="keywordflow">return</font> bRet;
03008     }
<a name="l03009"></a><a class="code" href="classWTL_1_1CFindFile.html#a5">03009</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a10">GetFileTitle</a>(LPTSTR lpstrFileTitle, <font class="keywordtype">int</font> cchLength)<font class="keyword"> const</font>
03010 <font class="keyword">    </font>{
03011         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03012 
03013         TCHAR szBuff[MAX_PATH];
03014         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CFindFile.html#a8">GetFileName</a>(szBuff, MAX_PATH))
03015             <font class="keywordflow">return</font> FALSE;
03016         TCHAR szNameBuff[_MAX_FNAME];
03017         _tsplitpath(szBuff, NULL, NULL, szNameBuff, NULL);
03018         <font class="keywordflow">if</font>(lstrlen(szNameBuff) &gt;= cchLength)
03019             <font class="keywordflow">return</font> FALSE;
03020         <font class="keywordflow">return</font> (lstrcpy(lpstrFileTitle, szNameBuff) != NULL);
03021     }
<a name="l03022"></a><a class="code" href="classWTL_1_1CFindFile.html#a6">03022</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a11">GetFileURL</a>(LPTSTR lpstrFileURL, <font class="keywordtype">int</font> cchLength)<font class="keyword"> const</font>
03023 <font class="keyword">    </font>{
03024         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03025 
03026         TCHAR szBuff[MAX_PATH];
03027         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CFindFile.html#a9">GetFilePath</a>(szBuff, MAX_PATH))
03028             <font class="keywordflow">return</font> FALSE;
03029         LPCTSTR lpstrFileURLPrefix = _T(<font class="stringliteral">"file://"</font>);
03030         <font class="keywordflow">if</font>(lstrlen(szBuff) + lstrlen(lpstrFileURLPrefix) &gt;= cchLength)
03031             <font class="keywordflow">return</font> FALSE;
03032         <font class="keywordflow">if</font>(lstrcpy(lpstrFileURL, lpstrFileURLPrefix) == NULL)
03033             <font class="keywordflow">return</font> FALSE;
03034         <font class="keywordflow">return</font> (lstrcat(lpstrFileURL, szBuff) != NULL);
03035     }
<a name="l03036"></a><a class="code" href="classWTL_1_1CFindFile.html#a7">03036</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a12">GetRoot</a>(LPTSTR lpstrRoot, <font class="keywordtype">int</font> cchLength)<font class="keyword"> const</font>
03037 <font class="keyword">    </font>{
03038         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03039         <font class="keywordflow">if</font>(lstrlen(<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>) &gt;= cchLength)
03040             <font class="keywordflow">return</font> FALSE;
03041         <font class="keywordflow">return</font> (lstrcpy(lpstrRoot, <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>) != NULL);
03042     }
03043 <font class="preprocessor">#if defined(_WTL_USE_CSTRING) || defined(__ATLSTR_H__)</font>
<a name="l03044"></a><a class="code" href="classWTL_1_1CFindFile.html#a8">03044</a> <font class="preprocessor"></font>    <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CFindFile.html#a8">GetFileName</a>()<font class="keyword"> const</font>
03045 <font class="keyword">    </font>{
03046         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03047 
03048         <a class="code" href="classWTL_1_1CString.html">CString</a> ret;
03049 
03050         <font class="keywordflow">if</font>(m_bFound)
03051             ret = <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName;
03052         <font class="keywordflow">return</font> ret;
03053     }
<a name="l03054"></a><a class="code" href="classWTL_1_1CFindFile.html#a9">03054</a>     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CFindFile.html#a9">GetFilePath</a>()<font class="keyword"> const</font>
03055 <font class="keyword">    </font>{
03056         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03057 
03058         <a class="code" href="classWTL_1_1CString.html">CString</a> strResult = <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>;
03059         <font class="keywordflow">if</font>(strResult[strResult.<a class="code" href="classWTL_1_1CString.html#a8">GetLength</a>() - 1] != <font class="charliteral">'\\'</font> &amp;&amp;
03060             strResult[strResult.<a class="code" href="classWTL_1_1CString.html#a8">GetLength</a>() - 1] != <font class="charliteral">'/'</font>)
03061             strResult += <a class="code" href="classWTL_1_1CFindFile.html#m2">m_chDirSeparator</a>;
03062         strResult += <a class="code" href="classWTL_1_1CFindFile.html#a8">GetFileName</a>();
03063         <font class="keywordflow">return</font> strResult;
03064     }
<a name="l03065"></a><a class="code" href="classWTL_1_1CFindFile.html#a10">03065</a>     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CFindFile.html#a10">GetFileTitle</a>()<font class="keyword"> const</font>
03066 <font class="keyword">    </font>{
03067         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03068 
03069         <a class="code" href="classWTL_1_1CString.html">CString</a> strFullName = <a class="code" href="classWTL_1_1CFindFile.html#a8">GetFileName</a>();
03070         <a class="code" href="classWTL_1_1CString.html">CString</a> strResult;
03071 
03072         _tsplitpath(strFullName, NULL, NULL, strResult.<a class="code" href="classWTL_1_1CString.html#a65">GetBuffer</a>(MAX_PATH), NULL);
03073         strResult.<a class="code" href="classWTL_1_1CString.html#a66">ReleaseBuffer</a>();
03074         <font class="keywordflow">return</font> strResult;
03075     }
<a name="l03076"></a><a class="code" href="classWTL_1_1CFindFile.html#a11">03076</a>     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CFindFile.html#a11">GetFileURL</a>()<font class="keyword"> const</font>
03077 <font class="keyword">    </font>{
03078         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03079 
03080         <a class="code" href="classWTL_1_1CString.html">CString</a> strResult(<font class="stringliteral">"file://"</font>);
03081         strResult += <a class="code" href="classWTL_1_1CFindFile.html#a9">GetFilePath</a>();
03082         <font class="keywordflow">return</font> strResult;
03083     }
<a name="l03084"></a><a class="code" href="classWTL_1_1CFindFile.html#a12">03084</a>     <a class="code" href="classWTL_1_1CString.html">CString</a> <a class="code" href="classWTL_1_1CFindFile.html#a12">GetRoot</a>()<font class="keyword"> const</font>
03085 <font class="keyword">    </font>{
03086         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03087 
03088         <a class="code" href="classWTL_1_1CString.html">CString</a> str = <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>;
03089         <font class="keywordflow">return</font> str;
03090     }
03091 <font class="preprocessor">#endif //defined(_WTL_USE_CSTRING) || defined(__ATLSTR_H__)</font>
<a name="l03092"></a><a class="code" href="classWTL_1_1CFindFile.html#a13">03092</a> <font class="preprocessor"></font>    BOOL <a class="code" href="classWTL_1_1CFindFile.html#a13">GetLastWriteTime</a>(FILETIME* pTimeStamp)<font class="keyword"> const</font>
03093 <font class="keyword">    </font>{
03094         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03095         ATLASSERT(pTimeStamp != NULL);
03096 
03097         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> &amp;&amp; pTimeStamp != NULL)
03098         {
03099             *pTimeStamp = <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.ftLastWriteTime;
03100             <font class="keywordflow">return</font> TRUE;
03101         }
03102 
03103         <font class="keywordflow">return</font> FALSE;
03104     }
<a name="l03105"></a><a class="code" href="classWTL_1_1CFindFile.html#a14">03105</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a14">GetLastAccessTime</a>(FILETIME* pTimeStamp)<font class="keyword"> const</font>
03106 <font class="keyword">    </font>{
03107         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03108         ATLASSERT(pTimeStamp != NULL);
03109 
03110         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> &amp;&amp; pTimeStamp != NULL)
03111         {
03112             *pTimeStamp = <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.ftLastAccessTime;
03113             <font class="keywordflow">return</font> TRUE;
03114         }
03115 
03116         <font class="keywordflow">return</font> FALSE;
03117     }
<a name="l03118"></a><a class="code" href="classWTL_1_1CFindFile.html#a15">03118</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a15">GetCreationTime</a>(FILETIME* pTimeStamp)<font class="keyword"> const</font>
03119 <font class="keyword">    </font>{
03120         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03121 
03122         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> &amp;&amp; pTimeStamp != NULL)
03123         {
03124             *pTimeStamp = <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.ftCreationTime;
03125             <font class="keywordflow">return</font> TRUE;
03126         }
03127 
03128         <font class="keywordflow">return</font> FALSE;
03129     }
<a name="l03130"></a><a class="code" href="classWTL_1_1CFindFile.html#a16">03130</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(DWORD dwMask)<font class="keyword"> const</font>
03131 <font class="keyword">    </font>{
03132         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03133 
03134         <font class="keywordflow">if</font>(m_bFound)
03135             <font class="keywordflow">return</font> ((<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.dwFileAttributes &amp; dwMask) != 0);
03136 
03137         <font class="keywordflow">return</font> FALSE;
03138     }
<a name="l03139"></a><a class="code" href="classWTL_1_1CFindFile.html#a17">03139</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a17">IsDots</a>()<font class="keyword"> const</font>
03140 <font class="keyword">    </font>{
03141         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03142 
03143         <font class="comment">// return TRUE if the file name is "." or ".." and</font>
03144         <font class="comment">// the file is a directory</font>
03145 
03146         BOOL bResult = FALSE;
03147         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> &amp;&amp; <a class="code" href="classWTL_1_1CFindFile.html#a19">IsDirectory</a>())
03148         {
03149             <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName[0] == <font class="charliteral">'.'</font> &amp;&amp; (<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName[1] == <font class="charliteral">'\0'</font> || (<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName[1] == <font class="charliteral">'.'</font> &amp;&amp; <a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName[2] == <font class="charliteral">'\0'</font>)))
03150                 bResult = TRUE;
03151         }
03152 
03153         <font class="keywordflow">return</font> bResult;
03154     }
03155 
<a name="l03156"></a><a class="code" href="classWTL_1_1CFindFile.html#a18">03156</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a18">IsReadOnly</a>()<font class="keyword"> const</font>
03157 <font class="keyword">    </font>{
03158         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_READONLY);
03159     }
<a name="l03160"></a><a class="code" href="classWTL_1_1CFindFile.html#a19">03160</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a19">IsDirectory</a>()<font class="keyword"> const</font>
03161 <font class="keyword">    </font>{
03162         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_DIRECTORY);
03163     }
<a name="l03164"></a><a class="code" href="classWTL_1_1CFindFile.html#a20">03164</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a20">IsCompressed</a>()<font class="keyword"> const</font>
03165 <font class="keyword">    </font>{
03166         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_COMPRESSED);
03167     }
<a name="l03168"></a><a class="code" href="classWTL_1_1CFindFile.html#a21">03168</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a21">IsSystem</a>()<font class="keyword"> const</font>
03169 <font class="keyword">    </font>{
03170         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_SYSTEM);
03171     }
<a name="l03172"></a><a class="code" href="classWTL_1_1CFindFile.html#a22">03172</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a22">IsHidden</a>()<font class="keyword"> const</font>
03173 <font class="keyword">    </font>{
03174         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_HIDDEN);
03175     }
<a name="l03176"></a><a class="code" href="classWTL_1_1CFindFile.html#a23">03176</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a23">IsTemporary</a>()<font class="keyword"> const</font>
03177 <font class="keyword">    </font>{
03178         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_TEMPORARY);
03179     }
<a name="l03180"></a><a class="code" href="classWTL_1_1CFindFile.html#a24">03180</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a24">IsNormal</a>()<font class="keyword"> const</font>
03181 <font class="keyword">    </font>{
03182         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_NORMAL);
03183     }
<a name="l03184"></a><a class="code" href="classWTL_1_1CFindFile.html#a25">03184</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a25">IsArchived</a>()<font class="keyword"> const</font>
03185 <font class="keyword">    </font>{
03186         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#a16">MatchesMask</a>(FILE_ATTRIBUTE_ARCHIVE);
03187     }
03188 
03189 <font class="comment">// Operations</font>
<a name="l03190"></a><a class="code" href="classWTL_1_1CFindFile.html#a26">03190</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a26">FindFile</a>(LPCTSTR pstrName = NULL)
03191     {
03192         <a class="code" href="classWTL_1_1CFindFile.html#a28">Close</a>();
03193 
03194         <font class="keywordflow">if</font>(pstrName == NULL)
03195             pstrName = _T(<font class="stringliteral">"*.*"</font>);
03196         lstrcpy(<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>.cFileName, pstrName);
03197 
03198         <a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> = ::FindFirstFile(pstrName, &amp;<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>);
03199 
03200         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> == INVALID_HANDLE_VALUE)
03201             <font class="keywordflow">return</font> FALSE;
03202 
03203         LPCTSTR pstr = _tfullpath(<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>, pstrName, MAX_PATH);
03204 
03205         <font class="comment">// passed name isn't a valid path but was found by the API</font>
03206         ATLASSERT(pstr != NULL);
03207         <font class="keywordflow">if</font>(pstr == NULL)
03208         {
03209             <a class="code" href="classWTL_1_1CFindFile.html#a28">Close</a>();
03210             ::SetLastError(ERROR_INVALID_NAME);
03211             <font class="keywordflow">return</font> FALSE;
03212         }
03213         <font class="keywordflow">else</font>
03214         {
03215             <font class="comment">// find the last forward or backward whack</font>
03216             LPTSTR pstrBack  = _tcsrchr(<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>, <font class="charliteral">'\\'</font>);
03217             LPTSTR pstrFront = _tcsrchr(<a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>, <font class="charliteral">'/'</font>);
03218 
03219             <font class="keywordflow">if</font>(pstrFront != NULL || pstrBack != NULL)
03220             {
03221                 <font class="keywordflow">if</font>(pstrFront == NULL)
03222                     pstrFront = <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>;
03223                 <font class="keywordflow">if</font>(pstrBack == NULL)
03224                     pstrBack = <a class="code" href="classWTL_1_1CFindFile.html#m1">m_lpszRoot</a>;
03225 
03226                 <font class="comment">// from the start to the last whack is the root</font>
03227 
03228                 <font class="keywordflow">if</font>(pstrFront &gt;= pstrBack)
03229                     *pstrFront = <font class="charliteral">'\0'</font>;
03230                 <font class="keywordflow">else</font>
03231                     *pstrBack = <font class="charliteral">'\0'</font>;
03232             }
03233         }
03234 
03235         <a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> = TRUE;
03236 
03237         <font class="keywordflow">return</font> TRUE;
03238     }
03239 
<a name="l03240"></a><a class="code" href="classWTL_1_1CFindFile.html#a27">03240</a>     BOOL <a class="code" href="classWTL_1_1CFindFile.html#a27">FindNextFile</a>()
03241     {
03242         ATLASSERT(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL);
03243 
03244         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> == NULL)
03245             <font class="keywordflow">return</font> FALSE;
03246 
03247         <font class="keywordflow">if</font>(!<a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a>)
03248             <font class="keywordflow">return</font> FALSE;
03249 
03250         <a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> = ::FindNextFile(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a>, &amp;<a class="code" href="classWTL_1_1CFindFile.html#m0">m_fd</a>);
03251 
03252         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a>;
03253     }
<a name="l03254"></a><a class="code" href="classWTL_1_1CFindFile.html#a28">03254</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CFindFile.html#a28">Close</a>()
03255     {
03256         <a class="code" href="classWTL_1_1CFindFile.html#m4">m_bFound</a> = FALSE;
03257 
03258         <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != NULL &amp;&amp; <a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> != INVALID_HANDLE_VALUE)
03259         {
03260             ::FindClose(m_hFind);
03261             <a class="code" href="classWTL_1_1CFindFile.html#m3">m_hFind</a> = NULL;
03262         }
03263     }
03264 };
03265 
03266 
03268 <font class="comment">// Global functions for loading resources</font>
03269 
<a name="l03270"></a><a class="code" href="namespaceWTL.html#a91">03270</a> <font class="keyword">inline</font> HACCEL <a class="code" href="namespaceWTL.html#a91">AtlLoadAccelerators</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> table)
03271 {
03272     return ::LoadAccelerators(_Module.GetResourceInstance(), table.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>);
03273 }
03274 
<a name="l03275"></a><a class="code" href="namespaceWTL.html#a92">03275</a> <font class="keyword">inline</font> HMENU <a class="code" href="namespaceWTL.html#a92">AtlLoadMenu</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> menu)
03276 {
03277     return ::LoadMenu(_Module.GetResourceInstance(), menu.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>);
03278 }
03279 
<a name="l03280"></a><a class="code" href="namespaceWTL.html#a93">03280</a> <font class="keyword">inline</font> HBITMAP <a class="code" href="namespaceWTL.html#a93">AtlLoadBitmap</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> bitmap)
03281 {
03282     return ::LoadBitmap(_Module.GetResourceInstance(), bitmap.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>);
03283 }
03284 
03285 <font class="preprocessor">#ifdef OEMRESOURCE</font>
03286 <font class="preprocessor"></font><font class="keyword">inline</font> HBITMAP AtlLoadSysBitmap(LPCTSTR lpBitmapName)
03287 {
03288 <font class="preprocessor">#ifdef _DEBUG</font>
03289 <font class="preprocessor"></font>    WORD wID = (WORD)lpBitmapName;
03290     ATLASSERT(wID &gt;= 32734 &amp;&amp; wID &lt;= 32767);
03291 <font class="preprocessor">#endif //_DEBUG</font>
03292 <font class="preprocessor"></font>    return ::LoadBitmap(NULL, lpBitmapName);
03293 }
03294 <font class="preprocessor">#endif //OEMRESOURCE</font>
03295 <font class="preprocessor"></font>
<a name="l03296"></a><a class="code" href="namespaceWTL.html#a94">03296</a> <font class="keyword">inline</font> HCURSOR <a class="code" href="namespaceWTL.html#a94">AtlLoadCursor</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> cursor)
03297 {
03298     return ::LoadCursor(_Module.GetResourceInstance(), cursor.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>);
03299 }
03300 
<a name="l03301"></a><a class="code" href="namespaceWTL.html#a95">03301</a> <font class="keyword">inline</font> HCURSOR <a class="code" href="namespaceWTL.html#a95">AtlLoadSysCursor</a>(LPCTSTR lpCursorName)
03302 {
03303     ATLASSERT(lpCursorName == IDC_ARROW || lpCursorName == IDC_IBEAM || lpCursorName == IDC_WAIT ||
03304         lpCursorName == IDC_CROSS || lpCursorName == IDC_UPARROW || lpCursorName == IDC_SIZE ||
03305         lpCursorName == IDC_ICON || lpCursorName == IDC_SIZENWSE || lpCursorName == IDC_SIZENESW ||
03306         lpCursorName == IDC_SIZEWE || lpCursorName == IDC_SIZENS || lpCursorName == IDC_SIZEALL ||
03307         lpCursorName == IDC_NO || lpCursorName == IDC_APPSTARTING || lpCursorName == IDC_HELP);
03308     return ::LoadCursor(NULL, lpCursorName);
03309 }
03310 
<a name="l03311"></a><a class="code" href="namespaceWTL.html#a96">03311</a> <font class="keyword">inline</font> HICON <a class="code" href="namespaceWTL.html#a96">AtlLoadIcon</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> icon)
03312 {
03313     return ::LoadIcon(_Module.GetResourceInstance(), icon.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>);
03314 }
03315 
<a name="l03316"></a><a class="code" href="namespaceWTL.html#a97">03316</a> <font class="keyword">inline</font> HICON <a class="code" href="namespaceWTL.html#a97">AtlLoadSysIcon</a>(LPCTSTR lpIconName)
03317 {
03318     ATLASSERT(lpIconName == IDI_APPLICATION ||
03319         lpIconName == IDI_ASTERISK ||
03320         lpIconName == IDI_EXCLAMATION ||
03321         lpIconName == IDI_HAND ||
03322         lpIconName == IDI_QUESTION ||
03323         lpIconName == IDI_WINLOGO);
03324     return ::LoadIcon(NULL, lpIconName);
03325 }
03326 
<a name="l03327"></a><a class="code" href="namespaceWTL.html#a98">03327</a> <font class="keyword">inline</font> HBITMAP <a class="code" href="namespaceWTL.html#a98">AtlLoadBitmapImage</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> bitmap, UINT fuLoad = LR_DEFAULTCOLOR)
03328 {
03329     <font class="keywordflow">return</font> (HBITMAP)::LoadImage(_Module.GetResourceInstance(), bitmap.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>, IMAGE_BITMAP, 0, 0, fuLoad);
03330 }
03331 
<a name="l03332"></a><a class="code" href="namespaceWTL.html#a99">03332</a> <font class="keyword">inline</font> HCURSOR <a class="code" href="namespaceWTL.html#a99">AtlLoadCursorImage</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> cursor, UINT fuLoad = LR_DEFAULTCOLOR | LR_DEFAULTSIZE, <font class="keywordtype">int</font> cxDesired = 0, <font class="keywordtype">int</font> cyDesired = 0)
03333 {
03334     <font class="keywordflow">return</font> (HCURSOR)::LoadImage(_Module.GetResourceInstance(), cursor.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>, IMAGE_CURSOR, cxDesired, cyDesired, fuLoad);
03335 }
03336 
<a name="l03337"></a><a class="code" href="namespaceWTL.html#a100">03337</a> <font class="keyword">inline</font> HICON <a class="code" href="namespaceWTL.html#a100">AtlLoadIconImage</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> icon, UINT fuLoad = LR_DEFAULTCOLOR | LR_DEFAULTSIZE, <font class="keywordtype">int</font> cxDesired = 0, <font class="keywordtype">int</font> cyDesired = 0)
03338 {
03339     <font class="keywordflow">return</font> (HICON)::LoadImage(_Module.GetResourceInstance(), icon.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>, IMAGE_ICON, cxDesired, cyDesired, fuLoad);
03340 }
03341 
03342 <font class="preprocessor">#ifdef OEMRESOURCE</font>
03343 <font class="preprocessor"></font><font class="keyword">inline</font> HBITMAP AtlLoadSysBitmapImage(WORD wBitmapID, UINT fuLoad = LR_DEFAULTCOLOR)
03344 {
03345     ATLASSERT(wBitmapID &gt;= 32734 &amp;&amp; wBitmapID &lt;= 32767);
03346     ATLASSERT((fuLoad &amp; LR_LOADFROMFILE) == 0); <font class="comment">// this one doesn't load from a file</font>
03347     <font class="keywordflow">return</font> (HBITMAP)::LoadImage(NULL, MAKEINTRESOURCE(wBitmapID), IMAGE_BITMAP, 0, 0, fuLoad);
03348 }
03349 <font class="preprocessor">#endif //OEMRESOURCE</font>
03350 <font class="preprocessor"></font>
<a name="l03351"></a><a class="code" href="namespaceWTL.html#a101">03351</a> <font class="keyword">inline</font> HCURSOR <a class="code" href="namespaceWTL.html#a101">AtlLoadSysCursorImage</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> cursor, UINT fuLoad = LR_DEFAULTCOLOR | LR_DEFAULTSIZE, <font class="keywordtype">int</font> cxDesired = 0, <font class="keywordtype">int</font> cyDesired = 0)
03352 {
03353 <font class="preprocessor">#ifdef _DEBUG</font>
03354 <font class="preprocessor"></font>    WORD wID = (WORD)cursor.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>;
03355     ATLASSERT((wID &gt;= 32512 &amp;&amp; wID &lt;= 32516) || (wID &gt;= 32640 &amp;&amp; wID &lt;= 32648) || (wID == 32650) || (wID == 32651));
03356     ATLASSERT((fuLoad &amp; LR_LOADFROMFILE) == 0); <font class="comment">// this one doesn't load from a file</font>
03357 <font class="preprocessor">#endif //_DEBUG</font>
03358 <font class="preprocessor"></font>    <font class="keywordflow">return</font> (HCURSOR)::LoadImage(NULL, cursor.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>, IMAGE_CURSOR, cxDesired, cyDesired, fuLoad);
03359 }
03360 
<a name="l03361"></a><a class="code" href="namespaceWTL.html#a102">03361</a> <font class="keyword">inline</font> HICON <a class="code" href="namespaceWTL.html#a102">AtlLoadSysIconImage</a>(<a class="code" href="classWTL_1_1__U__STRINGorID.html">_U_STRINGorID</a> icon, UINT fuLoad = LR_DEFAULTCOLOR | LR_DEFAULTSIZE, <font class="keywordtype">int</font> cxDesired = 0, <font class="keywordtype">int</font> cyDesired = 0)
03362 {
03363 <font class="preprocessor">#ifdef _DEBUG</font>
03364 <font class="preprocessor"></font>    WORD wID = (WORD)icon.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>;
03365     ATLASSERT(wID &gt;= 32512 &amp;&amp; wID &lt;= 32517);
03366     ATLASSERT((fuLoad &amp; LR_LOADFROMFILE) == 0); <font class="comment">// this one doesn't load from a file</font>
03367 <font class="preprocessor">#endif //_DEBUG</font>
03368 <font class="preprocessor"></font>    <font class="keywordflow">return</font> (HICON)::LoadImage(NULL, icon.<a class="code" href="classWTL_1_1__U__STRINGorID.html#m0">m_lpstr</a>, IMAGE_ICON, cxDesired, cyDesired, fuLoad);
03369 }
03370 
03371 <font class="preprocessor">#if (_ATL_VER &lt; 0x0700)</font>
<a name="l03372"></a><a class="code" href="namespaceWTL.html#a103">03372</a> <font class="preprocessor"></font><font class="keyword">inline</font> <font class="keywordtype">int</font> <a class="code" href="namespaceWTL.html#a103">AtlLoadString</a>(UINT uID, LPTSTR lpBuffer, <font class="keywordtype">int</font> nBufferMax)
03373 {
03374     return ::LoadString(_Module.GetResourceInstance(), uID, lpBuffer, nBufferMax);
03375 }
03376 <font class="preprocessor">#endif //(_ATL_VER &lt; 0x0700)</font>
03377 <font class="preprocessor"></font>
<a name="l03378"></a><a class="code" href="namespaceWTL.html#a104">03378</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespaceWTL.html#a103">AtlLoadString</a>(UINT uID, BSTR&amp; bstrText)
03379 {
03380     USES_CONVERSION;
03381     ATLASSERT(bstrText == NULL);
03382 
03383     LPTSTR lpstrText = NULL;
03384     <font class="keywordtype">int</font> nRes = 0;
03385     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> nLen = 256; ; nLen *= 2)
03386     {
03387         ATLTRY(lpstrText = <font class="keyword">new</font> TCHAR[nLen]);
03388         <font class="keywordflow">if</font>(lpstrText == NULL)
03389             <font class="keywordflow">break</font>;
03390         nRes = ::LoadString(_Module.GetResourceInstance(), uID, lpstrText, nLen);
03391         <font class="keywordflow">if</font>(nRes &lt; nLen - 1)
03392             <font class="keywordflow">break</font>;
03393         <font class="keyword">delete</font> [] lpstrText;
03394         lpstrText = NULL;
03395     }
03396 
03397     <font class="keywordflow">if</font>(lpstrText != NULL)
03398     {
03399         <font class="keywordflow">if</font>(nRes != 0)
03400             bstrText = ::SysAllocString(T2OLE(lpstrText));
03401         <font class="keyword">delete</font> [] lpstrText;
03402     }
03403 
03404     <font class="keywordflow">return</font> (bstrText != NULL) ? <font class="keyword">true</font> : <font class="keyword">false</font>;
03405 }
03406 
03407 
03409 <font class="comment">// Global functions for stock GDI objects</font>
03410 
<a name="l03411"></a><a class="code" href="namespaceWTL.html#a105">03411</a> <font class="keyword">inline</font> HPEN <a class="code" href="namespaceWTL.html#a105">AtlGetStockPen</a>(<font class="keywordtype">int</font> nPen)
03412 {
03413 <font class="preprocessor">#if (_WIN32_WINNT &gt;= 0x0500)</font>
03414 <font class="preprocessor"></font>    ATLASSERT(nPen == WHITE_PEN || nPen == BLACK_PEN || nPen == NULL_PEN || nPen == DC_PEN);
03415 <font class="preprocessor">#else</font>
03416 <font class="preprocessor"></font>    ATLASSERT(nPen == WHITE_PEN || nPen == BLACK_PEN || nPen == NULL_PEN);
03417 <font class="preprocessor">#endif </font>
03418 <font class="preprocessor">    return (HPEN)::GetStockObject(nPen);</font>
03419 <font class="preprocessor"></font>}
03420 
<a name="l03421"></a><a class="code" href="namespaceWTL.html#a106">03421</a> <font class="keyword">inline</font> HBRUSH <a class="code" href="namespaceWTL.html#a106">AtlGetStockBrush</a>(<font class="keywordtype">int</font> nBrush)
03422 {
03423 <font class="preprocessor">#if (_WIN32_WINNT &gt;= 0x0500)</font>
03424 <font class="preprocessor"></font>    ATLASSERT((nBrush &gt;= WHITE_BRUSH &amp;&amp; nBrush &lt;= HOLLOW_BRUSH) || nBrush == DC_BRUSH);
03425 <font class="preprocessor">#else</font>
03426 <font class="preprocessor"></font>    ATLASSERT(nBrush &gt;= WHITE_BRUSH &amp;&amp; nBrush &lt;= HOLLOW_BRUSH);
03427 <font class="preprocessor">#endif </font>
03428 <font class="preprocessor">    return (HBRUSH)::GetStockObject(nBrush);</font>
03429 <font class="preprocessor"></font>}
03430 
<a name="l03431"></a><a class="code" href="namespaceWTL.html#a107">03431</a> <font class="keyword">inline</font> HFONT <a class="code" href="namespaceWTL.html#a107">AtlGetStockFont</a>(<font class="keywordtype">int</font> nFont)
03432 {
03433     ATLASSERT((nFont &gt;= OEM_FIXED_FONT &amp;&amp; nFont &lt;= SYSTEM_FIXED_FONT) || nFont == DEFAULT_GUI_FONT);
03434     <font class="keywordflow">return</font> (HFONT)::GetStockObject(nFont);
03435 }
03436 
<a name="l03437"></a><a class="code" href="namespaceWTL.html#a108">03437</a> <font class="keyword">inline</font> HPALETTE <a class="code" href="namespaceWTL.html#a108">AtlGetStockPalette</a>(<font class="keywordtype">int</font> nPalette)
03438 {
03439     ATLASSERT(nPalette == DEFAULT_PALETTE); <font class="comment">// the only one supported</font>
03440     <font class="keywordflow">return</font> (HPALETTE)::GetStockObject(nPalette);
03441 }
03442 
03443 
03445 <font class="comment">// Global function for compacting a path by replacing parts with ellipsis</font>
03446 
03447 <font class="comment">// helper for multi-byte character sets</font>
<a name="l03448"></a><a class="code" href="namespaceWTL.html#a109">03448</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespaceWTL.html#a109">_IsDBCSTrailByte</a>(LPCTSTR lpstr, <font class="keywordtype">int</font> nChar)
03449 {
03450 <font class="preprocessor">#ifndef _UNICODE</font>
03451 <font class="preprocessor"></font>    <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = nChar; i &gt; 0; i--)
03452     {
03453         <font class="keywordflow">if</font>(!::IsDBCSLeadByte(lpstr[i - 1]))
03454             <font class="keywordflow">break</font>;
03455     }
03456     <font class="keywordflow">return</font> ((nChar &gt; 0) &amp;&amp; (((nChar - i) &amp; 1) != 0));
03457 <font class="preprocessor">#else //_UNICODE</font>
03458 <font class="preprocessor"></font>    lpstr;  nChar;
03459     <font class="keywordflow">return</font> <font class="keyword">false</font>;
03460 <font class="preprocessor">#endif //_UNICODE</font>
03461 <font class="preprocessor"></font>}
03462 
<a name="l03463"></a><a class="code" href="namespaceWTL.html#a90">03463</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespaceWTL.html#a90">AtlCompactPath</a>(LPTSTR lpstrOut, LPCTSTR lpstrIn, <font class="keywordtype">int</font> cchLen)
03464 {
03465     ATLASSERT(lpstrOut != NULL);
03466     ATLASSERT(lpstrIn != NULL);
03467     ATLASSERT(cchLen &gt; 0);
03468 
03469     LPCTSTR szEllipsis = _T(<font class="stringliteral">"..."</font>);
03470     <font class="keyword">const</font> <font class="keywordtype">int</font> cchEndEllipsis = 3;
03471     <font class="keyword">const</font> <font class="keywordtype">int</font> cchMidEllipsis = 4;
03472 
03473     <font class="keywordflow">if</font>(lstrlen(lpstrIn) + 1 &lt; cchLen)
03474         <font class="keywordflow">return</font> (lstrcpy(lpstrOut, lpstrIn) != NULL);
03475 
03476     lpstrOut[0] = 0;
03477 
03478     <font class="comment">// check if the separator is a slash or a backslash</font>
03479     TCHAR chSlash = _T(<font class="charliteral">'\\'</font>);
03480     <font class="keywordflow">for</font>(LPTSTR lpstr = (LPTSTR)lpstrIn; *lpstr != 0; lpstr = ::CharNext(lpstr))
03481     {
03482         <font class="keywordflow">if</font>((*lpstr == _T(<font class="charliteral">'/'</font>)) || (*lpstr == _T(<font class="charliteral">'\\'</font>)))
03483             chSlash = *lpstr;
03484     }
03485 
03486     <font class="comment">// find the filename portion of the path</font>
03487     LPCTSTR lpstrFileName = lpstrIn;
03488     <font class="keywordflow">for</font>(LPCTSTR pPath = lpstrIn; *pPath; pPath = ::CharNext(pPath))
03489     {
03490         <font class="keywordflow">if</font>((pPath[0] == _T(<font class="charliteral">'\\'</font>) || pPath[0] == _T(<font class="charliteral">':'</font>) || pPath[0] == _T(<font class="charliteral">'/'</font>))
03491                 &amp;&amp; pPath[1] &amp;&amp; pPath[1] != _T(<font class="charliteral">'\\'</font>) &amp;&amp; pPath[1] != _T(<font class="charliteral">'/'</font>))
03492             lpstrFileName = pPath + 1;
03493     }
03494     <font class="keywordtype">int</font> cchFileName = lstrlen(lpstrFileName);
03495 
03496     <font class="comment">// handle just the filename without a path</font>
03497     <font class="keywordflow">if</font>(lpstrFileName == lpstrIn &amp;&amp; cchLen &gt; cchEndEllipsis)
03498     {
03499         <font class="keywordtype">bool</font> bRet = (lstrcpyn(lpstrOut, lpstrIn, cchLen - cchEndEllipsis) != NULL);
03500         <font class="keywordflow">if</font>(bRet)
03501         {
03502 <font class="preprocessor">#ifndef _UNICODE</font>
03503 <font class="preprocessor"></font>            <font class="keywordflow">if</font>(<a class="code" href="namespaceWTL.html#a109">_IsDBCSTrailByte</a>(lpstrIn, cchLen - cchEndEllipsis))
03504                 lpstrOut[cchLen - cchEndEllipsis - 1] = 0;
03505 <font class="preprocessor">#endif //_UNICODE</font>
03506 <font class="preprocessor"></font>            bRet = (lstrcat(lpstrOut, szEllipsis) != NULL);
03507         }
03508         <font class="keywordflow">return</font> bRet;
03509     }
03510 
03511     <font class="comment">// handle just ellipsis</font>
03512     <font class="keywordflow">if</font>((cchLen &lt; (cchMidEllipsis + cchEndEllipsis)))
03513     {
03514         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; cchLen - 1; i++)
03515             lpstrOut[i] = ((i + 1) == cchMidEllipsis) ? chSlash : _T(<font class="charliteral">'.'</font>);
03516         lpstrOut[i] = 0;
03517         <font class="keywordflow">return</font> <font class="keyword">true</font>;
03518     }
03519 
03520     <font class="comment">// calc how much we have to copy</font>
03521     <font class="keywordtype">int</font> cchToCopy = cchLen - (cchMidEllipsis + cchFileName);
03522 
03523     <font class="keywordflow">if</font>(cchToCopy &lt; 0)
03524         cchToCopy = 0;
03525 
03526 <font class="preprocessor">#ifndef _UNICODE</font>
03527 <font class="preprocessor"></font>    <font class="keywordflow">if</font>(cchToCopy &gt; 0 &amp;&amp; <a class="code" href="namespaceWTL.html#a109">_IsDBCSTrailByte</a>(lpstrIn, cchToCopy))
03528         cchToCopy--;
03529 <font class="preprocessor">#endif //_UNICODE</font>
03530 <font class="preprocessor"></font>
03531     <font class="keywordtype">bool</font> bRet = (lstrcpyn(lpstrOut, lpstrIn, cchToCopy) != NULL);
03532     <font class="keywordflow">if</font>(!bRet)
03533         <font class="keywordflow">return</font> <font class="keyword">false</font>;
03534 
03535     <font class="comment">// add ellipsis</font>
03536     bRet = (lstrcat(lpstrOut, szEllipsis) != NULL);
03537     <font class="keywordflow">if</font>(!bRet)
03538         <font class="keywordflow">return</font> <font class="keyword">false</font>;
03539     TCHAR szSlash[2] = { chSlash, 0 };
03540     bRet = (lstrcat(lpstrOut, szSlash) != NULL);
03541     <font class="keywordflow">if</font>(!bRet)
03542         <font class="keywordflow">return</font> <font class="keyword">false</font>;
03543 
03544     <font class="comment">// add filename (and ellipsis, if needed)</font>
03545     <font class="keywordflow">if</font>(cchLen &gt; (cchMidEllipsis + cchFileName))
03546     {
03547         bRet = (lstrcat(lpstrOut, lpstrFileName) != NULL);
03548     }
03549     <font class="keywordflow">else</font>
03550     {
03551         cchToCopy = cchLen - cchMidEllipsis - cchEndEllipsis;
03552 <font class="preprocessor">#ifndef _UNICODE</font>
03553 <font class="preprocessor"></font>        <font class="keywordflow">if</font>(cchToCopy &gt; 0 &amp;&amp; <a class="code" href="namespaceWTL.html#a109">_IsDBCSTrailByte</a>(lpstrFileName, cchToCopy))
03554             cchToCopy--;
03555 <font class="preprocessor">#endif //_UNICODE</font>
03556 <font class="preprocessor"></font>        bRet = (lstrcpyn(&amp;lpstrOut[cchMidEllipsis], lpstrFileName, cchToCopy) != NULL);
03557         <font class="keywordflow">if</font>(bRet)
03558             bRet = (lstrcat(lpstrOut, szEllipsis) != NULL);
03559     }
03560 
03561     <font class="keywordflow">return</font> bRet;
03562 }
03563 
03564 }; <font class="comment">//namespace WTL</font>
03565 
03566 <font class="preprocessor">#endif // __ATLMISC_H__</font>
</pre></div><hr><address align="right"><small>Generated on Thu Apr 11 21:09:32 2002 for wtl-doc by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
