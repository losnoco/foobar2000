<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>atlddx.h Source File</title>
<link href="mystyles.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>atlddx.h</h1><a href="atlddx_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// Windows Template Library - WTL version 7.0</font>
00002 <font class="comment">// Copyright (C) 1997-2002 Microsoft Corporation</font>
00003 <font class="comment">// All rights reserved.</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// This file is a part of the Windows Template Library.</font>
00006 <font class="comment">// The code and information is provided "as-is" without</font>
00007 <font class="comment">// warranty of any kind, either expressed or implied.</font>
00008 
00009 <font class="preprocessor">#ifndef __ATLDDX_H__</font>
00010 <font class="preprocessor"></font><font class="preprocessor">#define __ATLDDX_H__</font>
00011 <font class="preprocessor"></font>
00012 <font class="preprocessor">#pragma once</font>
00013 <font class="preprocessor"></font>
00014 <font class="preprocessor">#if defined(_ATL_USE_DDX_FLOAT) &amp;&amp; defined(_ATL_MIN_CRT)</font>
00015 <font class="preprocessor"></font><font class="preprocessor">    #error Cannot use floating point DDX with _ATL_MIN_CRT defined</font>
00016 <font class="preprocessor"></font><font class="preprocessor">#endif //defined(_ATL_USE_DDX_FLOAT) &amp;&amp; defined(_ATL_MIN_CRT)</font>
00017 <font class="preprocessor"></font>
00018 <font class="preprocessor">#ifdef _ATL_USE_DDX_FLOAT</font>
00019 <font class="preprocessor"></font><font class="preprocessor">#include &lt;float.h&gt;</font>
00020 <font class="preprocessor">#ifndef _DEBUG</font>
00021 <font class="preprocessor"></font><font class="preprocessor">#include &lt;stdio.h&gt;</font>
00022 <font class="preprocessor">#endif </font>
00023 <font class="preprocessor">#endif //_ATL_USE_DDX_FLOAT</font>
00024 <font class="preprocessor"></font>
00025 
00027 <font class="comment">// Classes in this file</font>
00028 <font class="comment">//</font>
00029 <font class="comment">// CWinDataExchange&lt;T&gt;</font>
00030 
00031 
00032 <font class="keyword">namespace </font>WTL
00033 {
00034 
00035 <font class="comment">// Constants</font>
<a name="l00036"></a><a class="code" href="atlddx_8h.html#a0">00036</a> <font class="preprocessor">#define DDX_LOAD    FALSE</font>
<a name="l00037"></a><a class="code" href="atlddx_8h.html#a1">00037</a> <font class="preprocessor"></font><font class="preprocessor">#define DDX_SAVE    TRUE</font>
00038 <font class="preprocessor"></font>
00039 <font class="comment">// DDX map macros</font>
<a name="l00040"></a><a class="code" href="atlddx_8h.html#a2">00040</a> <font class="preprocessor">#define BEGIN_DDX_MAP(thisClass) \</font>
00041 <font class="preprocessor">    BOOL DoDataExchange(BOOL bSaveAndValidate = FALSE, UINT nCtlID = (UINT)-1) \</font>
00042 <font class="preprocessor">    { \</font>
00043 <font class="preprocessor">        bSaveAndValidate; \</font>
00044 <font class="preprocessor">        nCtlID;</font>
00045 <font class="preprocessor"></font>
<a name="l00046"></a><a class="code" href="atlddx_8h.html#a3">00046</a> <font class="preprocessor">#define DDX_TEXT(nID, var) \</font>
00047 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00048 <font class="preprocessor">        { \</font>
00049 <font class="preprocessor">            if(!DDX_Text(nID, var, sizeof(var), bSaveAndValidate)) \</font>
00050 <font class="preprocessor">                return FALSE; \</font>
00051 <font class="preprocessor">        }</font>
00052 <font class="preprocessor"></font>
<a name="l00053"></a><a class="code" href="atlddx_8h.html#a4">00053</a> <font class="preprocessor">#define DDX_TEXT_LEN(nID, var, len) \</font>
00054 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00055 <font class="preprocessor">        { \</font>
00056 <font class="preprocessor">            if(!DDX_Text(nID, var, sizeof(var), bSaveAndValidate, TRUE, len)) \</font>
00057 <font class="preprocessor">                return FALSE; \</font>
00058 <font class="preprocessor">        }</font>
00059 <font class="preprocessor"></font>
<a name="l00060"></a><a class="code" href="atlddx_8h.html#a5">00060</a> <font class="preprocessor">#define DDX_INT(nID, var) \</font>
00061 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00062 <font class="preprocessor">        { \</font>
00063 <font class="preprocessor">            if(!DDX_Int(nID, var, TRUE, bSaveAndValidate)) \</font>
00064 <font class="preprocessor">                return FALSE; \</font>
00065 <font class="preprocessor">        }</font>
00066 <font class="preprocessor"></font>
<a name="l00067"></a><a class="code" href="atlddx_8h.html#a6">00067</a> <font class="preprocessor">#define DDX_INT_RANGE(nID, var, min, max) \</font>
00068 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00069 <font class="preprocessor">        { \</font>
00070 <font class="preprocessor">            if(!DDX_Int(nID, var, TRUE, bSaveAndValidate, TRUE, min, max)) \</font>
00071 <font class="preprocessor">                return FALSE; \</font>
00072 <font class="preprocessor">        }</font>
00073 <font class="preprocessor"></font>
<a name="l00074"></a><a class="code" href="atlddx_8h.html#a7">00074</a> <font class="preprocessor">#define DDX_UINT(nID, var) \</font>
00075 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00076 <font class="preprocessor">        { \</font>
00077 <font class="preprocessor">            if(!DDX_Int(nID, var, FALSE, bSaveAndValidate)) \</font>
00078 <font class="preprocessor">                return FALSE; \</font>
00079 <font class="preprocessor">        }</font>
00080 <font class="preprocessor"></font>
<a name="l00081"></a><a class="code" href="atlddx_8h.html#a8">00081</a> <font class="preprocessor">#define DDX_UINT_RANGE(nID, var, min, max) \</font>
00082 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00083 <font class="preprocessor">        { \</font>
00084 <font class="preprocessor">            if(!DDX_Int(nID, var, FALSE, bSaveAndValidate, TRUE, min, max)) \</font>
00085 <font class="preprocessor">                return FALSE; \</font>
00086 <font class="preprocessor">        }</font>
00087 <font class="preprocessor"></font>
00088 <font class="preprocessor">#ifdef _ATL_USE_DDX_FLOAT</font>
00089 <font class="preprocessor"></font><font class="preprocessor">#define DDX_FLOAT(nID, var) \</font>
00090 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00091 <font class="preprocessor">        { \</font>
00092 <font class="preprocessor">            if(!DDX_Float(nID, var, bSaveAndValidate)) \</font>
00093 <font class="preprocessor">                return FALSE; \</font>
00094 <font class="preprocessor">        }</font>
00095 <font class="preprocessor"></font>
00096 <font class="preprocessor">#define DDX_FLOAT_RANGE(nID, var, min, max) \</font>
00097 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00098 <font class="preprocessor">        { \</font>
00099 <font class="preprocessor">            if(!DDX_Float(nID, var, bSaveAndValidate, TRUE, min, max)) \</font>
00100 <font class="preprocessor">                return FALSE; \</font>
00101 <font class="preprocessor">        }</font>
00102 <font class="preprocessor"></font><font class="preprocessor">#endif //_ATL_USE_DDX_FLOAT</font>
00103 <font class="preprocessor"></font>
<a name="l00104"></a><a class="code" href="atlddx_8h.html#a9">00104</a> <font class="preprocessor">#define DDX_CONTROL(nID, obj) \</font>
00105 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00106 <font class="preprocessor">            DDX_Control(nID, obj, bSaveAndValidate);</font>
00107 <font class="preprocessor"></font>
<a name="l00108"></a><a class="code" href="atlddx_8h.html#a10">00108</a> <font class="preprocessor">#define DDX_CHECK(nID, var) \</font>
00109 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00110 <font class="preprocessor">            DDX_Check(nID, var, bSaveAndValidate);</font>
00111 <font class="preprocessor"></font>
<a name="l00112"></a><a class="code" href="atlddx_8h.html#a11">00112</a> <font class="preprocessor">#define DDX_RADIO(nID, var) \</font>
00113 <font class="preprocessor">        if(nCtlID == (UINT)-1 || nCtlID == nID) \</font>
00114 <font class="preprocessor">            DDX_Radio(nID, var, bSaveAndValidate);</font>
00115 <font class="preprocessor"></font>
<a name="l00116"></a><a class="code" href="atlddx_8h.html#a12">00116</a> <font class="preprocessor">#define END_DDX_MAP() \</font>
00117 <font class="preprocessor">        return TRUE; \</font>
00118 <font class="preprocessor">    }</font>
00119 <font class="preprocessor"></font>
00120 
00122 <font class="comment">// CWinDataExchange - provides support for DDX</font>
00123 
00124 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
<a name="l00125"></a><a class="code" href="classWTL_1_1CWinDataExchange.html">00125</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CWinDataExchange.html">CWinDataExchange</a>
00126 {
00127 <font class="keyword">public</font>:
00128 <font class="comment">// Data exchange method - override in your derived class</font>
<a name="l00129"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a0">00129</a>     BOOL <a class="code" href="classWTL_1_1CWinDataExchange.html#a0">DoDataExchange</a>(BOOL <font class="comment">/*bSaveAndValidate*/</font> = FALSE, UINT <font class="comment">/*nCtlID*/</font> = (UINT)-1)
00130     {
00131         <font class="comment">// this one should never be called, override it in</font>
00132         <font class="comment">// your derived class by implementing DDX map</font>
00133         ATLASSERT(FALSE);
00134         <font class="keywordflow">return</font> FALSE;
00135     }
00136 
00137 <font class="comment">// Helpers for validation error reporting</font>
<a name="l00138"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#s5">00138</a>     <font class="keyword">enum</font> <a class="code" href="classWTL_1_1CWinDataExchange.html#s5">_XDataType</a>
00139     {
00140         <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s0">ddxDataNull</a> = 0,
00141         <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s1">ddxDataText</a> = 1,
00142         <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s2">ddxDataInt</a> = 2,
00143         <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s3">ddxDataFloat</a> = 3,
00144         <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s4">ddxDataDouble</a> = 4
00145     };
00146 
<a name="l00147"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html">00147</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html">_XTextData</a>
00148     {
<a name="l00149"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m0">00149</a>         <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m0">nLength</a>;
<a name="l00150"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m1">00150</a>         <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m1">nMaxLength</a>;
00151     };
00152 
<a name="l00153"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html">00153</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html">_XIntData</a>
00154     {
<a name="l00155"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m0">00155</a>         <font class="keywordtype">long</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m0">nVal</a>;
<a name="l00156"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m1">00156</a>         <font class="keywordtype">long</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m1">nMin</a>;
<a name="l00157"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m2">00157</a>         <font class="keywordtype">long</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m2">nMax</a>;
00158     };
00159 
<a name="l00160"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html">00160</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html">_XFloatData</a>
00161     {
<a name="l00162"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html#m0">00162</a>         <font class="keywordtype">double</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html#m0">nVal</a>;
<a name="l00163"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html#m1">00163</a>         <font class="keywordtype">double</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html#m1">nMin</a>;
<a name="l00164"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html#m2">00164</a>         <font class="keywordtype">double</font> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html#m2">nMax</a>;
00165     };
00166 
<a name="l00167"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">00167</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">_XData</a>
00168     {
<a name="l00169"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m0">00169</a>         _XDataType <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m0">nDataType</a>;
00170         <font class="keyword">union</font>
00171 <font class="keyword">        </font>{
<a name="l00172"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">00172</a>             <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html">_XTextData</a> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>;
<a name="l00173"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m2">00173</a>             <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html">_XIntData</a> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m2">intData</a>;
<a name="l00174"></a><a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m3">00174</a>             <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XFloatData.html">_XFloatData</a> <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m3">floatData</a>;
00175         };
00176     };
00177 
00178 <font class="comment">// Text exchange</font>
<a name="l00179"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a1">00179</a>     BOOL <a class="code" href="classWTL_1_1CWinDataExchange.html#a1">DDX_Text</a>(UINT nID, LPTSTR lpstrText, <font class="keywordtype">int</font> cbSize, BOOL bSave, BOOL bValidate = FALSE, <font class="keywordtype">int</font> nLength = 0)
00180     {
00181         T* pT = static_cast&lt;T*&gt;(this);
00182         BOOL bSuccess = TRUE;
00183 
00184         <font class="keywordflow">if</font>(bSave)
00185         {
00186             HWND hWndCtrl = pT-&gt;GetDlgItem(nID);
00187             <font class="keywordtype">int</font> nRetLen = ::GetWindowText(hWndCtrl, lpstrText, cbSize / <font class="keyword">sizeof</font>(TCHAR));
00188             <font class="keywordflow">if</font>(nRetLen &lt; ::GetWindowTextLength(hWndCtrl))
00189                 bSuccess = FALSE;
00190         }
00191         <font class="keywordflow">else</font>
00192         {
00193             ATLASSERT(!bValidate || lstrlen(lpstrText) &lt;= nLength);
00194             bSuccess = pT-&gt;SetDlgItemText(nID, lpstrText);
00195         }
00196 
00197         <font class="keywordflow">if</font>(!bSuccess)
00198         {
00199             pT-&gt;OnDataExchangeError(nID, bSave);
00200         }
00201         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00202         {
00203             ATLASSERT(nLength &gt; 0);
00204             <font class="keywordflow">if</font>(lstrlen(lpstrText) &gt; nLength)
00205             {
00206                 <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">_XData</a> data;
00207                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m0">nDataType</a> = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s1">ddxDataText</a>;
00208                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m0">nLength</a> = lstrlen(lpstrText);
00209                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m1">nMaxLength</a> = nLength;
00210                 pT-&gt;OnDataValidateError(nID, bSave, data);
00211                 bSuccess = FALSE;
00212             }
00213         }
00214         <font class="keywordflow">return</font> bSuccess;
00215     }
00216 
<a name="l00217"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a2">00217</a>     BOOL <a class="code" href="classWTL_1_1CWinDataExchange.html#a1">DDX_Text</a>(UINT nID, BSTR&amp; bstrText, <font class="keywordtype">int</font> <font class="comment">/*cbSize*/</font>, BOOL bSave, BOOL bValidate = FALSE, <font class="keywordtype">int</font> nLength = 0)
00218     {
00219         T* pT = static_cast&lt;T*&gt;(this);
00220         BOOL bSuccess = TRUE;
00221 
00222         <font class="keywordflow">if</font>(bSave)
00223         {
00224             bSuccess = pT-&gt;GetDlgItemText(nID, bstrText);
00225         }
00226         <font class="keywordflow">else</font>
00227         {
00228             USES_CONVERSION;
00229             LPTSTR lpstrText = OLE2T(bstrText);
00230             ATLASSERT(!bValidate || lstrlen(lpstrText) &lt;= nLength);
00231             bSuccess = pT-&gt;SetDlgItemText(nID, lpstrText);
00232         }
00233 
00234         <font class="keywordflow">if</font>(!bSuccess)
00235         {
00236             pT-&gt;OnDataExchangeError(nID, bSave);
00237         }
00238         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00239         {
00240             ATLASSERT(nLength &gt; 0);
00241             <font class="keywordflow">if</font>((int)::SysStringLen(bstrText) &gt; nLength)
00242             {
00243                 <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">_XData</a> data;
00244                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m0">nDataType</a> = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s1">ddxDataText</a>;
00245                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m0">nLength</a> = (int)::SysStringLen(bstrText);
00246                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m1">nMaxLength</a> = nLength;
00247                 pT-&gt;OnDataValidateError(nID, bSave, data);
00248                 bSuccess = FALSE;
00249             }
00250         }
00251         <font class="keywordflow">return</font> bSuccess;
00252     }
00253 
<a name="l00254"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a3">00254</a>     BOOL <a class="code" href="classWTL_1_1CWinDataExchange.html#a1">DDX_Text</a>(UINT nID, CComBSTR&amp; bstrText, <font class="keywordtype">int</font> <font class="comment">/*cbSize*/</font>, BOOL bSave, BOOL bValidate = FALSE, <font class="keywordtype">int</font> nLength = 0)
00255     {
00256         T* pT = static_cast&lt;T*&gt;(this);
00257         BOOL bSuccess = TRUE;
00258 
00259         <font class="keywordflow">if</font>(bSave)
00260         {
00261             bSuccess = pT-&gt;GetDlgItemText(nID, (BSTR&amp;)bstrText);
00262         }
00263         <font class="keywordflow">else</font>
00264         {
00265             USES_CONVERSION;
00266             LPTSTR lpstrText = OLE2T(bstrText);
00267             ATLASSERT(!bValidate || lstrlen(lpstrText) &lt;= nLength);
00268             bSuccess = pT-&gt;SetDlgItemText(nID, lpstrText);
00269         }
00270 
00271         <font class="keywordflow">if</font>(!bSuccess)
00272         {
00273             pT-&gt;OnDataExchangeError(nID, bSave);
00274         }
00275         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00276         {
00277             ATLASSERT(nLength &gt; 0);
00278             <font class="keywordflow">if</font>((int)bstrText.Length() &gt; nLength)
00279             {
00280                 <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">_XData</a> data;
00281                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m0">nDataType</a> = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s1">ddxDataText</a>;
00282                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m0">nLength</a> = (int)bstrText.Length();
00283                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m1">textData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XTextData.html#m1">nMaxLength</a> = nLength;
00284                 pT-&gt;OnDataValidateError(nID, bSave, data);
00285                 bSuccess = FALSE;
00286             }
00287         }
00288         <font class="keywordflow">return</font> bSuccess;
00289     }
00290 
00291 <font class="preprocessor">#if defined(_WTL_USE_CSTRING) || defined(__ATLSTR_H__)</font>
00292 <font class="preprocessor"></font>    BOOL <a class="code" href="classWTL_1_1CWinDataExchange.html#a1">DDX_Text</a>(UINT nID, CString&amp; strText, <font class="keywordtype">int</font> <font class="comment">/*cbSize*/</font>, BOOL bSave, BOOL bValidate = FALSE, <font class="keywordtype">int</font> nLength = 0)
00293     {
00294         T* pT = static_cast&lt;T*&gt;(this);
00295         BOOL bSuccess = TRUE;
00296 
00297         <font class="keywordflow">if</font>(bSave)
00298         {
00299             HWND hWndCtrl = pT-&gt;GetDlgItem(nID);
00300             <font class="keywordtype">int</font> nLen = ::GetWindowTextLength(hWndCtrl);
00301             <font class="keywordtype">int</font> nRetLen = -1;
00302             LPTSTR lpstr = strText.GetBufferSetLength(nLen);
00303             <font class="keywordflow">if</font>(lpstr != NULL)
00304             {
00305                 nRetLen = ::GetWindowText(hWndCtrl, lpstr, nLen + 1);
00306                 strText.ReleaseBuffer();
00307             }
00308             <font class="keywordflow">if</font>(nRetLen &lt; nLen)
00309                 bSuccess = FALSE;
00310         }
00311         <font class="keywordflow">else</font>
00312         {
00313             bSuccess = pT-&gt;SetDlgItemText(nID, strText);
00314         }
00315 
00316         <font class="keywordflow">if</font>(!bSuccess)
00317         {
00318             pT-&gt;OnDataExchangeError(nID, bSave);
00319         }
00320         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00321         {
00322             ATLASSERT(nLength &gt; 0);
00323             <font class="keywordflow">if</font>(strText.GetLength() &gt; nLength)
00324             {
00325                 _XData data;
00326                 data.nDataType = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s1">ddxDataText</a>;
00327                 data.textData.nLength = strText.GetLength();
00328                 data.textData.nMaxLength = nLength;
00329                 pT-&gt;OnDataValidateError(nID, bSave, data);
00330                 bSuccess = FALSE;
00331             }
00332         }
00333         <font class="keywordflow">return</font> bSuccess;
00334     }
00335 <font class="preprocessor">#endif //defined(_WTL_USE_CSTRING) || defined(__ATLSTR_H__)</font>
00336 <font class="preprocessor"></font>
00337 <font class="comment">// Numeric exchange</font>
00338     <font class="keyword">template</font> &lt;<font class="keyword">class</font> Type&gt;
<a name="l00339"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a4">00339</a>     BOOL <a class="code" href="classWTL_1_1CWinDataExchange.html#a4">DDX_Int</a>(UINT nID, Type&amp; nVal, BOOL bSigned, BOOL bSave, BOOL bValidate = FALSE, Type nMin = 0, Type nMax = 0)
00340     {
00341         T* pT = static_cast&lt;T*&gt;(this);
00342         BOOL bSuccess = TRUE;
00343 
00344         <font class="keywordflow">if</font>(bSave)
00345         {
00346             nVal = (Type)pT-&gt;GetDlgItemInt(nID, &amp;bSuccess, bSigned);
00347         }
00348         <font class="keywordflow">else</font>
00349         {
00350             ATLASSERT(!bValidate || nVal &gt;= nMin &amp;&amp; nVal &lt;= nMax);
00351             bSuccess = pT-&gt;SetDlgItemInt(nID, nVal, bSigned);
00352         }
00353 
00354         <font class="keywordflow">if</font>(!bSuccess)
00355         {
00356             pT-&gt;OnDataExchangeError(nID, bSave);
00357         }
00358         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00359         {
00360             ATLASSERT(nMin != nMax);
00361             <font class="keywordflow">if</font>(nVal &lt; nMin || nVal &gt; nMax)
00362             {
00363                 <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">_XData</a> data;
00364                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m0">nDataType</a> = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s2">ddxDataInt</a>;
00365                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m2">intData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m0">nVal</a> = (long)nVal;
00366                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m2">intData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m1">nMin</a> = (long)nMin;
00367                 data.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html#m2">intData</a>.<a class="code" href="structWTL_1_1CWinDataExchange_1_1__XIntData.html#m2">nMax</a> = (long)nMax;
00368                 pT-&gt;OnDataValidateError(nID, bSave, data);
00369                 bSuccess = FALSE;
00370             }
00371         }
00372         <font class="keywordflow">return</font> bSuccess;
00373     }
00374 
00375 <font class="comment">// Float exchange</font>
00376 <font class="preprocessor">#ifdef _ATL_USE_DDX_FLOAT</font>
00377 <font class="preprocessor"></font>    <font class="keyword">static</font> BOOL _AtlSimpleFloatParse(LPCTSTR lpszText, <font class="keywordtype">double</font>&amp; d)
00378     {
00379         ATLASSERT(lpszText != NULL);
00380         <font class="keywordflow">while</font> (*lpszText == <font class="charliteral">' '</font> || *lpszText == <font class="charliteral">'\t'</font>)
00381             lpszText++;
00382 
00383         TCHAR chFirst = lpszText[0];
00384         d = _tcstod(lpszText, (LPTSTR*)&amp;lpszText);
00385         <font class="keywordflow">if</font> (d == 0.0 &amp;&amp; chFirst != <font class="charliteral">'0'</font>)
00386             <font class="keywordflow">return</font> FALSE;   <font class="comment">// could not convert</font>
00387         <font class="keywordflow">while</font> (*lpszText == <font class="charliteral">' '</font> || *lpszText == <font class="charliteral">'\t'</font>)
00388             lpszText++;
00389 
00390         <font class="keywordflow">if</font> (*lpszText != <font class="charliteral">'\0'</font>)
00391             <font class="keywordflow">return</font> FALSE;   <font class="comment">// not terminated properly</font>
00392 
00393         <font class="keywordflow">return</font> TRUE;
00394     }
00395 
00396     BOOL DDX_Float(UINT nID, <font class="keywordtype">float</font>&amp; nVal, BOOL bSave, BOOL bValidate = FALSE, <font class="keywordtype">float</font> nMin = 0.F, <font class="keywordtype">float</font> nMax = 0.F)
00397     {
00398         T* pT = static_cast&lt;T*&gt;(this);
00399         BOOL bSuccess = TRUE;
00400         TCHAR szBuff[32];
00401 
00402         <font class="keywordflow">if</font>(bSave)
00403         {
00404             pT-&gt;GetDlgItemText(nID, szBuff, <font class="keyword">sizeof</font>(szBuff) / <font class="keyword">sizeof</font>(TCHAR));
00405             <font class="keywordtype">double</font> d = 0;
00406             <font class="keywordflow">if</font>(_AtlSimpleFloatParse(szBuff, d))
00407                 nVal = (float)d;
00408             <font class="keywordflow">else</font>
00409                 bSuccess = FALSE;
00410         }
00411         <font class="keywordflow">else</font>
00412         {
00413             ATLASSERT(!bValidate || nVal &gt;= nMin &amp;&amp; nVal &lt;= nMax);
00414             _stprintf(szBuff, _T(<font class="stringliteral">"%.*g"</font>), FLT_DIG, nVal);
00415             bSuccess = pT-&gt;SetDlgItemText(nID, szBuff);
00416         }
00417 
00418         <font class="keywordflow">if</font>(!bSuccess)
00419         {
00420             pT-&gt;OnDataExchangeError(nID, bSave);
00421         }
00422         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00423         {
00424             ATLASSERT(nMin != nMax);
00425             <font class="keywordflow">if</font>(nVal &lt; nMin || nVal &gt; nMax)
00426             {
00427                 _XData data;
00428                 data.nDataType = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s3">ddxDataFloat</a>;
00429                 data.floatData.nVal = (double)nVal;
00430                 data.floatData.nMin = (double)nMin;
00431                 data.floatData.nMax = (double)nMax;
00432                 pT-&gt;OnDataValidateError(nID, bSave, data);
00433                 bSuccess = FALSE;
00434             }
00435         }
00436         <font class="keywordflow">return</font> bSuccess;
00437     }
00438 
00439     BOOL DDX_Float(UINT nID, <font class="keywordtype">double</font>&amp; nVal, BOOL bSave, BOOL bValidate = FALSE, <font class="keywordtype">double</font> nMin = 0., <font class="keywordtype">double</font> nMax = 0.)
00440     {
00441         T* pT = static_cast&lt;T*&gt;(this);
00442         BOOL bSuccess = TRUE;
00443         TCHAR szBuff[32];
00444 
00445         <font class="keywordflow">if</font>(bSave)
00446         {
00447             pT-&gt;GetDlgItemText(nID, szBuff, <font class="keyword">sizeof</font>(szBuff) / <font class="keyword">sizeof</font>(TCHAR));
00448             <font class="keywordtype">double</font> d = 0;
00449             <font class="keywordflow">if</font>(_AtlSimpleFloatParse(szBuff, d))
00450                 nVal = d;
00451             <font class="keywordflow">else</font>
00452                 bSuccess = FALSE;
00453         }
00454         <font class="keywordflow">else</font>
00455         {
00456             ATLASSERT(!bValidate || nVal &gt;= nMin &amp;&amp; nVal &lt;= nMax);
00457             _stprintf(szBuff, _T(<font class="stringliteral">"%.*g"</font>), DBL_DIG, nVal);
00458             bSuccess = pT-&gt;SetDlgItemText(nID, szBuff);
00459         }
00460 
00461         <font class="keywordflow">if</font>(!bSuccess)
00462         {
00463             pT-&gt;OnDataExchangeError(nID, bSave);
00464         }
00465         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(bSave &amp;&amp; bValidate) <font class="comment">// validation</font>
00466         {
00467             ATLASSERT(nMin != nMax);
00468             <font class="keywordflow">if</font>(nVal &lt; nMin || nVal &gt; nMax)
00469             {
00470                 _XData data;
00471                 data.nDataType = <a class="code" href="classWTL_1_1CWinDataExchange.html#s5s3">ddxDataFloat</a>;
00472                 data.floatData.nVal = nVal;
00473                 data.floatData.nMin = nMin;
00474                 data.floatData.nMax = nMax;
00475                 pT-&gt;OnDataValidateError(nID, bSave, data);
00476                 bSuccess = FALSE;
00477             }
00478         }
00479         <font class="keywordflow">return</font> bSuccess;
00480     }
00481 <font class="preprocessor">#endif //_ATL_USE_DDX_FLOAT</font>
00482 <font class="preprocessor"></font>
00483 <font class="comment">// Control subclassing</font>
00484     <font class="keyword">template</font> &lt;<font class="keyword">class</font> TControl&gt;
<a name="l00485"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a5">00485</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CWinDataExchange.html#a5">DDX_Control</a>(UINT nID, TControl&amp; ctrl, BOOL bSave)
00486     {
00487         T* pT = static_cast&lt;T*&gt;(this);
00488         <font class="keywordflow">if</font>(!bSave &amp;&amp; ctrl.m_hWnd == NULL)
00489             ctrl.SubclassWindow(pT-&gt;GetDlgItem(nID));
00490     }
00491 
00492 <font class="comment">// Control state</font>
<a name="l00493"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a6">00493</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CWinDataExchange.html#a6">DDX_Check</a>(UINT nID, <font class="keywordtype">int</font>&amp; nValue, BOOL bSave)
00494     {
00495         T* pT = static_cast&lt;T*&gt;(this);
00496         HWND hWndCtrl = pT-&gt;GetDlgItem(nID);
00497         <font class="keywordflow">if</font>(bSave)
00498         {
00499             nValue = (int)::SendMessage(hWndCtrl, BM_GETCHECK, 0, 0L);
00500             ATLASSERT(nValue &gt;= 0 &amp;&amp; nValue &lt;= 2);
00501         }
00502         <font class="keywordflow">else</font>
00503         {
00504             <font class="keywordflow">if</font>(nValue &lt; 0 || nValue &gt; 2)
00505             {
00506                 ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, <font class="stringliteral">"ATL: Warning - dialog data checkbox value (%d) out of range.\n"</font>, nValue);
00507                 nValue = 0;  <font class="comment">// default to off</font>
00508             }
00509             ::SendMessage(hWndCtrl, BM_SETCHECK, nValue, 0L);
00510         }
00511     }
00512 
<a name="l00513"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a7">00513</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CWinDataExchange.html#a7">DDX_Radio</a>(UINT nID, <font class="keywordtype">int</font>&amp; nValue, BOOL bSave)
00514     {
00515         T* pT = static_cast&lt;T*&gt;(this);
00516         HWND hWndCtrl = pT-&gt;GetDlgItem(nID);
00517         ATLASSERT(hWndCtrl != NULL);
00518 
00519         <font class="comment">// must be first in a group of auto radio buttons</font>
00520         ATLASSERT(::GetWindowLong(hWndCtrl, GWL_STYLE) &amp; WS_GROUP);
00521         ATLASSERT(::SendMessage(hWndCtrl, WM_GETDLGCODE, 0, 0L) &amp; DLGC_RADIOBUTTON);
00522 
00523         <font class="keywordflow">if</font>(bSave)
00524             nValue = -1;     <font class="comment">// value if none found</font>
00525 
00526         <font class="comment">// walk all children in group</font>
00527         <font class="keywordtype">int</font> nButton = 0;
00528         <font class="keywordflow">do</font>
00529         {
00530             <font class="keywordflow">if</font>(::SendMessage(hWndCtrl, WM_GETDLGCODE, 0, 0L) &amp; DLGC_RADIOBUTTON)
00531             {
00532                 <font class="comment">// control in group is a radio button</font>
00533                 <font class="keywordflow">if</font>(bSave)
00534                 {
00535                     <font class="keywordflow">if</font>(::SendMessage(hWndCtrl, BM_GETCHECK, 0, 0L) != 0)
00536                     {
00537                         ATLASSERT(nValue == -1);    <font class="comment">// only set once</font>
00538                         nValue = nButton;
00539                     }
00540                 }
00541                 <font class="keywordflow">else</font>
00542                 {
00543                     <font class="comment">// select button</font>
00544                     ::SendMessage(hWndCtrl, BM_SETCHECK, (nButton == nValue), 0L);
00545                 }
00546                 nButton++;
00547             }
00548             <font class="keywordflow">else</font>
00549             {
00550                 ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, <font class="stringliteral">"ATL: Warning - skipping non-radio button in group.\n"</font>);
00551             }
00552             hWndCtrl = ::GetWindow(hWndCtrl, GW_HWNDNEXT);
00553         }
00554         <font class="keywordflow">while</font> (hWndCtrl != NULL &amp;&amp; !(GetWindowLong(hWndCtrl, GWL_STYLE) &amp; WS_GROUP));
00555     }
00556 
00557 <font class="comment">// Overrideables</font>
<a name="l00558"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a8">00558</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CWinDataExchange.html#a8">OnDataExchangeError</a>(UINT nCtrlID, BOOL <font class="comment">/*bSave*/</font>)
00559     {
00560         <font class="comment">// Override to display an error message</font>
00561         ::MessageBeep((UINT)-1);
00562         T* pT = static_cast&lt;T*&gt;(this);
00563         ::SetFocus(pT-&gt;GetDlgItem(nCtrlID));
00564     }
00565 
<a name="l00566"></a><a class="code" href="classWTL_1_1CWinDataExchange.html#a9">00566</a>     <font class="keywordtype">void</font> <a class="code" href="classWTL_1_1CWinDataExchange.html#a9">OnDataValidateError</a>(UINT nCtrlID, BOOL <font class="comment">/*bSave*/</font>, <a class="code" href="structWTL_1_1CWinDataExchange_1_1__XData.html">_XData</a>&amp; <font class="comment">/*data*/</font>)
00567     {
00568         <font class="comment">// Override to display an error message</font>
00569         ::MessageBeep((UINT)-1);
00570         T* pT = static_cast&lt;T*&gt;(this);
00571         ::SetFocus(pT-&gt;GetDlgItem(nCtrlID));
00572     }
00573 };
00574 
00575 }; <font class="comment">//namespace WTL</font>
00576 
00577 <font class="preprocessor">#endif //__ATLDDX_H__</font>
</pre></div><hr><address align="right"><small>Generated on Thu Apr 11 21:09:30 2002 for wtl-doc by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
