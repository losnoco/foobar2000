<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>atlframe.h Source File</title>
<link href="mystyles.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>atlframe.h</h1><a href="atlframe_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// Windows Template Library - WTL version 7.0</font>
00002 <font class="comment">// Copyright (C) 1997-2002 Microsoft Corporation</font>
00003 <font class="comment">// All rights reserved.</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// This file is a part of the Windows Template Library.</font>
00006 <font class="comment">// The code and information is provided "as-is" without</font>
00007 <font class="comment">// warranty of any kind, either expressed or implied.</font>
00008 
00009 <font class="preprocessor">#ifndef __ATLFRAME_H__</font>
00010 <font class="preprocessor"></font><font class="preprocessor">#define __ATLFRAME_H__</font>
00011 <font class="preprocessor"></font>
00012 <font class="preprocessor">#pragma once</font>
00013 <font class="preprocessor"></font>
00014 <font class="preprocessor">#ifndef __cplusplus</font>
00015 <font class="preprocessor"></font><font class="preprocessor">    #error ATL requires C++ compilation (use a .cpp suffix)</font>
00016 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00017 <font class="preprocessor"></font>
00018 <font class="preprocessor">#ifndef __ATLAPP_H__</font>
00019 <font class="preprocessor"></font><font class="preprocessor">    #error atlframe.h requires atlapp.h to be included first</font>
00020 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00021 <font class="preprocessor"></font>
00022 <font class="preprocessor">#ifndef __ATLWIN_H__</font>
00023 <font class="preprocessor"></font><font class="preprocessor">    #error atlframe.h requires atlwin.h to be included first</font>
00024 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00025 <font class="preprocessor"></font>
00026 
00028 <font class="comment">// Classes in this file</font>
00029 <font class="comment">//</font>
00030 <font class="comment">// CFrameWindowImpl&lt;T, TBase, TWinTraits&gt;</font>
00031 <font class="comment">// CMDIWindow</font>
00032 <font class="comment">// CMDIFrameWindowImpl&lt;T, TBase, TWinTraits&gt;</font>
00033 <font class="comment">// CMDIChildWindowImpl&lt;T, TBase, TWinTraits&gt;</font>
00034 <font class="comment">// COwnerDraw&lt;T&gt;</font>
00035 <font class="comment">// CUpdateUIBase</font>
00036 <font class="comment">// CUpdateUI&lt;T&gt;</font>
00037 <font class="comment">// CDialogResize&lt;T&gt;</font>
00038 
00039 
00040 <font class="keyword">namespace </font>WTL
00041 {
00042 
00044 <font class="comment">// CFrameWndClassInfo - Manages frame window Windows class information</font>
00045 
<a name="l00046"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html">00046</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1CFrameWndClassInfo.html">CFrameWndClassInfo</a>
00047 {
00048 <font class="keyword">public</font>:
<a name="l00049"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">00049</a>     WNDCLASSEX <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>;
<a name="l00050"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m1">00050</a>     LPCTSTR <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m1">m_lpszOrigName</a>;
<a name="l00051"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m2">00051</a>     WNDPROC <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m2">pWndProc</a>;
<a name="l00052"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m3">00052</a>     LPCTSTR <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m3">m_lpszCursorID</a>;
<a name="l00053"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m4">00053</a>     BOOL <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m4">m_bSystemCursor</a>;
<a name="l00054"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">00054</a>     ATOM <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a>;
<a name="l00055"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m6">00055</a>     TCHAR <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m6">m_szAutoName</a>[5 + <font class="keyword">sizeof</font>(<font class="keywordtype">void</font>*) * 2];  <font class="comment">// sizeof(void*) * 2 is the number of digits %p outputs</font>
<a name="l00056"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m7">00056</a>     UINT <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m7">m_uCommonResourceID</a>;
00057 
<a name="l00058"></a><a class="code" href="classWTL_1_1CFrameWndClassInfo.html#a0">00058</a>     ATOM <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#a0">Register</a>(WNDPROC* pProc)
00059     {
00060         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a> == 0)
00061         {
00062             ::EnterCriticalSection(&amp;_Module.m_csWindowCreate);
00063             <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a> == 0)
00064             {
00065                 HINSTANCE hInst = _Module.GetModuleInstance();
00066                 <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m1">m_lpszOrigName</a> != NULL)
00067                 {
00068                     ATLASSERT(pProc != NULL);
00069                     LPCTSTR lpsz = <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpszClassName;
00070                     WNDPROC proc = <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpfnWndProc;
00071 
00072                     WNDCLASSEX wc;
00073                     wc.cbSize = <font class="keyword">sizeof</font>(WNDCLASSEX);
00074                     <font class="comment">// try process local class first</font>
00075                     <font class="keywordflow">if</font>(!::GetClassInfoEx(_Module.GetModuleInstance(), <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m1">m_lpszOrigName</a>, &amp;wc))
00076                     {
00077                         <font class="comment">// try global class</font>
00078                         <font class="keywordflow">if</font>(!::GetClassInfoEx(NULL, <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m1">m_lpszOrigName</a>, &amp;wc))
00079                         {
00080                             ::LeaveCriticalSection(&amp;_Module.m_csWindowCreate);
00081                             <font class="keywordflow">return</font> 0;
00082                         }
00083                     }
00084                     memcpy(&amp;<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>, &amp;wc, <font class="keyword">sizeof</font>(WNDCLASSEX));
00085                     <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m2">pWndProc</a> = <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpfnWndProc;
00086                     <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpszClassName = lpsz;
00087                     <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpfnWndProc = proc;
00088                 }
00089                 <font class="keywordflow">else</font>
00090                 {
00091                     <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.hCursor = ::LoadCursor(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m4">m_bSystemCursor</a> ? NULL : hInst, <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m3">m_lpszCursorID</a>);
00092                 }
00093 
00094                 <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.hInstance = hInst;
00095                 <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.style &amp;= ~CS_GLOBALCLASS;  <font class="comment">// we don't register global classes</font>
00096                 <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpszClassName == NULL)
00097                 {
00098                     wsprintf(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m6">m_szAutoName</a>, _T(<font class="stringliteral">"ATL:%p"</font>), &amp;<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>);
00099                     <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpszClassName = <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m6">m_szAutoName</a>;
00100                 }
00101                 WNDCLASSEX wcTemp;
00102                 memcpy(&amp;wcTemp, &amp;<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>, <font class="keyword">sizeof</font>(WNDCLASSEX));
00103                 <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a> = (ATOM)::GetClassInfoEx(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.hInstance, <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.lpszClassName, &amp;wcTemp);
00104 
00105                 <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a> == 0)
00106                 {
00107                     <font class="keywordflow">if</font>(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m7">m_uCommonResourceID</a> != 0)    <font class="comment">// use it if not zero</font>
00108                     {
00109                         <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.hIcon = (HICON)::LoadImage(_Module.GetResourceInstance(), MAKEINTRESOURCE(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m7">m_uCommonResourceID</a>), IMAGE_ICON, 32, 32, LR_DEFAULTCOLOR);
00110                         <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>.hIconSm = (HICON)::LoadImage(_Module.GetResourceInstance(), MAKEINTRESOURCE(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m7">m_uCommonResourceID</a>), IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR);
00111                     }
00112                     <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a> = ::RegisterClassEx(&amp;<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m0">m_wc</a>);
00113                 }
00114             }
00115             ::LeaveCriticalSection(&amp;_Module.m_csWindowCreate);
00116         }
00117 
00118         <font class="keywordflow">if</font> (<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m1">m_lpszOrigName</a> != NULL)
00119         {
00120             ATLASSERT(pProc != NULL);
00121             ATLASSERT(<a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m2">pWndProc</a> != NULL);
00122             *pProc = <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m2">pWndProc</a>;
00123         }
00124         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFrameWndClassInfo.html#m5">m_atom</a>;
00125     }
00126 };
00127 
<a name="l00128"></a><a class="code" href="atlframe_8h.html#a0">00128</a> <font class="preprocessor">#define DECLARE_FRAME_WND_CLASS(WndClassName, uCommonResourceID) \</font>
00129 <font class="preprocessor">static CFrameWndClassInfo&amp; GetWndClassInfo() \</font>
00130 <font class="preprocessor">{ \</font>
00131 <font class="preprocessor">    static CFrameWndClassInfo wc = \</font>
00132 <font class="preprocessor">    { \</font>
00133 <font class="preprocessor">        { sizeof(WNDCLASSEX), 0, StartWindowProc, \</font>
00134 <font class="preprocessor">          0, 0, NULL, NULL, NULL, (HBRUSH)(COLOR_WINDOW + 1), NULL, WndClassName, NULL }, \</font>
00135 <font class="preprocessor">        NULL, NULL, IDC_ARROW, TRUE, 0, _T(""), uCommonResourceID \</font>
00136 <font class="preprocessor">    }; \</font>
00137 <font class="preprocessor">    return wc; \</font>
00138 <font class="preprocessor">}</font>
00139 <font class="preprocessor"></font>
<a name="l00140"></a><a class="code" href="atlframe_8h.html#a1">00140</a> <font class="preprocessor">#define DECLARE_FRAME_WND_CLASS_EX(WndClassName, uCommonResourceID, style, bkgnd) \</font>
00141 <font class="preprocessor">static CFrameWndClassInfo&amp; GetWndClassInfo() \</font>
00142 <font class="preprocessor">{ \</font>
00143 <font class="preprocessor">    static CFrameWndClassInfo wc = \</font>
00144 <font class="preprocessor">    { \</font>
00145 <font class="preprocessor">        { sizeof(WNDCLASSEX), style, StartWindowProc, \</font>
00146 <font class="preprocessor">          0, 0, NULL, NULL, NULL, (HBRUSH)(bkgnd + 1), NULL, WndClassName, NULL }, \</font>
00147 <font class="preprocessor">        NULL, NULL, IDC_ARROW, TRUE, 0, _T(""), uCommonResourceID \</font>
00148 <font class="preprocessor">    }; \</font>
00149 <font class="preprocessor">    return wc; \</font>
00150 <font class="preprocessor">}</font>
00151 <font class="preprocessor"></font>
<a name="l00152"></a><a class="code" href="atlframe_8h.html#a2">00152</a> <font class="preprocessor">#define DECLARE_FRAME_WND_SUPERCLASS(WndClassName, OrigWndClassName, uCommonResourceID) \</font>
00153 <font class="preprocessor">static CFrameWndClassInfo&amp; GetWndClassInfo() \</font>
00154 <font class="preprocessor">{ \</font>
00155 <font class="preprocessor">    static CFrameWndClassInfo wc = \</font>
00156 <font class="preprocessor">    { \</font>
00157 <font class="preprocessor">        { sizeof(WNDCLASSEX), 0, StartWindowProc, \</font>
00158 <font class="preprocessor">          0, 0, NULL, NULL, NULL, NULL, NULL, WndClassName, NULL }, \</font>
00159 <font class="preprocessor">        OrigWndClassName, NULL, NULL, TRUE, 0, _T(""), uCommonResourceID \</font>
00160 <font class="preprocessor">    }; \</font>
00161 <font class="preprocessor">    return wc; \</font>
00162 <font class="preprocessor">}</font>
00163 <font class="preprocessor"></font>
00164 
00165 <font class="comment">// Command Chaining Macros</font>
00166 
<a name="l00167"></a><a class="code" href="atlframe_8h.html#a3">00167</a> <font class="preprocessor">#define CHAIN_COMMANDS(theChainClass) \</font>
00168 <font class="preprocessor">    { \</font>
00169 <font class="preprocessor">        if(uMsg == WM_COMMAND &amp;&amp; theChainClass::ProcessWindowMessage(hWnd, uMsg, wParam, lParam, lResult)) \</font>
00170 <font class="preprocessor">            return TRUE; \</font>
00171 <font class="preprocessor">    }</font>
00172 <font class="preprocessor"></font>
<a name="l00173"></a><a class="code" href="atlframe_8h.html#a4">00173</a> <font class="preprocessor">#define CHAIN_COMMANDS_MEMBER(theChainMember) \</font>
00174 <font class="preprocessor">    { \</font>
00175 <font class="preprocessor">        if(uMsg == WM_COMMAND &amp;&amp; theChainMember.ProcessWindowMessage(hWnd, uMsg, wParam, lParam, lResult)) \</font>
00176 <font class="preprocessor">            return TRUE; \</font>
00177 <font class="preprocessor">    }</font>
00178 <font class="preprocessor"></font>
<a name="l00179"></a><a class="code" href="atlframe_8h.html#a5">00179</a> <font class="preprocessor">#define CHAIN_COMMANDS_ALT(theChainClass, msgMapID) \</font>
00180 <font class="preprocessor">    { \</font>
00181 <font class="preprocessor">        if(uMsg == WM_COMMAND &amp;&amp; theChainClass::ProcessWindowMessage(hWnd, uMsg, wParam, lParam, lResult, msgMapID)) \</font>
00182 <font class="preprocessor">            return TRUE; \</font>
00183 <font class="preprocessor">    }</font>
00184 <font class="preprocessor"></font>
<a name="l00185"></a><a class="code" href="atlframe_8h.html#a6">00185</a> <font class="preprocessor">#define CHAIN_COMMANDS_ALT_MEMBER(theChainMember, msgMapID) \</font>
00186 <font class="preprocessor">    { \</font>
00187 <font class="preprocessor">        if(uMsg == WM_COMMAND &amp;&amp; theChainMember.ProcessWindowMessage(hWnd, uMsg, wParam, lParam, lResult, msgMapID)) \</font>
00188 <font class="preprocessor">            return TRUE; \</font>
00189 <font class="preprocessor">    }</font>
00190 <font class="preprocessor"></font>
00191 
00192 <font class="comment">// Client window command chaining macro</font>
<a name="l00193"></a><a class="code" href="atlframe_8h.html#a7">00193</a> <font class="preprocessor">#define CHAIN_CLIENT_COMMANDS() \</font>
00194 <font class="preprocessor">    if(uMsg == WM_COMMAND &amp;&amp; m_hWndClient != NULL) \</font>
00195 <font class="preprocessor">        ::SendMessage(m_hWndClient, uMsg, wParam, lParam);</font>
00196 <font class="preprocessor"></font>
00198 <font class="comment">// CFrameWindowImpl</font>
00199 
00200 <font class="comment">// standard toolbar styles</font>
<a name="l00201"></a><a class="code" href="atlframe_8h.html#a8">00201</a> <font class="preprocessor">#define ATL_SIMPLE_TOOLBAR_STYLE \</font>
00202 <font class="preprocessor">    (WS_CHILD | WS_VISIBLE | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | TBSTYLE_TOOLTIPS)</font>
00203 <font class="preprocessor"></font><font class="comment">// toolbar in a rebar pane</font>
<a name="l00204"></a><a class="code" href="atlframe_8h.html#a9">00204</a> <font class="preprocessor">#define ATL_SIMPLE_TOOLBAR_PANE_STYLE \</font>
00205 <font class="preprocessor">    (WS_CHILD | WS_VISIBLE | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | CCS_NODIVIDER | CCS_NORESIZE | CCS_NOPARENTALIGN | TBSTYLE_TOOLTIPS | TBSTYLE_FLAT)</font>
00206 <font class="preprocessor"></font><font class="comment">// standard rebar styles</font>
00207 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
<a name="l00208"></a><a class="code" href="atlframe_8h.html#a10">00208</a> <font class="preprocessor"></font><font class="preprocessor">#define ATL_SIMPLE_REBAR_STYLE \</font>
00209 <font class="preprocessor">    (WS_CHILD | WS_VISIBLE | WS_BORDER | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | RBS_VARHEIGHT | RBS_BANDBORDERS | RBS_AUTOSIZE)</font>
00210 <font class="preprocessor"></font><font class="preprocessor">#else</font>
00211 <font class="preprocessor"></font><font class="preprocessor">#define ATL_SIMPLE_REBAR_STYLE \</font>
00212 <font class="preprocessor">    (WS_CHILD | WS_VISIBLE | WS_BORDER | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | RBS_VARHEIGHT | RBS_BANDBORDERS)</font>
00213 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
00214 <font class="preprocessor">// rebar without borders</font>
00215 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
<a name="l00216"></a><a class="code" href="atlframe_8h.html#a11">00216</a> <font class="preprocessor"></font><font class="preprocessor">#define ATL_SIMPLE_REBAR_NOBORDER_STYLE \</font>
00217 <font class="preprocessor">    (WS_CHILD | WS_VISIBLE | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | RBS_VARHEIGHT | RBS_BANDBORDERS | RBS_AUTOSIZE | CCS_NODIVIDER)</font>
00218 <font class="preprocessor"></font><font class="preprocessor">#else</font>
00219 <font class="preprocessor"></font><font class="preprocessor">#define ATL_SIMPLE_REBAR_NOBORDER_STYLE \</font>
00220 <font class="preprocessor">    (WS_CHILD | WS_VISIBLE | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | RBS_VARHEIGHT | RBS_BANDBORDERS | CCS_NODIVIDER)</font>
00221 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
00222 <font class="preprocessor"></font>
00223 <font class="preprocessor"></font><font class="comment">// command bar support</font>
00224 <font class="preprocessor">#ifndef __ATLCTRLW_H__</font>
00225 <font class="preprocessor"></font>
<a name="l00226"></a><a class="code" href="atlframe_8h.html#a12">00226</a> <font class="preprocessor">#define CBRM_GETCMDBAR          (WM_USER + 301) // return command bar HWND</font>
<a name="l00227"></a><a class="code" href="atlframe_8h.html#a13">00227</a> <font class="preprocessor"></font><font class="preprocessor">#define CBRM_GETMENU            (WM_USER + 302) // returns loaded or attached menu</font>
<a name="l00228"></a><a class="code" href="atlframe_8h.html#a14">00228</a> <font class="preprocessor"></font><font class="preprocessor">#define CBRM_TRACKPOPUPMENU     (WM_USER + 303) // displays a popup menu</font>
00229 <font class="preprocessor"></font>
<a name="l00230"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html">00230</a> <font class="keyword">struct </font><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html">_AtlFrameWnd_CmdBarPopupMenu</a>
00231 {
<a name="l00232"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m0">00232</a>     <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m0">cbSize</a>;
<a name="l00233"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m1">00233</a>     HMENU <a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m1">hMenu</a>;
<a name="l00234"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m2">00234</a>     UINT <a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m2">uFlags</a>;
<a name="l00235"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m3">00235</a>     <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m3">x</a>;
<a name="l00236"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m4">00236</a>     <font class="keywordtype">int</font> <a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m4">y</a>;
<a name="l00237"></a><a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m5">00237</a>     LPTPMPARAMS <a class="code" href="structWTL_1_1__AtlFrameWnd__CmdBarPopupMenu.html#m5">lptpm</a>;
00238 };
00239 
<a name="l00240"></a><a class="code" href="atlframe_8h.html#a15">00240</a> <font class="preprocessor">#define CBRPOPUPMENU _AtlFrameWnd_CmdBarPopupMenu</font>
00241 <font class="preprocessor"></font>
00242 <font class="preprocessor">#endif </font>
00243 <font class="preprocessor"></font>
00244 <font class="preprocessor"></font>
00245 <font class="keyword">template</font> &lt;<font class="keyword">class</font> TBase = CWindow, <font class="keyword">class</font> TWinTraits = CFrameWinTraits&gt;
<a name="l00246"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html">00246</a> <font class="keyword">class </font>ATL_NO_VTABLE <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase</a> : <font class="keyword">public</font> <a class="code" href="classCWindowImplBaseT.html">CWindowImplBaseT</a>&lt; TBase, TWinTraits &gt;
00247 {
00248 <font class="keyword">public</font>:
<a name="l00249"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#d0">00249</a>     <a class="code" href="atlframe_8h.html#a0">DECLARE_FRAME_WND_CLASS</a>(NULL, 0)
00250 
00251 <font class="comment">// Data members</font>
<a name="l00252"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#m0">00252</a>     HWND m_hWndToolBar;
<a name="l00253"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#m1">00253</a>     HWND m_hWndStatusBar;
<a name="l00254"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#m2">00254</a>     HWND m_hWndClient;
00255 
<a name="l00256"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#m3">00256</a>     HACCEL m_hAccel;
00257 
<a name="l00258"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html">00258</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html">_AtlToolBarData</a>
00259     {
<a name="l00260"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m0">00260</a>         WORD wVersion;
<a name="l00261"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m1">00261</a>         WORD wWidth;
<a name="l00262"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m2">00262</a>         WORD wHeight;
<a name="l00263"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m3">00263</a>         WORD wItemCount;
00264         <font class="comment">//WORD aItems[wItemCount]</font>
00265 
<a name="l00266"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#a0">00266</a>         WORD* items()
00267             { <font class="keywordflow">return</font> (WORD*)(<font class="keyword">this</font>+1); }
00268     };
00269 
00270 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
<a name="l00271"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html">00271</a> <font class="preprocessor"></font>    <font class="keyword">struct </font><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html">_ChevronMenuInfo</a>
00272     {
<a name="l00273"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m0">00273</a>         HMENU hMenu;
<a name="l00274"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">00274</a>         LPNMREBARCHEVRON lpnm;
<a name="l00275"></a><a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m2">00275</a>         <font class="keywordtype">bool</font> bCmdBar;
00276     };
00277 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
00278 <font class="preprocessor"></font>
00279 <font class="comment">// Constructor</font>
<a name="l00280"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a0">00280</a>     <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase</a>() : m_hWndToolBar(NULL), m_hWndStatusBar(NULL), m_hWndClient(NULL), m_hAccel(NULL)
00281     { }
00282 
00283 <font class="comment">// Methods</font>
00284 <font class="preprocessor">#if (_ATL_VER &lt; 0x0700)</font>
<a name="l00285"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a1">00285</a> <font class="preprocessor"></font>    HWND Create(HWND hWndParent, <a class="code" href="classWTL_1_1__U__RECT.html">_U_RECT</a> rect, LPCTSTR szWindowName, DWORD dwStyle, DWORD dwExStyle, <a class="code" href="classWTL_1_1__U__MENUorID.html">_U_MENUorID</a> MenuOrID, ATOM atom, LPVOID lpCreateParam)
00286     {
00287         ATLASSERT(m_hWnd == NULL);
00288 
00289         <font class="keywordflow">if</font>(atom == 0)
00290             <font class="keywordflow">return</font> NULL;
00291 
00292         _Module.AddCreateWndData(&amp;m_thunk.cd, <font class="keyword">this</font>);
00293 
00294         <font class="keywordflow">if</font>(MenuOrID.<a class="code" href="classWTL_1_1__U__MENUorID.html#m0">m_hMenu</a> == NULL &amp;&amp; (dwStyle &amp; WS_CHILD))
00295             MenuOrID.<a class="code" href="classWTL_1_1__U__MENUorID.html#m0">m_hMenu</a> = (HMENU)(UINT_PTR)<font class="keyword">this</font>;
00296         <font class="keywordflow">if</font>(rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a> == NULL)
00297             rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a> = &amp;TBase::rcDefault;
00298 
00299         HWND hWnd = ::CreateWindowEx(dwExStyle, (LPCTSTR)(LONG_PTR)MAKELONG(atom, 0), szWindowName,
00300             dwStyle, rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a>-&gt;left, rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a>-&gt;top, rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a>-&gt;right - rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a>-&gt;left,
00301             rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a>-&gt;bottom - rect.<a class="code" href="classWTL_1_1__U__RECT.html#m0">m_lpRect</a>-&gt;top, hWndParent, MenuOrID.<a class="code" href="classWTL_1_1__U__MENUorID.html#m0">m_hMenu</a>,
00302             _Module.GetModuleInstance(), lpCreateParam);
00303 
00304         ATLASSERT(m_hWnd == hWnd);
00305 
00306         <font class="keywordflow">return</font> hWnd;
00307     }
00308 <font class="preprocessor">#endif //(_ATL_VER &lt; 0x0700)</font>
00309 <font class="preprocessor"></font>
<a name="l00310"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#d1">00310</a>     <font class="keyword">static</font> HWND CreateSimpleToolBarCtrl(HWND hWndParent, UINT nResourceID, BOOL bInitialSeparator = FALSE, 
00311             DWORD dwStyle = <a class="code" href="atlframe_8h.html#a8">ATL_SIMPLE_TOOLBAR_STYLE</a>, UINT nID = <a class="code" href="atlres_8h.html#a4">ATL_IDW_TOOLBAR</a>)
00312     {
00313         HINSTANCE hInst = _Module.GetResourceInstance();
00314         HRSRC hRsrc = ::FindResource(hInst, MAKEINTRESOURCE(nResourceID), <a class="code" href="atlres_8h.html#a1">RT_TOOLBAR</a>);
00315         <font class="keywordflow">if</font> (hRsrc == NULL)
00316             <font class="keywordflow">return</font> NULL;
00317 
00318         HGLOBAL hGlobal = ::LoadResource(hInst, hRsrc);
00319         <font class="keywordflow">if</font> (hGlobal == NULL)
00320             <font class="keywordflow">return</font> NULL;
00321 
00322         <a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html">_AtlToolBarData</a>* pData = (<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html">_AtlToolBarData</a>*)::LockResource(hGlobal);
00323         <font class="keywordflow">if</font> (pData == NULL)
00324             <font class="keywordflow">return</font> NULL;
00325         ATLASSERT(pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m0">wVersion</a> == 1);
00326 
00327         WORD* pItems = pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#a0">items</a>();
00328         <font class="keywordtype">int</font> nItems = pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m3">wItemCount</a> + (bInitialSeparator ? 1 : 0);
00329         TBBUTTON* pTBBtn = (TBBUTTON*)_alloca(nItems * <font class="keyword">sizeof</font>(TBBUTTON));
00330 
00331         <font class="comment">// set initial separator (half width)</font>
00332         <font class="keywordflow">if</font>(bInitialSeparator)
00333         {
00334             pTBBtn[0].iBitmap = 4;
00335             pTBBtn[0].idCommand = 0;
00336             pTBBtn[0].fsState = 0;
00337             pTBBtn[0].fsStyle = TBSTYLE_SEP;
00338             pTBBtn[0].dwData = 0;
00339             pTBBtn[0].iString = 0;
00340         }
00341 
00342         <font class="keywordtype">int</font> nBmp = 0;
00343         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0, j = bInitialSeparator ? 1 : 0; i &lt; pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m3">wItemCount</a>; i++, j++)
00344         {
00345             <font class="keywordflow">if</font>(pItems[i] != 0)
00346             {
00347                 pTBBtn[j].iBitmap = nBmp++;
00348                 pTBBtn[j].idCommand = pItems[i];
00349                 pTBBtn[j].fsState = TBSTATE_ENABLED;
00350                 pTBBtn[j].fsStyle = TBSTYLE_BUTTON;
00351                 pTBBtn[j].dwData = 0;
00352                 pTBBtn[j].iString = 0;
00353             }
00354             <font class="keywordflow">else</font>
00355             {
00356                 pTBBtn[j].iBitmap = 8;
00357                 pTBBtn[j].idCommand = 0;
00358                 pTBBtn[j].fsState = 0;
00359                 pTBBtn[j].fsStyle = TBSTYLE_SEP;
00360                 pTBBtn[j].dwData = 0;
00361                 pTBBtn[j].iString = 0;
00362             }
00363         }
00364 
00365         HWND hWnd = ::CreateWindowEx(0, TOOLBARCLASSNAME, NULL, dwStyle, 0,0,100,100,
00366                 hWndParent, (HMENU)<a class="code" href="atlapp_8h.html#a15">LongToHandle</a>(nID), _Module.GetModuleInstance(), NULL);
00367 
00368         ::SendMessage(hWnd, TB_BUTTONSTRUCTSIZE, <font class="keyword">sizeof</font>(TBBUTTON), 0L);
00369 
00370         <font class="comment">// check if font is taller than our bitmaps</font>
00371         <a class="code" href="namespaceWTL.html#a39">CFontHandle</a> font = (HFONT)::SendMessage(hWnd, WM_GETFONT, 0, 0L);
00372         <font class="keywordflow">if</font>(font.IsNull())
00373             font = <a class="code" href="namespaceWTL.html#a60">AtlGetDefaultGuiFont</a>();
00374         LOGFONT lf;
00375         font.GetLogFont(lf);
00376         WORD cyFontHeight = (WORD)abs(lf.lfHeight);
00377 
00378         <font class="keywordflow">if</font>(<a class="code" href="namespaceWTL.html#a63">AtlIsAlphaBitmapResource</a>(nResourceID))   <font class="comment">// alpha channel bitmap (valid for Windows XP only)</font>
00379         {
00380             HIMAGELIST hImageList = ImageList_LoadImage(_Module.GetResourceInstance(), MAKEINTRESOURCE(nResourceID), pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m1">wWidth</a>, 1, CLR_NONE, IMAGE_BITMAP, LR_CREATEDIBSECTION | LR_DEFAULTSIZE);
00381             ATLASSERT(hImageList != NULL);
00382             ::SendMessage(hWnd, TB_SETIMAGELIST, 0, (LPARAM)hImageList);
00383         }
00384         <font class="keywordflow">else</font>
00385         {
00386             TBADDBITMAP tbab;
00387             tbab.hInst = hInst;
00388             tbab.nID = nResourceID;
00389             ::SendMessage(hWnd, TB_ADDBITMAP, nBmp, (LPARAM)&amp;tbab);
00390         }
00391 
00392         TBADDBITMAP tbab;
00393         tbab.hInst = hInst;
00394         tbab.nID = nResourceID;
00395         ::SendMessage(hWnd, TB_ADDBUTTONS, nItems, (LPARAM)pTBBtn);
00396         ::SendMessage(hWnd, TB_SETBITMAPSIZE, 0, MAKELONG(pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m1">wWidth</a>, max(pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m2">wHeight</a>, cyFontHeight)));
00397         ::SendMessage(hWnd, TB_SETBUTTONSIZE, 0, MAKELONG(pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m1">wWidth</a> + 7, max(pData-&gt;<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__AtlToolBarData.html#m2">wHeight</a>, cyFontHeight) + 7));
00398 
00399         <font class="keywordflow">return</font> hWnd;
00400     }
00401 
<a name="l00402"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#d2">00402</a>     <font class="keyword">static</font> HWND CreateSimpleReBarCtrl(HWND hWndParent, DWORD dwStyle = <a class="code" href="atlframe_8h.html#a10">ATL_SIMPLE_REBAR_STYLE</a>, UINT nID = <a class="code" href="atlres_8h.html#a4">ATL_IDW_TOOLBAR</a>)
00403     {
00404         <font class="comment">// Ensure style combinations for proper rebar painting</font>
00405         <font class="keywordflow">if</font>(dwStyle &amp; CCS_NODIVIDER &amp;&amp; dwStyle &amp; WS_BORDER)
00406             dwStyle &amp;= ~WS_BORDER;
00407         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(!(dwStyle &amp; WS_BORDER) &amp;&amp; !(dwStyle &amp; CCS_NODIVIDER))
00408             dwStyle |= CCS_NODIVIDER;
00409 
00410         <font class="comment">// Create rebar window</font>
00411         HWND hWndReBar = ::CreateWindowEx(0, REBARCLASSNAME, NULL, dwStyle, 0, 0, 100, 100, hWndParent, (HMENU)<a class="code" href="atlapp_8h.html#a15">LongToHandle</a>(nID), _Module.GetModuleInstance(), NULL);
00412         <font class="keywordflow">if</font>(hWndReBar == NULL)
00413         {
00414             ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"Failed to create rebar.\n"</font>));
00415             <font class="keywordflow">return</font> NULL;
00416         }
00417 
00418         <font class="comment">// Initialize and send the REBARINFO structure</font>
00419         REBARINFO rbi;
00420         rbi.cbSize = <font class="keyword">sizeof</font>(REBARINFO);
00421         rbi.fMask  = 0;
00422         <font class="keywordflow">if</font>(!::SendMessage(hWndReBar, RB_SETBARINFO, 0, (LPARAM)&amp;rbi))
00423         {
00424             ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"Failed to initialize rebar.\n"</font>));
00425             ::DestroyWindow(hWndReBar);
00426             <font class="keywordflow">return</font> NULL;
00427         }
00428 
00429         <font class="keywordflow">return</font> hWndReBar;
00430     }
00431 
<a name="l00432"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a2">00432</a>     BOOL CreateSimpleReBar(DWORD dwStyle = <a class="code" href="atlframe_8h.html#a10">ATL_SIMPLE_REBAR_STYLE</a>, UINT nID = <a class="code" href="atlres_8h.html#a4">ATL_IDW_TOOLBAR</a>)
00433     {
00434         ATLASSERT(!::IsWindow(m_hWndToolBar));
00435         m_hWndToolBar = CreateSimpleReBarCtrl(m_hWnd, dwStyle, nID);
00436         <font class="keywordflow">return</font> (m_hWndToolBar != NULL);
00437     }
00438 
<a name="l00439"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#d3">00439</a>     <font class="keyword">static</font> BOOL AddSimpleReBarBandCtrl(HWND hWndReBar, HWND hWndBand, <font class="keywordtype">int</font> nID = 0, LPTSTR lpstrTitle = NULL, BOOL bNewRow = FALSE, <font class="keywordtype">int</font> cxWidth = 0, BOOL bFullWidthAlways = FALSE)
00440     {
00441         ATLASSERT(::IsWindow(hWndReBar));   <font class="comment">// must be already created</font>
00442 <font class="preprocessor">#ifdef _DEBUG</font>
00443 <font class="preprocessor"></font>        <font class="comment">// block - check if this is really a rebar</font>
00444         {
00445             TCHAR lpszClassName[<font class="keyword">sizeof</font>(REBARCLASSNAME)];
00446             ::GetClassName(hWndReBar, lpszClassName, <font class="keyword">sizeof</font>(REBARCLASSNAME));
00447             ATLASSERT(lstrcmp(lpszClassName, REBARCLASSNAME) == 0);
00448         }
00449 <font class="preprocessor">#endif //_DEBUG</font>
00450 <font class="preprocessor"></font>        ATLASSERT(::IsWindow(hWndBand));    <font class="comment">// must be already created</font>
00451 
00452         <font class="comment">// Get number of buttons on the toolbar</font>
00453         <font class="keywordtype">int</font> nBtnCount = (int)::SendMessage(hWndBand, TB_BUTTONCOUNT, 0, 0L);
00454 
00455         <font class="comment">// Set band info structure</font>
00456         REBARBANDINFO rbBand;
00457         rbBand.cbSize = <font class="keyword">sizeof</font>(REBARBANDINFO);
00458 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
00459 <font class="preprocessor"></font>        rbBand.fMask = RBBIM_CHILD | RBBIM_CHILDSIZE | RBBIM_STYLE | RBBIM_ID | RBBIM_SIZE | RBBIM_IDEALSIZE;
00460 <font class="preprocessor">#else</font>
00461 <font class="preprocessor"></font>        rbBand.fMask = RBBIM_CHILD | RBBIM_CHILDSIZE | RBBIM_STYLE | RBBIM_ID | RBBIM_SIZE;
00462 <font class="preprocessor">#endif </font>
00463 <font class="preprocessor">        if(lpstrTitle != NULL)</font>
00464 <font class="preprocessor"></font>            rbBand.fMask |= RBBIM_TEXT;
00465         rbBand.fStyle = RBBS_CHILDEDGE;
00466 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
00467 <font class="preprocessor"></font>        <font class="keywordflow">if</font>(nBtnCount &gt; 0)   <font class="comment">// add chevron style for toolbar with buttons</font>
00468             rbBand.fStyle |= RBBS_USECHEVRON;
00469 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
00470 <font class="preprocessor"></font>        <font class="keywordflow">if</font>(bNewRow)
00471             rbBand.fStyle |= RBBS_BREAK;
00472 
00473         rbBand.lpText = lpstrTitle;
00474         rbBand.hwndChild = hWndBand;
00475         <font class="keywordflow">if</font>(nID == 0)    <font class="comment">// calc band ID</font>
00476             nID = <a class="code" href="atlres_8h.html#a14">ATL_IDW_BAND_FIRST</a> + (int)::SendMessage(hWndReBar, RB_GETBANDCOUNT, 0, 0L);
00477         rbBand.wID = nID;
00478 
00479         <font class="comment">// Calculate the size of the band</font>
00480         BOOL bRet;
00481         RECT rcTmp;
00482         <font class="keywordflow">if</font>(nBtnCount &gt; 0)
00483         {
00484             bRet = (BOOL)::SendMessage(hWndBand, TB_GETITEMRECT, nBtnCount - 1, (LPARAM)&amp;rcTmp);
00485             ATLASSERT(bRet);
00486             rbBand.cx = (cxWidth != 0) ? cxWidth : rcTmp.right;
00487             rbBand.cyMinChild = rcTmp.bottom - rcTmp.top;
00488             <font class="keywordflow">if</font>(bFullWidthAlways)
00489             {
00490                 rbBand.cxMinChild = rbBand.cx;
00491             }
00492             <font class="keywordflow">else</font> <font class="keywordflow">if</font>(lpstrTitle == 0)
00493             {
00494                 bRet = (BOOL)::SendMessage(hWndBand, TB_GETITEMRECT, 0, (LPARAM)&amp;rcTmp);
00495                 ATLASSERT(bRet);
00496                 rbBand.cxMinChild = rcTmp.right;
00497             }
00498             <font class="keywordflow">else</font>
00499             {
00500                 rbBand.cxMinChild = 0;
00501             }
00502         }
00503         <font class="keywordflow">else</font>    <font class="comment">// no buttons, either not a toolbar or really has no buttons</font>
00504         {
00505             bRet = ::GetWindowRect(hWndBand, &amp;rcTmp);
00506             ATLASSERT(bRet);
00507             rbBand.cx = (cxWidth != 0) ? cxWidth : (rcTmp.right - rcTmp.left);
00508             rbBand.cxMinChild = bFullWidthAlways ? rbBand.cx : 0;
00509             rbBand.cyMinChild = rcTmp.bottom - rcTmp.top;
00510         }
00511 
00512 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
00513 <font class="preprocessor"></font>        rbBand.cxIdeal = rbBand.cx;
00514 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
00515 <font class="preprocessor"></font>
00516         <font class="comment">// Add the band</font>
00517         LRESULT lRes = ::SendMessage(hWndReBar, RB_INSERTBAND, (WPARAM)-1, (LPARAM)&amp;rbBand);
00518         <font class="keywordflow">if</font>(lRes == 0)
00519         {
00520             ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"Failed to add a band to the rebar.\n"</font>));
00521             <font class="keywordflow">return</font> FALSE;
00522         }
00523 
00524 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0501)</font>
00525 <font class="preprocessor"></font>        DWORD dwExStyle = (DWORD)::SendMessage(hWndBand, TB_GETEXTENDEDSTYLE, 0, 0L);
00526         ::SendMessage(hWndBand, TB_SETEXTENDEDSTYLE, 0, dwExStyle | TBSTYLE_EX_HIDECLIPPEDBUTTONS);
00527 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0501)</font>
00528 <font class="preprocessor"></font>
00529         <font class="keywordflow">return</font> TRUE;
00530     }
00531 
<a name="l00532"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a3">00532</a>     BOOL AddSimpleReBarBand(HWND hWndBand, LPTSTR lpstrTitle = NULL, BOOL bNewRow = FALSE, <font class="keywordtype">int</font> cxWidth = 0, BOOL bFullWidthAlways = FALSE)
00533     {
00534         ATLASSERT(::IsWindow(m_hWndToolBar));   <font class="comment">// must be an existing rebar</font>
00535         ATLASSERT(::IsWindow(hWndBand));    <font class="comment">// must be created</font>
00536         <font class="keywordflow">return</font> AddSimpleReBarBandCtrl(m_hWndToolBar, hWndBand, 0, lpstrTitle, bNewRow, cxWidth, bFullWidthAlways);
00537     }
00538 
00539 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
<a name="l00540"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a4">00540</a> <font class="preprocessor"></font>    <font class="keywordtype">void</font> SizeSimpleReBarBands()
00541     {
00542         ATLASSERT(::IsWindow(m_hWndToolBar));   <font class="comment">// must be an existing rebar</font>
00543 
00544         <font class="keywordtype">int</font> nCount = (int)::SendMessage(m_hWndToolBar, RB_GETBANDCOUNT, 0, 0L);
00545 
00546         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; nCount; i++)
00547         {
00548             REBARBANDINFO rbBand;
00549             rbBand.cbSize = <font class="keyword">sizeof</font>(REBARBANDINFO);
00550             rbBand.fMask = RBBIM_SIZE;
00551             BOOL bRet = (BOOL)::SendMessage(m_hWndToolBar, RB_GETBANDINFO, i, (LPARAM)&amp;rbBand);
00552             ATLASSERT(bRet);
00553             RECT rect = { 0, 0, 0, 0 };
00554             ::SendMessage(m_hWndToolBar, RB_GETBANDBORDERS, i, (LPARAM)&amp;rect);
00555             rbBand.cx += rect.left + rect.right;
00556             bRet = (BOOL)::SendMessage(m_hWndToolBar, RB_SETBANDINFO, i, (LPARAM)&amp;rbBand);
00557             ATLASSERT(bRet);
00558         }
00559     }
00560 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
00561 <font class="preprocessor"></font>
<a name="l00562"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a5">00562</a>     BOOL CreateSimpleStatusBar(LPCTSTR lpstrText, DWORD dwStyle = WS_CHILD | WS_VISIBLE | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | SBARS_SIZEGRIP, UINT nID = <a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>)
00563     {
00564         ATLASSERT(!::IsWindow(m_hWndStatusBar));
00565         m_hWndStatusBar = ::CreateStatusWindow(dwStyle, lpstrText, m_hWnd, nID);
00566         <font class="keywordflow">return</font> (m_hWndStatusBar != NULL);
00567     }
00568 
<a name="l00569"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a6">00569</a>     BOOL CreateSimpleStatusBar(UINT nTextID = <a class="code" href="atlres_8h.html#a104">ATL_IDS_IDLEMESSAGE</a>, DWORD dwStyle = WS_CHILD | WS_VISIBLE | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | SBARS_SIZEGRIP, UINT nID = <a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>)
00570     {
00571         TCHAR szText[128];  <font class="comment">// max text lentgth is 127 for status bars</font>
00572         szText[0] = 0;
00573         ::LoadString(_Module.GetResourceInstance(), nTextID, szText, 128);
00574         <font class="keywordflow">return</font> CreateSimpleStatusBar(szText, dwStyle, nID);
00575     }
00576 
<a name="l00577"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a7">00577</a>     <font class="keywordtype">void</font> UpdateLayout(BOOL bResizeBars = TRUE)
00578     {
00579         RECT rect;
00580         GetClientRect(&amp;rect);
00581 
00582         <font class="comment">// position bars and offset their dimensions</font>
00583         UpdateBarsPosition(rect, bResizeBars);
00584 
00585         <font class="comment">// resize client window</font>
00586         <font class="keywordflow">if</font>(m_hWndClient != NULL)
00587             ::SetWindowPos(m_hWndClient, NULL, rect.left, rect.top,
00588                 rect.right - rect.left, rect.bottom - rect.top,
00589                 SWP_NOZORDER | SWP_NOACTIVATE);
00590     }
00591 
<a name="l00592"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a8">00592</a>     <font class="keywordtype">void</font> UpdateBarsPosition(RECT&amp; rect, BOOL bResizeBars = TRUE)
00593     {
00594         <font class="comment">// resize toolbar</font>
00595         <font class="keywordflow">if</font>(m_hWndToolBar != NULL &amp;&amp; ((DWORD)::GetWindowLong(m_hWndToolBar, GWL_STYLE) &amp; WS_VISIBLE))
00596         {
00597             <font class="keywordflow">if</font>(bResizeBars)
00598                 ::SendMessage(m_hWndToolBar, WM_SIZE, 0, 0);
00599             RECT rectTB;
00600             ::GetWindowRect(m_hWndToolBar, &amp;rectTB);
00601             rect.top += rectTB.bottom - rectTB.top;
00602         }
00603 
00604         <font class="comment">// resize status bar</font>
00605         <font class="keywordflow">if</font>(m_hWndStatusBar != NULL &amp;&amp; ((DWORD)::GetWindowLong(m_hWndStatusBar, GWL_STYLE) &amp; WS_VISIBLE))
00606         {
00607             <font class="keywordflow">if</font>(bResizeBars)
00608                 ::SendMessage(m_hWndStatusBar, WM_SIZE, 0, 0);
00609             RECT rectSB;
00610             ::GetWindowRect(m_hWndStatusBar, &amp;rectSB);
00611             rect.bottom -= rectSB.bottom - rectSB.top;
00612         }
00613     }
00614 
<a name="l00615"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a9">00615</a>     BOOL PreTranslateMessage(MSG* pMsg)
00616     {
00617         <font class="keywordflow">if</font>(m_hAccel != NULL &amp;&amp; ::TranslateAccelerator(m_hWnd, m_hAccel, pMsg))
00618             <font class="keywordflow">return</font> TRUE;
00619         <font class="keywordflow">return</font> FALSE;
00620     }
00621 
<a name="l00622"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#s0">00622</a>     <font class="keyword">typedef</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase&lt; TBase, TWinTraits &gt;</a>   thisClass;
00623     BEGIN_MSG_MAP(thisClass)
00624         MESSAGE_HANDLER(WM_ERASEBKGND, OnEraseBackground)
00625         MESSAGE_HANDLER(WM_MENUSELECT, OnMenuSelect)
00626         MESSAGE_HANDLER(WM_SETFOCUS, OnSetFocus)
00627         MESSAGE_HANDLER(WM_DESTROY, OnDestroy)
00628         NOTIFY_CODE_HANDLER(TTN_GETDISPINFOA, OnToolTipTextA)
00629         NOTIFY_CODE_HANDLER(TTN_GETDISPINFOW, OnToolTipTextW)
00630     END_MSG_MAP()
00631 
<a name="l00632"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a10">00632</a>     LRESULT OnEraseBackground(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
00633     {
00634         <font class="keywordflow">if</font>(m_hWndClient != NULL)    <font class="comment">// view will paint itself instead</font>
00635             <font class="keywordflow">return</font> 1;
00636 
00637         bHandled = FALSE;
00638         <font class="keywordflow">return</font> 0;
00639     }
00640 
<a name="l00641"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a11">00641</a>     LRESULT OnMenuSelect(UINT <font class="comment">/*uMsg*/</font>, WPARAM wParam, LPARAM lParam, BOOL&amp; bHandled)
00642     {
00643         bHandled = FALSE;
00644 
00645         <font class="keywordflow">if</font>(m_hWndStatusBar == NULL)
00646             <font class="keywordflow">return</font> 1;
00647 
00648         WORD wFlags = HIWORD(wParam);
00649         <font class="keywordflow">if</font>(wFlags == 0xFFFF &amp;&amp; lParam == NULL)  <font class="comment">// menu closing</font>
00650             ::SendMessage(m_hWndStatusBar, SB_SIMPLE, FALSE, 0L);
00651         <font class="keywordflow">else</font>
00652         {
00653             TCHAR szBuff[256];
00654             szBuff[0] = 0;
00655             <font class="keywordflow">if</font>(!(wFlags &amp; MF_POPUP))
00656             {
00657                 WORD wID = LOWORD(wParam);
00658                 <font class="comment">// check for special cases</font>
00659                 <font class="keywordflow">if</font>(wID &gt;= 0xF000 &amp;&amp; wID &lt; 0xF1F0)               <font class="comment">// system menu IDs</font>
00660                     wID = (WORD)(((wID - 0xF000) &gt;&gt; 4) + <a class="code" href="atlres_8h.html#a105">ATL_IDS_SCFIRST</a>);
00661                 <font class="keywordflow">else</font> <font class="keywordflow">if</font>(wID &gt;= <a class="code" href="atlres_8h.html#a29">ID_FILE_MRU_FIRST</a> &amp;&amp; wID &lt;= <a class="code" href="atlres_8h.html#a46">ID_FILE_MRU_LAST</a>)    <font class="comment">// MRU items</font>
00662                     wID = <a class="code" href="atlres_8h.html#a116">ATL_IDS_MRU_FILE</a>;
00663                 <font class="keywordflow">else</font> <font class="keywordflow">if</font>(wID &gt;= <a class="code" href="atlres_8h.html#a68">ATL_IDM_FIRST_MDICHILD</a>)              <font class="comment">// MDI child windows</font>
00664                     wID = <a class="code" href="atlres_8h.html#a115">ATL_IDS_MDICHILD</a>;
00665 
00666                 <font class="keywordtype">int</font> nRet = ::LoadString(_Module.GetResourceInstance(), wID, szBuff, 256);
00667                 <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; nRet; i++)
00668                 {
00669                     <font class="keywordflow">if</font>(szBuff[i] == _T(<font class="charliteral">'\n'</font>))
00670                     {
00671                         szBuff[i] = 0;
00672                         <font class="keywordflow">break</font>;
00673                     }
00674                 }
00675             }
00676             ::SendMessage(m_hWndStatusBar, SB_SIMPLE, TRUE, 0L);
00677             ::SendMessage(m_hWndStatusBar, SB_SETTEXT, (255 | SBT_NOBORDERS), (LPARAM)szBuff);
00678         }
00679 
00680         <font class="keywordflow">return</font> 1;
00681     }
00682 
<a name="l00683"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a12">00683</a>     LRESULT OnSetFocus(UINT, WPARAM, LPARAM, BOOL&amp; bHandled)
00684     {
00685         <font class="keywordflow">if</font>(m_hWndClient != NULL &amp;&amp; ::IsWindowVisible(m_hWndClient))
00686             ::SetFocus(m_hWndClient);
00687 
00688         bHandled = FALSE;
00689         <font class="keywordflow">return</font> 1;
00690     }
00691 
<a name="l00692"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a13">00692</a>     LRESULT OnDestroy(UINT, WPARAM, LPARAM, BOOL&amp; bHandled)
00693     {
00694         <font class="keywordflow">if</font>((GetStyle() &amp; (WS_CHILD | WS_POPUP)) == 0)
00695             ::PostQuitMessage(1);
00696 
00697         bHandled = FALSE;
00698         <font class="keywordflow">return</font> 1;
00699     }
00700 
<a name="l00701"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a14">00701</a>     LRESULT OnToolTipTextA(<font class="keywordtype">int</font> idCtrl, LPNMHDR pnmh, BOOL&amp; <font class="comment">/*bHandled*/</font>)
00702     {
00703         LPNMTTDISPINFOA pDispInfo = (LPNMTTDISPINFOA)pnmh;
00704         pDispInfo-&gt;szText[0] = 0;
00705 
00706         <font class="keywordflow">if</font>((idCtrl != 0) &amp;&amp; !(pDispInfo-&gt;uFlags &amp; TTF_IDISHWND))
00707         {
00708             <font class="keywordtype">char</font> szBuff[256];
00709             szBuff[0] = 0;
00710             <font class="keywordtype">int</font> nRet = ::LoadStringA(_Module.GetResourceInstance(), idCtrl, szBuff, 256);
00711             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; nRet; i++)
00712             {
00713                 <font class="keywordflow">if</font>(szBuff[i] == <font class="charliteral">'\n'</font>)
00714                 {
00715                     lstrcpynA(pDispInfo-&gt;szText, &amp;szBuff[i + 1], <font class="keyword">sizeof</font>(pDispInfo-&gt;szText) / <font class="keyword">sizeof</font>(pDispInfo-&gt;szText[0]));
00716                     <font class="keywordflow">break</font>;
00717                 }
00718             }
00719 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0300)</font>
00720 <font class="preprocessor"></font>            <font class="keywordflow">if</font>(nRet &gt; 0)    <font class="comment">// string was loaded, save it</font>
00721                 pDispInfo-&gt;uFlags |= TTF_DI_SETITEM;
00722 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0300)</font>
00723 <font class="preprocessor"></font>        }
00724 
00725         <font class="keywordflow">return</font> 0;
00726     }
00727 
<a name="l00728"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a15">00728</a>     LRESULT OnToolTipTextW(<font class="keywordtype">int</font> idCtrl, LPNMHDR pnmh, BOOL&amp; <font class="comment">/*bHandled*/</font>)
00729     {
00730         LPNMTTDISPINFOW pDispInfo = (LPNMTTDISPINFOW)pnmh;
00731         pDispInfo-&gt;szText[0] = 0;
00732 
00733         <font class="keywordflow">if</font>((idCtrl != 0) &amp;&amp; !(pDispInfo-&gt;uFlags &amp; TTF_IDISHWND))
00734         {
00735             <font class="keywordtype">wchar_t</font> szBuff[256];
00736             szBuff[0] = 0;
00737             <font class="keywordtype">int</font> nRet = ::LoadStringW(_Module.GetResourceInstance(), idCtrl, szBuff, 256);
00738             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; nRet; i++)
00739             {
00740                 <font class="keywordflow">if</font>(szBuff[i] == L<font class="charliteral">'\n'</font>)
00741                 {
00742                     lstrcpynW(pDispInfo-&gt;szText, &amp;szBuff[i + 1], <font class="keyword">sizeof</font>(pDispInfo-&gt;szText) / <font class="keyword">sizeof</font>(pDispInfo-&gt;szText[0]));
00743                     <font class="keywordflow">break</font>;
00744                 }
00745             }
00746 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0300)</font>
00747 <font class="preprocessor"></font>            <font class="keywordflow">if</font>(nRet &gt; 0)    <font class="comment">// string was loaded, save it</font>
00748                 pDispInfo-&gt;uFlags |= TTF_DI_SETITEM;
00749 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0300)</font>
00750 <font class="preprocessor"></font>        }
00751 
00752         <font class="keywordflow">return</font> 0;
00753     }
00754 
00755 <font class="comment">// Implementation - chevron menu support</font>
00756 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
<a name="l00757"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a16">00757</a> <font class="preprocessor"></font>    <font class="keywordtype">bool</font> PrepareChevronMenu(<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html">_ChevronMenuInfo</a>&amp; cmi)
00758     {
00759         <font class="comment">// get rebar and toolbar</font>
00760         REBARBANDINFO rbbi;
00761         rbbi.cbSize = <font class="keyword">sizeof</font>(REBARBANDINFO);
00762         rbbi.fMask = RBBIM_CHILD;
00763         BOOL bRet = (BOOL)::SendMessage(cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">lpnm</a>-&gt;hdr.hwndFrom, RB_GETBANDINFO, cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">lpnm</a>-&gt;uBand, (LPARAM)&amp;rbbi);
00764         ATLASSERT(bRet);
00765 
00766         <font class="comment">// assume the band is a toolbar</font>
00767         <a class="code" href="classCWindow.html">CWindow</a> wnd = rbbi.hwndChild;
00768         <font class="keywordtype">int</font> nCount = (int)wnd.SendMessage(TB_BUTTONCOUNT);
00769         <font class="keywordflow">if</font>(nCount &lt;= 0)     <font class="comment">// probably not a toolbar</font>
00770             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00771 
00772         <font class="comment">// check if it's a command bar</font>
00773         <a class="code" href="namespaceWTL.html#a57">CMenuHandle</a> menuCmdBar = (HMENU)wnd.SendMessage(<a class="code" href="atlframe_8h.html#a13">CBRM_GETMENU</a>);
00774         cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m2">bCmdBar</a> = (menuCmdBar.m_hMenu != NULL);
00775 
00776         <font class="comment">// build a menu from hidden items</font>
00777         <a class="code" href="namespaceWTL.html#a57">CMenuHandle</a> menu;
00778         bRet = menu.CreatePopupMenu();
00779         ATLASSERT(bRet);
00780         RECT rcClient;
00781         bRet = wnd.GetClientRect(&amp;rcClient);
00782         ATLASSERT(bRet);
00783         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; nCount; i++)
00784         {
00785             TBBUTTON tbb;
00786             bRet = (BOOL)wnd.SendMessage(TB_GETBUTTON, i, (LPARAM)&amp;tbb);
00787             ATLASSERT(bRet);
00788             <font class="comment">// skip hidden buttons</font>
00789             <font class="keywordflow">if</font>((tbb.fsState &amp; TBSTATE_HIDDEN) != 0)
00790                 <font class="keywordflow">continue</font>;
00791             RECT rcButton;
00792             bRet = (BOOL)wnd.SendMessage(TB_GETITEMRECT, i, (LPARAM)&amp;rcButton);
00793             ATLASSERT(bRet);
00794             <font class="keywordtype">bool</font> bEnabled = ((tbb.fsState &amp; TBSTATE_ENABLED) != 0);
00795             <font class="keywordflow">if</font>(rcButton.right &gt; rcClient.right)
00796             {
00797                 <font class="keywordflow">if</font>(tbb.fsStyle &amp; BTNS_SEP)
00798                 {
00799                     <font class="keywordflow">if</font>(menu.GetMenuItemCount() &gt; 0)
00800                         menu.AppendMenu(MF_SEPARATOR);
00801                 }
00802                 <font class="keywordflow">else</font> <font class="keywordflow">if</font>(cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m2">bCmdBar</a>)
00803                 {
00804                     TCHAR szBuff[100];
00805                     <a class="code" href="classWTL_1_1CMenuItemInfo.html">CMenuItemInfo</a> mii;
00806                     mii.fMask = MIIM_TYPE | MIIM_SUBMENU;
00807                     mii.dwTypeData = szBuff;
00808                     mii.cch = <font class="keyword">sizeof</font>(szBuff) / <font class="keyword">sizeof</font>(TCHAR);
00809                     bRet = menuCmdBar.GetMenuItemInfo(i, TRUE, &amp;mii);
00810                     ATLASSERT(bRet);
00811                     <font class="comment">// Note: CmdBar currently supports only drop-down items</font>
00812                     ATLASSERT(::IsMenu(mii.hSubMenu));
00813                     bRet = menu.AppendMenu(MF_STRING | MF_POPUP | (bEnabled ? MF_ENABLED : MF_GRAYED), (UINT_PTR)mii.hSubMenu, mii.dwTypeData);
00814                     ATLASSERT(bRet);
00815                 }
00816                 <font class="keywordflow">else</font>
00817                 {
00818                     <font class="comment">// get button's text</font>
00819                     TCHAR szBuff[100];
00820                     LPTSTR lpstrText = szBuff;
00821                     TBBUTTONINFO tbbi;
00822                     tbbi.cbSize = <font class="keyword">sizeof</font>(TBBUTTONINFO);
00823                     tbbi.dwMask = TBIF_TEXT;
00824                     tbbi.pszText = szBuff;
00825                     tbbi.cchText = <font class="keyword">sizeof</font>(szBuff) / <font class="keyword">sizeof</font>(TCHAR);
00826                     <font class="keywordflow">if</font>(wnd.SendMessage(TB_GETBUTTONINFO, tbb.idCommand, (LPARAM)&amp;tbbi) == -1 || lstrlen(szBuff) == 0)
00827                     {
00828                         <font class="comment">// no text for this button, try a resource string</font>
00829                         lpstrText = _T(<font class="stringliteral">""</font>);
00830                         <font class="keywordtype">int</font> nRet = ::LoadString(_Module.GetResourceInstance(), tbb.idCommand, szBuff, <font class="keyword">sizeof</font>(szBuff) / <font class="keyword">sizeof</font>(TCHAR));
00831                         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> n = 0; n &lt; nRet; n++)
00832                         {
00833                             <font class="keywordflow">if</font>(szBuff[n] == _T(<font class="charliteral">'\n'</font>))
00834                             {
00835                                 lpstrText = &amp;szBuff[n + 1];
00836                                 <font class="keywordflow">break</font>;
00837                             }
00838                         }
00839                     }
00840                     bRet = menu.AppendMenu(MF_STRING | (bEnabled ? MF_ENABLED : MF_GRAYED), tbb.idCommand, lpstrText);
00841                     ATLASSERT(bRet);
00842                 }
00843             }
00844         }
00845 
00846         <font class="keywordflow">if</font>(menu.GetMenuItemCount() == 0)    <font class="comment">// no hidden buttons after all</font>
00847         {
00848             menu.DestroyMenu();
00849             ::MessageBeep((UINT)-1);
00850             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00851         }
00852 
00853         cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m0">hMenu</a> = menu;
00854         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00855     }
00856 
<a name="l00857"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a17">00857</a>     <font class="keywordtype">void</font> DisplayChevronMenu(<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html">_ChevronMenuInfo</a>&amp; cmi)
00858     {
00859 <font class="preprocessor">#ifndef TPM_VERPOSANIMATION</font>
00860 <font class="preprocessor"></font>        <font class="keyword">const</font> UINT TPM_VERPOSANIMATION = 0x1000L;   <font class="comment">// Menu animation flag</font>
00861 <font class="preprocessor">#endif</font>
00862 <font class="preprocessor"></font>        <font class="comment">// convert chevron rect to screen coordinates</font>
00863         <a class="code" href="classCWindow.html">CWindow</a> wndFrom = cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">lpnm</a>-&gt;hdr.hwndFrom;
00864         RECT rc = cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">lpnm</a>-&gt;rc;
00865         wndFrom.MapWindowPoints(NULL, &amp;rc);
00866         <font class="comment">// set up flags and rect</font>
00867         UINT uMenuFlags = TPM_LEFTBUTTON | TPM_VERTICAL | TPM_LEFTALIGN | TPM_TOPALIGN | (!<a class="code" href="namespaceWTL.html#a59">AtlIsOldWindows</a>() ? TPM_VERPOSANIMATION : 0);
00868         TPMPARAMS TPMParams;
00869         TPMParams.cbSize = <font class="keyword">sizeof</font>(TPMPARAMS);
00870         TPMParams.rcExclude = rc;
00871         <font class="comment">// check if this window has a command bar</font>
00872         HWND hWndCmdBar = (HWND)::SendMessage(m_hWnd, <a class="code" href="atlframe_8h.html#a12">CBRM_GETCMDBAR</a>, 0, 0L);
00873         <font class="keywordflow">if</font>(::IsWindow(hWndCmdBar))
00874         {
00875             <a class="code" href="structWTL_1_1tagCBRPOPUPMENU.html">CBRPOPUPMENU</a> CBRPopupMenu = { <font class="keyword">sizeof</font>(CBRPOPUPMENU), cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m0">hMenu</a>, uMenuFlags, rc.left, rc.bottom, &amp;TPMParams };
00876             ::SendMessage(hWndCmdBar, <a class="code" href="atlframe_8h.html#a14">CBRM_TRACKPOPUPMENU</a>, 0, (LPARAM)&amp;CBRPopupMenu);
00877         }
00878         <font class="keywordflow">else</font>
00879         {
00880             ::TrackPopupMenuEx(cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m0">hMenu</a>, uMenuFlags, rc.left, rc.bottom, m_hWnd, &amp;TPMParams);
00881         }
00882     }
00883 
<a name="l00884"></a><a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a18">00884</a>     <font class="keywordtype">void</font> CleanupChevronMenu(<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html">_ChevronMenuInfo</a>&amp; cmi)
00885     {
00886         <a class="code" href="namespaceWTL.html#a57">CMenuHandle</a> menu = cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m0">hMenu</a>;
00887         <font class="comment">// if menu is from a command bar, detach submenus so they are not destroyed</font>
00888         <font class="keywordflow">if</font>(cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m2">bCmdBar</a>)
00889         {
00890             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = menu.GetMenuItemCount() - 1; i &gt;=0; i--)
00891                 menu.RemoveMenu(i, MF_BYPOSITION);
00892         }
00893         <font class="comment">// destroy menu</font>
00894         menu.DestroyMenu();
00895         <font class="comment">// convert chevron rect to screen coordinates</font>
00896         <a class="code" href="classCWindow.html">CWindow</a> wndFrom = cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">lpnm</a>-&gt;hdr.hwndFrom;
00897         RECT rc = cmi.<a class="code" href="structWTL_1_1CFrameWindowImplBase_1_1__ChevronMenuInfo.html#m1">lpnm</a>-&gt;rc;
00898         wndFrom.MapWindowPoints(NULL, &amp;rc);
00899         <font class="comment">// eat next message if click is on the same button</font>
00900         MSG msg;
00901         <font class="keywordflow">if</font>(::PeekMessage(&amp;msg, m_hWnd, WM_LBUTTONDOWN, WM_LBUTTONDOWN, PM_NOREMOVE) &amp;&amp; ::PtInRect(&amp;rc, msg.pt))
00902             ::PeekMessage(&amp;msg, m_hWnd, WM_LBUTTONDOWN, WM_LBUTTONDOWN, PM_REMOVE);
00903     }
00904 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
00905 <font class="preprocessor"></font>};
00906 
<a name="l00907"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html">00907</a> 
00908 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> TBase = CWindow, <font class="keyword">class</font> TWinTraits = CFrameWinTraits&gt;
00909 <font class="keyword">class </font>ATL_NO_VTABLE CFrameWindowImpl : <font class="keyword">public</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase</a>&lt; TBase, TWinTraits &gt;
<a name="l00910"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#a0">00910</a> {
00911 <font class="keyword">public</font>:
00912     HWND Create(HWND hWndParent = NULL, <a class="code" href="classWTL_1_1__U__RECT.html">_U_RECT</a> rect = NULL, LPCTSTR szWindowName = NULL,
00913             DWORD dwStyle = 0, DWORD dwExStyle = 0,
00914             HMENU hMenu = NULL, LPVOID lpCreateParam = NULL)
00915     {
00916         ATOM atom = T::GetWndClassInfo().Register(&amp;m_pfnSuperWindowProc);
00917 
00918         dwStyle = T::GetWndStyle(dwStyle);
00919         dwExStyle = T::GetWndExStyle(dwExStyle);
00920 
00921         <font class="keywordflow">if</font>(rect.m_lpRect == NULL)
00922             rect.m_lpRect = &amp;TBase::rcDefault;
00923 
00924         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase&lt; TBase, TWinTraits &gt;::Create</a>(hWndParent, rect.m_lpRect, szWindowName, dwStyle, dwExStyle, hMenu, atom, lpCreateParam);
<a name="l00925"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#a1">00925</a>     }
00926 
00927     HWND CreateEx(HWND hWndParent = NULL, _U_RECT rect = NULL, DWORD dwStyle = 0, DWORD dwExStyle = 0, LPVOID lpCreateParam = NULL)
00928     {
00929         TCHAR szWindowName[256];
00930         szWindowName[0] = 0;
00931         ::LoadString(_Module.GetResourceInstance(), T::GetWndClassInfo().m_uCommonResourceID, szWindowName, 256);
00932 
00933         HMENU hMenu = ::LoadMenu(_Module.GetResourceInstance(), MAKEINTRESOURCE(T::GetWndClassInfo().m_uCommonResourceID));
00934 
00935         T* pT = static_cast&lt;T*&gt;(this);
00936         HWND hWnd = pT-&gt;Create(hWndParent, rect, szWindowName, dwStyle, dwExStyle, hMenu, lpCreateParam);
00937 
00938         <font class="keywordflow">if</font>(hWnd != NULL)
00939             m_hAccel = ::LoadAccelerators(_Module.GetResourceInstance(), MAKEINTRESOURCE(T::GetWndClassInfo().m_uCommonResourceID));
00940 
00941         <font class="keywordflow">return</font> hWnd;
<a name="l00942"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#a2">00942</a>     }
00943 
00944     BOOL CreateSimpleToolBar(UINT nResourceID = 0, DWORD dwStyle = <a class="code" href="atlframe_8h.html#a8">ATL_SIMPLE_TOOLBAR_STYLE</a>, UINT nID = <a class="code" href="atlres_8h.html#a4">ATL_IDW_TOOLBAR</a>)
00945     {
00946         ATLASSERT(!::IsWindow(m_hWndToolBar));
00947         <font class="keywordflow">if</font>(nResourceID == 0)
00948             nResourceID = T::GetWndClassInfo().m_uCommonResourceID;
00949         m_hWndToolBar = T::CreateSimpleToolBarCtrl(m_hWnd, nResourceID, TRUE, dwStyle, nID);
00950         <font class="keywordflow">return</font> (m_hWndToolBar != NULL);
00951     }
<a name="l00952"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#s0">00952</a> 
<a name="l00953"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#s1">00953</a> <font class="comment">// message map and handlers</font>
00954     <font class="keyword">typedef</font> <a class="code" href="classWTL_1_1CFrameWindowImpl.html">CFrameWindowImpl&lt; T, TBase, TWinTraits &gt;</a>    thisClass;
00955     <font class="keyword">typedef</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase&lt; TBase, TWinTraits &gt;</a>   baseClass;
00956 
00957     BEGIN_MSG_MAP(thisClass)
00958         MESSAGE_HANDLER(WM_SIZE, OnSize)
00959 <font class="preprocessor">#ifndef _ATL_NO_REBAR_SUPPORT</font>
00960 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
00961 <font class="preprocessor"></font>        NOTIFY_CODE_HANDLER(RBN_AUTOSIZE, OnReBarAutoSize)
00962 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
00963 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
00964 <font class="preprocessor"></font>        NOTIFY_CODE_HANDLER(RBN_CHEVRONPUSHED, OnChevronPushed)
00965 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
00966 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
00967 <font class="preprocessor">        CHAIN_MSG_MAP(baseClass)</font>
<a name="l00968"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#a3">00968</a> <font class="preprocessor"></font>    END_MSG_MAP()
00969 
00970     LRESULT OnSize(UINT <font class="comment">/*uMsg*/</font>, WPARAM wParam, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
00971     {
00972         <font class="keywordflow">if</font>(wParam != SIZE_MINIMIZED)
00973         {
00974             T* pT = static_cast&lt;T*&gt;(this);
00975             pT-&gt;UpdateLayout();
00976         }
00977         bHandled = FALSE;
00978         <font class="keywordflow">return</font> 1;
00979     }
00980 
<a name="l00981"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#a4">00981</a> <font class="preprocessor">#ifndef _ATL_NO_REBAR_SUPPORT</font>
00982 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
00983 <font class="preprocessor"></font>    LRESULT OnReBarAutoSize(<font class="keywordtype">int</font> <font class="comment">/*idCtrl*/</font>, LPNMHDR <font class="comment">/*pnmh*/</font>, BOOL&amp; <font class="comment">/*bHandled*/</font>)
00984     {
00985         T* pT = static_cast&lt;T*&gt;(this);
00986         pT-&gt;UpdateLayout(FALSE);
00987         <font class="keywordflow">return</font> 0;
00988     }
00989 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
<a name="l00990"></a><a class="code" href="classWTL_1_1CFrameWindowImpl.html#a5">00990</a> <font class="preprocessor"></font>
00991 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
00992 <font class="preprocessor"></font>    LRESULT OnChevronPushed(<font class="keywordtype">int</font> <font class="comment">/*idCtrl*/</font>, LPNMHDR pnmh, BOOL&amp; bHandled)
00993     {
00994         T* pT = static_cast&lt;T*&gt;(this);
00995         _ChevronMenuInfo cmi = { NULL, (LPNMREBARCHEVRON)pnmh, <font class="keyword">false</font> };
00996         <font class="keywordflow">if</font>(!pT-&gt;PrepareChevronMenu(cmi))
00997         {
00998             bHandled = FALSE;
00999             <font class="keywordflow">return</font> 1;
01000         }
01001         <font class="comment">// display a popup menu with hidden items</font>
01002         pT-&gt;DisplayChevronMenu(cmi);
01003         <font class="comment">// cleanup</font>
01004         pT-&gt;CleanupChevronMenu(cmi);
01005         <font class="keywordflow">return</font> 0;
01006     }
01007 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
01008 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
01009 <font class="preprocessor">};</font>
01010 <font class="preprocessor"></font>
01011 
01013 <font class="comment">// CMDIWindow</font>
<a name="l01014"></a><a class="code" href="atlframe_8h.html#a16">01014</a> 
01015 <font class="preprocessor">#ifndef _WTL_MDIWINDOWMENU_TEXT</font>
01016 <font class="preprocessor"></font><font class="preprocessor">#define _WTL_MDIWINDOWMENU_TEXT _T("&amp;Window")</font>
<a name="l01017"></a><a class="code" href="classWTL_1_1CMDIWindow.html">01017</a> <font class="preprocessor"></font><font class="preprocessor">#endif</font>
01018 <font class="preprocessor"></font>
01019 <font class="keyword">class </font><a class="code" href="classWTL_1_1CMDIWindow.html">CMDIWindow</a> : <font class="keyword">public</font> <a class="code" href="classCWindow.html">CWindow</a>
01020 {
<a name="l01021"></a><a class="code" href="classWTL_1_1CMDIWindow.html#m0">01021</a> <font class="keyword">public</font>:
<a name="l01022"></a><a class="code" href="classWTL_1_1CMDIWindow.html#m1">01022</a> <font class="comment">// Data members</font>
01023     HWND m_hWndMDIClient;
01024     HMENU m_hMenu;
<a name="l01025"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a0">01025</a> 
01026 <font class="comment">// Constructors</font>
<a name="l01027"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a1">01027</a>     <a class="code" href="classWTL_1_1CMDIWindow.html">CMDIWindow</a>(HWND hWnd = NULL) : <a class="code" href="classCWindow.html">CWindow</a>(hWnd), m_hWndMDIClient(NULL), m_hMenu(NULL) { }
01028 
01029     CMDIWindow&amp; operator=(HWND hWnd)
01030     {
01031         m_hWnd = hWnd;
01032         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
01033     }
<a name="l01034"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a2">01034</a> 
01035 <font class="comment">// Operations</font>
01036     HWND MDIGetActive(BOOL* lpbMaximized = NULL)
01037     {
01038         ATLASSERT(::IsWindow(m_hWndMDIClient));
01039         <font class="keywordflow">return</font> (HWND)::SendMessage(m_hWndMDIClient, WM_MDIGETACTIVE, 0, (LPARAM)lpbMaximized);
<a name="l01040"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a3">01040</a>     }
01041 
01042     <font class="keywordtype">void</font> MDIActivate(HWND hWndChildToActivate)
01043     {
01044         ATLASSERT(::IsWindow(m_hWndMDIClient));
01045         ATLASSERT(::IsWindow(hWndChildToActivate));
01046         ::SendMessage(m_hWndMDIClient, WM_MDIACTIVATE, (WPARAM)hWndChildToActivate, 0);
<a name="l01047"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a4">01047</a>     }
01048 
01049     <font class="keywordtype">void</font> MDINext(HWND hWndChild, BOOL bPrevious = FALSE)
01050     {
01051         ATLASSERT(::IsWindow(m_hWndMDIClient));
01052         ATLASSERT(hWndChild == NULL || ::IsWindow(hWndChild));
01053         ::SendMessage(m_hWndMDIClient, WM_MDINEXT, (WPARAM)hWndChild, (LPARAM)bPrevious);
<a name="l01054"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a5">01054</a>     }
01055 
01056     <font class="keywordtype">void</font> MDIMaximize(HWND hWndChildToMaximize)
01057     {
01058         ATLASSERT(::IsWindow(m_hWndMDIClient));
01059         ATLASSERT(::IsWindow(hWndChildToMaximize));
01060         ::SendMessage(m_hWndMDIClient, WM_MDIMAXIMIZE, (WPARAM)hWndChildToMaximize, 0);
<a name="l01061"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a6">01061</a>     }
01062 
01063     <font class="keywordtype">void</font> MDIRestore(HWND hWndChildToRestore)
01064     {
01065         ATLASSERT(::IsWindow(m_hWndMDIClient));
01066         ATLASSERT(::IsWindow(hWndChildToRestore));
01067         ::SendMessage(m_hWndMDIClient, WM_MDIRESTORE, (WPARAM)hWndChildToRestore, 0);
<a name="l01068"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a7">01068</a>     }
01069 
01070     <font class="keywordtype">void</font> MDIDestroy(HWND hWndChildToDestroy)
01071     {
01072         ATLASSERT(::IsWindow(m_hWndMDIClient));
01073         ATLASSERT(::IsWindow(hWndChildToDestroy));
01074         ::SendMessage(m_hWndMDIClient, WM_MDIDESTROY, (WPARAM)hWndChildToDestroy, 0);
<a name="l01075"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a8">01075</a>     }
01076 
01077     BOOL MDICascade(UINT uFlags = 0)
01078     {
01079         ATLASSERT(::IsWindow(m_hWndMDIClient));
01080         <font class="keywordflow">return</font> (BOOL)::SendMessage(m_hWndMDIClient, WM_MDICASCADE, (WPARAM)uFlags, 0);
<a name="l01081"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a9">01081</a>     }
01082 
01083     BOOL MDITile(UINT uFlags = MDITILE_HORIZONTAL)
01084     {
01085         ATLASSERT(::IsWindow(m_hWndMDIClient));
<a name="l01086"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a10">01086</a>         <font class="keywordflow">return</font> (BOOL)::SendMessage(m_hWndMDIClient, WM_MDITILE, (WPARAM)uFlags, 0);
01087     }
01088     <font class="keywordtype">void</font> MDIIconArrange()
01089     {
01090         ATLASSERT(::IsWindow(m_hWndMDIClient));
01091         ::SendMessage(m_hWndMDIClient, WM_MDIICONARRANGE, 0, 0);
<a name="l01092"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a11">01092</a>     }
01093 
01094     HMENU MDISetMenu(HMENU hMenuFrame, HMENU hMenuWindow)
01095     {
01096         ATLASSERT(::IsWindow(m_hWndMDIClient));
01097         <font class="keywordflow">return</font> (HMENU)::SendMessage(m_hWndMDIClient, WM_MDISETMENU, (WPARAM)hMenuFrame, (LPARAM)hMenuWindow);
<a name="l01098"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a12">01098</a>     }
01099 
01100     HMENU MDIRefreshMenu()
01101     {
01102         ATLASSERT(::IsWindow(m_hWndMDIClient));
01103         <font class="keywordflow">return</font> (HMENU)::SendMessage(m_hWndMDIClient, WM_MDIREFRESHMENU, 0, 0);
01104     }
<a name="l01105"></a><a class="code" href="classWTL_1_1CMDIWindow.html#d0">01105</a> 
01106 <font class="comment">// Additional operations</font>
01107     <font class="keyword">static</font> HMENU GetStandardWindowMenu(HMENU hMenu)
01108     {
01109         <font class="keywordtype">int</font> nCount = ::GetMenuItemCount(hMenu);
01110         <font class="keywordflow">if</font>(nCount == -1)
01111             <font class="keywordflow">return</font> NULL;
01112         <font class="keywordtype">int</font> nLen = ::GetMenuString(hMenu, nCount - 2, NULL, 0, MF_BYPOSITION);
01113         <font class="keywordflow">if</font>(nLen == 0)
01114             <font class="keywordflow">return</font> NULL;
01115         LPTSTR lpszText = (LPTSTR)_alloca((nLen + 1) * <font class="keyword">sizeof</font>(TCHAR));
01116         <font class="keywordflow">if</font>(::GetMenuString(hMenu, nCount - 2, lpszText, nLen + 1, MF_BYPOSITION) != nLen)
01117             <font class="keywordflow">return</font> NULL;
01118         <font class="keywordflow">if</font>(lstrcmp(lpszText, <a class="code" href="atlframe_8h.html#a16">_WTL_MDIWINDOWMENU_TEXT</a>) != 0)
01119             <font class="keywordflow">return</font> NULL;
01120         return ::GetSubMenu(hMenu, nCount - 2);
<a name="l01121"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a13">01121</a>     }
01122 
01123     <font class="keywordtype">void</font> SetMDIFrameMenu()
01124     {
01125         HMENU hWindowMenu = GetStandardWindowMenu(m_hMenu);
01126         MDISetMenu(m_hMenu, hWindowMenu);
01127         MDIRefreshMenu();
01128         ::DrawMenuBar(GetMDIFrame());
<a name="l01129"></a><a class="code" href="classWTL_1_1CMDIWindow.html#a14">01129</a>     }
01130 
01131     HWND GetMDIFrame()<font class="keyword"> const</font>
01132 <font class="keyword">    </font>{
01133         return ::GetParent(m_hWndMDIClient);
01134     }
01135 };
01136 
01137 
01139 <font class="comment">// CMDIFrameWindowImpl</font>
<a name="l01140"></a><a class="code" href="atlframe_8h.html#a17">01140</a> 
01141 <font class="comment">// MDI child command chaining macro</font>
01142 <font class="preprocessor">#define CHAIN_MDI_CHILD_COMMANDS() \</font>
01143 <font class="preprocessor">    if(uMsg == WM_COMMAND) \</font>
01144 <font class="preprocessor">    { \</font>
01145 <font class="preprocessor">        HWND hWndChild = MDIGetActive(); \</font>
01146 <font class="preprocessor">        if(hWndChild != NULL) \</font>
01147 <font class="preprocessor">            ::SendMessage(hWndChild, uMsg, wParam, lParam); \</font>
01148 <font class="preprocessor">    }</font>
01149 <font class="preprocessor"></font>
<a name="l01150"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html">01150</a> 
01151 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> TBase = CMDIWindow, <font class="keyword">class</font> TWinTraits = CFrameWinTraits&gt;
01152 <font class="keyword">class </font>ATL_NO_VTABLE CMDIFrameWindowImpl : <font class="keyword">public</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase</a>&lt;TBase, TWinTraits &gt;
<a name="l01153"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a0">01153</a> {
01154 <font class="keyword">public</font>:
01155     HWND Create(HWND hWndParent = NULL, <a class="code" href="classWTL_1_1__U__RECT.html">_U_RECT</a> rect = NULL, LPCTSTR szWindowName = NULL,
01156             DWORD dwStyle = 0, DWORD dwExStyle = 0,
01157             HMENU hMenu = NULL, LPVOID lpCreateParam = NULL)
01158     {
01159         m_hMenu = hMenu;
01160         ATOM atom = T::GetWndClassInfo().Register(&amp;m_pfnSuperWindowProc);
01161 
01162         dwStyle = T::GetWndStyle(dwStyle);
01163         dwExStyle = T::GetWndExStyle(dwExStyle);
01164 
01165         <font class="keywordflow">if</font>(rect.m_lpRect == NULL)
01166             rect.m_lpRect = &amp;TBase::rcDefault;
01167 
01168         <font class="keywordflow">return</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase&lt;TBase, TWinTraits &gt;::Create</a>(hWndParent, rect.m_lpRect, szWindowName, dwStyle, dwExStyle, hMenu, atom, lpCreateParam);
<a name="l01169"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a1">01169</a>     }
01170 
01171     HWND CreateEx(HWND hWndParent = NULL, _U_RECT rect = NULL, DWORD dwStyle = 0, DWORD dwExStyle = 0, LPVOID lpCreateParam = NULL)
01172     {
01173         TCHAR szWindowName[256];
01174         szWindowName[0] = 0;
01175         ::LoadString(_Module.GetResourceInstance(), T::GetWndClassInfo().m_uCommonResourceID, szWindowName, 256);
01176 
01177         HMENU hMenu = ::LoadMenu(_Module.GetResourceInstance(), MAKEINTRESOURCE(T::GetWndClassInfo().m_uCommonResourceID));
01178 
01179         T* pT = static_cast&lt;T*&gt;(this);
01180         HWND hWnd = pT-&gt;Create(hWndParent, rect, szWindowName, dwStyle, dwExStyle, hMenu, lpCreateParam);
01181 
01182         <font class="keywordflow">if</font>(hWnd != NULL)
01183             m_hAccel = ::LoadAccelerators(_Module.GetResourceInstance(), MAKEINTRESOURCE(T::GetWndClassInfo().m_uCommonResourceID));
01184 
01185         <font class="keywordflow">return</font> hWnd;
<a name="l01186"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a2">01186</a>     }
01187 
01188     BOOL CreateSimpleToolBar(UINT nResourceID = 0, DWORD dwStyle = <a class="code" href="atlframe_8h.html#a8">ATL_SIMPLE_TOOLBAR_STYLE</a>, UINT nID = <a class="code" href="atlres_8h.html#a4">ATL_IDW_TOOLBAR</a>)
01189     {
01190         ATLASSERT(!::IsWindow(m_hWndToolBar));
01191         <font class="keywordflow">if</font>(nResourceID == 0)
01192             nResourceID = T::GetWndClassInfo().m_uCommonResourceID;
01193         m_hWndToolBar = T::CreateSimpleToolBarCtrl(m_hWnd, nResourceID, TRUE, dwStyle, nID);
01194         <font class="keywordflow">return</font> (m_hWndToolBar != NULL);
<a name="l01195"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a3">01195</a>     }
01196 
01197     <font class="keyword">virtual</font> WNDPROC GetWindowProc()
01198     {
01199         <font class="keywordflow">return</font> MDIFrameWindowProc;
<a name="l01200"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#d0">01200</a>     }
01201 
01202     <font class="keyword">static</font> LRESULT CALLBACK MDIFrameWindowProc(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
01203     {
01204         CMDIFrameWindowImpl&lt; T, TBase, TWinTraits &gt;* pThis = (CMDIFrameWindowImpl&lt; T, TBase, TWinTraits &gt;*)hWnd;
01205         <font class="comment">// set a ptr to this message and save the old value</font>
01206 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
01207 <font class="preprocessor"></font>        _ATL_MSG msg(pThis-&gt;m_hWnd, uMsg, wParam, lParam);
01208         <font class="keyword">const</font> _ATL_MSG* pOldMsg = pThis-&gt;m_pCurrentMsg;
01209 <font class="preprocessor">#else </font>
01210 <font class="preprocessor">        MSG msg = { pThis-&gt;m_hWnd, uMsg, wParam, lParam, 0, { 0, 0 } };</font>
01211 <font class="preprocessor"></font>        <font class="keyword">const</font> MSG* pOldMsg = pThis-&gt;m_pCurrentMsg;
01212 <font class="preprocessor">#endif </font>
01213 <font class="preprocessor">        pThis-&gt;m_pCurrentMsg = &amp;msg;</font>
01214 <font class="preprocessor"></font>        <font class="comment">// pass to the message map to process</font>
01215         LRESULT lRes;
01216         BOOL bRet = pThis-&gt;ProcessWindowMessage(pThis-&gt;m_hWnd, uMsg, wParam, lParam, lRes, 0);
01217         <font class="comment">// restore saved value for the current message</font>
01218         ATLASSERT(pThis-&gt;m_pCurrentMsg == &amp;msg);
01219         pThis-&gt;m_pCurrentMsg = pOldMsg;
01220         <font class="comment">// do the default processing if message was not handled</font>
01221         <font class="keywordflow">if</font>(!bRet)
01222         {
01223             <font class="keywordflow">if</font>(uMsg != WM_NCDESTROY)
01224                 lRes = pThis-&gt;DefWindowProc(uMsg, wParam, lParam);
01225             <font class="keywordflow">else</font>
01226             {
01227                 <font class="comment">// unsubclass, if needed</font>
01228                 <a class="code" href="atlapp_8h.html#a41">LONG_PTR</a> pfnWndProc = ::GetWindowLongPtr(pThis-&gt;m_hWnd, <a class="code" href="atlapp_8h.html#a7">GWLP_WNDPROC</a>);
01229                 lRes = pThis-&gt;DefWindowProc(uMsg, wParam, lParam);
01230                 <font class="keywordflow">if</font>(pThis-&gt;m_pfnSuperWindowProc != ::DefWindowProc &amp;&amp; ::GetWindowLongPtr(pThis-&gt;m_hWnd, <a class="code" href="atlapp_8h.html#a7">GWLP_WNDPROC</a>) == pfnWndProc)
01231                     ::SetWindowLongPtr(pThis-&gt;m_hWnd, <a class="code" href="atlapp_8h.html#a7">GWLP_WNDPROC</a>, (LONG_PTR)pThis-&gt;m_pfnSuperWindowProc);
01232 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
01233 <font class="preprocessor"></font>                <font class="comment">// mark window as destryed</font>
01234                 pThis-&gt;m_dwState |= WINSTATE_DESTROYED;
01235 <font class="preprocessor">#else </font>
01236 <font class="preprocessor">                // clear out window handle</font>
01237 <font class="preprocessor"></font>                HWND hWnd = pThis-&gt;m_hWnd;
01238                 pThis-&gt;m_hWnd = NULL;
01239                 <font class="comment">// clean up after window is destroyed</font>
01240                 pThis-&gt;OnFinalMessage(hWnd);
01241 <font class="preprocessor">#endif </font>
01242 <font class="preprocessor">            }</font>
01243 <font class="preprocessor"></font>        }
01244 <font class="preprocessor">#if (_ATL_VER &gt;= 0x0700)</font>
01245 <font class="preprocessor"></font>        <font class="keywordflow">if</font>(pThis-&gt;m_dwState &amp; WINSTATE_DESTROYED &amp;&amp; pThis-&gt;m_pCurrentMsg == NULL)
01246         {
01247             <font class="comment">// clear out window handle</font>
01248             HWND hWnd = pThis-&gt;m_hWnd;
01249             pThis-&gt;m_hWnd = NULL;
01250             pThis-&gt;m_dwState &amp;= ~WINSTATE_DESTROYED;
01251             <font class="comment">// clean up after window is destroyed</font>
01252             pThis-&gt;OnFinalMessage(hWnd);
01253         }
01254 <font class="preprocessor">#endif //(_ATL_VER &gt;= 0x0700)</font>
01255 <font class="preprocessor"></font>        <font class="keywordflow">return</font> lRes;
01256     }
<a name="l01257"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a4">01257</a> 
01258     <font class="comment">// Overriden to call DefWindowProc which uses DefFrameProc</font>
01259     LRESULT DefWindowProc()
01260     {
01261         <font class="keyword">const</font> MSG* pMsg = m_pCurrentMsg;
01262         LRESULT lRes = 0;
01263         <font class="keywordflow">if</font> (pMsg != NULL)
01264             lRes = DefWindowProc(pMsg-&gt;message, pMsg-&gt;wParam, pMsg-&gt;lParam);
01265         <font class="keywordflow">return</font> lRes;
<a name="l01266"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a5">01266</a>     }
01267 
01268     LRESULT DefWindowProc(UINT uMsg, WPARAM wParam, LPARAM lParam)
01269     {
01270         return ::DefFrameProc(m_hWnd, m_hWndMDIClient, uMsg, wParam, lParam);
<a name="l01271"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a6">01271</a>     }
01272 
01273     BOOL PreTranslateMessage(MSG* pMsg)
01274     {
01275         <font class="keywordflow">if</font>(CFrameWindowImplBase&lt;TBase, TWinTraits&gt;::PreTranslateMessage(pMsg))
01276             <font class="keywordflow">return</font> TRUE;
01277         return ::TranslateMDISysAccel(m_hWndMDIClient, pMsg);
<a name="l01278"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a7">01278</a>     }
01279 
01280     HWND CreateMDIClient(HMENU hWindowMenu = NULL, UINT nID = <a class="code" href="atlres_8h.html#a7">ATL_IDW_CLIENT</a>, UINT nFirstChildID = <a class="code" href="atlres_8h.html#a68">ATL_IDM_FIRST_MDICHILD</a>)
01281     {
01282         DWORD dwStyle = WS_VISIBLE | WS_CHILD | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | MDIS_ALLCHILDSTYLES;
01283         DWORD dwExStyle = WS_EX_CLIENTEDGE;
01284 
01285         CLIENTCREATESTRUCT ccs;
01286         ccs.hWindowMenu = hWindowMenu;
01287         ccs.idFirstChild = nFirstChildID;
01288 
01289         <font class="keywordflow">if</font>((GetStyle() &amp; (WS_HSCROLL | WS_VSCROLL)) != 0)
01290         {
01291             <font class="comment">// parent MDI frame's scroll styles move to the MDICLIENT</font>
01292             dwStyle |= (GetStyle() &amp; (WS_HSCROLL | WS_VSCROLL));
01293 
01294             <font class="comment">// fast way to turn off the scrollbar bits (without a resize)</font>
01295             ModifyStyle(WS_HSCROLL | WS_VSCROLL, 0, SWP_NOREDRAW | SWP_FRAMECHANGED);
01296         }
01297 
01298         <font class="comment">// Create MDICLIENT window</font>
01299         m_hWndClient = ::CreateWindowEx(dwExStyle, _T(<font class="stringliteral">"MDIClient"</font>), NULL,
01300             dwStyle, 0, 0, 1, 1, m_hWnd, (HMENU)<a class="code" href="atlapp_8h.html#a15">LongToHandle</a>(nID),
01301             _Module.GetModuleInstance(), (LPVOID)&amp;ccs);
01302         <font class="keywordflow">if</font> (m_hWndClient == NULL)
01303         {
01304             ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"MDI Frame failed to create MDICLIENT.\n"</font>));
01305             <font class="keywordflow">return</font> NULL;
01306         }
01307 
01308         <font class="comment">// Move it to the top of z-order</font>
01309         ::BringWindowToTop(m_hWndClient);
01310 
01311         <font class="comment">// set as MDI client window</font>
01312         m_hWndMDIClient = m_hWndClient;
01313 
01314         <font class="comment">// update to proper size</font>
01315         T* pT = static_cast&lt;T*&gt;(this);
01316         pT-&gt;UpdateLayout();
01317 
01318         <font class="keywordflow">return</font> m_hWndClient;
<a name="l01319"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#s0">01319</a>     }
<a name="l01320"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#s1">01320</a> 
01321     <font class="keyword">typedef</font> <a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html">CMDIFrameWindowImpl&lt; T, TBase, TWinTraits &gt;</a> thisClass;
01322     <font class="keyword">typedef</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase&lt;TBase, TWinTraits &gt;</a>    baseClass;
01323     BEGIN_MSG_MAP(thisClass)
01324         MESSAGE_HANDLER(WM_SIZE, OnSize)
01325         MESSAGE_HANDLER(WM_SETFOCUS, OnSetFocus)
01326         MESSAGE_HANDLER(WM_MDISETMENU, OnMDISetMenu)
01327 <font class="preprocessor">#ifndef _ATL_NO_REBAR_SUPPORT</font>
01328 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
01329 <font class="preprocessor"></font>        NOTIFY_CODE_HANDLER(RBN_AUTOSIZE, OnReBarAutoSize)
01330 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
01331 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
01332 <font class="preprocessor"></font>        NOTIFY_CODE_HANDLER(RBN_CHEVRONPUSHED, OnChevronPushed)
01333 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
01334 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
01335 <font class="preprocessor">        CHAIN_MSG_MAP(baseClass)</font>
<a name="l01336"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a8">01336</a> <font class="preprocessor"></font>    END_MSG_MAP()
01337 
01338     LRESULT OnSize(UINT <font class="comment">/*uMsg*/</font>, WPARAM wParam, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; <font class="comment">/*bHandled*/</font>)
01339     {
01340         <font class="keywordflow">if</font>(wParam != SIZE_MINIMIZED)
01341         {
01342             T* pT = static_cast&lt;T*&gt;(this);
01343             pT-&gt;<a class="code" href="classWTL_1_1CFrameWindowImplBase.html#a7">UpdateLayout</a>();
01344         }
01345         <font class="comment">// message must be handled, otherwise DefFrameProc would resize the client again</font>
01346         <font class="keywordflow">return</font> 0;
<a name="l01347"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a9">01347</a>     }
01348 
01349     LRESULT OnSetFocus(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; <font class="comment">/*bHandled*/</font>)
01350     {
01351         <font class="comment">// don't allow CFrameWindowImplBase to handle this one</font>
01352         <font class="keywordflow">return</font> DefWindowProc(uMsg, wParam, lParam);
<a name="l01353"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a10">01353</a>     }
01354 
01355     LRESULT OnMDISetMenu(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; <font class="comment">/*bHandled*/</font>)
01356     {
01357         SetMDIFrameMenu();
01358         <font class="keywordflow">return</font> 0;
01359     }
01360 
<a name="l01361"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a11">01361</a> <font class="preprocessor">#ifndef _ATL_NO_REBAR_SUPPORT</font>
01362 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
01363 <font class="preprocessor"></font>    LRESULT OnReBarAutoSize(<font class="keywordtype">int</font> <font class="comment">/*idCtrl*/</font>, LPNMHDR <font class="comment">/*pnmh*/</font>, BOOL&amp; <font class="comment">/*bHandled*/</font>)
01364     {
01365         T* pT = static_cast&lt;T*&gt;(this);
01366         pT-&gt;UpdateLayout(FALSE);
01367         <font class="keywordflow">return</font> 0;
01368     }
01369 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
<a name="l01370"></a><a class="code" href="classWTL_1_1CMDIFrameWindowImpl.html#a12">01370</a> <font class="preprocessor"></font>
01371 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
01372 <font class="preprocessor"></font>    LRESULT OnChevronPushed(<font class="keywordtype">int</font> <font class="comment">/*idCtrl*/</font>, LPNMHDR pnmh, BOOL&amp; bHandled)
01373     {
01374         T* pT = static_cast&lt;T*&gt;(this);
01375         _ChevronMenuInfo cmi = { NULL, (LPNMREBARCHEVRON)pnmh, <font class="keyword">false</font> };
01376         <font class="keywordflow">if</font>(!pT-&gt;PrepareChevronMenu(cmi))
01377         {
01378             bHandled = FALSE;
01379             <font class="keywordflow">return</font> 1;
01380         }
01381         <font class="comment">// display a popup menu with hidden items</font>
01382         pT-&gt;DisplayChevronMenu(cmi);
01383         <font class="comment">// cleanup</font>
01384         pT-&gt;CleanupChevronMenu(cmi);
01385         <font class="keywordflow">return</font> 0;
01386     }
01387 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
01388 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
01389 <font class="preprocessor">};</font>
01390 <font class="preprocessor"></font>
01391 
01393 <font class="comment">// CMDIChildWindowImpl</font>
01394 
<a name="l01395"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a0">01395</a> <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> TBase = CMDIWindow, <font class="keyword">class</font> TWinTraits = CMDIChildWinTraits&gt;
01396 <font class="keyword">class </font>ATL_NO_VTABLE CMDIChildWindowImpl : <font class="keyword">public</font> <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase</a>&lt;TBase, TWinTraits &gt;
01397 {
01398 <font class="keyword">public</font>:
01399     HWND Create(HWND hWndParent, <a class="code" href="classWTL_1_1__U__RECT.html">_U_RECT</a> rect = NULL, LPCTSTR szWindowName = NULL,
01400             DWORD dwStyle = 0, DWORD dwExStyle = 0,
01401             UINT nMenuID = 0, LPVOID lpCreateParam = NULL)
01402     {
01403         ATOM atom = T::GetWndClassInfo().Register(&amp;m_pfnSuperWindowProc);
01404 
01405         <font class="keywordflow">if</font>(nMenuID != 0)
01406             m_hMenu = ::LoadMenu(_Module.GetResourceInstance(), MAKEINTRESOURCE(nMenuID));
01407 
01408         dwStyle = T::GetWndStyle(dwStyle);
01409         dwExStyle = T::GetWndExStyle(dwExStyle);
01410 
01411         dwExStyle |= WS_EX_MDICHILD;    <font class="comment">// force this one</font>
01412         m_pfnSuperWindowProc = ::DefMDIChildProc;
01413         m_hWndMDIClient = hWndParent;
01414         ATLASSERT(::IsWindow(m_hWndMDIClient));
01415 
01416         <font class="keywordflow">if</font>(rect.m_lpRect == NULL)
01417             rect.m_lpRect = &amp;TBase::rcDefault;
01418 
01419         HWND hWnd = <a class="code" href="classWTL_1_1CFrameWindowImplBase.html">CFrameWindowImplBase&lt;TBase, TWinTraits &gt;::Create</a>(hWndParent, rect.m_lpRect, szWindowName, dwStyle, dwExStyle, (UINT)0U, atom, lpCreateParam);
01420 
01421         <font class="keywordflow">if</font>(hWnd != NULL &amp;&amp; ::IsWindowVisible(m_hWnd) &amp;&amp; !::IsChild(hWnd, ::GetFocus()))
01422             ::SetFocus(hWnd);
<a name="l01423"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a1">01423</a> 
01424         <font class="keywordflow">return</font> hWnd;
01425     }
01426 
01427     HWND CreateEx(HWND hWndParent, _U_RECT rect = NULL, LPCTSTR lpcstrWindowName = NULL, DWORD dwStyle = 0, DWORD dwExStyle = 0, LPVOID lpCreateParam = NULL)
01428     {
01429         TCHAR szWindowName[256];
01430         szWindowName[0] = 0;
01431         <font class="keywordflow">if</font>(lpcstrWindowName == NULL)
01432         {
01433             ::LoadString(_Module.GetResourceInstance(), T::GetWndClassInfo().m_uCommonResourceID, szWindowName, 256);
01434             lpcstrWindowName = szWindowName;
01435         }
01436 
01437         T* pT = static_cast&lt;T*&gt;(this);
01438         HWND hWnd = pT-&gt;Create(hWndParent, rect, lpcstrWindowName, dwStyle, dwExStyle, T::GetWndClassInfo().m_uCommonResourceID, lpCreateParam);
01439 
01440         <font class="keywordflow">if</font>(hWnd != NULL)
01441             m_hAccel = ::LoadAccelerators(_Module.GetResourceInstance(), MAKEINTRESOURCE(T::GetWndClassInfo().m_uCommonResourceID));
<a name="l01442"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a2">01442</a> 
01443         <font class="keywordflow">return</font> hWnd;
01444     }
01445 
01446     BOOL CreateSimpleToolBar(UINT nResourceID = 0, DWORD dwStyle = <a class="code" href="atlframe_8h.html#a8">ATL_SIMPLE_TOOLBAR_STYLE</a>, UINT nID = <a class="code" href="atlres_8h.html#a4">ATL_IDW_TOOLBAR</a>)
01447     {
01448         ATLASSERT(!::IsWindow(m_hWndToolBar));
01449         <font class="keywordflow">if</font>(nResourceID == 0)
01450             nResourceID = T::GetWndClassInfo().m_uCommonResourceID;
<a name="l01451"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a3">01451</a>         m_hWndToolBar = T::CreateSimpleToolBarCtrl(m_hWnd, nResourceID, TRUE, dwStyle, nID);
01452         <font class="keywordflow">return</font> (m_hWndToolBar != NULL);
01453     }
01454 
01455     BOOL UpdateClientEdge(LPRECT lpRect = NULL)
01456     {
01457         <font class="comment">// only adjust for active MDI child window</font>
01458         HWND hWndChild = MDIGetActive();
01459         <font class="keywordflow">if</font>(hWndChild != NULL &amp;&amp; hWndChild != m_hWnd)
01460             <font class="keywordflow">return</font> FALSE;
01461 
01462         <font class="comment">// need to adjust the client edge style as max/restore happens</font>
01463         DWORD dwStyle = ::GetWindowLong(m_hWndMDIClient, GWL_EXSTYLE);
01464         DWORD dwNewStyle = dwStyle;
01465         <font class="keywordflow">if</font>(hWndChild != NULL &amp;&amp; ((GetExStyle() &amp; WS_EX_CLIENTEDGE) == 0) &amp;&amp; ((GetStyle() &amp; WS_MAXIMIZE) != 0))
01466             dwNewStyle &amp;= ~(WS_EX_CLIENTEDGE);
01467         <font class="keywordflow">else</font>
01468             dwNewStyle |= WS_EX_CLIENTEDGE;
01469 
01470         <font class="keywordflow">if</font>(dwStyle != dwNewStyle)
01471         {
01472             <font class="comment">// SetWindowPos will not move invalid bits</font>
01473             ::RedrawWindow(m_hWndMDIClient, NULL, NULL,
01474                 RDW_INVALIDATE | RDW_ALLCHILDREN);
01475             <font class="comment">// remove/add WS_EX_CLIENTEDGE to MDI client area</font>
01476             ::SetWindowLong(m_hWndMDIClient, GWL_EXSTYLE, dwNewStyle);
01477             ::SetWindowPos(m_hWndMDIClient, NULL, 0, 0, 0, 0,
01478                 SWP_FRAMECHANGED | SWP_NOACTIVATE | SWP_NOMOVE | SWP_NOSIZE |
01479                 SWP_NOZORDER | SWP_NOCOPYBITS);
01480 
01481             <font class="comment">// return new client area</font>
01482             <font class="keywordflow">if</font> (lpRect != NULL)
01483                 ::GetClientRect(m_hWndMDIClient, lpRect);
01484 
01485             <font class="keywordflow">return</font> TRUE;
01486         }
<a name="l01487"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#s0">01487</a> 
<a name="l01488"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#s1">01488</a>         <font class="keywordflow">return</font> FALSE;
01489     }
01490 
01491     <font class="keyword">typedef</font> CMDIChildWindowImpl&lt; T, TBase, TWinTraits &gt; thisClass;
01492     <font class="keyword">typedef</font> CFrameWindowImplBase&lt;TBase, TWinTraits &gt;    baseClass;
01493     BEGIN_MSG_MAP(thisClass)
01494         MESSAGE_HANDLER(WM_SIZE, OnSize)
01495         MESSAGE_HANDLER(WM_WINDOWPOSCHANGED, OnWindowPosChanged)
01496         MESSAGE_HANDLER(WM_MENUSELECT, OnMenuSelect)
01497         MESSAGE_HANDLER(WM_MDIACTIVATE, OnMDIActivate)
01498         MESSAGE_HANDLER(WM_DESTROY, OnDestroy)
01499 <font class="preprocessor">#ifndef _ATL_NO_REBAR_SUPPORT</font>
01500 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
01501 <font class="preprocessor"></font>        NOTIFY_CODE_HANDLER(RBN_AUTOSIZE, OnReBarAutoSize)
01502 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
01503 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
01504 <font class="preprocessor"></font>        NOTIFY_CODE_HANDLER(RBN_CHEVRONPUSHED, OnChevronPushed)
01505 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
<a name="l01506"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a4">01506</a> <font class="preprocessor"></font><font class="preprocessor">#endif </font>
01507 <font class="preprocessor">        CHAIN_MSG_MAP(baseClass)</font>
01508 <font class="preprocessor"></font>    END_MSG_MAP()
01509 
01510     LRESULT OnSize(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; <font class="comment">/*bHandled*/</font>)
01511     {
01512         DefWindowProc(uMsg, wParam, lParam);    <font class="comment">// needed for MDI children</font>
01513         <font class="keywordflow">if</font>(wParam != SIZE_MINIMIZED)
01514         {
01515             T* pT = static_cast&lt;T*&gt;(this);
01516             pT-&gt;UpdateLayout();
<a name="l01517"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a5">01517</a>         }
01518         <font class="keywordflow">return</font> 0;
01519     }
01520 
01521     LRESULT OnWindowPosChanged(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; bHandled)
01522     {
01523         <font class="comment">// update MDI client edge and adjust MDI child rect</font>
01524         LPWINDOWPOS lpWndPos = (LPWINDOWPOS)lParam;
01525 
01526         <font class="keywordflow">if</font>(!(lpWndPos-&gt;flags &amp; SWP_NOSIZE))
01527         {
01528             <a class="code" href="classCWindow.html">CWindow</a> wnd(m_hWndMDIClient);
01529             RECT rectClient;
01530 
01531             <font class="keywordflow">if</font>(UpdateClientEdge(&amp;rectClient) &amp;&amp; ((GetStyle() &amp; WS_MAXIMIZE) != 0))
01532             {
01533                 ::AdjustWindowRectEx(&amp;rectClient, GetStyle(), FALSE, GetExStyle());
01534                 lpWndPos-&gt;x = rectClient.left;
01535                 lpWndPos-&gt;y = rectClient.top;
01536                 lpWndPos-&gt;cx = rectClient.right - rectClient.left;
01537                 lpWndPos-&gt;cy = rectClient.bottom - rectClient.top;
01538             }
01539         }
01540 
<a name="l01541"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a6">01541</a>         bHandled = FALSE;
01542         <font class="keywordflow">return</font> 1;
01543     }
01544 
01545     LRESULT OnMenuSelect(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; <font class="comment">/*bHandled*/</font>)
<a name="l01546"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a7">01546</a>     {
01547         return ::SendMessage(GetMDIFrame(), uMsg, wParam, lParam);
01548     }
01549 
01550     LRESULT OnMDIActivate(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; bHandled)
01551     {
01552         <font class="keywordflow">if</font>((HWND)lParam == m_hWnd &amp;&amp; m_hMenu != NULL)
01553             SetMDIFrameMenu();
01554         <font class="keywordflow">else</font> <font class="keywordflow">if</font>((HWND)lParam == NULL)
01555             ::SendMessage(GetMDIFrame(), WM_MDISETMENU, 0, 0);
01556 
<a name="l01557"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a8">01557</a>         bHandled = FALSE;
01558         <font class="keywordflow">return</font> 1;
01559     }
01560 
01561     LRESULT OnDestroy(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
01562     {
01563         UpdateClientEdge();
01564         bHandled = FALSE;
01565         <font class="keywordflow">return</font> 1;
<a name="l01566"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a9">01566</a>     }
01567 
01568 <font class="preprocessor">#ifndef _ATL_NO_REBAR_SUPPORT</font>
01569 <font class="preprocessor"></font><font class="preprocessor">#if (_WIN32_IE &gt;= 0x0400)</font>
01570 <font class="preprocessor"></font>    LRESULT OnReBarAutoSize(<font class="keywordtype">int</font> <font class="comment">/*idCtrl*/</font>, LPNMHDR <font class="comment">/*pnmh*/</font>, BOOL&amp; <font class="comment">/*bHandled*/</font>)
01571     {
01572         T* pT = static_cast&lt;T*&gt;(this);
01573         pT-&gt;UpdateLayout(FALSE);
01574         <font class="keywordflow">return</font> 0;
<a name="l01575"></a><a class="code" href="classWTL_1_1CMDIChildWindowImpl.html#a10">01575</a>     }
01576 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0400)</font>
01577 <font class="preprocessor"></font>
01578 <font class="preprocessor">#if (_WIN32_IE &gt;= 0x0500)</font>
01579 <font class="preprocessor"></font>    LRESULT OnChevronPushed(<font class="keywordtype">int</font> <font class="comment">/*idCtrl*/</font>, LPNMHDR pnmh, BOOL&amp; bHandled)
01580     {
01581         T* pT = static_cast&lt;T*&gt;(this);
01582         _ChevronMenuInfo cmi = { NULL, (LPNMREBARCHEVRON)pnmh, <font class="keyword">false</font> };
01583         <font class="keywordflow">if</font>(!pT-&gt;PrepareChevronMenu(cmi))
01584         {
01585             bHandled = FALSE;
01586             <font class="keywordflow">return</font> 1;
01587         }
01588         <font class="comment">// display a popup menu with hidden items</font>
01589         pT-&gt;DisplayChevronMenu(cmi);
01590         <font class="comment">// cleanup</font>
01591         pT-&gt;CleanupChevronMenu(cmi);
01592         <font class="keywordflow">return</font> 0;
01593     }
01594 <font class="preprocessor">#endif //(_WIN32_IE &gt;= 0x0500)</font>
01595 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
01596 <font class="preprocessor">};</font>
<a name="l01597"></a><a class="code" href="classWTL_1_1COwnerDraw.html">01597</a> <font class="preprocessor"></font>
01598 
01600 <font class="comment">// COwnerDraw - MI class for owner-draw support</font>
<a name="l01601"></a><a class="code" href="classWTL_1_1COwnerDraw.html#m0">01601</a> 
01602 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
<a name="l01603"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a0">01603</a> <font class="keyword">class </font><a class="code" href="classWTL_1_1COwnerDraw.html">COwnerDraw</a>
01604 {
01605 <font class="keyword">public</font>:
01606 <font class="preprocessor">#if (_ATL_VER &lt; 0x0700)</font>
<a name="l01607"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a1">01607</a> <font class="preprocessor"></font>    BOOL m_bHandledOD;
01608 
01609     BOOL IsMsgHandled()<font class="keyword"> const</font>
01610 <font class="keyword">    </font>{
01611         <font class="keywordflow">return</font> m_bHandledOD;
01612     }
01613     <font class="keywordtype">void</font> SetMsgHandled(BOOL bHandled)
01614     {
01615         m_bHandledOD = bHandled;
01616     }
01617 <font class="preprocessor">#endif //(_ATL_VER &lt; 0x0700)</font>
01618 <font class="preprocessor"></font>
01619 <font class="comment">// Message map and handlers</font>
01620     BEGIN_MSG_MAP(COwnerDraw&lt; T &gt;)
01621         MESSAGE_HANDLER(WM_DRAWITEM, OnDrawItem)
01622         MESSAGE_HANDLER(WM_MEASUREITEM, OnMeasureItem)
01623         MESSAGE_HANDLER(WM_COMPAREITEM, OnCompareItem)
01624         MESSAGE_HANDLER(WM_DELETEITEM, OnDeleteItem)
01625     ALT_MSG_MAP(1)
<a name="l01626"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a2">01626</a>         MESSAGE_HANDLER(OCM_DRAWITEM, OnDrawItem)
01627         MESSAGE_HANDLER(OCM_MEASUREITEM, OnMeasureItem)
01628         MESSAGE_HANDLER(OCM_COMPAREITEM, OnCompareItem)
01629         MESSAGE_HANDLER(OCM_DELETEITEM, OnDeleteItem)
01630     END_MSG_MAP()
01631 
01632     LRESULT OnDrawItem(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; bHandled)
01633     {
<a name="l01634"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a3">01634</a>         T* pT = static_cast&lt;T*&gt;(this);
01635         pT-&gt;SetMsgHandled(TRUE);
01636         pT-&gt;DrawItem((LPDRAWITEMSTRUCT)lParam);
01637         bHandled = pT-&gt;IsMsgHandled();
01638         <font class="keywordflow">return</font> (LRESULT)TRUE;
01639     }
01640     LRESULT OnMeasureItem(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; bHandled)
01641     {
<a name="l01642"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a4">01642</a>         T* pT = static_cast&lt;T*&gt;(this);
01643         pT-&gt;SetMsgHandled(TRUE);
01644         pT-&gt;MeasureItem((LPMEASUREITEMSTRUCT)lParam);
01645         bHandled = pT-&gt;IsMsgHandled();
01646         <font class="keywordflow">return</font> (LRESULT)TRUE;
01647     }
01648     LRESULT OnCompareItem(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; bHandled)
<a name="l01649"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a5">01649</a>     {
01650         T* pT = static_cast&lt;T*&gt;(this);
01651         pT-&gt;SetMsgHandled(TRUE);
01652         bHandled = pT-&gt;IsMsgHandled();
01653         <font class="keywordflow">return</font> (LRESULT)pT-&gt;CompareItem((LPCOMPAREITEMSTRUCT)lParam);
01654     }
01655     LRESULT OnDeleteItem(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; bHandled)
01656     {
01657         T* pT = static_cast&lt;T*&gt;(this);
01658         pT-&gt;SetMsgHandled(TRUE);
<a name="l01659"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a6">01659</a>         pT-&gt;DeleteItem((LPDELETEITEMSTRUCT)lParam);
01660         bHandled = pT-&gt;IsMsgHandled();
01661         <font class="keywordflow">return</font> (LRESULT)TRUE;
01662     }
01663 
<a name="l01664"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a7">01664</a> <font class="comment">// Overrideables</font>
01665     <font class="keywordtype">void</font> DrawItem(LPDRAWITEMSTRUCT <font class="comment">/*lpDrawItemStruct*/</font>)
01666     {
01667         <font class="comment">// must be implemented</font>
01668         ATLASSERT(FALSE);
01669     }
01670     <font class="keywordtype">void</font> MeasureItem(LPMEASUREITEMSTRUCT lpMeasureItemStruct)
01671     {
01672         <font class="keywordflow">if</font>(lpMeasureItemStruct-&gt;CtlType != ODT_MENU)
01673         {
01674             <font class="comment">// return default height for a system font</font>
01675             T* pT = static_cast&lt;T*&gt;(this);
01676             HWND hWnd = pT-&gt;GetDlgItem(lpMeasureItemStruct-&gt;CtlID);
01677             CClientDC dc(hWnd);
01678             TEXTMETRIC tm;
01679             dc.GetTextMetrics(&amp;tm);
<a name="l01680"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a8">01680</a> 
01681             lpMeasureItemStruct-&gt;itemHeight = tm.tmHeight;
01682         }
01683         <font class="keywordflow">else</font>
01684             lpMeasureItemStruct-&gt;itemHeight = ::GetSystemMetrics(SM_CYMENU);
<a name="l01685"></a><a class="code" href="classWTL_1_1COwnerDraw.html#a9">01685</a>     }
01686     <font class="keywordtype">int</font> CompareItem(LPCOMPAREITEMSTRUCT <font class="comment">/*lpCompareItemStruct*/</font>)
01687     {
01688         <font class="comment">// all items are equal</font>
01689         <font class="keywordflow">return</font> 0;
01690     }
01691     <font class="keywordtype">void</font> DeleteItem(LPDELETEITEMSTRUCT <font class="comment">/*lpDeleteItemStruct*/</font>)
01692     {
01693         <font class="comment">// default - nothing</font>
01694     }
01695 };
<a name="l01696"></a><a class="code" href="atlframe_8h.html#a18">01696</a> 
01697 
01699 <font class="comment">// Update UI macros</font>
01700 
01701 <font class="comment">// these build the Update UI map inside a class definition</font>
<a name="l01702"></a><a class="code" href="atlframe_8h.html#a19">01702</a> <font class="preprocessor">#define BEGIN_UPDATE_UI_MAP(thisClass) \</font>
01703 <font class="preprocessor">    static const _AtlUpdateUIMap* GetUpdateUIMap() \</font>
01704 <font class="preprocessor">    { \</font>
<a name="l01705"></a><a class="code" href="atlframe_8h.html#a20">01705</a> <font class="preprocessor">        static const _AtlUpdateUIMap theMap[] = \</font>
01706 <font class="preprocessor">        {</font>
01707 <font class="preprocessor"></font>
01708 <font class="preprocessor">#define UPDATE_ELEMENT(nID, wType) \</font>
01709 <font class="preprocessor">            { nID,  wType },</font>
01710 <font class="preprocessor"></font>
01711 <font class="preprocessor">#define END_UPDATE_UI_MAP() \</font>
01712 <font class="preprocessor">            { (WORD)-1, 0 } \</font>
01713 <font class="preprocessor">        }; \</font>
<a name="l01714"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html">01714</a> <font class="preprocessor">        return theMap; \</font>
01715 <font class="preprocessor">    }</font>
01716 <font class="preprocessor"></font>
01718 <font class="comment">// CUpdateUI - manages UI elements updating</font>
01719 
01720 <font class="keyword">class </font><a class="code" href="classWTL_1_1CUpdateUIBase.html">CUpdateUIBase</a>
01721 {
01722 <font class="keyword">public</font>:
01723     <font class="comment">// constants</font>
01724     <font class="keyword">enum</font>
01725     {
01726         <font class="comment">// UI element type</font>
01727         UPDUI_MENUPOPUP     = 0x0001,
01728         UPDUI_MENUBAR       = 0x0002,
01729         UPDUI_CHILDWINDOW   = 0x0004,
01730         UPDUI_TOOLBAR       = 0x0008,
01731         UPDUI_STATUSBAR     = 0x0010,
01732         <font class="comment">// state</font>
01733         UPDUI_ENABLED       = 0x0000,
01734         UPDUI_DISABLED      = 0x0100,
01735         UPDUI_CHECKED       = 0x0200,
01736         UPDUI_CHECKED2      = 0x0400,
<a name="l01737"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html">01737</a>         UPDUI_RADIO     = 0x0800,
01738         UPDUI_DEFAULT       = 0x1000,
<a name="l01739"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m0">01739</a>         UPDUI_TEXT      = 0x2000,
<a name="l01740"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m1">01740</a>     };
<a name="l01741"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#a0">01741</a> 
01742     <font class="comment">// element data</font>
01743     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html">_AtlUpdateUIElement</a>
01744     {
01745         HWND m_hWnd;
<a name="l01746"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html">01746</a>         WORD m_wType;
01747         <font class="keywordtype">bool</font> <a class="code" href="namespaceWTL.html#a67">operator==</a>(<font class="keyword">const</font> <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html">_AtlUpdateUIElement</a>&amp; e)<font class="keyword"> const</font>
<a name="l01748"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html#m0">01748</a> <font class="keyword">        </font>{ <font class="keywordflow">return</font> (m_hWnd == e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m0">m_hWnd</a> &amp;&amp; m_wType == e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m1">m_wType</a>); }
<a name="l01749"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html#m1">01749</a>     };
01750 
01751     <font class="comment">// map data</font>
01752     <font class="keyword">struct </font>_AtlUpdateUIMap
<a name="l01753"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html">01753</a>     {
01754         WORD m_nID;
<a name="l01755"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">01755</a>         WORD m_wType;
<a name="l01756"></a><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m1">01756</a>     };
01757 
01758     <font class="comment">// instance data</font>
<a name="l01759"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#m0">01759</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html">_AtlUpdateUIData</a>
<a name="l01760"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#m1">01760</a>     {
<a name="l01761"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#m2">01761</a>         WORD m_wState;
<a name="l01762"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#m3">01762</a>         <font class="keywordtype">void</font>* m_lpData;
01763     };
<a name="l01764"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#m4">01764</a> 
01765     <a class="code" href="classCSimpleArray.html">CSimpleArray&lt;_AtlUpdateUIElement&gt;</a> m_UIElements; <font class="comment">// elements data</font>
01766     <font class="keyword">const</font> <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html">_AtlUpdateUIMap</a>* m_pUIMap;        <font class="comment">// static UI data</font>
01767     <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html">_AtlUpdateUIData</a>* m_pUIData;            <font class="comment">// instance UI data</font>
<a name="l01768"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a0">01768</a>     WORD m_wDirtyType;              <font class="comment">// global dirty flag</font>
01769 
01770     <font class="keywordtype">bool</font> m_bBlockAccelerators;
<a name="l01771"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a1">01771</a> 
01772 
01773 <font class="comment">// Constructor, destructor</font>
01774     <a class="code" href="classWTL_1_1CUpdateUIBase.html">CUpdateUIBase</a>() : m_pUIMap(NULL), m_pUIData(NULL), m_wDirtyType(0), m_bBlockAccelerators(false)
01775     { }
01776 
01777     ~CUpdateUIBase()
01778     {
01779         <font class="keywordflow">if</font>(m_pUIMap != NULL &amp;&amp; m_pUIData != NULL)
01780         {
01781             <font class="keyword">const</font> _AtlUpdateUIMap* pUIMap = m_pUIMap;
01782             _AtlUpdateUIData* pUIData = m_pUIData;
01783             <font class="keywordflow">while</font>(pUIMap-&gt;m_nID != (WORD)-1)
01784             {
01785                 <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
01786                     free(pUIData-&gt;m_lpData);
01787                 pUIMap++;
01788                 pUIData++;
<a name="l01789"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a2">01789</a>             }
01790             <font class="keyword">delete</font> [] m_pUIData;
01791         }
01792     }
01793 
<a name="l01794"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a3">01794</a> <font class="comment">// Check for disabled commands</font>
01795     <font class="keywordtype">bool</font> UIGetBlockAccelerators()<font class="keyword"> const</font>
01796 <font class="keyword">    </font>{
01797         <font class="keywordflow">return</font> m_bBlockAccelerators;
01798     }
01799 
01800     <font class="keywordtype">bool</font> UISetBlockAccelerators(<font class="keywordtype">bool</font> bBlock)
01801     {
<a name="l01802"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a4">01802</a>         <font class="keywordtype">bool</font> bOld = m_bBlockAccelerators;
01803         m_bBlockAccelerators = bBlock;
01804         <font class="keywordflow">return</font> bOld;
01805     }
01806 
01807 <font class="comment">// Add elements</font>
01808     BOOL UIAddMenuBar(HWND hWnd)            <font class="comment">// menu bar (main menu)</font>
01809     {
01810         <font class="keywordflow">if</font>(hWnd == NULL)
<a name="l01811"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a5">01811</a>             <font class="keywordflow">return</font> FALSE;
01812         <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html">_AtlUpdateUIElement</a> e;
01813         e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m0">m_hWnd</a> = hWnd;
01814         e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m1">m_wType</a> = UPDUI_MENUBAR;
01815         <font class="keywordflow">return</font> m_UIElements.Add(e);
01816     }
01817     BOOL UIAddToolBar(HWND hWnd)            <font class="comment">// toolbar</font>
01818     {
01819         <font class="keywordflow">if</font>(hWnd == NULL)
<a name="l01820"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a6">01820</a>             <font class="keywordflow">return</font> FALSE;
01821         <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html">_AtlUpdateUIElement</a> e;
01822         e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m0">m_hWnd</a> = hWnd;
01823         e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m1">m_wType</a> = UPDUI_TOOLBAR;
01824         <font class="keywordflow">return</font> m_UIElements.Add(e);
01825     }
01826     BOOL UIAddStatusBar(HWND hWnd)          <font class="comment">// status bar</font>
01827     {
01828         <font class="keywordflow">if</font>(hWnd == NULL)
<a name="l01829"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a7">01829</a>             <font class="keywordflow">return</font> FALSE;
01830         <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html">_AtlUpdateUIElement</a> e;
01831         e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m0">m_hWnd</a> = hWnd;
01832         e.<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIElement.html#m1">m_wType</a> = UPDUI_STATUSBAR;
01833         <font class="keywordflow">return</font> m_UIElements.Add(e);
01834     }
01835     BOOL UIAddChildWindowContainer(HWND hWnd)   <font class="comment">// child window</font>
01836     {
01837         <font class="keywordflow">if</font>(hWnd == NULL)
01838             <font class="keywordflow">return</font> FALSE;
01839         _AtlUpdateUIElement e;
01840         e.m_hWnd = hWnd;
01841         e.m_wType = UPDUI_CHILDWINDOW;
01842         <font class="keywordflow">return</font> m_UIElements.Add(e);
01843     }
01844 
<a name="l01845"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a8">01845</a> <font class="comment">// Message map for popup menu updates and accelerator blocking</font>
01846     BEGIN_MSG_MAP(<a class="code" href="classWTL_1_1CUpdateUIBase.html">CUpdateUIBase</a>)
01847         MESSAGE_HANDLER(WM_INITMENUPOPUP, OnInitMenuPopup)
01848         MESSAGE_HANDLER(WM_COMMAND, OnCommand)
01849     END_MSG_MAP()
01850 
01851     LRESULT OnInitMenuPopup(UINT <font class="comment">/*uMsg*/</font>, WPARAM wParam, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
01852     {
01853         bHandled = FALSE;
01854         HMENU hMenu = (HMENU)wParam;
01855         <font class="keywordflow">if</font>(hMenu == NULL)
01856             <font class="keywordflow">return</font> 1;
01857         <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html">_AtlUpdateUIData</a>* pUIData = m_pUIData;
01858         <font class="keywordflow">if</font>(pUIData == NULL)
01859             <font class="keywordflow">return</font> 1;
01860         ::SetMenuDefaultItem(hMenu, (UINT)-1, 0);
01861         <font class="keyword">const</font> <a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html">_AtlUpdateUIMap</a>* pMap = m_pUIMap;
01862         <font class="keywordflow">while</font>(pMap-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html#m0">m_nID</a> != (WORD)-1)
01863         {
01864             <font class="keywordflow">if</font>(pMap-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html#m1">m_wType</a> &amp; UPDUI_MENUPOPUP)
01865                 UIUpdateMenuBarElement(pMap-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIMap.html#m0">m_nID</a>, pUIData, hMenu);
<a name="l01866"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a9">01866</a>             pMap++;
01867             pUIData++;
01868         }
01869         <font class="keywordflow">return</font> 0;
01870     }
01871 
01872     LRESULT OnCommand(UINT <font class="comment">/*uMsg*/</font>, WPARAM wParam, LPARAM <font class="comment">/*lParam*/</font>, BOOL&amp; bHandled)
01873     {
01874         bHandled = FALSE;
01875         <font class="keywordflow">if</font>(m_bBlockAccelerators &amp;&amp; HIWORD(wParam) == 1) <font class="comment">// accelerators only</font>
01876         {
01877             <font class="keywordtype">int</font> nID = LOWORD(wParam);
01878             <font class="keywordflow">if</font>((UIGetState(nID) &amp; UPDUI_DISABLED) == UPDUI_DISABLED)
01879             {
01880                 ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"CUpdateUIBase::OnCommand - blocked disabled command 0x%4.4X\n"</font>), nID);
01881                 bHandled = TRUE;    <font class="comment">// eat the command, UI item is disabled</font>
<a name="l01882"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a10">01882</a>             }
01883         }
01884         <font class="keywordflow">return</font> 0;
01885     }
01886 
01887 <font class="comment">// methods for setting UI element state</font>
01888     BOOL UIEnable(<font class="keywordtype">int</font> nID, BOOL bEnable, BOOL bForceUpdate = FALSE)
01889     {
01890         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
01891         _AtlUpdateUIData* pUIData = m_pUIData;
01892         <font class="keywordflow">if</font>(pUIData == NULL)
01893             <font class="keywordflow">return</font> FALSE;
01894 
01895         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
01896         {
01897             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
01898             {
01899                 <font class="keywordflow">if</font>(bEnable)
01900                 {
01901                     <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_DISABLED)
01902                     {
01903                         pUIData-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">m_wState</a> |= pMap-&gt;m_wType;
01904                         pUIData-&gt;m_wState &amp;= ~UPDUI_DISABLED;
01905                     }
01906                 }
01907                 <font class="keywordflow">else</font>
01908                 {
01909                     <font class="keywordflow">if</font>(!(pUIData-&gt;m_wState &amp; UPDUI_DISABLED))
01910                     {
01911                         pUIData-&gt;m_wState |= pMap-&gt;m_wType;
01912                         pUIData-&gt;m_wState |= UPDUI_DISABLED;
01913                     }
01914                 }
01915 
01916                 <font class="keywordflow">if</font>(bForceUpdate)
01917                     pUIData-&gt;m_wState |= pMap-&gt;m_wType;
01918                 <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; pMap-&gt;m_wType)
01919                     m_wDirtyType |= pMap-&gt;m_wType;
01920 
01921                 <font class="keywordflow">break</font>;  <font class="comment">// found</font>
<a name="l01922"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a11">01922</a>             }
01923         }
01924 
01925         <font class="keywordflow">return</font> TRUE;
01926     }
01927 
01928     BOOL UISetCheck(<font class="keywordtype">int</font> nID, <font class="keywordtype">int</font> nCheck, BOOL bForceUpdate = FALSE)
01929     {
01930         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
01931         _AtlUpdateUIData* pUIData = m_pUIData;
01932         <font class="keywordflow">if</font>(pUIData == NULL)
01933             <font class="keywordflow">return</font> FALSE;
01934 
01935         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
01936         {
01937             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
01938             {
01939                 <font class="keywordflow">switch</font>(nCheck)
01940                 {
01941                 <font class="keywordflow">case</font> 0:
01942                     <font class="keywordflow">if</font>((pUIData-&gt;m_wState &amp; UPDUI_CHECKED) || (pUIData-&gt;m_wState &amp; UPDUI_CHECKED2))
01943                     {
01944                         pUIData-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">m_wState</a> |= pMap-&gt;m_wType;
01945                         pUIData-&gt;m_wState &amp;= ~(UPDUI_CHECKED | UPDUI_CHECKED2);
01946                     }
01947                     <font class="keywordflow">break</font>;
01948                 <font class="keywordflow">case</font> 1:
01949                     <font class="keywordflow">if</font>(!(pUIData-&gt;m_wState &amp; UPDUI_CHECKED))
01950                     {
01951                         pUIData-&gt;m_wState |= pMap-&gt;m_wType;
01952                         pUIData-&gt;m_wState &amp;= ~UPDUI_CHECKED2;
01953                         pUIData-&gt;m_wState |= UPDUI_CHECKED;
01954                     }
01955                     <font class="keywordflow">break</font>;
01956                 <font class="keywordflow">case</font> 2:
01957                     <font class="keywordflow">if</font>(!(pUIData-&gt;m_wState &amp; UPDUI_CHECKED2))
01958                     {
01959                         pUIData-&gt;m_wState |= pMap-&gt;m_wType;
01960                         pUIData-&gt;m_wState &amp;= ~UPDUI_CHECKED;
01961                         pUIData-&gt;m_wState |= UPDUI_CHECKED2;
01962                     }
01963                     <font class="keywordflow">break</font>;
01964                 }
01965 
01966                 <font class="keywordflow">if</font>(bForceUpdate)
01967                     pUIData-&gt;m_wState |= pMap-&gt;m_wType;
01968                 <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; pMap-&gt;m_wType)
01969                     m_wDirtyType |= pMap-&gt;m_wType;
01970 
01971                 <font class="keywordflow">break</font>;  <font class="comment">// found</font>
<a name="l01972"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a12">01972</a>             }
01973         }
01974 
01975         <font class="keywordflow">return</font> TRUE;
01976     }
01977 
01978     BOOL UISetRadio(<font class="keywordtype">int</font> nID, BOOL bRadio, BOOL bForceUpdate = FALSE)
01979     {
01980         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
01981         _AtlUpdateUIData* pUIData = m_pUIData;
01982         <font class="keywordflow">if</font>(pUIData == NULL)
01983             <font class="keywordflow">return</font> FALSE;
01984 
01985         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
01986         {
01987             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
01988             {
01989                 <font class="keywordflow">if</font>(bRadio)
01990                 {
01991                     <font class="keywordflow">if</font>(!(pUIData-&gt;m_wState &amp; UPDUI_RADIO))
01992                     {
01993                         pUIData-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">m_wState</a> |= pMap-&gt;m_wType;
01994                         pUIData-&gt;m_wState |= UPDUI_RADIO;
01995                     }
01996                 }
01997                 <font class="keywordflow">else</font>
01998                 {
01999                     <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_RADIO)
02000                     {
02001                         pUIData-&gt;m_wState |= pMap-&gt;m_wType;
02002                         pUIData-&gt;m_wState &amp;= ~UPDUI_RADIO;
02003                     }
02004                 }
02005 
02006                 <font class="keywordflow">if</font>(bForceUpdate)
02007                     pUIData-&gt;m_wState |= pMap-&gt;m_wType;
02008                 <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; pMap-&gt;m_wType)
02009                     m_wDirtyType |= pMap-&gt;m_wType;
02010 
02011                 <font class="keywordflow">break</font>;  <font class="comment">// found</font>
<a name="l02012"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a13">02012</a>             }
02013         }
02014 
02015         <font class="keywordflow">return</font> TRUE;
02016     }
02017 
02018     BOOL UISetText(<font class="keywordtype">int</font> nID, LPCTSTR lpstrText, BOOL bForceUpdate = FALSE)
02019     {
02020         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02021         _AtlUpdateUIData* pUIData = m_pUIData;
02022         <font class="keywordflow">if</font>(pUIData == NULL)
02023             <font class="keywordflow">return</font> FALSE;
02024         <font class="keywordflow">if</font>(lpstrText == NULL)
02025             lpstrText = _T(<font class="stringliteral">""</font>);
02026 
02027         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
02028         {
02029             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
02030             {
02031                 <font class="keywordflow">if</font>(pUIData-&gt;m_lpData == NULL || lstrcmp((LPTSTR)pUIData-&gt;m_lpData, lpstrText))
02032                 {
02033                     <font class="keywordtype">int</font> nStrLen = lstrlen(lpstrText);
02034                     free(pUIData-&gt;m_lpData);
02035                     pUIData-&gt;m_lpData = NULL;
02036                     ATLTRY(pUIData-&gt;m_lpData = malloc((nStrLen + 1) * <font class="keyword">sizeof</font>(TCHAR)));
02037                     <font class="keywordflow">if</font>(pUIData-&gt;m_lpData == NULL)
02038                     {
02039                         ATLTRACE2(<a class="code" href="namespaceWTL.html#a111a1">atlTraceUI</a>, 0, _T(<font class="stringliteral">"UISetText - malloc failed\n"</font>));
02040                         <font class="keywordflow">break</font>;
02041                     }
02042                     lstrcpy((LPTSTR)pUIData-&gt;m_lpData, lpstrText);
02043                     pUIData-&gt;m_wState |= (UPDUI_TEXT | pMap-&gt;m_wType);
02044                 }
02045 
02046                 <font class="keywordflow">if</font>(bForceUpdate)
02047                     pUIData-&gt;m_wState |= (UPDUI_TEXT | pMap-&gt;m_wType);
02048                 <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; pMap-&gt;m_wType)
02049                     m_wDirtyType |= pMap-&gt;m_wType;
02050 
02051                 <font class="keywordflow">break</font>;  <font class="comment">// found</font>
<a name="l02052"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a14">02052</a>             }
02053         }
02054 
02055         <font class="keywordflow">return</font> TRUE;
02056     }
02057 
02058     BOOL UISetDefault(<font class="keywordtype">int</font> nID, BOOL bDefault, BOOL bForceUpdate = FALSE)
02059     {
02060         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02061         _AtlUpdateUIData* pUIData = m_pUIData;
02062         <font class="keywordflow">if</font>(pUIData == NULL)
02063             <font class="keywordflow">return</font> FALSE;
02064 
02065         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
02066         {
02067             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
02068             {
02069                 <font class="keywordflow">if</font>(bDefault)
02070                 {
02071                     <font class="keywordflow">if</font>((pUIData-&gt;m_wState &amp; UPDUI_DEFAULT) == 0)
02072                     {
02073                         pUIData-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">m_wState</a> |= pMap-&gt;m_wType;
02074                         pUIData-&gt;m_wState |= UPDUI_DEFAULT;
02075                     }
02076                 }
02077                 <font class="keywordflow">else</font>
02078                 {
02079                     <font class="keywordflow">if</font>((pUIData-&gt;m_wState &amp; UPDUI_DEFAULT) != 0)
02080                     {
02081                         pUIData-&gt;m_wState |= pMap-&gt;m_wType;
02082                         pUIData-&gt;m_wState &amp;= ~UPDUI_DEFAULT;
02083                     }
02084                 }
02085 
02086                 <font class="keywordflow">if</font>(bForceUpdate)
02087                     pUIData-&gt;m_wState |= pMap-&gt;m_wType;
02088                 <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; pMap-&gt;m_wType)
02089                     m_wDirtyType |= pMap-&gt;m_wType;
02090 
02091                 <font class="keywordflow">break</font>;  <font class="comment">// found</font>
02092             }
<a name="l02093"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a15">02093</a>         }
02094 
02095         <font class="keywordflow">return</font> TRUE;
02096     }
02097 
02098 <font class="comment">// methods for complete state set/get</font>
02099     BOOL UISetState(<font class="keywordtype">int</font> nID, DWORD dwState)
02100     {
02101         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02102         _AtlUpdateUIData* pUIData = m_pUIData;
02103         <font class="keywordflow">if</font>(pUIData == NULL)
02104             <font class="keywordflow">return</font> FALSE;
02105         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
02106         {
02107             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
02108             {       
02109                 pUIData-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">m_wState</a> = (WORD)(dwState | pMap-&gt;m_wType);
<a name="l02110"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a16">02110</a>                 m_wDirtyType |= pMap-&gt;m_wType;
02111                 <font class="keywordflow">break</font>;  <font class="comment">// found</font>
02112             }
02113         }
02114         <font class="keywordflow">return</font> TRUE;
02115     }
02116     DWORD UIGetState(<font class="keywordtype">int</font> nID)
02117     {
02118         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02119         _AtlUpdateUIData* pUIData = m_pUIData;
02120         <font class="keywordflow">if</font>(pUIData == NULL)
02121             <font class="keywordflow">return</font> 0;
02122         <font class="keywordflow">for</font>( ; pMap-&gt;m_nID != (WORD)-1; pMap++, pUIData++)
02123         {
02124             <font class="keywordflow">if</font>(nID == (int)pMap-&gt;m_nID)
<a name="l02125"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a17">02125</a>                 <font class="keywordflow">return</font> pUIData-&gt;<a class="code" href="structWTL_1_1CUpdateUIBase_1_1__AtlUpdateUIData.html#m0">m_wState</a>;
02126         }
02127         <font class="keywordflow">return</font> 0;
02128     }
02129 
02130 <font class="comment">// methods for updating UI</font>
02131     BOOL UIUpdateMenuBar(BOOL bForceUpdate = FALSE, BOOL bMainMenu = FALSE)
02132     {
02133         <font class="keywordflow">if</font>(!(m_wDirtyType &amp; UPDUI_MENUBAR) &amp;&amp; !bForceUpdate)
02134             <font class="keywordflow">return</font> TRUE;
02135 
02136         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02137         _AtlUpdateUIData* pUIData = m_pUIData;
02138         <font class="keywordflow">if</font>(pUIData == NULL)
02139             <font class="keywordflow">return</font> FALSE;
02140 
02141         <font class="keywordflow">while</font>(pMap-&gt;m_nID != (WORD)-1)
02142         {
02143             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; m_UIElements.GetSize(); i++)
02144             {
02145                 <font class="keywordflow">if</font>(m_UIElements[i].m_wType == UPDUI_MENUBAR)
02146                 {
02147                     HMENU hMenu = ::GetMenu(m_UIElements[i].m_hWnd);
02148                     <font class="keywordflow">if</font>(hMenu != NULL &amp;&amp; (pUIData-&gt;m_wState &amp; UPDUI_MENUBAR) &amp;&amp; (pMap-&gt;m_wType &amp; UPDUI_MENUBAR))
02149                         UIUpdateMenuBarElement(pMap-&gt;m_nID, pUIData, hMenu);
02150                 }
02151                 <font class="keywordflow">if</font>(bMainMenu)
02152                     ::DrawMenuBar(m_UIElements[i].m_hWnd);
02153             }
02154             pMap++;
02155             pUIData-&gt;m_wState &amp;= ~UPDUI_MENUBAR;
02156             <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
02157             {
02158                 free(pUIData-&gt;m_lpData);
02159                 pUIData-&gt;m_lpData = NULL;
02160                 pUIData-&gt;m_wState &amp;= ~UPDUI_TEXT;
02161             }
02162             pUIData++;
<a name="l02163"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a18">02163</a>         }
02164 
02165         m_wDirtyType &amp;= ~UPDUI_MENUBAR;
02166         <font class="keywordflow">return</font> TRUE;
02167     }
02168 
02169     BOOL UIUpdateToolBar(BOOL bForceUpdate = FALSE)
02170     {
02171         <font class="keywordflow">if</font>(!(m_wDirtyType &amp; UPDUI_TOOLBAR) &amp;&amp; !bForceUpdate)
02172             <font class="keywordflow">return</font> TRUE;
02173 
02174         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02175         _AtlUpdateUIData* pUIData = m_pUIData;
02176         <font class="keywordflow">if</font>(pUIData == NULL)
02177             <font class="keywordflow">return</font> FALSE;
02178 
02179         <font class="keywordflow">while</font>(pMap-&gt;m_nID != (WORD)-1)
02180         {
02181             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; m_UIElements.GetSize(); i++)
02182             {
02183                 <font class="keywordflow">if</font>(m_UIElements[i].m_wType == UPDUI_TOOLBAR)
02184                 {
02185                     <font class="keywordflow">if</font>((pUIData-&gt;m_wState &amp; UPDUI_TOOLBAR) &amp;&amp; (pMap-&gt;m_wType &amp; UPDUI_TOOLBAR))
02186                         UIUpdateToolBarElement(pMap-&gt;m_nID, pUIData, m_UIElements[i].m_hWnd);
02187                 }
02188             }
02189             pMap++;
02190             pUIData-&gt;m_wState &amp;= ~UPDUI_TOOLBAR;
02191             pUIData++;
<a name="l02192"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a19">02192</a>         }
02193 
02194         m_wDirtyType &amp;= ~UPDUI_TOOLBAR;
02195         <font class="keywordflow">return</font> TRUE;
02196     }
02197 
02198     BOOL UIUpdateStatusBar(BOOL bForceUpdate = FALSE)
02199     {
02200         <font class="keywordflow">if</font>(!(m_wDirtyType &amp; UPDUI_STATUSBAR) &amp;&amp; !bForceUpdate)
02201             <font class="keywordflow">return</font> TRUE;
02202 
02203         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02204         _AtlUpdateUIData* pUIData = m_pUIData;
02205         <font class="keywordflow">if</font>(pUIData == NULL)
02206             <font class="keywordflow">return</font> FALSE;
02207 
02208         <font class="keywordflow">while</font>(pMap-&gt;m_nID != (WORD)-1)
02209         {
02210             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; m_UIElements.GetSize(); i++)
02211             {
02212                 <font class="keywordflow">if</font>(m_UIElements[i].m_wType == UPDUI_STATUSBAR)
02213                 {
02214                     <font class="keywordflow">if</font>((pUIData-&gt;m_wState &amp; UPDUI_STATUSBAR) &amp;&amp; (pMap-&gt;m_wType &amp; UPDUI_STATUSBAR))
02215                         UIUpdateStatusBarElement(pMap-&gt;m_nID, pUIData, m_UIElements[i].m_hWnd);
02216                 }
02217             }
02218             pMap++;
02219             pUIData-&gt;m_wState &amp;= ~UPDUI_STATUSBAR;
02220             <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
02221             {
02222                 free(pUIData-&gt;m_lpData);
02223                 pUIData-&gt;m_lpData = NULL;
02224                 pUIData-&gt;m_wState &amp;= ~UPDUI_TEXT;
02225             }
02226             pUIData++;
<a name="l02227"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#a20">02227</a>         }
02228 
02229         m_wDirtyType &amp;= ~UPDUI_STATUSBAR;
02230         <font class="keywordflow">return</font> TRUE;
02231     }
02232 
02233     BOOL UIUpdateChildWindows(BOOL bForceUpdate = FALSE)
02234     {
02235         <font class="keywordflow">if</font>(!(m_wDirtyType &amp; UPDUI_CHILDWINDOW) &amp;&amp; !bForceUpdate)
02236             <font class="keywordflow">return</font> TRUE;
02237 
02238         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = m_pUIMap;
02239         _AtlUpdateUIData* pUIData = m_pUIData;
02240         <font class="keywordflow">if</font>(pUIData == NULL)
02241             <font class="keywordflow">return</font> FALSE;
02242 
02243         <font class="keywordflow">while</font>(pMap-&gt;m_nID != (WORD)-1)
02244         {
02245             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; m_UIElements.GetSize(); i++)
02246             {
02247                 <font class="keywordflow">if</font>(m_UIElements[i].m_wType == UPDUI_CHILDWINDOW)
02248                 {
02249                     <font class="keywordflow">if</font>((pUIData-&gt;m_wState &amp; UPDUI_CHILDWINDOW) &amp;&amp; (pMap-&gt;m_wType &amp; UPDUI_CHILDWINDOW))
02250                         UIUpdateChildWindow(pMap-&gt;m_nID, pUIData, m_UIElements[i].m_hWnd);
02251                 }
02252             }
02253             pMap++;
02254             pUIData-&gt;m_wState &amp;= ~UPDUI_CHILDWINDOW;
02255             <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
02256             {
02257                 free(pUIData-&gt;m_lpData);
02258                 pUIData-&gt;m_lpData = NULL;
02259                 pUIData-&gt;m_wState &amp;= ~UPDUI_TEXT;
02260             }
02261             pUIData++;
02262         }
<a name="l02263"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#d0">02263</a> 
02264         m_wDirtyType &amp;= ~UPDUI_CHILDWINDOW;
02265         <font class="keywordflow">return</font> TRUE;
02266     }
02267 
02268 <font class="comment">// internal element specific methods</font>
02269     <font class="keyword">static</font> <font class="keywordtype">void</font> UIUpdateMenuBarElement(<font class="keywordtype">int</font> nID, _AtlUpdateUIData* pUIData, HMENU hMenu)
02270     {
02271         MENUITEMINFO mii;
02272         memset(&amp;mii, 0, <font class="keyword">sizeof</font>(MENUITEMINFO));
02273         mii.cbSize = <font class="keyword">sizeof</font>(MENUITEMINFO);
02274         mii.fMask = MIIM_STATE;
02275         mii.wID = nID;
02276 
02277         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_DISABLED)
02278             mii.fState |= MFS_DISABLED | MFS_GRAYED;
02279         <font class="keywordflow">else</font>
02280             mii.fState |= MFS_ENABLED;
02281 
02282         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_CHECKED)
02283             mii.fState |= MFS_CHECKED;
02284         <font class="keywordflow">else</font>
02285             mii.fState |= MFS_UNCHECKED;
02286 
02287         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_DEFAULT)
02288             mii.fState |= MFS_DEFAULT;
02289 
02290         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
02291         {
02292             MENUITEMINFO miiNow;
02293             memset(&amp;miiNow, 0, <font class="keyword">sizeof</font>(MENUITEMINFO));
02294             miiNow.cbSize = <font class="keyword">sizeof</font>(MENUITEMINFO);
02295             miiNow.fMask = MIIM_TYPE;
02296             miiNow.wID = nID;
02297             <font class="keywordflow">if</font>(::GetMenuItemInfo(hMenu, nID, FALSE, &amp;miiNow))
02298             {
02299                 mii.fMask |= MIIM_TYPE;
02300                 <font class="comment">// MFT_BITMAP and MFT_SEPARATOR don't go together with MFT_STRING</font>
02301                 mii.fType |= (miiNow.fType &amp; ~(MFT_BITMAP | MFT_SEPARATOR)) | MFT_STRING;
02302                 mii.dwTypeData = (LPTSTR)pUIData-&gt;m_lpData;
<a name="l02303"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#d1">02303</a>             }
02304         }
02305 
02306         ::SetMenuItemInfo(hMenu, nID, FALSE, &amp;mii);
02307     }
02308 
02309     <font class="keyword">static</font> <font class="keywordtype">void</font> UIUpdateToolBarElement(<font class="keywordtype">int</font> nID, _AtlUpdateUIData* pUIData, HWND hWndToolBar)
02310     {
02311         <font class="comment">// Note: only handles enabled/disabled, checked state, and radio (press)</font>
<a name="l02312"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#d2">02312</a>         ::SendMessage(hWndToolBar, TB_ENABLEBUTTON, nID, (LPARAM)(pUIData-&gt;m_wState &amp; UPDUI_DISABLED) ? FALSE : TRUE);
02313         ::SendMessage(hWndToolBar, TB_CHECKBUTTON, nID, (LPARAM)(pUIData-&gt;m_wState &amp; UPDUI_CHECKED) ? TRUE : FALSE);
02314         ::SendMessage(hWndToolBar, TB_INDETERMINATE, nID, (LPARAM)(pUIData-&gt;m_wState &amp; UPDUI_CHECKED2) ? TRUE : FALSE);
02315         ::SendMessage(hWndToolBar, TB_PRESSBUTTON, nID, (LPARAM)(pUIData-&gt;m_wState &amp; UPDUI_RADIO) ? TRUE : FALSE);
02316     }
02317 
02318     <font class="keyword">static</font> <font class="keywordtype">void</font> UIUpdateStatusBarElement(<font class="keywordtype">int</font> nID, _AtlUpdateUIData* pUIData, HWND hWndStatusBar)
<a name="l02319"></a><a class="code" href="classWTL_1_1CUpdateUIBase.html#d3">02319</a>     {
02320         <font class="comment">// Note: only handles text</font>
02321         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
02322             ::SendMessage(hWndStatusBar, SB_SETTEXT, nID, (LPARAM)pUIData-&gt;m_lpData);
02323     }
02324 
02325     <font class="keyword">static</font> <font class="keywordtype">void</font> UIUpdateChildWindow(<font class="keywordtype">int</font> nID, _AtlUpdateUIData* pUIData, HWND hWnd)
02326     {
02327         HWND hChild = ::GetDlgItem(hWnd, nID);
02328 
02329         ::EnableWindow(hChild, (pUIData-&gt;m_wState &amp; UPDUI_DISABLED) ? FALSE : TRUE);
02330         <font class="comment">// for check and radio, assume that window is a button</font>
02331         <font class="keywordtype">int</font> nCheck = BST_UNCHECKED;
02332         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_CHECKED || pUIData-&gt;m_wState &amp; UPDUI_RADIO)
02333             nCheck = BST_CHECKED;
02334         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_CHECKED2)
02335             nCheck = BST_INDETERMINATE;
02336         ::SendMessage(hChild, BM_SETCHECK, nCheck, 0L);
02337         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_DEFAULT)
02338         {
02339             DWORD dwRet = (DWORD)::SendMessage(hWnd, DM_GETDEFID, 0, 0L);
02340             <font class="keywordflow">if</font>(HIWORD(dwRet) == DC_HASDEFID)
02341             {
02342                 HWND hOldDef = ::GetDlgItem(hWnd, (int)(short)LOWORD(dwRet));
02343                 <font class="comment">// remove BS_DEFPUSHBUTTON</font>
02344                 ::SendMessage(hOldDef, BM_SETSTYLE, BS_PUSHBUTTON, MAKELPARAM(TRUE, 0));
02345             }
02346             ::SendMessage(hWnd, DM_SETDEFID, nID, 0L);
02347         }
<a name="l02348"></a><a class="code" href="classWTL_1_1CUpdateUI.html">02348</a>         <font class="keywordflow">if</font>(pUIData-&gt;m_wState &amp; UPDUI_TEXT)
02349             ::SetWindowText(hChild, (LPTSTR)pUIData-&gt;m_lpData);
02350     }
<a name="l02351"></a><a class="code" href="classWTL_1_1CUpdateUI.html#a0">02351</a> };
02352 
02353 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
02354 <font class="keyword">class </font>CUpdateUI : <font class="keyword">public</font> CUpdateUIBase
02355 {
02356 <font class="keyword">public</font>:
02357     CUpdateUI()
02358     {
02359         T* pT = static_cast&lt;T*&gt;(this);
02360         pT;
02361         <font class="keyword">const</font> _AtlUpdateUIMap* pMap = pT-&gt;GetUpdateUIMap();
02362         m_pUIMap = pMap;
02363         ATLASSERT(m_pUIMap != NULL);
02364         <font class="keywordtype">int</font> nCount;
02365         <font class="keywordflow">for</font>(nCount = 1; pMap-&gt;m_nID != (WORD)-1; nCount++)
02366             pMap++;
02367 
02368         <font class="comment">// check for duplicates (debug only)</font>
02369 <font class="preprocessor">#ifdef _DEBUG</font>
02370 <font class="preprocessor"></font>        <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; nCount; i++)
02371         {
02372             <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; nCount; j++)
02373             {
02374                 <font class="comment">// shouldn't have duplicates in the update UI map</font>
02375                 <font class="keywordflow">if</font>(i != j)
02376                     ATLASSERT(m_pUIMap[j].m_nID != m_pUIMap[i].m_nID);
02377             }
02378         }
02379 <font class="preprocessor">#endif //_DEBUG</font>
02380 <font class="preprocessor"></font>
02381         ATLTRY(m_pUIData = <font class="keyword">new</font> _AtlUpdateUIData[nCount]);
02382         ATLASSERT(m_pUIData != NULL);
02383 
02384         <font class="keywordflow">if</font>(m_pUIData != NULL)
02385             memset(m_pUIData, 0, <font class="keyword">sizeof</font>(_AtlUpdateUIData) * nCount);
02386     }
02387 };
02388 
02389 
02391 <font class="comment">// CDialogResize - provides support for resizing dialog controls</font>
02392 <font class="comment">//                 (works for any window that has child controls)</font>
02393 
<a name="l02394"></a><a class="code" href="atlframe_8h.html#a21">02394</a> <font class="comment">// Put CDialogResize in the list of base classes for a dialog (or even plain window),</font>
02395 <font class="comment">// then implement DLGRESIZE map by specifying controls and groups of control</font>
02396 <font class="comment">// and using DLSZ_* values to specify how are they supposed to be resized.</font>
02397 
02398 
02399 <font class="comment">// dialog resize map macros</font>
<a name="l02400"></a><a class="code" href="atlframe_8h.html#a22">02400</a> <font class="preprocessor">#define BEGIN_DLGRESIZE_MAP(thisClass) \</font>
02401 <font class="preprocessor">    static const _AtlDlgResizeMap* GetDlgResizeMap() \</font>
02402 <font class="preprocessor">    { \</font>
02403 <font class="preprocessor">        static const _AtlDlgResizeMap theMap[] = \</font>
02404 <font class="preprocessor">        {</font>
02405 <font class="preprocessor"></font>
<a name="l02406"></a><a class="code" href="atlframe_8h.html#a23">02406</a> <font class="preprocessor">#define END_DLGRESIZE_MAP() \</font>
02407 <font class="preprocessor">            { -1, 0 }, \</font>
02408 <font class="preprocessor">        }; \</font>
<a name="l02409"></a><a class="code" href="atlframe_8h.html#a24">02409</a> <font class="preprocessor">        return theMap; \</font>
02410 <font class="preprocessor">    }</font>
02411 <font class="preprocessor"></font>
<a name="l02412"></a><a class="code" href="atlframe_8h.html#a25">02412</a> <font class="preprocessor">#define DLGRESIZE_CONTROL(id, flags) \</font>
02413 <font class="preprocessor">        { id, flags },</font>
02414 <font class="preprocessor"></font>
02415 <font class="preprocessor">#define BEGIN_DLGRESIZE_GROUP() \</font>
02416 <font class="preprocessor">        { -1, _DLSZ_BEGIN_GROUP },</font>
<a name="l02417"></a><a class="code" href="classWTL_1_1CDialogResize.html">02417</a> <font class="preprocessor"></font>
02418 <font class="preprocessor">#define END_DLGRESIZE_GROUP() \</font>
02419 <font class="preprocessor">        { -1, _DLSZ_END_GROUP },</font>
02420 <font class="preprocessor"></font>
02421 
02422 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
02423 <font class="keyword">class </font><a class="code" href="classWTL_1_1CDialogResize.html">CDialogResize</a>
02424 {
02425 <font class="keyword">public</font>:
02426 <font class="comment">// Data declarations and members</font>
02427     <font class="keyword">enum</font>
02428     {
02429         DLSZ_SIZE_X     = 0x00000001,
02430         DLSZ_SIZE_Y     = 0x00000002,
02431         DLSZ_MOVE_X     = 0x00000004,
02432         DLSZ_MOVE_Y     = 0x00000008,
02433         DLSZ_REPAINT        = 0x00000010,
02434 
<a name="l02435"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeMap.html">02435</a>         <font class="comment">// internal use only</font>
02436         _DLSZ_BEGIN_GROUP   = 0x00001000,
<a name="l02437"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeMap.html#m0">02437</a>         _DLSZ_END_GROUP     = 0x00002000,
<a name="l02438"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeMap.html#m1">02438</a>         _DLSZ_GRIPPER       = 0x00004000
02439     };
02440 
<a name="l02441"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html">02441</a>     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeMap.html">_AtlDlgResizeMap</a>
02442     {
<a name="l02443"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#m0">02443</a>         <font class="keywordtype">int</font> m_nCtlID;
<a name="l02444"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#m1">02444</a>         DWORD m_dwResizeFlags;
<a name="l02445"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#m2">02445</a>     };
<a name="l02446"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#a0">02446</a> 
02447     <font class="keyword">struct </font><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html">_AtlDlgResizeData</a>
02448     {
02449         <font class="keywordtype">int</font> m_nCtlID;
<a name="l02450"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#a1">02450</a>         DWORD m_dwResizeFlags;
02451         RECT m_rect;
02452         <font class="keywordtype">int</font> GetGroupCount()<font class="keyword"> const</font>
02453 <font class="keyword">        </font>{
02454             <font class="keywordflow">return</font> (int)LOBYTE(HIWORD(m_dwResizeFlags));
02455         }
02456         <font class="keywordtype">void</font> SetGroupCount(<font class="keywordtype">int</font> nCount)
<a name="l02457"></a><a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#a2">02457</a>         {
02458             ATLASSERT(nCount &gt; 0 &amp;&amp; nCount &lt; 256);
02459             DWORD dwCount = (DWORD)MAKELONG(0, MAKEWORD(nCount, 0));
02460             m_dwResizeFlags &amp;= 0xFF00FFFF;
<a name="l02461"></a><a class="code" href="classWTL_1_1CDialogResize.html#m0">02461</a>             m_dwResizeFlags |= dwCount;
<a name="l02462"></a><a class="code" href="classWTL_1_1CDialogResize.html#m1">02462</a>         }
<a name="l02463"></a><a class="code" href="classWTL_1_1CDialogResize.html#m2">02463</a>         <font class="keywordtype">bool</font> <a class="code" href="namespaceWTL.html#a67">operator==</a>(<font class="keyword">const</font> <a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html">_AtlDlgResizeData</a>&amp; r)<font class="keyword"> const</font>
<a name="l02464"></a><a class="code" href="classWTL_1_1CDialogResize.html#m3">02464</a> <font class="keyword">        </font>{ <font class="keywordflow">return</font> (m_nCtlID == r.<a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#m0">m_nCtlID</a> &amp;&amp; m_dwResizeFlags == r.<a class="code" href="structWTL_1_1CDialogResize_1_1__AtlDlgResizeData.html#m1">m_dwResizeFlags</a>); }
02465     };
02466 
02467     <a class="code" href="classCSimpleArray.html">CSimpleArray&lt;_AtlDlgResizeData&gt;</a> m_arrData;
<a name="l02468"></a><a class="code" href="classWTL_1_1CDialogResize.html#a0">02468</a>     SIZE m_sizeDialog;
02469     POINT m_ptMinTrackSize;
02470     <font class="keywordtype">bool</font> m_bGripper;
02471 
02472 
02473 <font class="comment">// Constructor</font>
02474     <a class="code" href="classWTL_1_1CDialogResize.html">CDialogResize</a>() : m_bGripper(false)
02475     {
02476         m_sizeDialog.cx = 0;
<a name="l02477"></a><a class="code" href="classWTL_1_1CDialogResize.html#a1">02477</a>         m_sizeDialog.cy = 0;
02478         m_ptMinTrackSize.x = -1;
02479         m_ptMinTrackSize.y = -1;
02480     }
02481 
02482 <font class="comment">// Operations</font>
02483     <font class="keywordtype">void</font> DlgResize_Init(<font class="keywordtype">bool</font> bAddGripper = <font class="keyword">true</font>, <font class="keywordtype">bool</font> bUseMinTrackSize = <font class="keyword">true</font>, DWORD dwForceStyle = WS_THICKFRAME | WS_CLIPCHILDREN)
02484     {
02485         T* pT = static_cast&lt;T*&gt;(this);
02486         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
02487 
02488         <font class="comment">// Force specified styles (default WS_THICKFRAME | WS_CLIPCHILDREN to enable resizing border and reduce flicker)</font>
02489         <font class="keywordflow">if</font>((pT-&gt;GetStyle() &amp; dwForceStyle) != dwForceStyle)
02490             pT-&gt;ModifyStyle(0, dwForceStyle);
02491 
02492         <font class="comment">// Cleanup in case of multiple initialization</font>
02493         <font class="comment">// block: first check for the gripper control, destroy it if needed</font>
02494         {
02495             <a class="code" href="classCWindow.html">CWindow</a> wndGripper = pT-&gt;GetDlgItem(<a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>);
02496             <font class="keywordflow">if</font>(wndGripper.IsWindow() &amp;&amp; m_arrData.GetSize() &gt; 0 &amp;&amp; (m_arrData[0].m_dwResizeFlags &amp; _DLSZ_GRIPPER) != 0)
02497                 wndGripper.DestroyWindow();
02498         }
02499         <font class="comment">// clear out everything else</font>
02500         m_arrData.RemoveAll();
02501         m_sizeDialog.cx = 0;
02502         m_sizeDialog.cy = 0;
02503         m_ptMinTrackSize.x = -1;
02504         m_ptMinTrackSize.y = -1;
02505 
02506         <font class="comment">// Get initial dialog client size</font>
02507         RECT rectDlg;
02508         pT-&gt;GetClientRect(&amp;rectDlg);
02509         m_sizeDialog.cx = rectDlg.right;
02510         m_sizeDialog.cy = rectDlg.bottom;
02511 
02512         <font class="comment">// Create gripper if requested</font>
02513         m_bGripper = <font class="keyword">false</font>;
02514         <font class="keywordflow">if</font>(bAddGripper)
02515         {
02516             <font class="comment">// shouldn't exist already</font>
02517             ATLASSERT(!::IsWindow(pT-&gt;GetDlgItem(<a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>)));
02518             <font class="keywordflow">if</font>(!::IsWindow(pT-&gt;GetDlgItem(<a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>)))
02519             {
02520                 <a class="code" href="classCWindow.html">CWindow</a> wndGripper;
02521                 wndGripper.Create(_T(<font class="stringliteral">"SCROLLBAR"</font>), pT-&gt;m_hWnd, rectDlg, NULL, WS_CHILD | WS_VISIBLE | WS_CLIPSIBLINGS | SBS_SIZEBOX | SBS_SIZEGRIP | SBS_SIZEBOXBOTTOMRIGHTALIGN, 0, <a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>);
02522                 ATLASSERT(wndGripper.IsWindow());
02523                 <font class="keywordflow">if</font>(wndGripper.IsWindow())
02524                 {
02525                     m_bGripper = <font class="keyword">true</font>;
02526                     RECT rectCtl;
02527                     wndGripper.GetWindowRect(&amp;rectCtl);
02528                     ::MapWindowPoints(NULL, pT-&gt;m_hWnd, (LPPOINT)&amp;rectCtl, 2);
02529                     _AtlDlgResizeData data = { <a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>, DLSZ_MOVE_X | DLSZ_MOVE_Y | DLSZ_REPAINT | _DLSZ_GRIPPER, { rectCtl.left, rectCtl.top, rectCtl.right, rectCtl.bottom } };
02530                     m_arrData.Add(data);
02531                 }
02532             }
02533         }
02534 
02535         <font class="comment">// Get min track position if requested</font>
02536         <font class="keywordflow">if</font>(bUseMinTrackSize)
02537         {
02538             RECT rect;
02539             pT-&gt;GetWindowRect(&amp;rect);
02540             m_ptMinTrackSize.x = rect.right - rect.left;
02541             m_ptMinTrackSize.y = rect.bottom - rect.top;
02542         }
02543 
02544         <font class="comment">// Walk the map and initialize data</font>
02545         <font class="keyword">const</font> _AtlDlgResizeMap* pMap = pT-&gt;GetDlgResizeMap();
02546         ATLASSERT(pMap != NULL);
02547         <font class="keywordtype">int</font> nGroupStart = -1;
02548         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> nCount = 1; !(pMap-&gt;m_nCtlID == -1 &amp;&amp; pMap-&gt;m_dwResizeFlags == 0); nCount++, pMap++)
02549         {
02550             <font class="keywordflow">if</font>(pMap-&gt;m_nCtlID == -1)
02551             {
02552                 <font class="keywordflow">switch</font>(pMap-&gt;m_dwResizeFlags)
02553                 {
02554                 <font class="keywordflow">case</font> _DLSZ_BEGIN_GROUP:
02555                     ATLASSERT(nGroupStart == -1);
02556                     nGroupStart = m_arrData.GetSize();
02557                     <font class="keywordflow">break</font>;
02558                 <font class="keywordflow">case</font> _DLSZ_END_GROUP:
02559                     {
02560                         ATLASSERT(nGroupStart != -1);
02561                         <font class="keywordtype">int</font> nGroupCount = m_arrData.GetSize() - nGroupStart;
02562                         m_arrData[nGroupStart].SetGroupCount(nGroupCount);
02563                         nGroupStart = -1;
02564                     }
02565                     <font class="keywordflow">break</font>;
02566                 <font class="keywordflow">default</font>:
02567                     ATLASSERT(FALSE &amp;&amp; _T(<font class="stringliteral">"Invalid DLGRESIZE Map Entry"</font>));
02568                     <font class="keywordflow">break</font>;
02569                 }
02570             }
02571             <font class="keywordflow">else</font>
02572             {
02573                 <font class="comment">// this ID conflicts with the default gripper one</font>
02574                 ATLASSERT(m_bGripper ? (pMap-&gt;m_nCtlID != <a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>) : TRUE);
02575 
02576                 <a class="code" href="classCWindow.html">CWindow</a> ctl = pT-&gt;GetDlgItem(pMap-&gt;m_nCtlID);
02577                 ATLASSERT(ctl.IsWindow());
02578                 RECT rectCtl;
02579                 ctl.GetWindowRect(&amp;rectCtl);
02580                 ::MapWindowPoints(NULL, pT-&gt;m_hWnd, (LPPOINT)&amp;rectCtl, 2);
02581 
02582                 DWORD dwGroupFlag = (nGroupStart != -1 &amp;&amp; m_arrData.GetSize() == nGroupStart) ? _DLSZ_BEGIN_GROUP : 0;
02583                 _AtlDlgResizeData data = { pMap-&gt;m_nCtlID, pMap-&gt;m_dwResizeFlags | dwGroupFlag, { rectCtl.left, rectCtl.top, rectCtl.right, rectCtl.bottom } };
<a name="l02584"></a><a class="code" href="classWTL_1_1CDialogResize.html#a2">02584</a>                 m_arrData.Add(data);
02585             }
02586         }
02587         ATLASSERT((nGroupStart == -1) &amp;&amp; _T(<font class="stringliteral">"No End Group Entry in the DLGRESIZE Map"</font>));
02588     }
02589 
02590     <font class="keywordtype">void</font> DlgResize_UpdateLayout(<font class="keywordtype">int</font> cxWidth, <font class="keywordtype">int</font> cyHeight)
02591     {
02592         T* pT = static_cast&lt;T*&gt;(this);
02593         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
02594         pT-&gt;SetRedraw(FALSE);
02595         RECT rectGroup = { 0, 0, 0, 0 };
02596         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i = 0; i &lt; m_arrData.GetSize(); i++)
02597         {
02598             <font class="keywordflow">if</font>((m_arrData[i].m_dwResizeFlags &amp; _DLSZ_BEGIN_GROUP) != 0) <font class="comment">// start of a group</font>
02599             {
02600                 <font class="keywordtype">int</font> nGroupCount = m_arrData[i].GetGroupCount();
02601                 ATLASSERT(nGroupCount &gt; 0 &amp;&amp; i + nGroupCount - 1 &lt; m_arrData.GetSize());
02602                 rectGroup = m_arrData[i].m_rect;
02603                 <font class="keywordtype">int</font> j;
02604                 <font class="keywordflow">for</font>(j = 1; j &lt; nGroupCount; j++)
02605                 {
02606                     rectGroup.left = min(rectGroup.left, m_arrData[i + j].m_rect.left);
02607                     rectGroup.top = min(rectGroup.top, m_arrData[i + j].m_rect.top);
02608                     rectGroup.right = max(rectGroup.right, m_arrData[i + j].m_rect.right);
02609                     rectGroup.bottom = max(rectGroup.bottom, m_arrData[i + j].m_rect.bottom);
02610                 }
02611                 RECT rcThis;
02612                 RECT rcNext;
02613                 <font class="keywordflow">for</font>(j = 0; j &lt; nGroupCount; j++)
02614                 {
02615                     <font class="keywordtype">int</font> xyStartNext = -1;
02616                     <font class="keywordflow">if</font>((j &lt; (nGroupCount - 1)) &amp;&amp; ((m_arrData[i + j].m_dwResizeFlags &amp; (DLSZ_SIZE_X | DLSZ_SIZE_Y)) != 0) &amp;&amp; ((m_arrData[i + j + 1].m_dwResizeFlags &amp; (DLSZ_SIZE_X | DLSZ_SIZE_Y)) != 0))
02617                     {
02618                         <a class="code" href="classCWindow.html">CWindow</a> ctlThis = pT-&gt;GetDlgItem(m_arrData[i + j].m_nCtlID);
02619                         ctlThis.GetWindowRect(&amp;rcThis);
02620                         ::MapWindowPoints(NULL, pT-&gt;m_hWnd, (LPPOINT)&amp;rcThis, 2);
02621                         <a class="code" href="classCWindow.html">CWindow</a> ctlNext = pT-&gt;GetDlgItem(m_arrData[i + j + 1].m_nCtlID);
02622                         ctlNext.GetWindowRect(&amp;rcNext);
02623                         ::MapWindowPoints(NULL, pT-&gt;m_hWnd, (LPPOINT)&amp;rcNext, 2);
02624                         <font class="keywordflow">if</font>((m_arrData[i + j].m_dwResizeFlags &amp; DLSZ_SIZE_X) == DLSZ_SIZE_X &amp;&amp; (m_arrData[i + j + 1].m_dwResizeFlags &amp; DLSZ_SIZE_X) == DLSZ_SIZE_X)
02625                         {
02626                             <font class="keywordflow">if</font>(rcNext.left &gt;= rcThis.right)
02627                                 xyStartNext = m_arrData[i + j + 1].m_rect.left;
02628                         }
02629                         <font class="keywordflow">else</font> <font class="keywordflow">if</font>((m_arrData[i + j].m_dwResizeFlags &amp; DLSZ_SIZE_Y) == DLSZ_SIZE_Y &amp;&amp; (m_arrData[i + j + 1].m_dwResizeFlags &amp; DLSZ_SIZE_Y) == DLSZ_SIZE_Y)
02630                         {
02631                             <font class="keywordflow">if</font>(rcNext.top &gt;= rcThis.bottom)
02632                                 xyStartNext = m_arrData[i + j + 1].m_rect.top;
02633                         }
02634                     }
02635                     pT-&gt;DlgResize_PositionControl(cxWidth, cyHeight, rectGroup, m_arrData[i + j], <font class="keyword">true</font>, xyStartNext);
02636                 }
02637                 <font class="comment">// increment to skip all group controls</font>
02638                 i += nGroupCount - 1;
02639             }
02640             <font class="keywordflow">else</font>        <font class="comment">// one control entry</font>
02641             {
02642                 pT-&gt;DlgResize_PositionControl(cxWidth, cyHeight, rectGroup, m_arrData[i], <font class="keyword">false</font>);
02643             }
02644         }
02645         pT-&gt;SetRedraw(TRUE);
02646         pT-&gt;RedrawWindow(NULL, NULL, RDW_ERASE | RDW_INVALIDATE | RDW_UPDATENOW | RDW_ALLCHILDREN);
02647     }
02648 
<a name="l02649"></a><a class="code" href="classWTL_1_1CDialogResize.html#a3">02649</a> <font class="comment">// Message map and handlers</font>
02650     BEGIN_MSG_MAP(<a class="code" href="classWTL_1_1CDialogResize.html">CDialogResize</a>)
02651         MESSAGE_HANDLER(WM_SIZE, OnSize)
02652         MESSAGE_HANDLER(WM_GETMINMAXINFO, OnGetMinMaxInfo)
02653     END_MSG_MAP()
02654 
02655     LRESULT OnSize(UINT <font class="comment">/*uMsg*/</font>, WPARAM wParam, LPARAM lParam, BOOL&amp; <font class="comment">/*bHandled*/</font>)
02656     {
02657         T* pT = static_cast&lt;T*&gt;(this);
02658         <font class="keywordflow">if</font>(m_bGripper)
02659         {
02660             <a class="code" href="classCWindow.html">CWindow</a> wndGripper = pT-&gt;GetDlgItem(<a class="code" href="atlres_8h.html#a5">ATL_IDW_STATUS_BAR</a>);
02661             <font class="keywordflow">if</font>(wParam == SIZE_MAXIMIZED)
02662                 wndGripper.ShowWindow(SW_HIDE);
02663             <font class="keywordflow">else</font> <font class="keywordflow">if</font>(wParam == SIZE_RESTORED)
02664                 wndGripper.ShowWindow(SW_SHOW);
02665         }
02666         <font class="keywordflow">if</font>(wParam != SIZE_MINIMIZED)
02667         {
<a name="l02668"></a><a class="code" href="classWTL_1_1CDialogResize.html#a4">02668</a>             ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
02669             pT-&gt;DlgResize_UpdateLayout(<a class="code" href="atlapp_8h.html#a28">GET_X_LPARAM</a>(lParam), <a class="code" href="atlapp_8h.html#a29">GET_Y_LPARAM</a>(lParam));
02670         }
02671         <font class="keywordflow">return</font> 0;
02672     }
02673 
02674     LRESULT OnGetMinMaxInfo(UINT <font class="comment">/*uMsg*/</font>, WPARAM <font class="comment">/*wParam*/</font>, LPARAM lParam, BOOL&amp; <font class="comment">/*bHandled*/</font>)
02675     {
02676         <font class="keywordflow">if</font>(m_ptMinTrackSize.x != -1 &amp;&amp; m_ptMinTrackSize.y != -1)
02677         {
02678             LPMINMAXINFO lpMMI = (LPMINMAXINFO)lParam;
<a name="l02679"></a><a class="code" href="classWTL_1_1CDialogResize.html#a5">02679</a>             lpMMI-&gt;ptMinTrackSize =  m_ptMinTrackSize;
02680         }
02681         <font class="keywordflow">return</font> 0;
02682     }
02683 
02684 <font class="comment">// Implementation</font>
02685     <font class="keywordtype">bool</font> DlgResize_PositionControl(<font class="keywordtype">int</font> cxWidth, <font class="keywordtype">int</font> cyHeight, RECT&amp; rectGroup, _AtlDlgResizeData&amp; data, <font class="keywordtype">bool</font> bGroup, <font class="keywordtype">int</font> xyStartNext = -1)
02686     {
02687         T* pT = static_cast&lt;T*&gt;(this);
02688         ATLASSERT(::IsWindow(pT-&gt;m_hWnd));
02689         <a class="code" href="classCWindow.html">CWindow</a> ctl;
02690         RECT rectCtl;
02691 
02692         ctl = pT-&gt;GetDlgItem(data.m_nCtlID);
02693         <font class="keywordflow">if</font>(!ctl.GetWindowRect(&amp;rectCtl))
02694             <font class="keywordflow">return</font> <font class="keyword">false</font>;
02695         <font class="keywordflow">if</font>(::MapWindowPoints(NULL, pT-&gt;m_hWnd, (LPPOINT)&amp;rectCtl, 2) == 0)
02696             <font class="keywordflow">return</font> <font class="keyword">false</font>;
02697 
02698         <font class="keywordflow">if</font>(bGroup)
02699         {
02700             <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; (DLSZ_SIZE_X | DLSZ_MOVE_X)) != 0)
02701             {
02702                 rectCtl.left = rectGroup.left + ::MulDiv(data.m_rect.left - rectGroup.left, rectGroup.right - rectGroup.left + (cxWidth - m_sizeDialog.cx), rectGroup.right - rectGroup.left);
02703 
02704                 <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; DLSZ_SIZE_X) != 0)
02705                 {
02706                     <font class="keywordflow">if</font>(xyStartNext != -1)
02707                         rectCtl.right = rectGroup.left + ::MulDiv(xyStartNext - rectGroup.left, rectGroup.right - rectGroup.left + (cxWidth - m_sizeDialog.cx), rectGroup.right - rectGroup.left) - (xyStartNext - data.m_rect.right);
02708                     <font class="keywordflow">else</font>
02709                         rectCtl.right = rectGroup.left + ::MulDiv(data.m_rect.right - rectGroup.left, rectGroup.right - rectGroup.left + (cxWidth - m_sizeDialog.cx), rectGroup.right - rectGroup.left);
02710                 }
02711                 <font class="keywordflow">else</font>
02712                 {
02713                     rectCtl.right = rectCtl.left + (data.m_rect.right - data.m_rect.left);
02714                 }
02715             }
02716 
02717             <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; (DLSZ_SIZE_Y | DLSZ_MOVE_Y)) != 0)
02718             {
02719                 rectCtl.top = rectGroup.top + ::MulDiv(data.m_rect.top - rectGroup.top, rectGroup.bottom - rectGroup.top + (cyHeight - m_sizeDialog.cy), rectGroup.bottom - rectGroup.top);
02720 
02721                 <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; DLSZ_SIZE_Y) != 0)
02722                 {
02723                     <font class="keywordflow">if</font>(xyStartNext != -1)
02724                         rectCtl.bottom = rectGroup.top + ::MulDiv(xyStartNext - rectGroup.top, rectGroup.bottom - rectGroup.top + (cyHeight - m_sizeDialog.cy), rectGroup.bottom - rectGroup.top)  - (xyStartNext - data.m_rect.bottom);
02725                     <font class="keywordflow">else</font>
02726                         rectCtl.bottom = rectGroup.top + ::MulDiv(data.m_rect.bottom - rectGroup.top, rectGroup.bottom - rectGroup.top + (cyHeight - m_sizeDialog.cy), rectGroup.bottom - rectGroup.top);
02727                 }
02728                 <font class="keywordflow">else</font>
02729                 {
02730                     rectCtl.bottom = rectCtl.top + (data.m_rect.bottom - data.m_rect.top);
02731                 }
02732             }
02733         }
02734         <font class="keywordflow">else</font>
02735         {
02736             <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; (DLSZ_SIZE_X | DLSZ_MOVE_X)) != 0)
02737             {
02738                 rectCtl.right = data.m_rect.right + (cxWidth - m_sizeDialog.cx);
02739 
02740                 <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; DLSZ_MOVE_X) != 0)
02741                     rectCtl.left = rectCtl.right - (data.m_rect.right - data.m_rect.left);
02742             }
02743 
02744             <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; (DLSZ_SIZE_Y | DLSZ_MOVE_Y)) != 0)
02745             {
02746                 rectCtl.bottom = data.m_rect.bottom + (cyHeight - m_sizeDialog.cy);
02747 
02748                 <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; DLSZ_MOVE_Y) != 0)
02749                     rectCtl.top = rectCtl.bottom - (data.m_rect.bottom - data.m_rect.top);
02750             }
02751         }
02752 
02753         <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; DLSZ_REPAINT) != 0)
02754             ctl.Invalidate();
02755 
02756         <font class="keywordflow">if</font>((data.m_dwResizeFlags &amp; (DLSZ_SIZE_X | DLSZ_SIZE_Y | DLSZ_MOVE_X | DLSZ_MOVE_Y | DLSZ_REPAINT)) != 0)
02757             ctl.SetWindowPos(NULL, &amp;rectCtl, SWP_NOZORDER | SWP_NOACTIVATE);
02758 
02759         <font class="keywordflow">return</font> <font class="keyword">true</font>;
02760     }
02761 };
02762 
02763 
02764 <font class="comment">// command bar support</font>
02765 <font class="preprocessor">#ifndef __ATLCTRLW_H__</font>
02766 <font class="preprocessor"></font><font class="preprocessor">#undef CBRM_GETMENU</font>
02767 <font class="preprocessor"></font><font class="preprocessor">#undef CBRM_TRACKPOPUPMENU</font>
02768 <font class="preprocessor"></font><font class="preprocessor">#undef CBRM_GETCMDBAR</font>
02769 <font class="preprocessor"></font><font class="preprocessor">#undef CBRPOPUPMENU</font>
02770 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
02771 <font class="preprocessor"></font>
02772 <font class="preprocessor"></font>}; <font class="comment">//namespace WTL</font>
02773 
02774 <font class="preprocessor">#endif // __ATLFRAME_H__</font>
</pre></div><hr><address align="right"><small>Generated on Thu Apr 11 21:09:31 2002 for wtl-doc by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
