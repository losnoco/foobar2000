<?

			$ID3v2ShortFrameNameLookup = array();

//			$ID3v2ShortFrameNameLookup[3]['audio_encryption']                                 = 'AENC';
//			$ID3v2ShortFrameNameLookup[3]['attached_picture']                                 = 'APIC';
			$ID3v2ShortFrameNameLookup[3]['comment']                                          = 'COMM';
//			$ID3v2ShortFrameNameLookup[3]['commercial']                                       = 'COMR';
//			$ID3v2ShortFrameNameLookup[3]['encryption_method_registration']                   = 'ENCR';
//			$ID3v2ShortFrameNameLookup[3]['event_timing_codes']                               = 'ETCO';
//			$ID3v2ShortFrameNameLookup[3]['general_encapsulated_object']                      = 'GEOB';
//			$ID3v2ShortFrameNameLookup[3]['group_identification_registration']                = 'GRID';
//			$ID3v2ShortFrameNameLookup[3]['linked_information']                               = 'LINK';
//			$ID3v2ShortFrameNameLookup[3]['music_cd_identifier']                              = 'MCDI';
//			$ID3v2ShortFrameNameLookup[3]['mpeg_location_lookup_table']                       = 'MLLT';
//			$ID3v2ShortFrameNameLookup[3]['ownership']                                        = 'OWNE';
//			$ID3v2ShortFrameNameLookup[3]['play_counter']                                     = 'PCNT';
//			$ID3v2ShortFrameNameLookup[3]['popularimeter']                                    = 'POPM';
//			$ID3v2ShortFrameNameLookup[3]['position_synchronisation']                         = 'POSS';
//			$ID3v2ShortFrameNameLookup[3]['private']                                          = 'PRIV';
//			$ID3v2ShortFrameNameLookup[3]['recommended_buffer_size']                          = 'RBUF';
//			$ID3v2ShortFrameNameLookup[3]['reverb']                                           = 'RVRB';
//			$ID3v2ShortFrameNameLookup[3]['synchronised_lyrics']                              = 'SYLT';
//			$ID3v2ShortFrameNameLookup[3]['synchronised_tempo_codes']                         = 'SYTC';
			$ID3v2ShortFrameNameLookup[3]['album']                                            = 'TALB';
			$ID3v2ShortFrameNameLookup[3]['beats_per_minute']                                 = 'TBPM';
			$ID3v2ShortFrameNameLookup[3]['composer']                                         = 'TCOM';
			$ID3v2ShortFrameNameLookup[3]['genre']                                            = 'TCON';
			$ID3v2ShortFrameNameLookup[3]['copyright']                                        = 'TCOP';
			$ID3v2ShortFrameNameLookup[3]['playlist_delay']                                   = 'TDLY';
			$ID3v2ShortFrameNameLookup[3]['encoded_by']                                       = 'TENC';
			$ID3v2ShortFrameNameLookup[3]['lyricist']                                         = 'TEXT';
			$ID3v2ShortFrameNameLookup[3]['file_type']                                        = 'TFLT';
			$ID3v2ShortFrameNameLookup[3]['content_group_description']                        = 'TIT1';
			$ID3v2ShortFrameNameLookup[3]['title']                                            = 'TIT2';
			$ID3v2ShortFrameNameLookup[3]['subtitle']                                         = 'TIT3';
			$ID3v2ShortFrameNameLookup[3]['initial_key']                                      = 'TKEY';
			$ID3v2ShortFrameNameLookup[3]['language']                                         = 'TLAN';
			$ID3v2ShortFrameNameLookup[3]['length']                                           = 'TLEN';
			$ID3v2ShortFrameNameLookup[3]['media_type']                                       = 'TMED';
			$ID3v2ShortFrameNameLookup[3]['original_album_title']                             = 'TOAL';
			$ID3v2ShortFrameNameLookup[3]['original_filename']                                = 'TOFN';
			$ID3v2ShortFrameNameLookup[3]['original_lyricist']                                = 'TOLY';
			$ID3v2ShortFrameNameLookup[3]['original_artist']                                  = 'TOPE';
			$ID3v2ShortFrameNameLookup[3]['file_owner']                                       = 'TOWN';
			$ID3v2ShortFrameNameLookup[3]['artist']                                           = 'TPE1';
			$ID3v2ShortFrameNameLookup[3]['band']                                             = 'TPE2';
			$ID3v2ShortFrameNameLookup[3]['conductor']                                        = 'TPE3';
			$ID3v2ShortFrameNameLookup[3]['remixer']                                          = 'TPE4';
			$ID3v2ShortFrameNameLookup[3]['part_of_set']                                      = 'TPOS';
			$ID3v2ShortFrameNameLookup[3]['publisher']                                        = 'TPUB';
			$ID3v2ShortFrameNameLookup[3]['tracknumber']                                      = 'TRCK';
			$ID3v2ShortFrameNameLookup[3]['internet_radio_station_name']                      = 'TRSN';
			$ID3v2ShortFrameNameLookup[3]['internet_radio_station_owner']                     = 'TRSO';
			$ID3v2ShortFrameNameLookup[3]['isrc']                                             = 'TSRC';
			$ID3v2ShortFrameNameLookup[3]['encoder_settings']                                 = 'TSSE';
			$ID3v2ShortFrameNameLookup[3]['user_text']                                        = 'TXXX';
			$ID3v2ShortFrameNameLookup[3]['unique_file_identifier']                           = 'UFID';
//			$ID3v2ShortFrameNameLookup[3]['terms_of_use']                                     = 'USER';
//			$ID3v2ShortFrameNameLookup[3]['unsynchronised_lyrics']                            = 'USLT';
			$ID3v2ShortFrameNameLookup[3]['commercial']                                       = 'WCOM';
			$ID3v2ShortFrameNameLookup[3]['copyright_information']                            = 'WCOP';
			$ID3v2ShortFrameNameLookup[3]['url_file']                                         = 'WOAF';
			$ID3v2ShortFrameNameLookup[3]['url_artist']                                       = 'WOAR';
			$ID3v2ShortFrameNameLookup[3]['url_source']                                       = 'WOAS';
			$ID3v2ShortFrameNameLookup[3]['url_station']                                      = 'WORS';
			$ID3v2ShortFrameNameLookup[3]['payment']                                          = 'WPAY';
			$ID3v2ShortFrameNameLookup[3]['url_publisher']                                    = 'WPUB';
			$ID3v2ShortFrameNameLookup[3]['url_user']                                         = 'WXXX';

			$ID3v2ShortFrameNameLookup[4] = $ID3v2ShortFrameNameLookup[3];

//			$ID3v2ShortFrameNameLookup[4]['audio_seek_point_index']                           = 'ASPI';
//			$ID3v2ShortFrameNameLookup[4]['equalisation']                                     = 'EQU2';
//			$ID3v2ShortFrameNameLookup[4]['relative_volume_adjustment']                       = 'RVA2';
//			$ID3v2ShortFrameNameLookup[4]['seek']                                             = 'SEEK';
//			$ID3v2ShortFrameNameLookup[4]['signature']                                        = 'SIGN';
			$ID3v2ShortFrameNameLookup[4]['encoding_time']                                    = 'TDEN';
			$ID3v2ShortFrameNameLookup[4]['original_release_time']                            = 'TDOR';
			$ID3v2ShortFrameNameLookup[4]['recording_time']                                   = 'TDRC';
			$ID3v2ShortFrameNameLookup[4]['release_time']                                     = 'TDRL';
			$ID3v2ShortFrameNameLookup[4]['tagging_time']                                     = 'TDTG';
			$ID3v2ShortFrameNameLookup[4]['involved_people_list']                             = 'TIPL';
			$ID3v2ShortFrameNameLookup[4]['musician_credits_list']                            = 'TMCL';
			$ID3v2ShortFrameNameLookup[4]['mood']                                             = 'TMOO';
			$ID3v2ShortFrameNameLookup[4]['produced_notice']                                  = 'TPRO';
			$ID3v2ShortFrameNameLookup[4]['album_sort_order']                                 = 'TSOA';
			$ID3v2ShortFrameNameLookup[4]['performer_sort_order']                             = 'TSOP';
			$ID3v2ShortFrameNameLookup[4]['title_sort_order']                                 = 'TSOT';
			$ID3v2ShortFrameNameLookup[4]['set_subtitle']                                     = 'TSST';

$ds = array(
	0 => array("pipe", "r"),
	1 => array("pipe", "w"),
	2 => array("file", "errors.log", "a")
);

$process = proc_open("gperf -tCcTonD -K short_name -N read_lookup -s -3 -k *", $ds, $pipes);

if (is_resource($process))
{
	fwrite($pipes[0], "%{\n\n#include \"lookup.h\"\n\n");

	fwrite($pipes[0], "#include <string.h>\n\n");

	fwrite($pipes[0], "#define RV(t) t##_validate, t##_process\n");
	fwrite($pipes[0], "#define RN(t)            0, t##_process\n");

	fwrite($pipes[0], "%}\n");

	fwrite($pipes[0], "struct t_read_lookup;\n%%\n");

	foreach ($ID3v2ShortFrameNameLookup[4] as $long => $short)
	{
		fwrite($pipes[0], $short . ', "' . $long . '", ');
		switch($short{0})
		{
		case 'T':
			fwrite($pipes[0], 'RV(text');
			if ($short == 'TXXX')
				fwrite($pipes[0], 'x');
			fwrite($pipes[0], ')');
			break;
		case 'W':
			fwrite($pipes[0], 'RV(url');
			if ($short == 'WXXX')
				fwrite($pipes[0], 'x');
			fwrite($pipes[0], ')');
			break;
		default:
			fwrite($pipes[0], 'RV(');
			switch($short)
			{
			case 'COMM':
				fwrite($pipes[0], 'comment');
				break;
			case 'UFID':
				fwrite($pipes[0], 'uniqueid');
				break;
			case 'USLT':
				fwrite($pipes[0], 'unsyncedlyrics');
				break;
			}
			fwrite($pipes[0], ')');
		}
		fwrite($pipes[0], "\n");
	}

	fclose($pipes[0]);

	$text = '';
	while (!feof($pipes[1]))
	{
		$text .= fgets($pipes[1], 1024);
	}

	fclose($pipes[1]);

	$rval = proc_close($process);

	if ($rval == 0)
	{
		file_put_contents('lookup_r.c', $text);
	}
	else
	{
		die("Check errors.log\n");
	}
}


$process = proc_open("gperf -tCcTonD -K long_name -N write_lookup -s -3 -k *", $ds, $pipes);

if (is_resource($process))
{
	fwrite($pipes[0], "%{\n\n#include \"lookup.h\"\n\n");

	fwrite($pipes[0], "#include <string.h>\n\n");

	fwrite($pipes[0], "#define WV(t) t##_validate, t##_render\n");
	fwrite($pipes[0], "#define WN(t)            0, t##_render\n");

	fwrite($pipes[0], "%}\n");

	fwrite($pipes[0], "struct t_write_lookup;\n%%\n");

	foreach ($ID3v2ShortFrameNameLookup[4] as $long => $short)
	{
		fwrite($pipes[0], $long . ', "' . $short . '", ');
		switch($short{0})
		{
		case 'T':
			fwrite($pipes[0], 'WV(text');
			if ($short == 'TXXX')
				fwrite($pipes[0], 'x');
			fwrite($pipes[0], ')');
			break;
		case 'W':
			fwrite($pipes[0], 'WV(url');
			if ($short == 'WXXX')
				fwrite($pipes[0], 'x');
			fwrite($pipes[0], ')');
			break;
		default:
			fwrite($pipes[0], 'WV(');
			switch($short)
			{
			case 'COMM':
				fwrite($pipes[0], 'comment');
				break;
			case 'UFID':
				fwrite($pipes[0], 'uniqueid');
				break;
			case 'USLT':
				fwrite($pipes[0], 'unsyncedlyrics');
				break;
			}
			fwrite($pipes[0], ')');
		}
		fwrite($pipes[0], "\n");
	}

	fclose($pipes[0]);

	$text = '';
	while (!feof($pipes[1]))
	{
		$text .= fgets($pipes[1], 1024);
	}

	fclose($pipes[1]);

	$rval = proc_close($process);

	if ($rval == 0)
	{
		file_put_contents('lookup_w.c', $text);
	}
	else
	{
		die("Check errors.log\n");
	}
}

unlink('errors.log');

?>